<!doctype html>
<!--
  FSA • Premium Kurs (Workbook)
  Kurs: Photovoltaik als Kapitalanlage
  Modul 08: Szenarien und Stresstest

  GitHub-Pfad: lp-anfang/pages/photovoltaik-als-kapitalanlage/module-08.html
  Commit-Message: photovoltaik-als-kapitalanlage – Modul 08 (Szenarien & Stresstest) Premium: Szenario-Auswahl, Stress-Tool, Wow-Chart, Glossar, Checkliste, Print, LocalStorage (DE/EN)
  Testlink (nocache): https://adler-fsa.github.io/lp-anfang/pages/photovoltaik-als-kapitalanlage/module-08.html?nocache=__TS__
-->
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modul 08 – Szenarien & Stresstest • Photovoltaik als Kapitalanlage</title>
  <meta name="description" content="Modul 08 (DE/EN): Szenarien und Stresstest – wie Annahmen kippen können. Premium Workbook mit Auswahlfeldern, Stress-Tool, Wow-Chart, Glossar, Print und LocalStorage." />
  <meta name="robots" content="index,follow" />

  <style>
    :root{
      --bg:#ffffff;
      --ink:#0f1114;
      --muted:#47505f;

      --line: rgba(15,17,20,.12);
      --line2: rgba(15,17,20,.18);

      --gold:#c8a63a;
      --gold2:#e0c466;

      --accent:#0b7d5c;
      --accent2:#1aa57a;

      --danger:#c52646;
      --dangerSoft: rgba(197,38,70,.12);

      --shadow: 0 14px 34px rgba(0,0,0,.10);
      --shadow2: 0 26px 70px rgba(0,0,0,.12);

      --radius:18px;
      --max: 1140px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 720px at 10% 8%, rgba(200,166,58,.18), transparent 58%),
        radial-gradient(1050px 720px at 88% 14%, rgba(11,125,92,.14), transparent 58%),
        radial-gradient(920px 640px at 52% 96%, rgba(197,38,70,.10), transparent 60%),
        linear-gradient(180deg, #ffffff 0%, #fbfbfc 45%, #ffffff 100%);
      overflow-x:hidden;
    }

    .spark{
      position:fixed;
      inset:-30vh -30vw auto -30vw;
      height:60vh;
      pointer-events:none;
      z-index:0;
      filter: blur(18px);
      opacity:.55;
      background:
        radial-gradient(closest-side at 18% 35%, rgba(200,166,58,.30), transparent 65%),
        radial-gradient(closest-side at 68% 28%, rgba(11,125,92,.24), transparent 65%),
        radial-gradient(closest-side at 48% 85%, rgba(197,38,70,.16), transparent 70%);
      transform: translate3d(0,0,0);
      animation: floaty 10s ease-in-out infinite;
    }
    @keyframes floaty{
      0%{ transform: translate3d(0px, 0px, 0px) scale(1); }
      50%{ transform: translate3d(12px, 10px, 0px) scale(1.02); }
      100%{ transform: translate3d(0px, 0px, 0px) scale(1); }
    }
    @media (prefers-reduced-motion: reduce){
      .spark{ animation:none; }
      .shine:before{ animation:none !important; }
    }

    .wrap{
      position:relative;
      z-index:1;
      max-width:var(--max);
      margin:0 auto;
      padding: 22px 18px 84px;
    }

    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      padding: 10px 12px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.78));
      border-radius: 999px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .brand:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(520px 180px at 12% 30%, rgba(200,166,58,.16), transparent 64%),
        radial-gradient(520px 180px at 84% 20%, rgba(11,125,92,.12), transparent 64%);
      pointer-events:none;
    }
    .brand > *{ position:relative; }
    .brand svg{ width:22px; height:22px; flex:0 0 auto; }
    .brand .t1{ font-weight:1000; letter-spacing:.2px; line-height:1.1; }
    .brand .t2{ font-size:12px; color:var(--muted); margin-top:2px; line-height:1.1; }

    .premiumTag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top:6px;
      font-size:11px;
      font-weight:1000;
      letter-spacing:.35px;
      padding: 4px 8px;
      border-radius: 999px;
      border:1px solid rgba(200,166,58,.35);
      background: rgba(200,166,58,.10);
      color: rgba(15,17,20,.86);
      width: fit-content;
    }
    .premiumTag .dot{
      width:8px; height:8px; border-radius:50%;
      background: linear-gradient(180deg, var(--gold2), var(--gold));
      box-shadow: 0 0 10px rgba(200,166,58,.35);
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }

    .lang{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.72));
      border-radius: 12px;
      box-shadow: var(--shadow);
    }
    .lang label{
      font-size:12px;
      color:var(--muted);
      font-weight:900;
    }
    .lang select{
      background: rgba(255,255,255,.92);
      border:1px solid rgba(15,17,20,.18);
      color: var(--ink);
      border-radius:10px;
      padding:8px 10px;
      font-weight:1000;
      outline:none;
    }

    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.76));
      color:var(--ink);
      padding:10px 12px;
      border-radius: 12px;
      font-weight:1000;
      cursor:pointer;
      box-shadow: var(--shadow);
      display:inline-flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      user-select:none;
      transition: transform .10s ease, border-color .14s ease, box-shadow .14s ease;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(200,166,58,.45); box-shadow: var(--shadow2); }
    .btn:active{ transform: translateY(0px); }
    .btn .dot{
      width:10px; height:10px; border-radius:50%;
      background: linear-gradient(180deg, var(--gold2), var(--gold));
      box-shadow: 0 0 12px rgba(200,166,58,.45);
    }
    .btn.secondary .dot{
      background: linear-gradient(180deg, var(--accent2), var(--accent));
      box-shadow: 0 0 12px rgba(11,125,92,.38);
    }
    .btn.danger .dot{
      background: linear-gradient(180deg, rgba(197,38,70,.9), rgba(197,38,70,1));
      box-shadow: 0 0 12px rgba(197,38,70,.30);
    }

    .hero{
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 18px 18px 16px;
      margin-bottom: 14px;
      position:relative;
      overflow:hidden;
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.82));
    }
    .hero:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(840px 280px at 14% 16%, rgba(200,166,58,.20), transparent 65%),
        radial-gradient(740px 260px at 86% 18%, rgba(11,125,92,.14), transparent 65%),
        radial-gradient(720px 260px at 40% 98%, rgba(197,38,70,.10), transparent 70%);
      pointer-events:none;
    }
    .hero:after{
      content:"";
      position:absolute;
      inset:0;
      border-radius: var(--radius);
      pointer-events:none;
      background: linear-gradient(90deg, rgba(200,166,58,.22), transparent 18%, transparent 82%, rgba(200,166,58,.18));
      mix-blend-mode: multiply;
      opacity:.45;
    }
    .hero > *{ position:relative; }

    h1{ margin:0 0 10px; font-size: 28px; letter-spacing:.2px; line-height:1.2; }
    .sub{ margin:0; color: var(--muted); line-height:1.75; font-size:14.8px; max-width: 98ch; }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px 16px 14px;
      margin-top: 12px;
      position:relative;
      overflow:hidden;
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.84));
    }
    .card:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(620px 180px at 16% 8%, rgba(200,166,58,.12), transparent 65%),
        radial-gradient(620px 180px at 84% 12%, rgba(11,125,92,.10), transparent 65%);
      pointer-events:none;
      opacity:.75;
    }
    .card > *{ position:relative; }

    .card h2{ margin:0 0 10px; font-size:16px; letter-spacing:.2px; }
    .card p{ margin:0 0 10px; color: var(--muted); font-size:14.2px; line-height:1.8; }

    .notice{
      border:1px solid rgba(200,166,58,.38);
      background: rgba(200,166,58,.10);
      border-radius: 14px;
      padding: 12px 12px;
      color: rgba(15,17,20,.92);
      line-height:1.75;
      font-size:13.6px;
      margin-top:12px;
      position:relative;
      overflow:hidden;
    }
    .notice:before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(520px 160px at 18% 50%, rgba(200,166,58,.18), transparent 70%);
      pointer-events:none;
    }
    .notice > *{ position:relative; }
    .notice strong{ color: #7a5c00; }

    /* Glossar */
    .glossWrap{ margin-top:10px; }
    details.gloss{
      border:1px solid rgba(15,17,20,.12);
      border-radius: 14px;
      background: rgba(255,255,255,.72);
      box-shadow: 0 10px 22px rgba(0,0,0,.05);
      padding: 10px 12px;
      margin: 10px 0;
      overflow:hidden;
    }
    details.gloss[open]{
      border-color: rgba(11,125,92,.22);
      box-shadow: 0 18px 40px rgba(0,0,0,.08);
    }
    details.gloss summary{
      cursor:pointer;
      list-style:none;
      font-weight:1000;
      color: rgba(15,17,20,.92);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      outline:none;
    }
    details.gloss summary::-webkit-details-marker{ display:none; }
    .glossBadge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:11px;
      font-weight:1000;
      padding: 4px 8px;
      border-radius:999px;
      border:1px solid rgba(200,166,58,.30);
      background: rgba(200,166,58,.10);
      color: rgba(15,17,20,.82);
      flex:0 0 auto;
    }
    .glossBadge .dot{
      width:8px; height:8px; border-radius:50%;
      background: linear-gradient(180deg, var(--gold2), var(--gold));
      box-shadow: 0 0 10px rgba(200,166,58,.28);
    }
    .glossBody{ margin-top:10px; color: var(--muted); line-height:1.8; font-size: 13.8px; }

    /* Auswahl-Felder */
    .form{ display:flex; flex-direction:column; gap:10px; margin-top:10px; }
    .field{
      border:1px solid rgba(15,17,20,.12);
      border-radius: 14px;
      background: rgba(255,255,255,.72);
      box-shadow: 0 10px 22px rgba(0,0,0,.05);
      padding: 12px 12px;
      position:relative;
      overflow:hidden;
    }
    .field:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(520px 160px at 10% 40%, rgba(200,166,58,.08), transparent 70%),
        radial-gradient(520px 160px at 90% 30%, rgba(11,125,92,.06), transparent 70%);
      pointer-events:none;
      opacity:.9;
    }
    .field > *{ position:relative; }
    .field .lbl{
      font-weight:1000;
      font-size:13px;
      margin-bottom:6px;
      color: rgba(15,17,20,.92);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .hint{
      font-weight:900;
      font-size:12px;
      color: rgba(71,80,95,.92);
      background: rgba(11,125,92,.08);
      border:1px solid rgba(11,125,92,.18);
      border-radius: 999px;
      padding: 4px 8px;
    }
    select{
      width:100%;
      border:1px solid rgba(15,17,20,.18);
      border-radius: 12px;
      padding: 10px 10px;
      font: inherit;
      background: rgba(255,255,255,.96);
      color: var(--ink);
      outline:none;
      font-weight:900;
    }
    .help{
      margin-top:8px;
      color: rgba(71,80,95,.92);
      font-size:12.8px;
      line-height:1.65;
    }

    /* KPIs */
    .kpis{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (min-width: 720px){
      .kpis{ grid-template-columns: 1fr 1fr 1fr 1fr; }
    }
    .kpi{
      border:1px solid rgba(15,17,20,.12);
      border-radius: 14px;
      background: rgba(255,255,255,.72);
      box-shadow: 0 12px 26px rgba(0,0,0,.06);
      padding: 12px 12px;
      position:relative;
      overflow:hidden;
      min-height: 82px;
    }
    .kpi:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(520px 160px at 18% 50%, rgba(200,166,58,.10), transparent 70%),
        radial-gradient(520px 160px at 82% 40%, rgba(11,125,92,.08), transparent 70%);
      pointer-events:none;
      opacity:.9;
    }
    .kpi > *{ position:relative; }
    .kpi .t{ font-size:12px; font-weight:1000; color: rgba(71,80,95,.92); }
    .kpi .v{ font-size:18px; font-weight:1100; margin-top:4px; color: rgba(15,17,20,.94); }
    .kpi .s{ font-size:12px; margin-top:2px; color: rgba(71,80,95,.88); line-height:1.35; }

    /* Wow Chart */
    .viz{
      border:1px solid rgba(15,17,20,.12);
      border-radius: 16px;
      background: rgba(255,255,255,.72);
      box-shadow: 0 14px 34px rgba(0,0,0,.08);
      padding: 12px 12px;
      margin-top: 10px;
      overflow:hidden;
      position:relative;
    }
    .viz.shine:before{
      content:"";
      position:absolute;
      inset:-60% -40%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.55), transparent);
      transform: rotate(18deg);
      opacity:.28;
      animation: sheen 6.5s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes sheen{
      0%{ transform: translateX(-30%) rotate(18deg); opacity:.12; }
      50%{ transform: translateX(18%) rotate(18deg); opacity:.32; }
      100%{ transform: translateX(60%) rotate(18deg); opacity:.12; }
    }
    .vizTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .vizTop .title{ font-weight:1100; color: rgba(15,17,20,.94); }
    .vizTop .note{
      font-size:12px;
      font-weight:900;
      color: rgba(71,80,95,.92);
      background: rgba(200,166,58,.10);
      border:1px solid rgba(200,166,58,.22);
      border-radius: 999px;
      padding: 4px 8px;
      width: fit-content;
    }
    .vizFrame{
      border:1px solid rgba(15,17,20,.10);
      border-radius: 16px;
      background: rgba(255,255,255,.92);
      padding: 10px;
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(200,166,58,.06);
    }
    .viz svg{ width:100%; height:auto; display:block; }

    /* Checklist */
    .checks{ display:flex; flex-direction:column; gap:8px; margin-top:10px; }
    .chk{
      display:flex;
      gap:10px;
      align-items:flex-start;
      border:1px solid rgba(15,17,20,.12);
      background: rgba(255,255,255,.72);
      border-radius: 14px;
      padding: 10px 12px;
      box-shadow: 0 10px 22px rgba(0,0,0,.05);
    }
    .chk input{
      width:18px; height:18px;
      margin-top:2px;
      accent-color: var(--accent);
      flex:0 0 auto;
    }
    .chk .t{ font-weight:1000; color: rgba(15,17,20,.92); line-height:1.4; }
    .chk .d{ margin-top:2px; color: rgba(71,80,95,.92); font-size:12.8px; line-height:1.6; }

    .footer{ margin-top: 16px; color: rgba(71,80,95,.85); font-size: 12px; line-height:1.6; text-align:center; }

    @media print{
      body{ background:#fff !important; color:#000 !important; }
      .spark, .topbar, .actions, .lang, .btn, .footer{ display:none !important; }
      .wrap{ max-width: 820px; padding: 0; }
      .hero, .card, .field, .viz, details.gloss, .chk, .kpi{
        box-shadow:none !important;
        background:#fff !important;
        border:1px solid #bbb !important;
        color:#000 !important;
      }
      .sub, .card p, .glossBody, .help, .chk .d, .kpi .s{ color:#111 !important; }
      .notice{ border:1px solid #999 !important; background:#f7f2df !important; color:#000 !important; }
      details.gloss{ break-inside: avoid; }
      .viz.shine:before{ display:none !important; }
      .hint{ border:1px solid #bbb !important; background:#f2f2f2 !important; color:#000 !important; }
    }
  </style>
</head>

<body>
  <div class="spark" aria-hidden="true"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand" aria-label="Kurs">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <linearGradient id="gSunM8" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#c8a63a"/>
              <stop offset="1" stop-color="#e0c466"/>
            </linearGradient>
          </defs>
          <circle cx="12" cy="12" r="5.2" fill="url(#gSunM8)"></circle>
          <g fill="none" stroke="rgba(15,17,20,.75)" stroke-width="1.2" stroke-linecap="round">
            <path d="M12 2.2v2.2M12 19.6v2.2M2.2 12h2.2M19.6 12h2.2"/>
            <path d="M4.6 4.6l1.55 1.55M17.85 17.85l1.55 1.55M19.4 4.6l-1.55 1.55M6.15 17.85L4.6 19.4"/>
          </g>
        </svg>
        <div>
          <div class="t1" data-i18n="brand_title">Premium Kurs</div>
          <div class="t2" data-i18n="brand_sub">Photovoltaik als Kapitalanlage</div>
          <div class="premiumTag" aria-hidden="true">
            <span class="dot"></span>
            <span data-i18n="premium_tag">Modul 08 • Hauptkurs</span>
          </div>
        </div>
      </div>

      <div class="actions">
        <a class="btn" id="toIndex" href="index.html" data-nocache="1" title="Index">
          <span class="dot" aria-hidden="true"></span>
          <span data-i18n="btn_index">Index</span>
        </a>

        <div class="lang" title="Sprache / Language">
          <label for="langSel" data-i18n="lang_label">Sprache</label>
          <select id="langSel" aria-label="Sprache wählen">
            <option value="de">DE</option>
            <option value="en">EN</option>
          </select>
        </div>

        <button class="btn secondary" id="printBtn" type="button" title="Drucken / Print">
          <span class="dot" aria-hidden="true"></span>
          <span data-i18n="btn_print">Drucken</span>
        </button>

        <button class="btn danger" id="resetBtn" type="button" title="Projektakte leeren">
          <span class="dot" aria-hidden="true"></span>
          <span data-i18n="btn_reset">Projektakte leeren</span>
        </button>
      </div>
    </div>

    <div class="hero">
      <h1 data-i18n="h1">Modul 08 – Szenarien und Stresstest</h1>
      <p class="sub" data-i18n="sub">
        Ein seriöses Projekt hält nicht nur im „Best-Case“. Dieses Modul zeigt, wie du Szenarien nutzt:
        Was passiert, wenn Ertrag, Preis oder Kosten schlechter laufen als geplant?
      </p>
    </div>

    <div class="card">
      <h2 data-i18n="sec1_title">1) Warum Stresstests dein wichtigster Betrugsschutz sind</h2>
      <p data-i18n="sec1_p1">
        Viele Angebote wirken stabil, solange nur die beste Annahme gezeigt wird. Ein Stresstest zwingt dazu,
        auch „unangenehme“ Fälle zu betrachten: weniger Sonne, geringere Preise, höhere Kosten oder Ausfälle.
      </p>
      <p data-i18n="sec1_p2">
        Ein Anbieter muss nicht die Zukunft kennen – aber er muss erklären, wie robust die Kalkulation ist,
        und welche Sicherheits-Puffer vorhanden sind.
      </p>

      <div class="notice">
        <strong data-i18n="notice_title">Wichtiger Hinweis:</strong>
        <span data-i18n="notice_text">Keine Anlageberatung, keine Steuer- oder Rechtsberatung. Dieses Modul ist Bildung: Szenario-Denken, Fragen, Orientierung.</span>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="sec2_title">2) Glossar: Szenario-Wörter, die du kennen solltest</h2>

      <div class="glossWrap">
        <details class="gloss">
          <summary>
            <span data-i18n="g1_t">Begriff: Best-Case / Base-Case / Worst-Case</span>
            <span class="glossBadge"><span class="dot" aria-hidden="true"></span><span data-i18n="g_badge">Glossar</span></span>
          </summary>
          <div class="glossBody" data-i18n="g1_b">
            Best-Case ist die beste Annahme, Base-Case die realistische Mitte, Worst-Case ein schlechteres (aber plausibles) Szenario.
            Seriös ist: Base-Case als Basis – und Worst-Case wird transparent gezeigt.
          </div>
        </details>

        <details class="gloss">
          <summary>
            <span data-i18n="g2_t">Begriff: Sensitivität</span>
            <span class="glossBadge"><span class="dot" aria-hidden="true"></span><span data-i18n="g_badge">Glossar</span></span>
          </summary>
          <div class="glossBody" data-i18n="g2_b">
            Sensitivität heißt: Welche Annahme beeinflusst das Ergebnis am stärksten (Preis, Ertrag, Kosten)?
            Genau das musst du im Gespräch herausfinden.
          </div>
        </details>

        <details class="gloss">
          <summary>
            <span data-i18n="g3_t">Begriff: Puffer / Sicherheitsmarge</span>
            <span class="glossBadge"><span class="dot" aria-hidden="true"></span><span data-i18n="g_badge">Glossar</span></span>
          </summary>
          <div class="glossBody" data-i18n="g3_b">
            Puffer sind bewusst eingerechnete Reserven (z. B. niedrigere Preise, höhere Kosten). Je kleiner der Puffer,
            desto anfälliger ist die Rendite.
          </div>
        </details>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="sec3_title">3) Stresstest-Tool (nur Auswahlfelder)</h2>
      <p data-i18n="sec3_p1">
        Wähle aus, wie hart du testen willst. Das Tool rechnet keine echten Euro – es zeigt dir aber,
        ob ein Projekt schon bei kleinen Verschlechterungen „kippt“.
      </p>

      <div class="form">
        <div class="field">
          <div class="lbl">
            <span data-i18n="f1_lbl">Szenario-Stufe</span>
            <span class="hint" data-i18n="hint_scen">Szenario</span>
          </div>
          <select data-save="m08_level">
            <option value="" data-i18n="opt_choose">Bitte wählen…</option>
            <option value="base" data-i18n="f1_o1">Base-Case (realistisch)</option>
            <option value="stress1" data-i18n="f1_o2">Stress 1 (moderate Verschlechterung)</option>
            <option value="stress2" data-i18n="f1_o3">Stress 2 (harte Verschlechterung)</option>
          </select>
          <div class="help" data-i18n="f1_help">Ein seriöses Angebot zeigt mindestens Base-Case + Stress 1.</div>
        </div>

        <div class="field">
          <div class="lbl">
            <span data-i18n="f2_lbl">Preis-Risiko (€/kWh Annahme) wird bewertet als…</span>
            <span class="hint" data-i18n="hint_price">Preis</span>
          </div>
          <select data-save="m08_priceRisk">
            <option value="" data-i18n="opt_choose">Bitte wählen…</option>
            <option value="low" data-i18n="f2_o1">niedrig (konservativ begründet)</option>
            <option value="mid" data-i18n="f2_o2">mittel (plausibel, aber wenig Puffer)</option>
            <option value="high" data-i18n="f2_o3">hoch (optimistisch / unklar)</option>
          </select>
          <div class="help" data-i18n="f2_help">Frage: Was passiert, wenn der Preis länger niedriger bleibt?</div>
        </div>

        <div class="field">
          <div class="lbl">
            <span data-i18n="f3_lbl">Ertrags-Risiko (Sonne/Abregelung/Ausfälle) wird bewertet als…</span>
            <span class="hint" data-i18n="hint_yield">Ertrag</span>
          </div>
          <select data-save="m08_yieldRisk">
            <option value="" data-i18n="opt_choose">Bitte wählen…</option>
            <option value="low" data-i18n="f3_o1">niedrig (gut erklärt + Puffer)</option>
            <option value="mid" data-i18n="f3_o2">mittel (teilweise erklärt)</option>
            <option value="high" data-i18n="f3_o3">hoch (wird schön geredet)</option>
          </select>
          <div class="help" data-i18n="f3_help">Frage: Gibt es historische Daten/Simulation? Wie wird Abregelung behandelt?</div>
        </div>

        <div class="field">
          <div class="lbl">
            <span data-i18n="f4_lbl">Kosten-Risiko (Wartung, Versicherung, Rücklagen) ist…</span>
            <span class="hint" data-i18n="hint_costs">Kosten</span>
          </div>
          <select data-save="m08_costRisk">
            <option value="" data-i18n="opt_choose">Bitte wählen…</option>
            <option value="low" data-i18n="f4_o1">niedrig (vollständig + plausibel)</option>
            <option value="mid" data-i18n="f4_o2">mittel (teilweise)</option>
            <option value="high" data-i18n="f4_o3">hoch (zu knapp / fehlt)</option>
          </select>
          <div class="help" data-i18n="f4_help">Frage: Welche Rücklagen sind eingeplant? Was ist mit Wechselrichter/Ersatzteilen?</div>
        </div>

        <div class="field">
          <div class="lbl">
            <span data-i18n="f5_lbl">Finanzierungs-/Zins-Risiko (falls vorhanden) ist…</span>
            <span class="hint" data-i18n="hint_fin">Finanzierung</span>
          </div>
          <select data-save="m08_finRisk">
            <option value="" data-i18n="opt_choose">Bitte wählen…</option>
            <option value="none" data-i18n="f5_o1">nicht relevant (ohne Finanzierung)</option>
            <option value="low" data-i18n="f5_o2">niedrig (Zins/Plan klar)</option>
            <option value="mid" data-i18n="f5_o3">mittel (teilweise)</option>
            <option value="high" data-i18n="f5_o4">hoch (unklar)</option>
          </select>
          <div class="help" data-i18n="f5_help">Frage: Wie ändert sich Cashflow, wenn Zins/Rate höher ist oder Laufzeit länger?</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="sec4_title">4) Ergebnis (Orientierung) + Merksätze</h2>
      <p data-i18n="sec4_p1">
        Die Kennzahlen hier sind bewusst „einfach“. Sie helfen dir, die Robustheit einzuordnen – und zeigen dir,
        ob du im Gespräch nachschärfen musst.
      </p>

      <div class="kpis">
        <div class="kpi">
          <div class="t" data-i18n="k1_t">Robustheit</div>
          <div class="v" id="kpiR">–</div>
          <div class="s" data-i18n="k1_s">Hält das Projekt Stress aus?</div>
        </div>
        <div class="kpi">
          <div class="t" data-i18n="k2_t">Sensitivität</div>
          <div class="v" id="kpiS">–</div>
          <div class="s" data-i18n="k2_s">Wo kippt es zuerst?</div>
        </div>
        <div class="kpi">
          <div class="t" data-i18n="k3_t">Puffer-Eindruck</div>
          <div class="v" id="kpiP">–</div>
          <div class="s" data-i18n="k3_s">Sind Reserven sichtbar?</div>
        </div>
        <div class="kpi">
          <div class="t" data-i18n="k4_t">Empfehlung</div>
          <div class="v" id="kpiE">–</div>
          <div class="s" data-i18n="k4_s">Nächster Schritt</div>
        </div>
      </div>

      <div class="notice">
        <strong data-i18n="rule_t">Regel:</strong>
        <span data-i18n="rule_b">Wenn ein Angebot keinen Worst-Case erklären will, ist es kein seriöses Investment-Gespräch.</span>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="sec5_title">5) Wow-Chart: Base vs. Stress (Illustration)</h2>
      <p data-i18n="sec5_p1">
        Die Balken passen sich an deine Auswahl an. Das ist keine Euro-Rechnung – es ist ein Visual,
        das dir zeigt, wie schnell eine Rendite „wegbricht“, wenn Annahmen schlechter werden.
      </p>

      <div class="viz shine">
        <div class="vizTop">
          <div class="title" data-i18n="viz_title">Stresstest-Visual (Illustration)</div>
          <div class="note" data-i18n="viz_note">keine Echt-Daten</div>
        </div>

        <div class="vizFrame">
          <svg viewBox="0 0 1200 420" role="img" aria-label="Stresstest Visual">
            <defs>
              <linearGradient id="bBase" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0" stop-color="rgba(11,125,92,.82)"/>
                <stop offset="1" stop-color="rgba(11,125,92,.22)"/>
              </linearGradient>
              <linearGradient id="bS1" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0" stop-color="rgba(200,166,58,.86)"/>
                <stop offset="1" stop-color="rgba(200,166,58,.26)"/>
              </linearGradient>
              <linearGradient id="bS2" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0" stop-color="rgba(197,38,70,.80)"/>
                <stop offset="1" stop-color="rgba(197,38,70,.22)"/>
              </linearGradient>
            </defs>

            <rect x="30" y="20" width="1140" height="380" rx="18" fill="rgba(255,255,255,.96)" stroke="rgba(15,17,20,.12)"/>

            <g stroke="rgba(15,17,20,.10)" stroke-width="1">
              <path d="M90 330H1130"/>
              <path d="M90 270H1130"/>
              <path d="M90 210H1130"/>
              <path d="M90 150H1130"/>
              <path d="M90 90H1130"/>
            </g>

            <rect id="barBase" x="220" y="110" width="170" height="220" rx="14" fill="url(#bBase)" stroke="rgba(11,125,92,.24)"/>
            <rect id="barS1"   x="525" y="155" width="170" height="175" rx="14" fill="url(#bS1)" stroke="rgba(200,166,58,.24)"/>
            <rect id="barS2"   x="830" y="210" width="170" height="120" rx="14" fill="url(#bS2)" stroke="rgba(197,38,70,.24)"/>

            <g font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif" fill="rgba(15,17,20,.92)">
              <text x="240" y="360" font-size="14" font-weight="900">Base</text>
              <text x="545" y="360" font-size="14" font-weight="900">Stress 1</text>
              <text x="850" y="360" font-size="14" font-weight="900">Stress 2</text>

              <text x="92" y="92" font-size="12" font-weight="800" fill="rgba(71,80,95,.92)">stabiler Überschuss</text>
              <text x="92" y="340" font-size="12" font-weight="800" fill="rgba(71,80,95,.92)">kippt / kaum Puffer</text>
            </g>
          </svg>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="sec6_title">6) Checkliste: Was du im Gespräch einfordern musst</h2>
      <p data-i18n="sec6_p1">Haken setzen, wenn du Antwort + Nachweis/Beleg bekommen hast.</p>

      <div class="checks">
        <label class="chk">
          <input type="checkbox" data-save-check="m08_c1" />
          <span>
            <div class="t" data-i18n="c1_t">Es gibt Base-Case + mindestens einen Stresstest</div>
            <div class="d" data-i18n="c1_d">Nicht nur „Best-Case“.</div>
          </span>
        </label>

        <label class="chk">
          <input type="checkbox" data-save-check="m08_c2" />
          <span>
            <div class="t" data-i18n="c2_t">Preisannahmen sind begründet + konservativ genug</div>
            <div class="d" data-i18n="c2_d">Und es wird gezeigt, was bei niedrigeren Preisen passiert.</div>
          </span>
        </label>

        <label class="chk">
          <input type="checkbox" data-save-check="m08_c3" />
          <span>
            <div class="t" data-i18n="c3_t">Kosten + Rücklagen sind vollständig (inkl. Ersatzteile)</div>
            <div class="d" data-i18n="c3_d">Besonders: Wechselrichter / Wartung / Versicherung.</div>
          </span>
        </label>

        <label class="chk">
          <input type="checkbox" data-save-check="m08_c4" />
          <span>
            <div class="t" data-i18n="c4_t">Risiken werden nicht weggewischt, sondern erklärt</div>
            <div class="d" data-i18n="c4_d">Wenn alles „gar kein Problem“ ist, fehlt Transparenz.</div>
          </span>
        </label>
      </div>
    </div>

    <div class="footer" data-i18n="footer">
      Premium Workbook – Modul 08. Eingaben werden lokal gespeichert und sind druckbar.
    </div>
  </div>

  <script>
    (function(){
      const LS_KEY_LANG = "fsa_pvka_lang";
      const LS_KEY_DATA = "fsa_pvka_project";

      const langSel  = document.getElementById("langSel");
      const printBtn = document.getElementById("printBtn");
      const resetBtn = document.getElementById("resetBtn");

      const kpiR = document.getElementById("kpiR");
      const kpiS = document.getElementById("kpiS");
      const kpiP = document.getElementById("kpiP");
      const kpiE = document.getElementById("kpiE");

      const barBase = document.getElementById("barBase");
      const barS1   = document.getElementById("barS1");
      const barS2   = document.getElementById("barS2");

      const i18n = {
        de: {
          brand_title:"Premium Kurs",
          brand_sub:"Photovoltaik als Kapitalanlage",
          premium_tag:"Modul 08 • Hauptkurs",
          btn_index:"Index",
          lang_label:"Sprache",
          btn_print:"Drucken",
          btn_reset:"Projektakte leeren",

          h1:"Modul 08 – Szenarien und Stresstest",
          sub:"Ein seriöses Projekt hält nicht nur im „Best-Case“. Dieses Modul zeigt, wie du Szenarien nutzt: Was passiert, wenn Ertrag, Preis oder Kosten schlechter laufen als geplant?",

          sec1_title:"1) Warum Stresstests dein wichtigster Betrugsschutz sind",
          sec1_p1:"Viele Angebote wirken stabil, solange nur die beste Annahme gezeigt wird. Ein Stresstest zwingt dazu, auch „unangenehme“ Fälle zu betrachten: weniger Sonne, geringere Preise, höhere Kosten oder Ausfälle.",
          sec1_p2:"Ein Anbieter muss nicht die Zukunft kennen – aber er muss erklären, wie robust die Kalkulation ist, und welche Sicherheits-Puffer vorhanden sind.",

          notice_title:"Wichtiger Hinweis:",
          notice_text:"Keine Anlageberatung, keine Steuer- oder Rechtsberatung. Dieses Modul ist Bildung: Szenario-Denken, Fragen, Orientierung.",

          sec2_title:"2) Glossar: Szenario-Wörter, die du kennen solltest",
          g_badge:"Glossar",
          g1_t:"Begriff: Best-Case / Base-Case / Worst-Case",
          g1_b:"Best-Case ist die beste Annahme, Base-Case die realistische Mitte, Worst-Case ein schlechteres (aber plausibles) Szenario. Seriös ist: Base-Case als Basis – und Worst-Case wird transparent gezeigt.",
          g2_t:"Begriff: Sensitivität",
          g2_b:"Sensitivität heißt: Welche Annahme beeinflusst das Ergebnis am stärksten (Preis, Ertrag, Kosten)? Genau das musst du im Gespräch herausfinden.",
          g3_t:"Begriff: Puffer / Sicherheitsmarge",
          g3_b:"Puffer sind bewusst eingerechnete Reserven (z. B. niedrigere Preise, höhere Kosten). Je kleiner der Puffer, desto anfälliger ist die Rendite.",

          sec3_title:"3) Stresstest-Tool (nur Auswahlfelder)",
          sec3_p1:"Wähle aus, wie hart du testen willst. Das Tool rechnet keine echten Euro – es zeigt dir aber, ob ein Projekt schon bei kleinen Verschlechterungen „kippt“.",

          hint_scen:"Szenario",
          hint_price:"Preis",
          hint_yield:"Ertrag",
          hint_costs:"Kosten",
          hint_fin:"Finanzierung",

          opt_choose:"Bitte wählen…",

          f1_lbl:"Szenario-Stufe",
          f1_o1:"Base-Case (realistisch)",
          f1_o2:"Stress 1 (moderate Verschlechterung)",
          f1_o3:"Stress 2 (harte Verschlechterung)",
          f1_help:"Ein seriöses Angebot zeigt mindestens Base-Case + Stress 1.",

          f2_lbl:"Preis-Risiko (€/kWh Annahme) wird bewertet als…",
          f2_o1:"niedrig (konservativ begründet)",
          f2_o2:"mittel (plausibel, aber wenig Puffer)",
          f2_o3:"hoch (optimistisch / unklar)",
          f2_help:"Frage: Was passiert, wenn der Preis länger niedriger bleibt?",

          f3_lbl:"Ertrags-Risiko (Sonne/Abregelung/Ausfälle) wird bewertet als…",
          f3_o1:"niedrig (gut erklärt + Puffer)",
          f3_o2:"mittel (teilweise erklärt)",
          f3_o3:"hoch (wird schön geredet)",
          f3_help:"Frage: Gibt es historische Daten/Simulation? Wie wird Abregelung behandelt?",

          f4_lbl:"Kosten-Risiko (Wartung, Versicherung, Rücklagen) ist…",
          f4_o1:"niedrig (vollständig + plausibel)",
          f4_o2:"mittel (teilweise)",
          f4_o3:"hoch (zu knapp / fehlt)",
          f4_help:"Frage: Welche Rücklagen sind eingeplant? Was ist mit Wechselrichter/Ersatzteilen?",

          f5_lbl:"Finanzierungs-/Zins-Risiko (falls vorhanden) ist…",
          f5_o1:"nicht relevant (ohne Finanzierung)",
          f5_o2:"niedrig (Zins/Plan klar)",
          f5_o3:"mittel (teilweise)",
          f5_o4:"hoch (unklar)",
          f5_help:"Frage: Wie ändert sich Cashflow, wenn Zins/Rate höher ist oder Laufzeit länger?",

          sec4_title:"4) Ergebnis (Orientierung) + Merksätze",
          sec4_p1:"Die Kennzahlen hier sind bewusst „einfach“. Sie helfen dir, die Robustheit einzuordnen – und zeigen dir, ob du im Gespräch nachschärfen musst.",
          k1_t:"Robustheit",
          k1_s:"Hält das Projekt Stress aus?",
          k2_t:"Sensitivität",
          k2_s:"Wo kippt es zuerst?",
          k3_t:"Puffer-Eindruck",
          k3_s:"Sind Reserven sichtbar?",
          k4_t:"Empfehlung",
          k4_s:"Nächster Schritt",

          rule_t:"Regel:",
          rule_b:"Wenn ein Angebot keinen Worst-Case erklären will, ist es kein seriöses Investment-Gespräch.",

          sec5_title:"5) Wow-Chart: Base vs. Stress (Illustration)",
          sec5_p1:"Die Balken passen sich an deine Auswahl an. Das ist keine Euro-Rechnung – es ist ein Visual, das dir zeigt, wie schnell eine Rendite „wegbricht“, wenn Annahmen schlechter werden.",
          viz_title:"Stresstest-Visual (Illustration)",
          viz_note:"keine Echt-Daten",

          sec6_title:"6) Checkliste: Was du im Gespräch einfordern musst",
          sec6_p1:"Haken setzen, wenn du Antwort + Nachweis/Beleg bekommen hast.",
          c1_t:"Es gibt Base-Case + mindestens einen Stresstest",
          c1_d:"Nicht nur „Best-Case“.",
          c2_t:"Preisannahmen sind begründet + konservativ genug",
          c2_d:"Und es wird gezeigt, was bei niedrigeren Preisen passiert.",
          c3_t:"Kosten + Rücklagen sind vollständig (inkl. Ersatzteile)",
          c3_d:"Besonders: Wechselrichter / Wartung / Versicherung.",
          c4_t:"Risiken werden nicht weggewischt, sondern erklärt",
          c4_d:"Wenn alles „gar kein Problem“ ist, fehlt Transparenz.",

          footer:"Premium Workbook – Modul 08. Eingaben werden lokal gespeichert und sind druckbar."
        },

        en: {
          brand_title:"Premium course",
          brand_sub:"Photovoltaics as a capital investment",
          premium_tag:"Module 08 • Main course",
          btn_index:"Index",
          lang_label:"Language",
          btn_print:"Print",
          btn_reset:"Clear project file",

          h1:"Module 08 – Scenarios and stress test",
          sub:"A serious project must not work only in the ‘best case’. This module shows how to use scenarios: what happens if yield, price or costs turn out worse than planned?",

          sec1_title:"1) Why stress tests are your strongest fraud protection",
          sec1_p1:"Many offers look stable as long as only the best assumption is shown. A stress test forces the ‘uncomfortable’ cases: less sun, lower prices, higher costs or downtime.",
          sec1_p2:"A provider doesn’t need to predict the future—but must explain how robust the model is and which safety buffers exist.",

          notice_title:"Important notice:",
          notice_text:"No investment advice, no tax or legal advice. This module is education: scenario thinking, questions, orientation.",

          sec2_title:"2) Glossary: scenario terms you should know",
          g_badge:"Glossary",
          g1_t:"Term: Best case / Base case / Worst case",
          g1_b:"Best case is the best assumption, base case the realistic middle, worst case a worse (but plausible) scenario. Serious offers: base case as baseline—and worst case shown transparently.",
          g2_t:"Term: Sensitivity",
          g2_b:"Sensitivity means: which assumption impacts the result most (price, yield, costs). That’s what you must uncover in the conversation.",
          g3_t:"Term: Buffer / safety margin",
          g3_b:"Buffers are deliberate reserves (e.g., lower prices, higher costs). The smaller the buffer, the more fragile the return becomes.",

          sec3_title:"3) Stress test tool (selection fields only)",
          sec3_p1:"Choose how hard you want to test. This tool does not calculate real euros—it shows whether a project ‘breaks’ already under small deteriorations.",

          hint_scen:"scenario",
          hint_price:"price",
          hint_yield:"yield",
          hint_costs:"costs",
          hint_fin:"financing",

          opt_choose:"Please choose…",

          f1_lbl:"Scenario level",
          f1_o1:"Base case (realistic)",
          f1_o2:"Stress 1 (moderate deterioration)",
          f1_o3:"Stress 2 (hard deterioration)",
          f1_help:"A serious offer shows at least base case + stress 1.",

          f2_lbl:"Price risk (€/kWh assumption) is…",
          f2_o1:"low (conservative and justified)",
          f2_o2:"medium (plausible, but little buffer)",
          f2_o3:"high (optimistic / unclear)",
          f2_help:"Ask: what if prices stay lower for longer?",

          f3_lbl:"Yield risk (sun/curtailment/downtime) is…",
          f3_o1:"low (well explained + buffer)",
          f3_o2:"medium (partly explained)",
          f3_o3:"high (downplayed)",
          f3_help:"Ask: historic data/simulation? How is curtailment handled?",

          f4_lbl:"Cost risk (maintenance, insurance, reserves) is…",
          f4_o1:"low (complete + plausible)",
          f4_o2:"medium (partial)",
          f4_o3:"high (too thin / missing)",
          f4_help:"Ask: which reserves are included? What about inverter/replacements?",

          f5_lbl:"Financing/interest risk (if applicable) is…",
          f5_o1:"not relevant (no financing)",
          f5_o2:"low (rate/plan clear)",
          f5_o3:"medium (partial)",
          f5_o4:"high (unclear)",
          f5_help:"Ask: how does cashflow change if interest/rate increases or term changes?",

          sec4_title:"4) Result (orientation) + key rules",
          sec4_p1:"These KPIs are intentionally simple. They help you judge robustness—and show where you must tighten questions.",
          k1_t:"Robustness",
          k1_s:"Does it survive stress?",
          k2_t:"Sensitivity",
          k2_s:"Where does it break first?",
          k3_t:"Buffer impression",
          k3_s:"Are reserves visible?",
          k4_t:"Recommendation",
          k4_s:"Next step",

          rule_t:"Rule:",
          rule_b:"If an offer refuses to explain a worst case, it’s not a serious investment conversation.",

          sec5_title:"5) Wow chart: base vs stress (illustration)",
          sec5_p1:"Bars adapt to your selection. Not a euro model—just a visual that shows how quickly ‘returns’ collapse when assumptions worsen.",
          viz_title:"Stress test visual (illustration)",
          viz_note:"no real data",

          sec6_title:"6) Checklist: what you must demand in the conversation",
          sec6_p1:"Tick only if you got an answer + proof.",
          c1_t:"There is a base case + at least one stress test",
          c1_d:"Not only ‘best case’.",
          c2_t:"Price assumptions are justified + conservative enough",
          c2_d:"And it’s shown what happens with lower prices.",
          c3_t:"Costs + reserves are complete (incl. replacements)",
          c3_d:"Especially: inverter / maintenance / insurance.",
          c4_t:"Risks are not dismissed but explained",
          c4_d:"If everything is ‘no problem’, transparency is missing.",

          footer:"Premium workbook – Module 08. Inputs are stored locally and printable."
        }
      };

      function getData(){
        try{
          const raw = localStorage.getItem(LS_KEY_DATA);
          const obj = raw ? JSON.parse(raw) : {};
          return (obj && typeof obj === "object") ? obj : {};
        }catch(e){ return {}; }
      }
      function setData(obj){
        localStorage.setItem(LS_KEY_DATA, JSON.stringify(obj));
      }

      function applyI18n(lang){
        document.documentElement.lang = lang;
        document.querySelectorAll("[data-i18n]").forEach(el=>{
          const k = el.getAttribute("data-i18n");
          const txt = (i18n[lang] && i18n[lang][k] !== undefined) ? i18n[lang][k] : null;
          if(txt !== null) el.textContent = txt;
        });
        document.querySelectorAll("option[data-i18n]").forEach(opt=>{
          const k = opt.getAttribute("data-i18n");
          const txt = (i18n[lang] && i18n[lang][k] !== undefined) ? i18n[lang][k] : null;
          if(txt !== null) opt.textContent = txt;
        });
      }

      function loadLang(){
        const saved = localStorage.getItem(LS_KEY_LANG);
        return saved === "en" ? "en" : "de";
      }
      function saveLang(lang){
        localStorage.setItem(LS_KEY_LANG, lang);
      }

      function wireFields(){
        const data = getData();

        document.querySelectorAll("select[data-save]").forEach(sel=>{
          const k = sel.getAttribute("data-save");
          if(data[k] !== undefined) sel.value = data[k];
          sel.addEventListener("change", ()=>{
            const d = getData();
            d[k] = sel.value;
            setData(d);
            updateAll();
          });
        });

        document.querySelectorAll("input[type='checkbox'][data-save-check]").forEach(chk=>{
          const k = chk.getAttribute("data-save-check");
          if(data[k] !== undefined) chk.checked = !!data[k];
          chk.addEventListener("change", ()=>{
            const d = getData();
            d[k] = chk.checked;
            setData(d);
            updateAll();
          });
        });
      }

      function addNoCache(){
        const ts = Date.now();
        document.querySelectorAll('a[data-nocache="1"]').forEach(link=>{
          const href = link.getAttribute("href") || "";
          const url = new URL(href, location.href);
          url.searchParams.set("nocache", String(ts));
          link.setAttribute("href", url.pathname.split("/").pop() + "?" + url.searchParams.toString());
        });
      }

      function riskToPenalty(v){
        if(v === "low") return 0.92;
        if(v === "mid") return 0.82;
        if(v === "high") return 0.70;
        if(v === "none") return 0.95;
        return 0.85;
      }

      function levelToFactor(level){
        if(level === "base") return 1.00;
        if(level === "stress1") return 0.85;
        if(level === "stress2") return 0.70;
        return 0.90;
      }

      function updateKPIs(){
        const lang = (langSel.value === "en") ? "en" : "de";
        const d = getData();

        const level = d.m08_level || "base";
        const fLevel = levelToFactor(level);

        const fPrice = riskToPenalty(d.m08_priceRisk);
        const fYield = riskToPenalty(d.m08_yieldRisk);
        const fCost  = riskToPenalty(d.m08_costRisk);
        const fFin   = riskToPenalty(d.m08_finRisk);

        // internal index: 100 = stable baseline
        const idxBase = 100;
        const idxNow  = Math.round(idxBase * fLevel * fPrice * fYield * fCost * fFin);

        // derive labels
        let robustness;
        if(idxNow >= 80) robustness = lang==="en" ? "high" : "hoch";
        else if(idxNow >= 65) robustness = lang==="en" ? "medium" : "mittel";
        else robustness = lang==="en" ? "low" : "niedrig";
        kpiR.textContent = robustness;

        // sensitivity (which factor hurts most)
        const factors = [
          {k:"price", v:fPrice, nameDe:"Preis", nameEn:"price"},
          {k:"yield", v:fYield, nameDe:"Ertrag", nameEn:"yield"},
          {k:"cost",  v:fCost,  nameDe:"Kosten", nameEn:"costs"},
          {k:"fin",   v:fFin,   nameDe:"Finanz.", nameEn:"financing"}
        ];
        factors.sort((a,b)=> a.v - b.v); // smallest factor = biggest damage
        kpiS.textContent = (lang==="en") ? factors[0].nameEn : factors[0].nameDe;

        // buffer impression (based on how many are low risk + level)
        let buf = 0;
        [d.m08_priceRisk, d.m08_yieldRisk, d.m08_costRisk, d.m08_finRisk].forEach(v=>{
          if(v === "low" || v === "none") buf += 1;
          else if(v === "mid") buf += 0.5;
        });
        if(level === "stress2") buf -= 0.5;
        const bufferLabel = (buf >= 3.2) ? (lang==="en" ? "visible" : "sichtbar")
                          : (buf >= 2.2) ? (lang==="en" ? "thin" : "dünn")
                          : (lang==="en" ? "missing" : "fehlt");
        kpiP.textContent = bufferLabel;

        // recommendation
        let rec;
        if(idxNow >= 80) rec = lang==="en" ? "continue checking" : "weiter prüfen";
        else if(idxNow >= 65) rec = lang==="en" ? "tighten questions" : "Fragen nachschärfen";
        else rec = lang==="en" ? "stop / clarify" : "Stopp / klären";
        kpiE.textContent = rec;

        // update bars: translate index to height
        function setBar(bar, index, minY, maxY){
          // index 100 => tall; index 40 => small
          const t = Math.max(35, Math.min(100, index));
          const h = Math.round((t / 100) * 250); // 0..250
          const y = 330 - h;
          bar.setAttribute("y", String(y));
          bar.setAttribute("height", String(h));
        }

        // compute three scenario indices (base, stress1, stress2) based on chosen risks
        const idxB  = Math.round(idxBase * 1.00 * fPrice * fYield * fCost * fFin);
        const idxS1 = Math.round(idxBase * 0.85 * fPrice * fYield * fCost * fFin);
        const idxS2 = Math.round(idxBase * 0.70 * fPrice * fYield * fCost * fFin);

        setBar(barBase, idxB);
        setBar(barS1, idxS1);
        setBar(barS2, idxS2);
      }

      function updateAll(){
        updateKPIs();
      }

      // Buttons
      printBtn.addEventListener("click", ()=> window.print());
      resetBtn.addEventListener("click", ()=>{
        const lang = langSel.value === "en" ? "en" : "de";
        const ok = confirm(lang === "en"
          ? "Clear all saved project inputs for this course?"
          : "Alle gespeicherten Eingaben für diesen Kurs wirklich löschen?"
        );
        if(!ok) return;
        localStorage.removeItem(LS_KEY_DATA);
        location.reload();
      });

      // Init
      addNoCache();
      const lang = loadLang();
      langSel.value = lang;
      applyI18n(lang);
      wireFields();
      updateAll();

      langSel.addEventListener("change", ()=>{
        const l = langSel.value === "en" ? "en" : "de";
        saveLang(l);
        applyI18n(l);
        updateAll();
      });
    })();
  </script>
<!-- PATCH: Modul-Navigation (Prev / Index / Next) -->
<style>
  .modNav{
    margin-top: 14px;
    border:1px solid rgba(15,17,20,.12);
    border-radius: 16px;
    background: rgba(255,255,255,.72);
    box-shadow: 0 14px 34px rgba(0,0,0,.08);
    padding: 12px 12px;
    position:relative;
    overflow:hidden;
  }
  .modNav:before{
    content:"";
    position:absolute;
    inset:-2px;
    background:
      radial-gradient(620px 180px at 16% 8%, rgba(200,166,58,.12), transparent 65%),
      radial-gradient(620px 180px at 84% 12%, rgba(11,125,92,.10), transparent 65%);
    pointer-events:none;
    opacity:.75;
  }
  .modNav > *{ position:relative; }

  .modNavTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:10px;
  }
  .modNavTitle{
    font-weight:1100;
    font-size:13px;
    color: rgba(15,17,20,.92);
  }
  .modNavHint{
    font-size:12px;
    font-weight:900;
    color: rgba(71,80,95,.92);
    background: rgba(200,166,58,.10);
    border:1px solid rgba(200,166,58,.22);
    border-radius: 999px;
    padding: 4px 8px;
    width: fit-content;
  }

  .modNavBtns{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }

  .modNavBtn{
    display:inline-flex;
    align-items:center;
    gap:10px;
    text-decoration:none;
    font-weight:1100;
    border-radius: 12px;
    padding: 11px 14px;
    border:1px solid rgba(15,17,20,.12);
    background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.76));
    color: rgba(15,17,20,.92);
    box-shadow: 0 14px 30px rgba(0,0,0,.06);
    transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    white-space:nowrap;
  }
  .modNavBtn:hover{
    transform: translateY(-1px);
    box-shadow: 0 18px 38px rgba(0,0,0,.10);
    border-color: rgba(11,125,92,.28);
  }

  .modNavBtn.primary{
    color:#fff;
    border:1px solid rgba(11,125,92,.22);
    background: linear-gradient(180deg, rgba(26,165,122,1), rgba(11,125,92,1));
    box-shadow: 0 14px 30px rgba(11,125,92,.18);
  }
  .modNavBtn.primary:hover{
    box-shadow: 0 18px 38px rgba(11,125,92,.22);
  }

  .modNavBtn svg{ width:16px; height:16px; flex:0 0 auto; opacity:.95; }
  .modNavBtn.disabled{
    opacity:.45;
    pointer-events:none;
    filter: grayscale(1);
  }

  @media print{
    .modNav{ display:none !important; }
  }
</style>

<nav class="modNav" id="modNav" aria-label="Modul Navigation" style="display:none">
  <div class="modNavTop">
    <div class="modNavTitle" data-i18n="nav_title">Navigation</div>
    <div class="modNavHint" data-i18n="nav_hint">Weiter zum nächsten Modul</div>
  </div>

  <div class="modNavBtns">
    <a class="modNavBtn" id="navPrev" href="#" data-nocache="1">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M15 6l-6 6 6 6" fill="none" stroke="rgba(15,17,20,.85)" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span data-i18n="nav_prev">Vorheriges Modul</span>
    </a>

    <a class="modNavBtn" id="navIndex" href="index.html" data-nocache="1">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M4 10.5l8-6 8 6V20a1 1 0 0 1-1 1h-4v-6H9v6H5a1 1 0 0 1-1-1v-9.5z"
              fill="rgba(200,166,58,.18)" stroke="rgba(15,17,20,.55)" stroke-width="1.4" stroke-linejoin="round"/>
      </svg>
      <span data-i18n="nav_index">Index</span>
    </a>

    <a class="modNavBtn primary" id="navNext" href="#" data-nocache="1">
      <span data-i18n="nav_next">Nächstes Modul</span>
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M9 6l6 6-6 6" fill="none" stroke="rgba(255,255,255,.95)" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </a>
  </div>
</nav>

<script>
  (function(){
    // i18n keys ergänzen, falls dein Modul bereits i18n nutzt:
    // (Wir überschreiben nichts – nur fallback, wenn Keys fehlen.)
    const fallback = {
      de: { nav_title:"Navigation", nav_hint:"Weiter zum nächsten Modul", nav_prev:"Vorheriges Modul", nav_index:"Index", nav_next:"Nächstes Modul" },
      en: { nav_title:"Navigation", nav_hint:"Continue to the next module", nav_prev:"Previous module", nav_index:"Index", nav_next:"Next module" }
    };

    // Sprache aus bestehender Seite ableiten (html lang oder select#langSel, wenn vorhanden)
    function getLang(){
      const sel = document.getElementById("langSel");
      if(sel && (sel.value==="en" || sel.value==="de")) return sel.value;
      const l = (document.documentElement.lang || "de").toLowerCase();
      return l.startsWith("en") ? "en" : "de";
    }

    // Modulnummer aus Dateiname: module-01.html ... module-12.html
    const file = (location.pathname.split("/").pop() || "").toLowerCase();
    const m = file.match(/^module-(\d{2})\.html$/);
    if(!m) return; // nur auf Modul-Seiten aktiv

    const num = parseInt(m[1], 10);
    if(!Number.isFinite(num)) return;

    const nav = document.getElementById("modNav");
    const prev = document.getElementById("navPrev");
    const next = document.getElementById("navNext");
    const idx  = document.getElementById("navIndex");

    function withNoCache(href){
      const ts = Date.now();
      const url = new URL(href, location.href);
      url.searchParams.set("nocache", String(ts));
      return url.pathname.split("/").pop() + "?" + url.searchParams.toString();
    }

    function pad2(n){ return String(n).padStart(2,"0"); }

    // Links setzen
    idx.href = withNoCache("index.html");

    if(num > 1){
      prev.href = withNoCache("module-" + pad2(num-1) + ".html");
      prev.classList.remove("disabled");
    }else{
      prev.href = "#";
      prev.classList.add("disabled");
    }

    if(num < 12){
      next.href = withNoCache("module-" + pad2(num+1) + ".html");
      next.classList.remove("disabled");
    }else{
      next.href = "#";
      next.classList.add("disabled");
    }

    // i18n minimal anwenden (nur diese Nav-Keys, ohne dein System zu stören)
    function applyNavI18n(){
      const lang = getLang();
      document.querySelectorAll("#modNav [data-i18n]").forEach(el => {
        const k = el.getAttribute("data-i18n");
        if(!k) return;
        // wenn deine Seite das schon setzt, lassen wir es; sonst fallback:
        const current = (el.textContent || "").trim();
        if(current) return;
        el.textContent = (fallback[lang] && fallback[lang][k]) ? fallback[lang][k] : (fallback.de[k] || "");
      });
    }

    // sichtbar machen
    nav.style.display = "";
    applyNavI18n();

    // falls dein Modul per Sprachumschalter live wechselt
    const langSel = document.getElementById("langSel");
    if(langSel){
      langSel.addEventListener("change", () => {
        // Texte nur setzen, wenn leer – also kein Überschreiben
        applyNavI18n();
      });
    }
  })();
</script>
<!-- /PATCH: Modul-Navigation -->
</body>
</html>
