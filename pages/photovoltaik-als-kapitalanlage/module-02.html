<!doctype html>
<!--
  FSA • Premium Kurs (Workbook)
  Kurs: Photovoltaik als Kapitalanlage
  Modul 02: Anlageklasse verstehen (PV-Logik)

  GitHub-Pfad: lp-anfang/pages/photovoltaik-als-kapitalanlage/module-02.html
  Commit-Message: photovoltaik-als-kapitalanlage – Modul 02 (PV-Logik) komplett (DE/EN, Eingaben+LocalStorage, Print, Tabelle+Diagramm+SVG)
  Testlink (nocache): https://adler-fsa.github.io/lp-anfang/pages/photovoltaik-als-kapitalanlage/module-02.html?nocache=__TS__
-->
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modul 2 – PV-Logik (Anlageklasse verstehen) • Photovoltaik als Kapitalanlage</title>
  <meta name="description" content="Modul 2 (DE/EN): PV-Logik verstehen – Stromfluss, Eigenverbrauch, Einspeisung, Erlös/Ersparnis. Rechenblatt, SVG-Übersicht, druckbar, LocalStorage." />
  <meta name="robots" content="index,follow" />

  <style>
    :root{
      --bg:#ffffff;
      --ink:#111214;
      --muted:#47505f;

      --line: rgba(17,18,20,.12);
      --line2: rgba(17,18,20,.18);

      --gold:#c8a63a;
      --gold2:#e0c466;

      --accent:#0b7d5c;
      --accent2:#1aa57a;

      --danger:#c52646;

      --shadow: 0 14px 34px rgba(0,0,0,.10);
      --shadow2: 0 26px 70px rgba(0,0,0,.12);

      --radius:18px;
      --max: 1140px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 720px at 10% 8%, rgba(200,166,58,.16), transparent 58%),
        radial-gradient(1050px 720px at 88% 14%, rgba(11,125,92,.12), transparent 58%),
        radial-gradient(920px 640px at 52% 96%, rgba(197,38,70,.08), transparent 60%),
        linear-gradient(180deg, #ffffff 0%, #fbfbfc 45%, #ffffff 100%);
      overflow-x:hidden;
    }

    .spark{
      position:fixed;
      inset:-30vh -30vw auto -30vw;
      height:60vh;
      pointer-events:none;
      z-index:0;
      filter: blur(18px);
      opacity:.55;
      background:
        radial-gradient(closest-side at 18% 35%, rgba(200,166,58,.28), transparent 65%),
        radial-gradient(closest-side at 68% 28%, rgba(11,125,92,.22), transparent 65%),
        radial-gradient(closest-side at 48% 85%, rgba(197,38,70,.14), transparent 70%);
      transform: translate3d(0,0,0);
      animation: floaty 10s ease-in-out infinite;
    }
    @keyframes floaty{
      0%{ transform: translate3d(0px, 0px, 0px) scale(1); }
      50%{ transform: translate3d(12px, 10px, 0px) scale(1.02); }
      100%{ transform: translate3d(0px, 0px, 0px) scale(1); }
    }
    @media (prefers-reduced-motion: reduce){
      .spark{ animation:none; }
    }

    .wrap{
      position:relative;
      z-index:1;
      max-width:var(--max);
      margin:0 auto;
      padding: 22px 18px 84px;
    }

    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      padding: 10px 12px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.76));
      border-radius: 999px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .brand:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(520px 180px at 12% 30%, rgba(200,166,58,.14), transparent 64%),
        radial-gradient(520px 180px at 84% 20%, rgba(11,125,92,.10), transparent 64%);
      pointer-events:none;
    }
    .brand > *{ position:relative; }
    .brand svg{ width:22px; height:22px; flex:0 0 auto; }
    .brand .t1{ font-weight:1000; letter-spacing:.2px; line-height:1.1; }
    .brand .t2{ font-size:12px; color:var(--muted); margin-top:2px; line-height:1.1; }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }

    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.76));
      color:var(--ink);
      padding:10px 12px;
      border-radius: 12px;
      font-weight:1000;
      cursor:pointer;
      box-shadow: var(--shadow);
      display:inline-flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      user-select:none;
      transition: transform .10s ease, border-color .14s ease, box-shadow .14s ease;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(200,166,58,.45); box-shadow: var(--shadow2); }
    .btn:active{ transform: translateY(0px); }

    .btn .dot{
      width:10px; height:10px; border-radius:50%;
      background: var(--gold);
      box-shadow: 0 0 14px rgba(200,166,58,.30);
    }
    .btn.secondary .dot{ background: var(--accent2); box-shadow: 0 0 14px rgba(26,165,122,.26); }
    .btn.danger .dot{ background: var(--danger); box-shadow: 0 0 14px rgba(197,38,70,.20); }

    .lang{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.74);
      border-radius: 12px;
      box-shadow: var(--shadow);
    }
    .lang label{ font-size:12px; color:var(--muted); font-weight:1000; }
    .lang select{
      background: rgba(255,255,255,.95);
      border:1px solid var(--line2);
      color: var(--ink);
      border-radius:10px;
      padding:8px 10px;
      font-weight:1000;
      outline:none;
    }

    .hero{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.80));
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 16px 16px 14px;
      margin-bottom: 12px;
      position:relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(720px 240px at 10% 18%, rgba(200,166,58,.18), transparent 66%),
        radial-gradient(620px 240px at 84% 26%, rgba(11,125,92,.12), transparent 66%);
      pointer-events:none;
    }
    .hero > *{ position:relative; }

    .kicker{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(200,166,58,.42);
      background: rgba(200,166,58,.10);
      font-weight:1000;
      font-size:12px;
      letter-spacing:.25px;
      color: rgba(17,18,20,.92);
    }
    .badge .bDot{
      width:10px; height:10px; border-radius:50%;
      background: var(--gold);
      box-shadow: 0 0 14px rgba(200,166,58,.26);
    }

    h1{
      margin:0 0 6px;
      font-size: 22px;
      letter-spacing:.2px;
      line-height:1.22;
    }
    .sub{
      margin:0;
      color: var(--muted);
      line-height:1.55;
      font-size:14px;
      max-width: 105ch;
    }

    .notice{
      margin-top:10px;
      border:1px solid rgba(200,166,58,.40);
      background: rgba(200,166,58,.10);
      border-radius: 14px;
      padding: 12px 12px;
      color: rgba(17,18,20,.92);
      line-height:1.55;
      font-size:13px;
    }
    .notice strong{ color:#6a520a; }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin-top: 12px;
    }
    @media (min-width: 980px){
      .grid{ grid-template-columns: 1.12fr .88fr; }
    }

    .card{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.82));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px 14px 12px;
      overflow:hidden;
      position:relative;
    }
    .card:before{
      content:"";
      position:absolute;
      left:0; top:0; bottom:0;
      width:4px;
      background: linear-gradient(180deg, rgba(200,166,58,.95), rgba(11,125,92,.65));
      opacity:.85;
    }
    .card h2{
      margin:0 0 10px;
      font-size:16px;
      letter-spacing:.2px;
      padding-left:8px;
    }

    .section{
      padding-left:8px;
      margin-bottom: 12px;
    }
    .section h3{
      margin:0 0 6px;
      font-size:13px;
      letter-spacing:.25px;
      font-weight:1000;
    }
    .section p{
      margin:0 0 10px;
      color: var(--muted);
      font-size:13px;
      line-height:1.55;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:8px;
    }
    @media (min-width: 760px){
      .row.two{ grid-template-columns: 1fr 1fr; }
      .row.three{ grid-template-columns: 1fr 1fr 1fr; }
    }

    .field{
      border:1px solid rgba(17,18,20,.12);
      background: rgba(255,255,255,.78);
      border-radius: 14px;
      padding: 10px 10px;
      box-shadow: 0 10px 20px rgba(0,0,0,.06);
    }
    .field label{
      display:block;
      font-size:12px;
      font-weight:1000;
      color: rgba(17,18,20,.86);
      margin-bottom:6px;
    }
    .hint{
      font-size:12px;
      color: var(--muted);
      line-height:1.45;
      margin-top:6px;
    }

    input[type="text"], input[type="number"], textarea, select{
      width:100%;
      border:1px solid rgba(17,18,20,.16);
      background: rgba(255,255,255,.96);
      border-radius: 12px;
      padding: 10px 10px;
      font-size:14px;
      outline:none;
      color: var(--ink);
    }
    textarea{ min-height: 84px; resize: vertical; }

    .calc{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 760px){
      .calc{ grid-template-columns: 1fr 1fr; }
    }

    .mini{
      font-size:12px;
      color: var(--muted);
      line-height:1.45;
      margin-top:8px;
    }

    .table{
      width:100%;
      border-collapse:collapse;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid rgba(17,18,20,.12);
      background: rgba(255,255,255,.86);
      box-shadow: 0 10px 20px rgba(0,0,0,.06);
    }
    .table th, .table td{
      padding:10px 10px;
      border-bottom:1px solid rgba(17,18,20,.10);
      text-align:left;
      font-size:13px;
    }
    .table th{
      font-size:12px;
      letter-spacing:.2px;
      color: rgba(17,18,20,.86);
      font-weight:1000;
      background: rgba(200,166,58,.08);
    }
    .table tr:last-child td{ border-bottom:none; }
    .val{
      font-weight:1000;
      color: rgba(17,18,20,.92);
      white-space:nowrap;
    }

    .svgBox{
      border:1px solid rgba(17,18,20,.12);
      background: rgba(255,255,255,.78);
      border-radius: 14px;
      padding: 10px 10px;
      box-shadow: 0 10px 20px rgba(0,0,0,.06);
      overflow:hidden;
    }
    .svgTitle{
      font-weight:1000;
      font-size:12px;
      color: rgba(17,18,20,.86);
      margin:0 0 8px;
      letter-spacing:.2px;
    }
    .chartNote{
      margin-top:8px;
      font-size:12px;
      color: var(--muted);
      line-height:1.45;
    }

    .sidebox{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.84));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px 14px 12px;
      position:relative;
      overflow:hidden;
    }
    .sidebox:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(560px 240px at 18% 22%, rgba(200,166,58,.16), transparent 66%),
        radial-gradient(560px 240px at 86% 24%, rgba(11,125,92,.10), transparent 66%);
      pointer-events:none;
      opacity:.65;
    }
    .sidebox > *{ position:relative; }
    .sidebox h2{ margin:0 0 10px; font-size:16px; letter-spacing:.2px; }

    .list{
      margin:0;
      padding-left: 18px;
      color: var(--muted);
      line-height:1.55;
      font-size:13px;
    }
    .list li{ margin: 6px 0; }

    .navRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .footer{
      margin-top: 14px;
      color: rgba(17,18,20,.55);
      font-size: 12px;
      line-height:1.55;
      text-align:center;
    }

    /* Print */
    @media print{
      .spark{ display:none !important; }
      body{ background:#fff !important; color:#000 !important; }
      .topbar, .actions, .lang, .btn{ display:none !important; }
      .wrap{ max-width: 820px; padding: 0; }
      .hero, .card, .sidebox, .svgBox, .field{
        box-shadow:none !important;
        background:#fff !important;
        border:1px solid #bbb !important;
        color:#000 !important;
      }
      .sub, .section p, .hint, .mini, .list, .chartNote{ color:#111 !important; }
      .notice{
        border:1px solid #999 !important;
        background:#f7f2df !important;
        color:#000 !important;
      }
      .card:before{ display:none !important; }
      input, textarea, select{
        border:1px solid #999 !important;
        background:#fff !important;
      }
      .table{ box-shadow:none !important; }
      .table th{ background:#f2f2f2 !important; }
    }
  </style>
</head>

<body>
  <div class="spark" aria-hidden="true"></div>

  <div class="wrap">

    <div class="topbar">
      <div class="brand" aria-label="Kurs">
        <!-- Inline-SVG -->
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <linearGradient id="gSun" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#c8a63a"/>
              <stop offset="1" stop-color="#e0c466"/>
            </linearGradient>
          </defs>
        <circle cx="12" cy="12" r="5.2" fill="url(#gSun)"></circle>
        <g fill="none" stroke="rgba(17,18,20,.78)" stroke-width="1.2" stroke-linecap="round">
          <path d="M12 2.2v2.2M12 19.6v2.2M2.2 12h2.2M19.6 12h2.2"/>
          <path d="M4.6 4.6l1.55 1.55M17.85 17.85l1.55 1.55M19.4 4.6l-1.55 1.55M6.15 17.85L4.6 19.4"/>
        </g>
        </svg>

        <div>
          <div class="t1" data-i18n="brand_title">Premium Kurs</div>
          <div class="t2" data-i18n="brand_sub">Photovoltaik als Kapitalanlage</div>
        </div>
      </div>

      <div class="actions">
        <div class="lang" title="Sprache / Language">
          <label for="langSel" data-i18n="lang_label">Sprache</label>
          <select id="langSel" aria-label="Sprache wählen">
            <option value="de">DE</option>
            <option value="en">EN</option>
          </select>
        </div>

        <a class="btn" id="indexBtn" href="index.html" data-nocache="1" title="Index">
          <span class="dot" aria-hidden="true"></span>
          <span data-i18n="btn_index">Index</span>
        </a>

        <button class="btn secondary" id="printBtn" type="button" title="Drucken / Print">
          <span class="dot" aria-hidden="true"></span>
          <span data-i18n="btn_print">Drucken</span>
        </button>

        <button class="btn danger" id="resetBtn" type="button" title="Projektakte leeren">
          <span class="dot" aria-hidden="true"></span>
          <span data-i18n="btn_reset">Projektakte leeren</span>
        </button>
      </div>
    </div>

    <div class="hero">
      <div class="kicker">
        <div class="badge">
          <span class="bDot" aria-hidden="true"></span>
          <span data-i18n="badge1">Modul 2 • PV-Logik</span>
        </div>
      </div>

      <h1 data-i18n="h1">Modul 2 – Anlageklasse verstehen (PV-Logik)</h1>
      <p class="sub" data-i18n="sub">
        In diesem Modul verstehst du den Kern: Eine PV-Anlage erzeugt Energie. Daraus entstehen zwei Effekte: (1) Ersparnis durch Eigenverbrauch, (2) Erlös durch Einspeisung.
        Du dokumentierst die Annahmen so, dass du sie im Profi-Gespräch gezielt prüfen kannst.
      </p>

      <div class="notice">
        <strong data-i18n="notice_title">Wichtiger Hinweis:</strong>
        <span data-i18n="notice_text">
          Keine Anlageberatung, keine Steuer- oder Rechtsberatung. Dieses Modul dient der Befähigung: Logik verstehen, Annahmen prüfen, Nachweise einfordern.
        </span>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <h2 data-i18n="left_title">PV-Logik – Annahmen & Rechenblatt (Basis)</h2>

        <div class="section">
          <h3 data-i18n="sec_a">A) Stromfluss: Erzeugung → Eigenverbrauch / Einspeisung</h3>
          <p data-i18n="sec_a_txt">
            Nutze das Rechenblatt als Gesprächsgrundlage. Es geht nicht um „perfekte Werte“, sondern darum, dass jede Zahl eine Quelle oder Begründung hat.
          </p>

          <div class="calc">
            <div class="field">
              <label for="kwp" data-i18n="f_kwp">Anlagengröße (kWp)</label>
              <input id="kwp" type="number" step="0.1" min="0" data-save="m02_kwp" />
              <div class="hint" data-i18n="h_kwp">Beispiel: 8.0 kWp (Dach) / 500 kWp (Gewerbe) / etc.</div>
            </div>

            <div class="field">
              <label for="specYield" data-i18n="f_specYield">Spezifischer Ertrag (kWh pro kWp/Jahr)</label>
              <input id="specYield" type="number" step="1" min="0" data-save="m02_specYield" />
              <div class="hint" data-i18n="h_specYield">Wert muss plausibel begründet sein (Standort/Neigung/Simulation).</div>
            </div>

            <div class="field">
              <label for="selfUse" data-i18n="f_selfUse">Eigenverbrauchsanteil (%)</label>
              <input id="selfUse" type="number" step="1" min="0" max="100" data-save="m02_selfUse" />
              <div class="hint" data-i18n="h_selfUse">Wichtig: Ohne Lastprofil/Verbrauchsdaten ist das oft geraten.</div>
            </div>

            <div class="field">
              <label for="pricePower" data-i18n="f_pricePower">Strompreis (€/kWh) für Ersparnis</label>
              <input id="pricePower" type="number" step="0.001" min="0" data-save="m02_pricePower" />
              <div class="hint" data-i18n="h_pricePower">Ersparnis = selbst genutzte kWh × Strompreis (vereinfachte Logik).</div>
            </div>

            <div class="field">
              <label for="feedIn" data-i18n="f_feedIn">Einspeisevergütung (€/kWh)</label>
              <input id="feedIn" type="number" step="0.001" min="0" data-save="m02_feedIn" />
              <div class="hint" data-i18n="h_feedIn">Hier später: Nachweis/Quelle + Laufzeit/Regelwerk klären.</div>
            </div>

            <div class="field">
              <label for="deg" data-i18n="f_deg">Degradation (Ertragsrückgang) pro Jahr (%)</label>
              <input id="deg" type="number" step="0.01" min="0" max="10" data-save="m02_deg" />
              <div class="hint" data-i18n="h_deg">Für Robustheit: geringe, nachvollziehbare Annahme.</div>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="sourceNotes" data-i18n="f_sourceNotes">Quellen/Begründungen zu den Annahmen (Notizen)</label>
              <textarea id="sourceNotes" data-save="m02_sourceNotes"></textarea>
              <div class="hint" data-i18n="h_sourceNotes">z. B. Simulation, Anbieterunterlagen, Verbrauchsprofil, Messwerte, Standortdaten.</div>
            </div>
          </div>

          <div class="mini" data-i18n="mini_auto">
            Alle Eingaben werden automatisch lokal gespeichert. Änderungen aktualisieren die Tabelle sofort.
          </div>
        </div>

        <div class="section">
          <h3 data-i18n="sec_b">B) Ergebnis (Jahr 1 – vereinfachte Basislogik)</h3>
          <p data-i18n="sec_b_txt">
            Diese Tabelle ist bewusst simpel: Sie zeigt die Grundlogik (Energie → Ersparnis/Erlös). Details (Steuern, Finanzierung, Rücklagen, Preiseffekte) kommen in späteren Modulen.
          </p>

          <table class="table" aria-label="Basis-Ergebnis">
            <thead>
              <tr>
                <th data-i18n="th_key">Kennzahl</th>
                <th data-i18n="th_val">Wert</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td data-i18n="r_energy">Jahreserzeugung (kWh)</td>
                <td class="val" id="out_energy">–</td>
              </tr>
              <tr>
                <td data-i18n="r_self">Eigenverbrauch (kWh)</td>
                <td class="val" id="out_self">–</td>
              </tr>
              <tr>
                <td data-i18n="r_export">Einspeisung (kWh)</td>
                <td class="val" id="out_export">–</td>
              </tr>
              <tr>
                <td data-i18n="r_save">Ersparnis (€/Jahr)</td>
                <td class="val" id="out_save">–</td>
              </tr>
              <tr>
                <td data-i18n="r_rev">Erlös Einspeisung (€/Jahr)</td>
                <td class="val" id="out_rev">–</td>
              </tr>
              <tr>
                <td data-i18n="r_total"><strong>Summe Nutzen (€/Jahr)</strong></td>
                <td class="val" id="out_total">–</td>
              </tr>
            </tbody>
          </table>

          <div class="row">
            <div class="svgBox">
              <div class="svgTitle" data-i18n="chart_title">Diagramm: Ersparnis vs. Einspeiseerlös (Jahr 1)</div>
              <svg id="barSvg" viewBox="0 0 520 170" width="100%" height="170" role="img" aria-label="Balkendiagramm"></svg>
              <div class="chartNote" data-i18n="chart_note">
                Hinweis: Diagramm ist eine Visualisierung der vereinfachten Rechnung (keine Empfehlung).
              </div>
            </div>
          </div>
        </div>

        <div class="section" style="margin-bottom:0;">
          <h3 data-i18n="sec_c">C) PV-Logik als Gesprächsfragen</h3>
          <p data-i18n="sec_c_txt">
            Diese Fragen helfen dir, falsche oder geschönte Annahmen zu erkennen – ohne jemanden zu „überführen“. Es geht um saubere Nachweise.
          </p>

          <div class="row two">
            <div class="field">
              <label for="q1" data-i18n="q1_t">Frageblock: Ertrag / Simulation</label>
              <textarea id="q1" data-save="m02_q1"></textarea>
              <div class="hint" data-i18n="q1_h">Was ist die Quelle? Welche Annahmen (Verschattung, Neigung, Verluste)? Gibt es eine Simulation als PDF?</div>
            </div>
            <div class="field">
              <label for="q2" data-i18n="q2_t">Frageblock: Eigenverbrauch / Lastprofil</label>
              <textarea id="q2" data-save="m02_q2"></textarea>
              <div class="hint" data-i18n="q2_h">Woraus ergibt sich der Eigenverbrauch? Gibt es Verbrauchsdaten/Lastprofil? Wird Speicher angenommen?</div>
            </div>
          </div>

          <div class="row two">
            <div class="field">
              <label for="q3" data-i18n="q3_t">Frageblock: Einspeisung / Vergütung</label>
              <textarea id="q3" data-save="m02_q3"></textarea>
              <div class="hint" data-i18n="q3_h">Welche Vergütung gilt konkret? Ab wann? Welche Bedingungen/Registrierungen? Wer stellt welche Anträge?</div>
            </div>
            <div class="field">
              <label for="q4" data-i18n="q4_t">Frageblock: Messung / Monitoring</label>
              <textarea id="q4" data-save="m02_q4"></textarea>
              <div class="hint" data-i18n="q4_h">Wie wird Erzeugung gemessen? Monitoring? Wer hat Zugriff? Was passiert bei Abweichungen?</div>
            </div>
          </div>

          <div class="mini" data-i18n="mini_print">
            Druck-Tipp: Drucke Modul 2 und lege es in deine Projektakte. Spätere Module bauen auf diesen Annahmen auf.
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="sidebox">
        <h2 data-i18n="side_title">Übersicht: Stromfluss (Logik)</h2>

        <div class="svgBox" style="margin-bottom:10px;">
          <div class="svgTitle" data-i18n="flow_title">Grafik: PV → Haus → Netz</div>
          <svg viewBox="0 0 520 210" width="100%" height="210" role="img" aria-label="Stromfluss">
            <defs>
              <linearGradient id="gg" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#c8a63a"/>
                <stop offset="1" stop-color="#e0c466"/>
              </linearGradient>
            </defs>

            <!-- PV -->
            <rect x="22" y="46" width="150" height="72" rx="14" fill="rgba(200,166,58,.10)" stroke="rgba(17,18,20,.18)" />
            <path d="M40 88h110" stroke="rgba(17,18,20,.40)" stroke-width="3" stroke-linecap="round"/>
            <path d="M46 74h32M90 74h32M134 74h18" stroke="rgba(17,18,20,.35)" stroke-width="2" stroke-linecap="round"/>
            <circle cx="46" cy="60" r="12" fill="url(#gg)" opacity=".95"/>
            <text x="100" y="78" text-anchor="middle" font-size="12" font-weight="800" fill="rgba(17,18,20,.88)" data-i18n="flow_pv">PV-Anlage</text>
            <text x="100" y="96" text-anchor="middle" font-size="11" fill="rgba(71,80,95,.95)" data-i18n="flow_gen">Erzeugung (kWh)</text>

            <!-- House -->
            <rect x="200" y="32" width="150" height="100" rx="14" fill="rgba(11,125,92,.08)" stroke="rgba(17,18,20,.18)" />
            <path d="M230 74l45-32 45 32" fill="none" stroke="rgba(17,18,20,.40)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            <rect x="250" y="74" width="50" height="44" rx="8" fill="rgba(255,255,255,.8)" stroke="rgba(17,18,20,.20)"/>
            <text x="275" y="103" text-anchor="middle" font-size="10" font-weight="800" fill="rgba(17,18,20,.84)" data-i18n="flow_self">Eigenverbrauch</text>
            <text x="275" y="117" text-anchor="middle" font-size="10" fill="rgba(71,80,95,.95)" data-i18n="flow_save">Ersparnis</text>

            <!-- Grid -->
            <rect x="378" y="46" width="120" height="72" rx="14" fill="rgba(197,38,70,.06)" stroke="rgba(17,18,20,.18)" />
            <path d="M406 106h64" stroke="rgba(17,18,20,.35)" stroke-width="2" stroke-linecap="round"/>
            <path d="M418 56l-12 30h24l-12 30" fill="none" stroke="rgba(17,18,20,.42)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            <text x="438" y="78" text-anchor="middle" font-size="12" font-weight="800" fill="rgba(17,18,20,.88)" data-i18n="flow_grid">Netz</text>
            <text x="438" y="96" text-anchor="middle" font-size="11" fill="rgba(71,80,95,.95)" data-i18n="flow_feed">Einspeisung</text>

            <!-- arrows -->
            <path d="M172 82h26" stroke="rgba(17,18,20,.42)" stroke-width="3" stroke-linecap="round"/>
            <path d="M190 74l10 8-10 8" fill="none" stroke="rgba(17,18,20,.42)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>

            <path d="M350 82h22" stroke="rgba(17,18,20,.42)" stroke-width="3" stroke-linecap="round"/>
            <path d="M366 74l10 8-10 8" fill="none" stroke="rgba(17,18,20,.42)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>

            <!-- note -->
            <text x="260" y="168" text-anchor="middle" font-size="11" fill="rgba(71,80,95,.95)" data-i18n="flow_note">
              Logik: Erzeugung teilt sich in Eigenverbrauch + Einspeisung.
            </text>
          </svg>
        </div>

        <ul class="list">
          <li data-i18n="side_1">Ohne nachvollziehbare Ertragsquelle ist jede Rendite nur Behauptung.</li>
          <li data-i18n="side_2">Eigenverbrauch muss aus Lastprofil/Verbrauchsdaten ableitbar sein.</li>
          <li data-i18n="side_3">Einspeisung erfordert Prozess/Anmeldung – sonst ist die Vergütung nicht gesichert.</li>
          <li data-i18n="side_4">In späteren Modulen: Netzprozess, CAPEX/OPEX, Rücklagen, Szenarien.</li>
        </ul>

        <div class="navRow">
          <a class="btn" href="module-01.html" data-nocache="1" title="Modul 1">
            <span class="dot" aria-hidden="true"></span>
            <span data-i18n="btn_prev">Modul 1</span>
          </a>
          <a class="btn secondary" href="module-03.html" data-nocache="1" title="Modul 3">
            <span class="dot" aria-hidden="true"></span>
            <span data-i18n="btn_next">Modul 3</span>
          </a>
        </div>
      </div>
    </div>

    <div class="footer" data-i18n="footer">
      Modul 2 – PV-Logik. Druckbar. LocalStorage (lokal).
    </div>

  </div>

  <script>
    (function(){
      const LS_KEY_LANG = "fsa_pvka_lang";
      const LS_KEY_DATA = "fsa_pvka_project";

      const langSel = document.getElementById("langSel");
      const printBtn = document.getElementById("printBtn");
      const resetBtn = document.getElementById("resetBtn");

      const out_energy = document.getElementById("out_energy");
      const out_self   = document.getElementById("out_self");
      const out_export = document.getElementById("out_export");
      const out_save   = document.getElementById("out_save");
      const out_rev    = document.getElementById("out_rev");
      const out_total  = document.getElementById("out_total");
      const barSvg     = document.getElementById("barSvg");

      const i18n = {
        de: {
          brand_title: "Premium Kurs",
          brand_sub: "Photovoltaik als Kapitalanlage",
          lang_label: "Sprache",
          btn_index: "Index",
          btn_print: "Drucken",
          btn_reset: "Projektakte leeren",
          btn_prev: "Modul 1",
          btn_next: "Modul 3",

          badge1: "Modul 2 • PV-Logik",
          h1: "Modul 2 – Anlageklasse verstehen (PV-Logik)",
          sub: "In diesem Modul verstehst du den Kern: Eine PV-Anlage erzeugt Energie. Daraus entstehen zwei Effekte: (1) Ersparnis durch Eigenverbrauch, (2) Erlös durch Einspeisung. Du dokumentierst die Annahmen so, dass du sie im Profi-Gespräch gezielt prüfen kannst.",

          notice_title: "Wichtiger Hinweis:",
          notice_text: "Keine Anlageberatung, keine Steuer- oder Rechtsberatung. Dieses Modul dient der Befähigung: Logik verstehen, Annahmen prüfen, Nachweise einfordern.",

          left_title: "PV-Logik – Annahmen & Rechenblatt (Basis)",

          sec_a: "A) Stromfluss: Erzeugung → Eigenverbrauch / Einspeisung",
          sec_a_txt: "Nutze das Rechenblatt als Gesprächsgrundlage. Es geht nicht um „perfekte Werte“, sondern darum, dass jede Zahl eine Quelle oder Begründung hat.",
          f_kwp: "Anlagengröße (kWp)",
          h_kwp: "Beispiel: 8.0 kWp (Dach) / 500 kWp (Gewerbe) / etc.",
          f_specYield: "Spezifischer Ertrag (kWh pro kWp/Jahr)",
          h_specYield: "Wert muss plausibel begründet sein (Standort/Neigung/Simulation).",
          f_selfUse: "Eigenverbrauchsanteil (%)",
          h_selfUse: "Wichtig: Ohne Lastprofil/Verbrauchsdaten ist das oft geraten.",
          f_pricePower: "Strompreis (€/kWh) für Ersparnis",
          h_pricePower: "Ersparnis = selbst genutzte kWh × Strompreis (vereinfachte Logik).",
          f_feedIn: "Einspeisevergütung (€/kWh)",
          h_feedIn: "Hier später: Nachweis/Quelle + Laufzeit/Regelwerk klären.",
          f_deg: "Degradation (Ertragsrückgang) pro Jahr (%)",
          h_deg: "Für Robustheit: geringe, nachvollziehbare Annahme.",
          f_sourceNotes: "Quellen/Begründungen zu den Annahmen (Notizen)",
          h_sourceNotes: "z. B. Simulation, Anbieterunterlagen, Verbrauchsprofil, Messwerte, Standortdaten.",
          mini_auto: "Alle Eingaben werden automatisch lokal gespeichert. Änderungen aktualisieren die Tabelle sofort.",

          sec_b: "B) Ergebnis (Jahr 1 – vereinfachte Basislogik)",
          sec_b_txt: "Diese Tabelle ist bewusst simpel: Sie zeigt die Grundlogik (Energie → Ersparnis/Erlös). Details (Steuern, Finanzierung, Rücklagen, Preiseffekte) kommen in späteren Modulen.",
          th_key: "Kennzahl",
          th_val: "Wert",
          r_energy: "Jahreserzeugung (kWh)",
          r_self: "Eigenverbrauch (kWh)",
          r_export: "Einspeisung (kWh)",
          r_save: "Ersparnis (€/Jahr)",
          r_rev: "Erlös Einspeisung (€/Jahr)",
          r_total: "Summe Nutzen (€/Jahr)",
          chart_title: "Diagramm: Ersparnis vs. Einspeiseerlös (Jahr 1)",
          chart_note: "Hinweis: Diagramm ist eine Visualisierung der vereinfachten Rechnung (keine Empfehlung).",

          sec_c: "C) PV-Logik als Gesprächsfragen",
          sec_c_txt: "Diese Fragen helfen dir, falsche oder geschönte Annahmen zu erkennen – ohne jemanden zu „überführen“. Es geht um saubere Nachweise.",
          q1_t: "Frageblock: Ertrag / Simulation",
          q1_h: "Was ist die Quelle? Welche Annahmen (Verschattung, Neigung, Verluste)? Gibt es eine Simulation als PDF?",
          q2_t: "Frageblock: Eigenverbrauch / Lastprofil",
          q2_h: "Woraus ergibt sich der Eigenverbrauch? Gibt es Verbrauchsdaten/Lastprofil? Wird Speicher angenommen?",
          q3_t: "Frageblock: Einspeisung / Vergütung",
          q3_h: "Welche Vergütung gilt konkret? Ab wann? Welche Bedingungen/Registrierungen? Wer stellt welche Anträge?",
          q4_t: "Frageblock: Messung / Monitoring",
          q4_h: "Wie wird Erzeugung gemessen? Monitoring? Wer hat Zugriff? Was passiert bei Abweichungen?",
          mini_print: "Druck-Tipp: Drucke Modul 2 und lege es in deine Projektakte. Spätere Module bauen auf diesen Annahmen auf.",

          side_title: "Übersicht: Stromfluss (Logik)",
          flow_title: "Grafik: PV → Haus → Netz",
          flow_pv: "PV-Anlage",
          flow_gen: "Erzeugung (kWh)",
          flow_self: "Eigenverbrauch",
          flow_save: "Ersparnis",
          flow_grid: "Netz",
          flow_feed: "Einspeisung",
          flow_note: "Logik: Erzeugung teilt sich in Eigenverbrauch + Einspeisung.",

          side_1: "Ohne nachvollziehbare Ertragsquelle ist jede Rendite nur Behauptung.",
          side_2: "Eigenverbrauch muss aus Lastprofil/Verbrauchsdaten ableitbar sein.",
          side_3: "Einspeisung erfordert Prozess/Anmeldung – sonst ist die Vergütung nicht gesichert.",
          side_4: "In späteren Modulen: Netzprozess, CAPEX/OPEX, Rücklagen, Szenarien.",

          footer: "Modul 2 – PV-Logik. Druckbar. LocalStorage (lokal).",

          confirm_reset: "Alle gespeicherten Eingaben für diesen Kurs wirklich löschen?",
          alert_reset: "Projektakte wurde geleert.",

          chart_lbl_save: "Ersparnis",
          chart_lbl_rev: "Einspeisung",
          chart_axis: "€ / Jahr"
        },

        en: {
          brand_title: "Premium course",
          brand_sub: "Photovoltaics as a capital investment",
          lang_label: "Language",
          btn_index: "Index",
          btn_print: "Print",
          btn_reset: "Clear project file",
          btn_prev: "Module 1",
          btn_next: "Module 3",

          badge1: "Module 2 • PV logic",
          h1: "Module 2 – Understand PV as an asset class (PV logic)",
          sub: "This module covers the core logic: a PV system produces energy. Two effects follow: (1) savings from self-consumption, (2) revenue from feed-in. You document assumptions so you can verify them in a professional meeting.",

          notice_title: "Important notice:",
          notice_text: "No investment advice, no tax or legal advice. This module is educational: understand the logic, verify assumptions, request evidence.",

          left_title: "PV logic – assumptions & base worksheet",

          sec_a: "A) Energy flow: production → self-consumption / feed-in",
          sec_a_txt: "Use the worksheet as a meeting baseline. It is not about “perfect values”, but that every number has a source or justification.",
          f_kwp: "System size (kWp)",
          h_kwp: "Example: 8.0 kWp (roof) / 500 kWp (commercial) / etc.",
          f_specYield: "Specific yield (kWh per kWp/year)",
          h_specYield: "Must be plausible (site/tilt/shading/simulation).",
          f_selfUse: "Self-consumption share (%)",
          h_selfUse: "Without load profile/consumption data this is often a guess.",
          f_pricePower: "Electricity price (€/kWh) for savings",
          h_pricePower: "Savings = self-used kWh × electricity price (simplified logic).",
          f_feedIn: "Feed-in tariff (€/kWh)",
          h_feedIn: "Later: clarify evidence/source + conditions/timeframe.",
          f_deg: "Degradation (yield decline) per year (%)",
          h_deg: "For robustness: keep it conservative and explainable.",
          f_sourceNotes: "Sources/justifications for assumptions (notes)",
          h_sourceNotes: "e.g., simulation, provider docs, consumption profile, measurements, location data.",
          mini_auto: "All inputs are saved locally. Changes update the table instantly.",

          sec_b: "B) Result (Year 1 – simplified base logic)",
          sec_b_txt: "This table is intentionally simple: it shows the core logic (energy → savings/revenue). Details (tax, financing, reserves, price effects) come later.",
          th_key: "Metric",
          th_val: "Value",
          r_energy: "Annual production (kWh)",
          r_self: "Self-consumption (kWh)",
          r_export: "Feed-in (kWh)",
          r_save: "Savings (€/year)",
          r_rev: "Feed-in revenue (€/year)",
          r_total: "Total benefit (€/year)",
          chart_title: "Chart: savings vs. feed-in revenue (Year 1)",
          chart_note: "Note: the chart visualizes a simplified calculation (no recommendation).",

          sec_c: "C) PV logic as meeting questions",
          sec_c_txt: "These questions help you detect unrealistic assumptions without “accusing” anyone. It’s about clean evidence.",
          q1_t: "Question block: yield / simulation",
          q1_h: "What is the source? Which assumptions (shading, tilt, losses)? Is there a simulation PDF?",
          q2_t: "Question block: self-consumption / load profile",
          q2_h: "How is self-consumption derived? Any consumption data/load profile? Is storage assumed?",
          q3_t: "Question block: feed-in / tariff",
          q3_h: "Which tariff applies exactly? From when? Which conditions/registrations? Who files which applications?",
          q4_t: "Question block: metering / monitoring",
          q4_h: "How is production measured? Monitoring? Who has access? What happens on deviations?",
          mini_print: "Print tip: print Module 2 and add it to your project file. Later modules build on these assumptions.",

          side_title: "Overview: energy flow (logic)",
          flow_title: "Graphic: PV → home → grid",
          flow_pv: "PV system",
          flow_gen: "Production (kWh)",
          flow_self: "Self-use",
          flow_save: "Savings",
          flow_grid: "Grid",
          flow_feed: "Feed-in",
          flow_note: "Logic: production splits into self-use + feed-in.",

          side_1: "Without a traceable yield source, any return is just a claim.",
          side_2: "Self-consumption should be derived from load/consumption data.",
          side_3: "Feed-in requires a clear process/registration—otherwise revenue is not secured.",
          side_4: "Later modules: grid process, CAPEX/OPEX, reserves, scenarios.",

          footer: "Module 2 – PV logic. Printable. LocalStorage (local).",

          confirm_reset: "Clear all saved project inputs for this course?",
          alert_reset: "Project file cleared.",

          chart_lbl_save: "Savings",
          chart_lbl_rev: "Feed-in",
          chart_axis: "€ / year"
        }
      };

      function setText(lang){
        document.documentElement.lang = lang;
        document.querySelectorAll("[data-i18n]").forEach(el => {
          const key = el.getAttribute("data-i18n");
          const txt = (i18n[lang] && i18n[lang][key]) ? i18n[lang][key] : null;
          if(txt !== null) el.textContent = txt;
        });
      }

      function loadLang(){
        const saved = localStorage.getItem(LS_KEY_LANG);
        return saved === "en" ? "en" : "de";
      }
      function saveLang(lang){
        localStorage.setItem(LS_KEY_LANG, lang);
      }

      function loadData(){
        try{
          const raw = localStorage.getItem(LS_KEY_DATA);
          if(!raw) return {};
          const obj = JSON.parse(raw);
          return (obj && typeof obj === "object") ? obj : {};
        }catch(e){
          return {};
        }
      }
      function saveData(data){
        localStorage.setItem(LS_KEY_DATA, JSON.stringify(data));
      }

      function bindFields(){
        const data = loadData();
        document.querySelectorAll("[data-save]").forEach(el => {
          const k = el.getAttribute("data-save");
          if(Object.prototype.hasOwnProperty.call(data, k)){
            el.value = data[k];
          }
          const onChange = () => {
            const d = loadData();
            d[k] = el.value;
            saveData(d);
            recalc();
          };
          el.addEventListener("input", onChange);
          el.addEventListener("change", onChange);
        });
      }

      function toNum(v){
        const n = Number(String(v ?? "").replace(",", "."));
        return Number.isFinite(n) ? n : 0;
      }

      function fmtKWh(n){
        const x = Math.round(n);
        return x.toLocaleString(undefined);
      }
      function fmtEUR(n){
        const x = Math.round(n * 100) / 100;
        return x.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }

      function recalc(){
        const d = loadData();
        const kwp = toNum(d.m02_kwp);
        const spec = toNum(d.m02_specYield);
        const selfPct = Math.max(0, Math.min(100, toNum(d.m02_selfUse)));
        const pPower = toNum(d.m02_pricePower);
        const pFeed = toNum(d.m02_feedIn);

        const energy = Math.max(0, kwp * spec);
        const selfKWh = energy * (selfPct/100);
        const exportKWh = Math.max(0, energy - selfKWh);

        const saving = selfKWh * pPower;
        const revenue = exportKWh * pFeed;
        const total = saving + revenue;

        out_energy.textContent = energy ? (fmtKWh(energy) + " kWh") : "–";
        out_self.textContent = energy ? (fmtKWh(selfKWh) + " kWh") : "–";
        out_export.textContent = energy ? (fmtKWh(exportKWh) + " kWh") : "–";
        out_save.textContent = energy ? (fmtEUR(saving) + " €") : "–";
        out_rev.textContent = energy ? (fmtEUR(revenue) + " €") : "–";
        out_total.textContent = energy ? (fmtEUR(total) + " €") : "–";

        drawBars(saving, revenue, loadLang());
      }

      function drawBars(saving, revenue, lang){
        const w = 520, h = 170;
        const pad = 22;
        const barW = 150;
        const gap = 58;

        const maxV = Math.max(1, saving, revenue);
        const scale = (h - 70) / maxV;

        const sH = Math.max(0, saving * scale);
        const rH = Math.max(0, revenue * scale);

        const baseY = h - 34;
        const sX = pad + 40;
        const rX = sX + barW + gap;

        const axis = i18n[lang].chart_axis;
        const sLbl = i18n[lang].chart_lbl_save;
        const rLbl = i18n[lang].chart_lbl_rev;

        barSvg.innerHTML = `
          <rect x="0" y="0" width="${w}" height="${h}" rx="14"
            fill="rgba(255,255,255,.92)" stroke="rgba(17,18,20,.14)"></rect>

          <line x1="${pad}" y1="${baseY}" x2="${w-pad}" y2="${baseY}"
            stroke="rgba(17,18,20,.22)" stroke-width="2" stroke-linecap="round"></line>

          <text x="${pad}" y="22" font-size="11" font-weight="800" fill="rgba(71,80,95,.95)">${axis}</text>

          <rect x="${sX}" y="${baseY - sH}" width="${barW}" height="${sH}" rx="12"
            fill="rgba(11,125,92,.18)" stroke="rgba(11,125,92,.35)"></rect>

          <rect x="${rX}" y="${baseY - rH}" width="${barW}" height="${rH}" rx="12"
            fill="rgba(200,166,58,.18)" stroke="rgba(200,166,58,.45)"></rect>

          <text x="${sX + barW/2}" y="${baseY + 18}" text-anchor="middle" font-size="12" font-weight="900"
            fill="rgba(17,18,20,.88)">${sLbl}</text>

          <text x="${rX + barW/2}" y="${baseY + 18}" text-anchor="middle" font-size="12" font-weight="900"
            fill="rgba(17,18,20,.88)">${rLbl}</text>

          <text x="${sX + barW/2}" y="${baseY - sH - 10}" text-anchor="middle" font-size="12" font-weight="900"
            fill="rgba(17,18,20,.88)">${fmtEUR(saving)} €</text>

          <text x="${rX + barW/2}" y="${baseY - rH - 10}" text-anchor="middle" font-size="12" font-weight="900"
            fill="rgba(17,18,20,.88)">${fmtEUR(revenue)} €</text>
        `;
      }

      function applyNoCache(){
        const ts = Date.now();
        document.querySelectorAll('a[data-nocache="1"]').forEach(link => {
          const href = link.getAttribute("href");
          const url = new URL(href, location.href);
          url.searchParams.set("nocache", String(ts));
          link.setAttribute("href", url.pathname.split("/").pop() + "?" + url.searchParams.toString());
        });
      }

      // init
      const lang = loadLang();
      langSel.value = lang;
      setText(lang);
      bindFields();
      applyNoCache();
      recalc();

      langSel.addEventListener("change", () => {
        const l = langSel.value === "en" ? "en" : "de";
        saveLang(l);
        setText(l);
        recalc();
      });

      printBtn.addEventListener("click", () => window.print());

      resetBtn.addEventListener("click", () => {
        const l = langSel.value === "en" ? "en" : "de";
        const ok = confirm(i18n[l].confirm_reset);
        if(!ok) return;
        localStorage.removeItem(LS_KEY_DATA);
        alert(i18n[l].alert_reset);
        location.reload();
      });

    })();
  </script>
</body>
</html>
