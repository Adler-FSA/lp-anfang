<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FSA Club – Produktshow (Pyramide)</title>
  <meta name="robots" content="noindex,nofollow" />

  <style>
    :root{
      --bg:#050814; --bg2:#020617;
      --panel:rgba(15,23,42,.90); --panel2:rgba(15,23,42,.72);
      --txt:#e9eef7; --muted:#a9b4c7;
      --gold:#d4af37; --gold2:#f2d37a;
      --line:rgba(212,175,55,.38);
      --shadow:0 24px 60px rgba(0,0,0,.55);
      --radius:18px;
      --tile:4cm;
    }

    html,body{height:100%;}
    body{
      margin:0;color:var(--txt);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(900px 600px at 20% 15%, rgba(212,175,55,.18), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(94,168,255,.14), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      overflow-x:hidden;
    }
    .wrap{width:100%;margin:0 auto;padding:28px 18px 60px;box-sizing:border-box;}

    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 16px;border:1px solid var(--line);border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(15,23,42,.92), rgba(15,23,42,.72));
      box-shadow:var(--shadow);
    }
    .brand{display:flex;flex-direction:column;gap:2px;}
    .brand h1{
      margin:0;font-size:18px;letter-spacing:.3px;color:var(--gold2);
      text-shadow:0 0 18px rgba(212,175,55,.22);
    }
    .brand p{margin:0;font-size:13px;color:var(--muted);}

    .actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end;}
    .btn{
      appearance:none;border:1px solid rgba(212,175,55,.46);
      background:linear-gradient(180deg, rgba(212,175,55,.20), rgba(212,175,55,.10));
      color:var(--txt);padding:10px 12px;border-radius:14px;cursor:pointer;
      box-shadow:0 0 18px rgba(212,175,55,.14);
      font-weight:700;font-size:13px;letter-spacing:.2px;
      transition:transform .12s ease, filter .12s ease;
      user-select:none;white-space:nowrap;
      text-decoration:none;display:inline-flex;align-items:center;justify-content:center;
    }
    .btn:hover{transform:translateY(-1px);filter:brightness(1.07);}
    .btn:active{transform:translateY(0);filter:brightness(.98);}
    .btn.secondary{
      border:1px solid rgba(148,163,184,.30);
      background:linear-gradient(180deg, rgba(148,163,184,.12), rgba(148,163,184,.06));
      box-shadow:none;color:var(--txt);font-weight:700;
    }

    .section{
      margin-top:18px;border:1px solid var(--line);border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(15,23,42,.88), rgba(15,23,42,.68));
      box-shadow:var(--shadow);overflow:hidden;
    }
    .sectionHead{
      padding:14px 16px;border-bottom:1px solid rgba(212,175,55,.22);
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;
    }
    .sectionHead h2{margin:0;font-size:16px;color:var(--gold2);}
    .sectionHead .hint{margin:2px 0 0 0;font-size:13px;color:var(--muted);}

    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;}

    .pyrWrap{padding:18px 16px 22px;display:flex;flex-direction:column;align-items:center;gap:12px;}
    .stage{
      width:100%;
      height:min(72vh, 720px);
      min-height:520px;
      position:relative;
      border-radius:18px;
      border:1px solid rgba(212,175,55,.20);
      background:
        radial-gradient(620px 320px at 50% 28%, rgba(212,175,55,.10), transparent 65%),
        radial-gradient(620px 320px at 50% 82%, rgba(94,168,255,.08), transparent 70%),
        rgba(0,0,0,.16);
      box-shadow:0 22px 60px rgba(0,0,0,.55);
      overflow:hidden;
    }

    .centerLabel{
      position:absolute;left:50%;top:20%;
      transform:translate(-50%,-50%);
      text-align:center;pointer-events:none;z-index:50;opacity:.95;
    }
    .centerLabel .big{
      font-weight:1000;letter-spacing:.8px;font-size:42px;color:var(--gold2);
      text-shadow: 0 0 24px rgba(212,175,55,.22), 0 18px 52px rgba(0,0,0,.60);
      line-height:1.06;white-space:nowrap;
    }
    .centerLabel .small{
      margin-top:6px;font-size:13px;color:rgba(233,238,247,.80);
      text-shadow:0 10px 30px rgba(0,0,0,.55);
    }

    .stack3d{
      position:absolute;
      left:50%;top:56%;
      transform-style:preserve-3d;
      width:1px;height:1px;
      will-change:transform;
    }

    .card3d{
      position:absolute;left:0;top:0;
      width:var(--tile);height:var(--tile);
      border-radius:14px;overflow:hidden;
      border:1px solid rgba(212,175,55,.28);
      box-shadow:0 18px 42px rgba(0,0,0,.55);
      transform-style:preserve-3d;
      background:rgba(0,0,0,.22);
      backface-visibility:hidden;
      will-change:transform;
    }
    .card3d img{width:100%;height:100%;object-fit:cover;display:block;transform:translateZ(0);}
    .card3d::before{
      content:"";position:absolute;inset:0;
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.28));
      pointer-events:none;
    }

    .warn{
      margin:0;padding:12px 16px;
      color:rgba(242,211,122,.92);
      font-size:13px;
      border-top:1px solid rgba(212,175,55,.14);
      background:rgba(0,0,0,.14);
    }

    @media (max-width:520px){
      .centerLabel .big{font-size:34px;}
      .stage{min-height:460px;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand">
        <h1 data-i18n="title">FSA Club – Produktshow (Pyramide)</h1>
        <p data-i18n="subtitle">Konfiguration kommt aus dem Center</p>
      </div>

      <div class="actions">
        <a class="btn secondary" href="index.html" data-i18n="back">Center</a>
        <button class="btn secondary" id="btnDE">DE</button>
        <button class="btn secondary" id="btnEN">EN</button>
      </div>
    </header>

    <section class="section" aria-label="Pyramide">
      <div class="sectionHead">
        <div>
          <h2 data-i18n="pyr_h">3D-Pyramide</h2>
          <p class="hint" data-i18n="pyr_p">Spitze oben = Start (⭐ Top oder erstes Element).</p>
        </div>
        <div class="controls">
          <button class="btn secondary" id="btnView1" data-i18n="view1">Ansicht: Standard</button>
          <button class="btn secondary" id="btnView2" data-i18n="view2">Ansicht: Mehr Schräg</button>
          <button class="btn secondary" id="btnView3" data-i18n="view3">Ansicht: Front</button>
        </div>
      </div>

      <div class="pyrWrap">
        <div class="stage" id="pyrStage">
          <div class="centerLabel">
            <div class="big">FSA Club</div>
            <div class="small" data-i18n="center_note">Produktpakete / Übersicht</div>
          </div>
          <div class="stack3d" id="stack3d"></div>
        </div>
      </div>

      <p class="warn" id="warnLine" data-i18n="warn">
        Hinweis: Wenn du weniger Bilder auswählst, wird die Pyramide automatisch kleiner aufgebaut.
      </p>
    </section>
  </div>

  <script>
    const BASE = "../../library/images/produkte/";
    const FILES = [
      "ewg2-0.jpg","geschenk-01.jpg","geschenk-02.jpg","geschenk-03.jpeg",
      "hoersaal-vorschau.jpeg","produkt-01-club-mitgliedschaft.jpeg","produkt-02-leadmaschine.jpeg",
      "produkt-03-live-formate-events.jpeg","produkt-04-weekend-setup-2-tage-workshop.jpeg",
      "produkt-05-hoersaal-angebot-lizenz.jpeg","produkt-06-krypto-setup-kurs.jpeg",
      "produkt-07-trading-grundkurs.jpeg","produkt-08-nft-basis-orientierung.jpeg",
      "produkt-09-buch.jpeg","solar-invest.jpg"
    ];

    const LS_KEY_LANG   = "fsa_lang";
    const LS_KEY_ORDER  = "fsa_product_order_shared_v1";
    const LS_KEY_SEL    = "fsa_product_selected_shared_v1";
    const LS_KEY_TOP    = "fsa_bundle_pyr_top_shared_v1";

    const I18N = {
      de:{
        title:"FSA Club – Produktshow (Pyramide)",
        subtitle:"Konfiguration kommt aus dem Center",
        back:"Center",
        pyr_h:"3D-Pyramide",
        pyr_p:"Spitze oben = Start (⭐ Top oder erstes Element).",
        view1:"Ansicht: Standard",
        view2:"Ansicht: Mehr Schräg",
        view3:"Ansicht: Front",
        center_note:"Produktpakete / Übersicht",
        warn:"Hinweis: Wenn du weniger Bilder auswählst, wird die Pyramide automatisch kleiner aufgebaut.",
        empty:"Keine Auswahl im Center – bitte dort mindestens 1 Bild auswählen."
      },
      en:{
        title:"FSA Club – Product Showcase (Pyramid)",
        subtitle:"Configuration is loaded from Center",
        back:"Center",
        pyr_h:"3D Pyramid",
        pyr_p:"Tip on top = start (⭐ Top or first item).",
        view1:"View: Standard",
        view2:"View: More Tilt",
        view3:"View: Front",
        center_note:"Product packages / overview",
        warn:"Note: If you select fewer images, the pyramid becomes smaller automatically.",
        empty:"No selection in Center – please select at least 1 image there."
      }
    };

    let lang = (localStorage.getItem(LS_KEY_LANG) || "de").toLowerCase();
    if(!I18N[lang]) lang = "de";

    function safeJSONParse(raw,fallback){ try{return JSON.parse(raw);}catch(e){return fallback;} }
    function loadOrder(){
      const raw = localStorage.getItem(LS_KEY_ORDER);
      if(!raw) return FILES.slice();
      const arr = safeJSONParse(raw,null);
      return Array.isArray(arr) ? arr.filter(x=>typeof x==="string") : FILES.slice();
    }
    function loadSelection(){
      const raw = localStorage.getItem(LS_KEY_SEL);
      if(!raw) return FILES.slice();
      const arr = safeJSONParse(raw,null);
      return Array.isArray(arr) ? arr.filter(x=>typeof x==="string") : FILES.slice();
    }

    function applyI18n(){
      document.documentElement.lang = lang;
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const k = el.getAttribute("data-i18n");
        const v = I18N[lang][k];
        if(typeof v === "string") el.textContent = v;
      });
    }

    function getTilePx(){
      const probe = document.createElement("div");
      probe.style.width = "var(--tile)";
      probe.style.position = "absolute";
      probe.style.left = "-9999px";
      document.body.appendChild(probe);
      const w = probe.getBoundingClientRect().width || 160;
      document.body.removeChild(probe);
      return Math.max(80, w);
    }

    const stack = document.getElementById("stack3d");
    const stage = document.getElementById("pyrStage");
    let currentView = 1;

    function computeRowsTopDown(n){
      const rows = [];
      let placed = 0;
      let k = 1;
      while(placed < n){
        const take = Math.min(k, n - placed);
        rows.push(take);
        placed += take;
        k++;
        if(k > 8 && placed < n) k = 8;
      }
      return rows;
    }

    function setView(mode){
      currentView = mode;
      render();
    }

    function applyRootTransform(shiftX, shiftY){
      const el = document.getElementById("stack3d");
      let base = "";
      if(currentView === 1) base = "perspective(1200px) rotateY(-22deg) rotateX(12deg)";
      else if(currentView === 2) base = "perspective(1200px) rotateY(-34deg) rotateX(16deg)";
      else base = "perspective(1200px) rotateY(-6deg) rotateX(6deg)";
      el.style.transform = `translate(-50%,-50%) translate3d(${-shiftX}px, ${-shiftY}px, 0px) ${base}`;
    }

    function render(){
      const order = loadOrder().filter(fn => FILES.includes(fn));
      const sel = new Set(loadSelection().filter(fn => FILES.includes(fn)));

      const top = (localStorage.getItem(LS_KEY_TOP) || "").trim();
      let list = order.filter(fn => sel.has(fn));

      if(!list.length){
        document.getElementById("warnLine").textContent = I18N[lang].empty;
        stack.innerHTML = "";
        return;
      }

      if(top && list.includes(top)){
        list = [top].concat(list.filter(x=>x!==top));
      }

      document.getElementById("warnLine").textContent = I18N[lang].warn;

      stack.innerHTML = "";
      const n = list.length;
      const rows = computeRowsTopDown(n);

      const tilePx = getTilePx();
      const rect = stage.getBoundingClientRect();
      const stageW = Math.max(320, rect.width);
      const stageH = Math.max(360, rect.height);

      /* spacing prevents overlap */
      let X = Math.round(tilePx * 1.18);
      let Y = Math.round(tilePx * 1.12);
      let Z = Math.round(tilePx * 0.08);

      const minX = Math.round(tilePx * 1.06);
      const minY = Math.round(tilePx * 1.00);

      const maxCount = Math.max(...rows);
      const neededW = (maxCount - 1) * X + tilePx;
      if(neededW > stageW * 0.88){
        const scale = (stageW * 0.88) / neededW;
        X = Math.max(minX, Math.floor(X * scale));
      }

      const neededH = (rows.length - 1) * Y + tilePx;
      if(neededH > stageH * 0.62){
        const scale = (stageH * 0.62) / neededH;
        Y = Math.max(minY, Math.floor(Y * scale));
      }

      /* positions (TIP ON TOP): r=0 is top row, r increases downward */
      let idx = 0;
      const pos = [];
      for(let r=0; r<rows.length; r++){
        const count = rows[r];
        const rowWidth = (count - 1) * X;
        for(let c=0; c<count; c++){
          const fn = list[idx++];
          if(!fn) break;
          const x = (c * X) - (rowWidth / 2);
          const y = (r * Y);     // down
          const z = (r * Z);
          pos.push({fn,x,y,z});
        }
      }

      /* bounding box for centering */
      const minXb = Math.min(...pos.map(p=>p.x));
      const maxXb = Math.max(...pos.map(p=>p.x));
      const minYb = Math.min(...pos.map(p=>p.y));
      const maxYb = Math.max(...pos.map(p=>p.y));
      const cx = (minXb + maxXb) / 2;
      const cy = (minYb + maxYb) / 2;

      pos.forEach(p=>{
        const card = document.createElement("div");
        card.className = "card3d";
        const img = document.createElement("img");
        img.loading = "lazy";
        img.alt = "";
        img.src = BASE + p.fn;

        card.style.transform = `translate3d(${p.x}px, ${p.y}px, ${p.z}px) rotateZ(0deg)`;
        card.style.zIndex = String(1000 + Math.round(p.z));
        card.appendChild(img);
        stack.appendChild(card);
      });

      applyRootTransform(cx, cy);
    }

    document.getElementById("btnDE").addEventListener("click", ()=>{
      lang = "de"; localStorage.setItem(LS_KEY_LANG, lang); applyI18n(); render();
    });
    document.getElementById("btnEN").addEventListener("click", ()=>{
      lang = "en"; localStorage.setItem(LS_KEY_LANG, lang); applyI18n(); render();
    });

    document.getElementById("btnView1").addEventListener("click", ()=> setView(1));
    document.getElementById("btnView2").addEventListener("click", ()=> setView(2));
    document.getElementById("btnView3").addEventListener("click", ()=> setView(3));

    window.addEventListener("resize", render);

    applyI18n();
    render();
  </script>
</body>
</html>
