<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FSA Club â€“ Produktshow (Halbkreis)</title>
  <meta name="robots" content="noindex,nofollow" />

  <style>
    :root{
      --bg:#050814; --bg2:#020617;
      --panel:rgba(15,23,42,.90); --panel2:rgba(15,23,42,.72);
      --txt:#e9eef7; --muted:#a9b4c7;
      --gold:#d4af37; --gold2:#f2d37a;
      --line:rgba(212,175,55,.38);
      --shadow:0 24px 60px rgba(0,0,0,.55);
      --radius:18px;
      --tile:4cm;
    }

    html,body{height:100%;}
    body{
      margin:0;color:var(--txt);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(900px 600px at 20% 15%, rgba(212,175,55,.18), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(94,168,255,.14), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      overflow-x:hidden;
    }

    .wrap{width:100%;margin:0 auto;padding:28px 18px 60px;box-sizing:border-box;}

    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 16px;border:1px solid var(--line);border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(15,23,42,.92), rgba(15,23,42,.72));
      box-shadow:var(--shadow);
    }
    .brand{display:flex;flex-direction:column;gap:2px;}
    .brand h1{
      margin:0;font-size:18px;letter-spacing:.3px;color:var(--gold2);
      text-shadow:0 0 18px rgba(212,175,55,.22);
    }
    .brand p{margin:0;font-size:13px;color:var(--muted);}

    .actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end;}
    .btn{
      appearance:none;border:1px solid rgba(212,175,55,.46);
      background:linear-gradient(180deg, rgba(212,175,55,.20), rgba(212,175,55,.10));
      color:var(--txt);padding:10px 12px;border-radius:14px;cursor:pointer;
      box-shadow:0 0 18px rgba(212,175,55,.14);
      font-weight:700;font-size:13px;letter-spacing:.2px;
      transition:transform .12s ease, filter .12s ease;
      user-select:none;white-space:nowrap;
      text-decoration:none;display:inline-flex;align-items:center;justify-content:center;
    }
    .btn:hover{transform:translateY(-1px);filter:brightness(1.07);}
    .btn:active{transform:translateY(0);filter:brightness(.98);}
    .btn.secondary{
      border:1px solid rgba(148,163,184,.30);
      background:linear-gradient(180deg, rgba(148,163,184,.12), rgba(148,163,184,.06));
      box-shadow:none;color:var(--txt);font-weight:700;
    }

    .section{
      margin-top:18px;border:1px solid var(--line);border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(15,23,42,.88), rgba(15,23,42,.68));
      box-shadow:var(--shadow);overflow:hidden;
    }
    .sectionHead{
      padding:14px 16px;border-bottom:1px solid rgba(212,175,55,.22);
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;
    }
    .sectionHead h2{margin:0;font-size:16px;color:var(--gold2);}
    .sectionHead .hint{margin:2px 0 0 0;font-size:13px;color:var(--muted);}

    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;}

    .arcWrap{padding:18px 16px 22px;display:flex;flex-direction:column;align-items:center;gap:12px;}
    .arcStage{
      width:100%;
      height:min(72vh, 720px);
      min-height:520px;
      position:relative;
      border-radius:18px;
      border:1px solid rgba(212,175,55,.20);
      background:
        radial-gradient(680px 360px at 50% 52%, rgba(212,175,55,.10), transparent 70%),
        radial-gradient(680px 360px at 50% 90%, rgba(94,168,255,.08), transparent 70%),
        rgba(0,0,0,.14);
      box-shadow:0 22px 60px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .arc3d{
      position:absolute;
      left:50%;
      top:60%;
      width:1px;height:1px;
      transform-style:preserve-3d;
      will-change:transform;
    }
    .arcCard{
      position:absolute;left:0;top:0;
      width:var(--tile);height:var(--tile);
      border-radius:16px;overflow:hidden;
      border:1px solid rgba(212,175,55,.28);
      background:rgba(0,0,0,.20);
      box-shadow:0 20px 52px rgba(0,0,0,.58);
      transform-style:preserve-3d;
      backface-visibility:hidden;
      will-change:transform;
    }
    .arcCard img{width:100%;height:100%;object-fit:cover;display:block;transform:translateZ(0);}
    .arcCard::before{
      content:"";position:absolute;inset:0;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.34));
      pointer-events:none;
    }

    .warn{
      margin:0;padding:12px 16px;
      color:rgba(242,211,122,.92);
      font-size:13px;
      border-top:1px solid rgba(212,175,55,.14);
      background:rgba(0,0,0,.14);
    }

    @media (max-width:520px){
      .arcStage{min-height:460px;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand">
        <h1 data-i18n="title">FSA Club â€“ Produktshow (Halbkreis)</h1>
        <p data-i18n="subtitle">Konfiguration kommt aus dem Center</p>
      </div>

      <div class="actions">
        <a class="btn secondary" href="index.html" data-i18n="back">Center</a>
        <button class="btn secondary" id="btnDE">DE</button>
        <button class="btn secondary" id="btnEN">EN</button>
      </div>
    </header>

    <section class="section" aria-label="Halbkreis">
      <div class="sectionHead">
        <div>
          <h2 data-i18n="arc_h">3D-Halbkreis</h2>
          <p class="hint" data-i18n="arc_p">Center = ðŸŽ¯ (oder erstes Element). Links/Rechts wie im Center festgelegt.</p>
        </div>
        <div class="controls">
          <button class="btn secondary" id="btnArc1" data-i18n="arc_view1">Ansicht: Standard</button>
          <button class="btn secondary" id="btnArc2" data-i18n="arc_view2">Ansicht: Mehr Tiefe</button>
          <button class="btn secondary" id="btnArc3" data-i18n="arc_view3">Ansicht: Front</button>
        </div>
      </div>

      <div class="arcWrap">
        <div class="arcStage" id="arcStage">
          <div class="arc3d" id="arc3d"></div>
        </div>
      </div>

      <p class="warn" id="warnArc" data-i18n="warn_arc">
        Hinweis: Reihenfolge/Center/Links/Rechts kommt aus dem Center.
      </p>
    </section>
  </div>

  <script>
    const BASE = "../../library/images/produkte/";
    const FILES = [
      "ewg2-0.jpg","geschenk-01.jpg","geschenk-02.jpg","geschenk-03.jpeg",
      "hoersaal-vorschau.jpeg","produkt-01-club-mitgliedschaft.jpeg","produkt-02-leadmaschine.jpeg",
      "produkt-03-live-formate-events.jpeg","produkt-04-weekend-setup-2-tage-workshop.jpeg",
      "produkt-05-hoersaal-angebot-lizenz.jpeg","produkt-06-krypto-setup-kurs.jpeg",
      "produkt-07-trading-grundkurs.jpeg","produkt-08-nft-basis-orientierung.jpeg",
      "produkt-09-buch.jpeg","solar-invest.jpg"
    ];

    const LS_KEY_LANG   = "fsa_lang";
    const LS_KEY_ORDER  = "fsa_product_order_shared_v1";
    const LS_KEY_SEL    = "fsa_product_selected_shared_v1";
    const LS_KEY_CENTER = "fsa_bundle_arc_center_shared_v1";
    const LS_KEY_SIDE   = "fsa_bundle_arc_side_map_shared_v1"; // { filename: "auto"|"left"|"right" }

    const I18N = {
      de:{
        title:"FSA Club â€“ Produktshow (Halbkreis)",
        subtitle:"Konfiguration kommt aus dem Center",
        back:"Center",
        arc_h:"3D-Halbkreis",
        arc_p:"Center = ðŸŽ¯ (oder erstes Element). Links/Rechts wie im Center festgelegt.",
        arc_view1:"Ansicht: Standard",
        arc_view2:"Ansicht: Mehr Tiefe",
        arc_view3:"Ansicht: Front",
        warn_arc:"Hinweis: Reihenfolge/Center/Links/Rechts kommt aus dem Center.",
        empty:"Keine Auswahl im Center â€“ bitte dort mindestens 1 Bild auswÃ¤hlen."
      },
      en:{
        title:"FSA Club â€“ Product Showcase (Semicircle)",
        subtitle:"Configuration is loaded from Center",
        back:"Center",
        arc_h:"3D Semicircle",
        arc_p:"Center = ðŸŽ¯ (or first item). Left/Right as set in Center.",
        arc_view1:"View: Standard",
        arc_view2:"View: More Depth",
        arc_view3:"View: Front",
        warn_arc:"Note: Order/Center/Left-Right comes from Center.",
        empty:"No selection in Center â€“ please select at least 1 image there."
      }
    };

    let lang = (localStorage.getItem(LS_KEY_LANG) || "de").toLowerCase();
    if(!I18N[lang]) lang = "de";

    function safeJSONParse(raw,fallback){ try{return JSON.parse(raw);}catch(e){return fallback;} }

    function loadOrder(){
      const raw = localStorage.getItem(LS_KEY_ORDER);
      if(!raw) return FILES.slice();
      const arr = safeJSONParse(raw,null);
      return Array.isArray(arr) ? arr.filter(x=>typeof x==="string") : FILES.slice();
    }
    function loadSelection(){
      const raw = localStorage.getItem(LS_KEY_SEL);
      if(!raw) return FILES.slice();
      const arr = safeJSONParse(raw,null);
      return Array.isArray(arr) ? arr.filter(x=>typeof x==="string") : FILES.slice();
    }
    function loadCenter(){
      return (localStorage.getItem(LS_KEY_CENTER) || "").trim();
    }
    function loadSideMap(){
      const raw = localStorage.getItem(LS_KEY_SIDE);
      const obj = raw ? safeJSONParse(raw, {}) : {};
      return (obj && typeof obj === "object") ? obj : {};
    }

    function applyI18n(){
      document.documentElement.lang = lang;
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const k = el.getAttribute("data-i18n");
        const v = I18N[lang][k];
        if(typeof v === "string") el.textContent = v;
      });
    }

    function getTilePx(){
      const probe = document.createElement("div");
      probe.style.width = "var(--tile)";
      probe.style.position = "absolute";
      probe.style.left = "-9999px";
      document.body.appendChild(probe);
      const w = probe.getBoundingClientRect().width || 160;
      document.body.removeChild(probe);
      return Math.max(80, w);
    }

    const arc3d = document.getElementById("arc3d");
    const arcStage = document.getElementById("arcStage");
    let currentArcView = 1;

    function setArcView(mode){
      currentArcView = mode;
      if(mode === 1){
        arc3d.style.transform = "translate(-50%,-50%) perspective(1400px) rotateX(10deg) rotateY(0deg)";
      }else if(mode === 2){
        arc3d.style.transform = "translate(-50%,-50%) perspective(1400px) rotateX(14deg) rotateY(-10deg)";
      }else{
        arc3d.style.transform = "translate(-50%,-50%) perspective(1400px) rotateX(6deg) rotateY(0deg)";
      }
    }

    function buildArcFromList(list, arcCenter, sideMap){
      arc3d.innerHTML = "";

      const n = list.length;
      if(n <= 0) return;

      const tilePx = getTilePx();
      const rect = arcStage.getBoundingClientRect();
      const stageW = Math.max(320, rect.width);

      const centerFn = (arcCenter && list.includes(arcCenter)) ? arcCenter : list[0];
      const rest = list.filter(fn => fn !== centerFn);

      const left = [];
      const right = [];
      rest.forEach(fn=>{
        const side = (sideMap && sideMap[fn]) ? sideMap[fn] : "auto";
        if(side === "left") left.push(fn);
        else if(side === "right") right.push(fn);
        else{
          if(left.length <= right.length) left.push(fn);
          else right.push(fn);
        }
      });

      const total = 1 + left.length + right.length;

      // span tuning (more items => wider arc)
      const baseSpan = Math.min(175, 110 + Math.max(0, (total - 6) * 6));
      const denom = Math.max(1, (left.length + right.length));
      const spanL = baseSpan * (left.length / denom);
      const spanR = baseSpan * (right.length / denom);

      let radius = Math.min(620, stageW * 0.44);
      radius = Math.max(300, radius - (total * 8));

      const depth = Math.max(160, Math.round(tilePx * 1.25));
      const lift  = Math.max(50,  Math.round(tilePx * 0.45));

      function renderCard(fn, angDeg){
        const ang = (angDeg * Math.PI) / 180;
        const x = Math.sin(ang) * radius;
        const y = Math.cos(ang) * lift;
        const z = Math.cos(ang) * depth;
        const faceY = angDeg * 0.55;

        const card = document.createElement("div");
        card.className = "arcCard";

        const img = document.createElement("img");
        img.loading = "lazy";
        img.alt = "";
        img.src = BASE + fn;

        card.style.transform =
          `translate3d(${x}px, ${-y}px, ${z}px) rotateY(${faceY}deg) rotateX(2deg) rotateZ(0deg)`;
        card.style.zIndex = String(1000 + Math.round(z));

        card.appendChild(img);
        arc3d.appendChild(card);
      }

      // center
      renderCard(centerFn, 0);

      // left
      if(left.length){
        const stepL = (left.length === 1) ? (spanL || 18) : (spanL / left.length);
        left.forEach((fn, i)=> renderCard(fn, -stepL * (i + 1)));
      }

      // right
      if(right.length){
        const stepR = (right.length === 1) ? (spanR || 18) : (spanR / right.length);
        right.forEach((fn, i)=> renderCard(fn, +stepR * (i + 1)));
      }
    }

    function render(){
      const order = loadOrder().filter(fn => FILES.includes(fn));
      const sel = new Set(loadSelection().filter(fn => FILES.includes(fn)));
      const list = order.filter(fn => sel.has(fn));

      const arcCenter = loadCenter();
      const sideMap = loadSideMap();

      if(list.length <= 0){
        document.getElementById("warnArc").textContent = I18N[lang].empty;
        arc3d.innerHTML = "";
        return;
      }

      document.getElementById("warnArc").textContent = I18N[lang].warn_arc;
      buildArcFromList(list, arcCenter, sideMap);
    }

    // EVENTS
    document.getElementById("btnDE").addEventListener("click", ()=>{
      lang = "de"; localStorage.setItem(LS_KEY_LANG, lang);
      applyI18n();
      render();
    });
    document.getElementById("btnEN").addEventListener("click", ()=>{
      lang = "en"; localStorage.setItem(LS_KEY_LANG, lang);
      applyI18n();
      render();
    });

    document.getElementById("btnArc1").addEventListener("click", ()=>{ setArcView(1); render(); });
    document.getElementById("btnArc2").addEventListener("click", ()=>{ setArcView(2); render(); });
    document.getElementById("btnArc3").addEventListener("click", ()=>{ setArcView(3); render(); });

    window.addEventListener("resize", ()=> render());

    // INIT
    applyI18n();
    setArcView(1);
    render();
  </script>
</body>
</html>
