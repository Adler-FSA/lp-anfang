<!doctype html>
<html lang="de" data-lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Produkte – Beschreibungen (Editor)</title>
  <meta name="description" content="Produktbeschreibungen Editor: Leistung + Sinn/Zweck je Produkt, Live speichern in LocalStorage, Export/Import + Druck/PDF. DE/EN." />
  <meta name="robots" content="noindex,nofollow" />

  <style>
    :root{
      --bg:#ffffff;
      --ink:#0f172a;
      --muted:#5b667a;
      --line:#e7edf3;
      --card:#f6f9fb;
      --accent:#1aa6b8;
      --accent2:#0f7f8c;
      --shadow: 0 12px 28px rgba(15,23,42,.08);
      --radius:14px;
      --max:1100px;
      --btnText:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:inherit;text-decoration:none}

    .topbar{position:sticky;top:0;z-index:20;background:#fff;border-bottom:1px solid var(--line)}
    .topbar .inner{max-width:var(--max);margin:0 auto;padding:14px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg, rgba(26,166,184,.18), rgba(15,127,140,.10));border:1px solid rgba(26,166,184,.25);display:grid;place-items:center}
    .brand h1{margin:0;font-size:16px;line-height:1.2}
    .brand .sub{margin:0;font-size:12px;color:var(--muted)}

    .lang{display:flex;align-items:center;gap:8px}
    .lang button{border:1px solid var(--line);background:#fff;padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:900;color:var(--ink)}
    .lang button.active{border-color:rgba(26,166,184,.55);box-shadow:0 0 0 4px rgba(26,166,184,.10);color:var(--accent2)}

    .wrap{max-width:var(--max);margin:0 auto;padding:24px 16px 44px}
    .hero{padding:18px;border:1px solid var(--line);border-radius:var(--radius);background:linear-gradient(180deg,#fff,#f8fbfd);box-shadow:var(--shadow)}
    .hero h2{margin:0;font-size:22px}
    .hero p{margin:6px 0 0;color:var(--muted);max-width:980px}

    .tools{margin-top:14px;display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .btn{
      background:var(--accent);
      color:var(--btnText);
      border:none;
      padding:10px 12px;
      border-radius:10px;
      font-weight:950;
      cursor:pointer;
      text-transform:uppercase;
      letter-spacing:.35px;
    }
    .btn.secondary{
      background:#fff;color:var(--accent2);
      border:1px solid rgba(26,166,184,.35);
    }
    .btn:active{transform:translateY(1px)}
    .hint{color:var(--muted);font-size:12px}

    .io{margin-top:12px;border:1px solid var(--line);border-radius:var(--radius);background:#fff;box-shadow:var(--shadow);overflow:hidden}
    .io .head{padding:12px 14px;border-bottom:1px solid var(--line);background:var(--card);display:flex;align-items:center;justify-content:space-between;gap:10px}
    .io .head strong{font-size:13px}
    .io .body{padding:12px 14px}
    .io textarea{
      width:100%;
      min-height:140px;
      resize:vertical;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      outline:none;
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      font-size:12px;
      background:#fbfdff;
      color:var(--ink);
    }
    .io .row{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}

    .grid{margin-top:18px;display:flex;flex-direction:column;gap:18px}

    .product{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:#fff;
      box-shadow:var(--shadow);
      overflow:hidden;
      display:grid;
      grid-template-columns:360px 1fr;
      min-height:240px;
      scroll-margin-top:90px;
    }
    .media{
      background:var(--card);
      border-right:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .ph{
      width:100%;
      min-height:200px;
      border-radius:12px;
      border:2px dashed rgba(26,166,184,.35);
      background:linear-gradient(180deg, rgba(26,166,184,.08), rgba(26,166,184,.02));
      display:grid;
      place-items:center;
      text-align:center;
      color:var(--accent2);
      font-weight:950;
      letter-spacing:.2px;
      padding:14px;
    }
    .ph small{display:block;font-weight:900;color:rgba(15,127,140,.85);margin-top:6px}

    .content{padding:16px;display:flex;flex-direction:column;gap:10px}
    .title{margin:0;font-size:20px;letter-spacing:.2px}
    .metaTop{display:flex;flex-wrap:wrap;gap:10px 14px;align-items:center}
    .tag{
      display:inline-flex;
      border:1px solid rgba(26,166,184,.25);
      background:rgba(26,166,184,.08);
      color:var(--accent2);
      padding:6px 10px;
      border-radius:999px;
      font-weight:950;
      font-size:12px;
    }
    .price{font-weight:950;color:var(--ink)}
    .price span{color:var(--muted);font-weight:900;margin-left:6px;font-size:12px}

    .fields{
      margin-top:6px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:start;
    }
    .field{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      background:#fbfdff;
    }
    .field label{
      display:block;
      font-weight:950;
      font-size:12px;
      color:var(--accent2);
      margin-bottom:6px;
      letter-spacing:.25px;
      text-transform:uppercase;
    }

    /* AUTO-GROW: kein Abschneiden */
    .field textarea{
      width:100%;
      min-height:120px;
      height:auto;
      overflow:hidden; /* wichtig */
      resize:none;     /* wichtig: wir wachsen automatisch */
      padding:10px 10px;
      border-radius:10px;
      border:1px solid var(--line);
      outline:none;
      font-size:13px;
      line-height:1.5;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background:#fff;
    }

    .saveRow{
      display:flex;justify-content:space-between;align-items:center;gap:10px;
      margin-top:8px;
      padding-top:10px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
    }
    .statusDot{
      width:10px;height:10px;border-radius:50%;
      background:rgba(91,102,122,.35);
      border:1px solid rgba(91,102,122,.35);
      display:inline-block;
      margin-right:6px;
      vertical-align:middle;
    }
    .statusDot.on{
      background:rgba(26,166,184,.28);
      border-color:rgba(26,166,184,.55);
      box-shadow:0 0 0 4px rgba(26,166,184,.10);
    }

    /* PRINT CONTAINER (hidden on screen) */
    #printView{display:none}

    @media (max-width:980px){
      .product{grid-template-columns:1fr}
      .media{border-right:none;border-bottom:1px solid var(--line)}
      .fields{grid-template-columns:1fr}
    }

    /* PRINT STYLES */
    @media print{
      .topbar, .hero, .grid{display:none !important;}
      body{background:#fff !important;}
      #printView{display:block !important;}
      @page{margin:12mm;}
    }

    /* Print layout styling (still matching clean corporate look) */
    .printWrap{max-width:900px;margin:0 auto;padding:0}
    .printHeader{
      border-bottom:1px solid #cfd8e3;
      padding:0 0 10px 0;
      margin-bottom:12px;
    }
    .printHeader h1{margin:0;font-size:18px}
    .printHeader .meta{margin-top:4px;color:#475569;font-size:12px}
    .printCard{
      border:1px solid #d7e0ea;
      border-radius:12px;
      padding:12px 12px;
      margin:0 0 12px 0;
      page-break-inside:avoid;
    }
    .printTop{display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
    .printName{font-weight:900;font-size:15px;margin:0}
    .printRight{font-size:12px;color:#334155;text-align:right;white-space:nowrap}
    .printTag{display:inline-block;margin-top:6px;border:1px solid rgba(26,166,184,.35);background:rgba(26,166,184,.10);color:#0f7f8c;padding:4px 8px;border-radius:999px;font-weight:900;font-size:11px}
    .printCols{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
    .printBox{border:1px solid #e2e8f0;border-radius:10px;padding:10px}
    .printBox h3{margin:0 0 6px 0;font-size:12px;letter-spacing:.25px;text-transform:uppercase;color:#0f7f8c}
    .printText{white-space:pre-wrap;word-break:break-word;line-height:1.45;font-size:12.5px;color:#0f172a}
    .pageBreak{page-break-after:always}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 2l8 4v6c0 5-3.4 9.4-8 10-4.6-.6-8-5-8-10V6l8-4z" stroke="rgba(15,127,140,.9)" stroke-width="1.6"/>
            <path d="M8 12h8" stroke="rgba(26,166,184,.95)" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M12 8v8" stroke="rgba(26,166,184,.95)" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1 data-i18n="t_title">Produktbeschreibungen</h1>
          <p class="sub" data-i18n="t_sub">Editor: Leistung + Sinn/Zweck (Live in LocalStorage)</p>
        </div>
      </div>

      <div class="lang">
        <button id="btnDE" class="active" type="button">DE</button>
        <button id="btnEN" type="button">EN</button>
      </div>
    </div>
  </div>

  <div class="wrap" id="screenView">
    <div class="hero">
      <h2 data-i18n="h_head">Editor (Live speichern)</h2>
      <p data-i18n="h_text">
        Pro Produkt gibt es zwei Textfelder: Leistung und Sinn/Zweck. Änderungen werden automatisch gespeichert.
        Export kopiert alle Texte (für diese Sprache) in ein JSON, das du später hier wieder einfügen kannst.
      </p>

      <div class="tools">
        <button class="btn" id="btnExport" type="button" data-i18n="btn_export">EXPORT KOPIEREN</button>
        <button class="btn secondary" id="btnLoadFromBox" type="button" data-i18n="btn_import">IMPORT ANWENDEN</button>
        <button class="btn secondary" id="btnClearLang" type="button" data-i18n="btn_clear">SPRACHE LÖSCHEN</button>
        <button class="btn secondary" id="btnPrint" type="button" data-i18n="btn_print">DRUCK / PDF</button>
        <span class="hint" id="langHint"></span>
      </div>

      <div class="io">
        <div class="head">
          <strong data-i18n="io_head">Export / Import Box</strong>
          <span class="hint" data-i18n="io_hint">JSON: kopieren oder einfügen</span>
        </div>
        <div class="body">
          <textarea id="ioBox" spellcheck="false" placeholder='{"membership":{"service":"...","purpose":"..."}}'></textarea>
          <div class="row">
            <span class="hint" data-i18n="io_hint2">Export enthält nur die aktuell gewählte Sprache (DE oder EN).</span>
          </div>
        </div>
      </div>
    </div>

    <div class="grid" id="productsGrid"></div>
  </div>

  <!-- PRINT VIEW (built dynamically from LocalStorage) -->
  <div id="printView">
    <div class="printWrap">
      <div class="printHeader">
        <h1 id="printTitle">Produktbeschreibungen</h1>
        <div class="meta" id="printMeta">—</div>
      </div>
      <div id="printList"></div>
    </div>
  </div>

  <script>
    (function(){
      const STORAGE_PREFIX = "fsa_products_desc_v1";
      const vatLabel = { de:"netto", en:"net" };

      const dict = {
        de:{
          t_title:"Produktbeschreibungen",
          t_sub:"Editor: Leistung + Sinn/Zweck (Live in LocalStorage)",
          h_head:"Editor (Live speichern)",
          h_text:"Pro Produkt gibt es zwei Textfelder: Leistung und Sinn/Zweck. Änderungen werden automatisch gespeichert. Export kopiert alle Texte (für diese Sprache) in ein JSON, das du später hier wieder einfügen kannst.",
          btn_export:"EXPORT KOPIEREN",
          btn_import:"IMPORT ANWENDEN",
          btn_clear:"SPRACHE LÖSCHEN",
          btn_print:"DRUCK / PDF",
          io_head:"Export / Import Box",
          io_hint:"JSON: kopieren oder einfügen",
          io_hint2:"Export enthält nur die aktuell gewählte Sprache (DE oder EN).",
          ph_img:"PRODUKTBILD",
          ph_hint:"Platzhalter – Bild folgt",
          lbl_service:"Leistung",
          lbl_purpose:"Sinn & Zweck",
          saved:"gespeichert",
          empty:"leer",
          confirm_clear:"Diese Sprache wirklich löschen? (Alle Texte dieser Sprache werden entfernt.)",
          import_ok:"Import angewendet.",
          import_fail:"Import fehlgeschlagen: JSON ungültig.",
          copied:"Export kopiert.",
          lang_hint:"Aktive Sprache: DE (Speicherung getrennt pro Sprache)",
          print_meta_prefix:"Stand:",
          print_meta_lang:"Sprache:"
        },
        en:{
          t_title:"Product descriptions",
          t_sub:"Editor: Service + purpose (live LocalStorage)",
          h_head:"Editor (Live saving)",
          h_text:"Each product has two fields: service and purpose. Changes are saved automatically. Export copies all texts (for this language) as JSON that you can paste back here later.",
          btn_export:"COPY EXPORT",
          btn_import:"APPLY IMPORT",
          btn_clear:"CLEAR LANGUAGE",
          btn_print:"PRINT / PDF",
          io_head:"Export / Import box",
          io_hint:"JSON: copy or paste",
          io_hint2:"Export only contains the currently selected language (DE or EN).",
          ph_img:"PRODUCT IMAGE",
          ph_hint:"Placeholder — image pending",
          lbl_service:"Service",
          lbl_purpose:"Purpose",
          saved:"saved",
          empty:"empty",
          confirm_clear:"Clear this language? (All texts for this language will be removed.)",
          import_ok:"Import applied.",
          import_fail:"Import failed: invalid JSON.",
          copied:"Export copied.",
          lang_hint:"Active language: EN (storage is separated per language)",
          print_meta_prefix:"Generated:",
          print_meta_lang:"Language:"
        }
      };

      // Seed-Texte: nur setzen, wenn Feld NOCH LEER ist (damit du nichts verlierst)
      const SEED = {
        de:{
          membership:{
            service:
`Mit einer Clubmitgliedschaft für 60 € pro Jahr zzgl. MwSt. erhalten Sie Zugang zum virtuellen Campus der Finanziellen Souveränitäts-Akademie (FSA).

Sie erhalten u. a.:
• kostenfreien Online-Grundkurs zum erfolgreichen Start in die Dezentralität & Kryptowelt (inkl. Zertifikat & Krypto-Führerschein)
• praxisnahe Tipps rund um Vermögensschutz, strategischen Vermögensaufbau und mehr Liquidität in der Dezentralität
• ein Buchgeschenk im Wert von 39 €, das den Einstieg erleichtert
• ein praxisnahes Vertriebshandbuch für Sales-Profis und alle, die mehr Liquidität fürs Leben aufbauen wollen
• 20 % Preisvorteil auf weitere Angebote der FSA sowie Premium-Status auf Live-Veranstaltungen
• Zugang zu Hörsälen im virtuellen Campus (teilweise moderat kostenpflichtig)
• auf Wunsch Unterstützung durch Experten – passgenau und individuell abgestimmt`,
            purpose:
`Die Mitgliedschaft gibt Ihnen Orientierung, Struktur und eine klare Lern- und Umsetzungsbasis: Sie verstehen die Logik hinter Vermögensarchitektur, Dezentralität und DeFi – und können Schritt für Schritt fundierte Entscheidungen treffen.

Kurz gesagt: Sie erhalten Zugriff auf Wissen und Werkzeuge, die zeigen, wie Sie legal mehr Liquidität gewinnen, Kontrolle über Ihre finanzielle Handlungsfähigkeit zurückholen und den Einstieg in die Kryptowelt sinnvoll und nachvollziehbar gestalten.`
          },
          weekend_setup:{
            service:
`Das Weekend-Setup ist ein Vor-Ort-Format für echte Umsetzung. Wir arbeiten strukturiert an Ihrem Setup, räumen Unklarheiten auf und bringen Ihre Schutz- und Zugriffslogik sauber in Ordnung – Schritt für Schritt.

Konfiguration:
• 2-Tage Workshop (Praxis-Setup, Struktur, Umsetzung, Q&A)
• Hotel/Verpflegung separat je Termin
• Mindest-Teilnehmerzahl: 50 (damit das Weekend stattfindet)`,
            purpose:
`Ziel ist ein Setup, das nicht nur „gut klingt“, sondern im Alltag funktioniert: klare Struktur, saubere Ordnung und eine nachvollziehbare Logik, auf die Sie sich verlassen können.

Sie erhalten einen klaren Fahrplan und direkte Unterstützung bei Fragen und Stolperstellen – mit dem Fokus auf echte Ergebnisse statt Theorie. Mitglieder erhalten −20% Preisvorteil auf das Weekend-Setup.`
          }
        },
        en:{}
      };

      const PRODUCTS = [
        { id:"membership", name:"Mitgliedschaft", price:"60,00", tag:"STANDARD" },
        { id:"leadmaschine_starter", name:"Leadmaschine Starter", price:"60,00", tag:"STANDARD" },
        { id:"leadmaschine_pro", name:"Leadmaschine Profi", price:"300,00", tag:"STANDARD" },
        { id:"weekend_setup", name:"Weekend Setup", price:"499,00", tag:"COACHING" },
        { id:"book_rueckeroberung", name:"Buch „Die Rückeroberung“", price:"39,00", tag:"STANDARD" },
        { id:"kurs_krypto_setup", name:"Krypto Setup Kurs", price:"140,00", tag:"COACHING" },
        { id:"kurs_trading", name:"Tradingkurs", price:"180,00", tag:"COACHING" },
        { id:"kurs_nft", name:"NFT Kurs", price:"160,00", tag:"COACHING" },

        { id:"paket_a_vorlesung_2h", name:"Paket A – Live-Vorlesung (2 Std)", price:"690,00", tag:"PARTNER" },
        { id:"paket_a_intensiv_35h", name:"Paket A – Live-Intensiv (3,5 Std)", price:"1.290,00", tag:"PARTNER" },
        { id:"paket_a_extra_qa_60", name:"Paket A – Extra-Q&A (60 Min, optional)", price:"290,00", tag:"PARTNER" },

        { id:"paket_b_vorlesung_2h", name:"Paket B – Live-Vorlesung (2 Std)", price:"2.900,00", tag:"PARTNER" },
        { id:"paket_b_intensiv_35h", name:"Paket B – Live-Intensiv (3,5 Std)", price:"4.900,00", tag:"PARTNER" },
        { id:"paket_b_upgrade_300", name:"Paket B – Teilnehmerzahl-Upgrade (>300, optional)", price:"1.000,00", tag:"PARTNER" },

        { id:"paket_c_exec_vorlesung_2h", name:"Paket C – Executive Vorlesung (2 Std)", price:"6.900,00", tag:"PARTNER" },
        { id:"paket_c_exec_intensiv_35h", name:"Paket C – Executive Intensiv (3,5 Std)", price:"9.900,00", tag:"PARTNER" },

        { id:"paket_c_board_pack", name:"Paket C – Board Pack (optional) – Regel: 25% vom Paketpreis", price:"REGEL", tag:"PARTNER_RULE" },

        { id:"hoersaal_s_jahr", name:"S – Basis-Hörsaal (Jahrespreis)", price:"4.900,00", tag:"PARTNER" },
        { id:"hoersaal_s_setup", name:"S – Basis-Hörsaal (Setup-Fee einmalig)", price:"1.225,00", tag:"PARTNER" },
        { id:"hoersaal_s_start", name:"S – Basis-Hörsaal (Startkosten 1. Jahr)", price:"6.125,00", tag:"PARTNER" },

        { id:"hoersaal_m_jahr", name:"M – Mehr Tiefe/Struktur (Jahrespreis)", price:"9.900,00", tag:"PARTNER" },
        { id:"hoersaal_m_setup", name:"M – Mehr Tiefe/Struktur (Setup-Fee einmalig)", price:"2.475,00", tag:"PARTNER" },
        { id:"hoersaal_m_start", name:"M – Mehr Tiefe/Struktur (Startkosten 1. Jahr)", price:"12.375,00", tag:"PARTNER" },

        { id:"hoersaal_l_jahr", name:"L – Premium-Hörsaal (Jahrespreis)", price:"19.900,00", tag:"PARTNER" },
        { id:"hoersaal_l_setup", name:"L – Premium-Hörsaal (Setup-Fee einmalig)", price:"4.975,00", tag:"PARTNER" },
        { id:"hoersaal_l_start", name:"L – Premium-Hörsaal (Startkosten 1. Jahr)", price:"24.875,00", tag:"PARTNER" },

        { id:"ticket_gruppe_19_pp", name:"Gruppen-Ticket (ab 10 TN) – pro Teilnehmer", price:"19,00", tag:"COACHING" },
        { id:"ticket_einzel_99", name:"Einzeltermin", price:"99,00", tag:"COACHING" },

        { id:"format_akquise_kickstart", name:"Akquise-Kickstart (Einsteiger-Flow) – Regelpreis", price:"REGEL", tag:"COACHING_RULE" },
        { id:"format_telefontraining", name:"Telefontraining (Routine) – Regelpreis", price:"REGEL", tag:"COACHING_RULE" },
        { id:"format_workshop_session", name:"Workshop-Session (Umsetzung mit Output) – Regelpreis", price:"REGEL", tag:"COACHING_RULE" },
        { id:"format_team_session", name:"Team-Session / Hörsaal-Besprechung – Regelpreis", price:"REGEL", tag:"COACHING_RULE" }
      ];

      function currentLang(){
        return document.documentElement.dataset.lang === "en" ? "en" : "de";
      }
      function storageKey(lang){ return STORAGE_PREFIX + "::" + lang; }

      function loadAll(lang){
        try{
          const raw = localStorage.getItem(storageKey(lang));
          if(!raw) return {};
          const obj = JSON.parse(raw);
          return (obj && typeof obj === "object") ? obj : {};
        }catch(e){ return {}; }
      }
      function saveAll(lang, obj){
        localStorage.setItem(storageKey(lang), JSON.stringify(obj));
      }

      function ensureEntry(store, id){
        if(!store[id] || typeof store[id] !== "object") store[id] = { service:"", purpose:"" };
        if(typeof store[id].service !== "string") store[id].service = "";
        if(typeof store[id].purpose !== "string") store[id].purpose = "";
        return store[id];
      }

      function applySeedIfEmpty(lang){
        const seedLang = (SEED[lang] && typeof SEED[lang]==="object") ? SEED[lang] : null;
        if(!seedLang) return;

        const store = loadAll(lang);
        let changed = false;

        Object.keys(seedLang).forEach(id=>{
          const s = seedLang[id];
          if(!s || typeof s !== "object") return;
          const e = ensureEntry(store, id);

          const wantService = (typeof s.service === "string") ? s.service : "";
          const wantPurpose = (typeof s.purpose === "string") ? s.purpose : "";

          if(!String(e.service||"").trim() && String(wantService||"").trim()){
            e.service = wantService; changed = true;
          }
          if(!String(e.purpose||"").trim() && String(wantPurpose||"").trim()){
            e.purpose = wantPurpose; changed = true;
          }
        });

        if(changed) saveAll(lang, store);
      }

      function setLang(lang){
        document.documentElement.setAttribute("lang", lang);
        document.documentElement.dataset.lang = lang;
        localStorage.setItem("products_lang", lang);

        document.querySelectorAll("[data-i18n]").forEach(el=>{
          const key = el.getAttribute("data-i18n");
          if(dict[lang] && dict[lang][key]) el.textContent = dict[lang][key];
        });

        document.getElementById("btnDE").classList.toggle("active", lang==="de");
        document.getElementById("btnEN").classList.toggle("active", lang==="en");
        document.getElementById("langHint").textContent = dict[lang].lang_hint;

        // Seed only if empty (no overwrite)
        applySeedIfEmpty(lang);

        renderProducts();
      }

      function escapeHtml(str){
        return String(str)
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }

      // AUTO-GROW helper
      function autoGrow(textarea){
        if(!textarea) return;
        textarea.style.height = "auto";
        // +2px to avoid last line cut in some browsers
        textarea.style.height = (textarea.scrollHeight + 2) + "px";
      }

      function renderProducts(){
        const lang = currentLang();
        const store = loadAll(lang);
        const grid = document.getElementById("productsGrid");
        grid.innerHTML = "";

        PRODUCTS.forEach((p)=>{
          const entry = ensureEntry(store, p.id);

          const section = document.createElement("section");
          section.className = "product";
          section.id = "p_" + p.id;

          section.innerHTML = `
            <div class="media">
              <div class="ph">
                <div>${escapeHtml(dict[lang].ph_img)}</div>
                <small>${escapeHtml(dict[lang].ph_hint)}</small>
              </div>
            </div>
            <div class="content">
              <div class="metaTop">
                <h3 class="title" style="margin-right:auto">${escapeHtml(p.name)}</h3>
                <span class="tag">${escapeHtml(p.tag)}</span>
              </div>

              <div class="metaTop">
                <div class="price">${escapeHtml(p.price)} <span>${escapeHtml(p.price==="REGEL" ? "" : vatLabel[lang])}</span></div>
              </div>

              <div class="fields">
                <div class="field">
                  <label>${escapeHtml(dict[lang].lbl_service)}</label>
                  <textarea data-field="service" data-id="${escapeHtml(p.id)}"></textarea>
                </div>
                <div class="field">
                  <label>${escapeHtml(dict[lang].lbl_purpose)}</label>
                  <textarea data-field="purpose" data-id="${escapeHtml(p.id)}"></textarea>
                </div>
              </div>

              <div class="saveRow">
                <div>
                  <span class="statusDot ${(entry.service.trim() || entry.purpose.trim()) ? "on" : ""}"></span>
                  <span class="saveText">${(entry.service.trim() || entry.purpose.trim()) ? escapeHtml(dict[lang].saved) : escapeHtml(dict[lang].empty)}</span>
                </div>
                <div class="hint">ID: ${escapeHtml(p.id)}</div>
              </div>
            </div>
          `;

          grid.appendChild(section);
        });

        // Set values + bind auto-grow + live save
        grid.querySelectorAll("textarea[data-id]").forEach(ta=>{
          const id = ta.getAttribute("data-id");
          const field = ta.getAttribute("data-field");
          const entry = ensureEntry(store, id);

          ta.value = entry[field] || "";
          autoGrow(ta);

          ta.addEventListener("input", ()=>{
            autoGrow(ta);

            const lang = currentLang();
            const live = loadAll(lang);
            const e = ensureEntry(live, id);
            e[field] = ta.value;
            saveAll(lang, live);

            const section = document.getElementById("p_" + id);
            if(section){
              const dot = section.querySelector(".statusDot");
              const txt = section.querySelector(".saveText");
              const filled = (String(e.service||"").trim() || String(e.purpose||"").trim());
              if(dot) dot.classList.toggle("on", !!filled);
              if(txt) txt.textContent = filled ? dict[lang].saved : dict[lang].empty;
            }
          });

          // Also grow on paste after a tick
          ta.addEventListener("paste", ()=>{
            setTimeout(()=>autoGrow(ta), 0);
          });
        });
      }

      function exportLang(){
        const lang = currentLang();
        const store = loadAll(lang);
        const out = {};
        PRODUCTS.forEach(p=>{
          const e = store[p.id];
          if(e && (String(e.service||"").trim() || String(e.purpose||"").trim())){
            out[p.id] = { service: String(e.service||""), purpose: String(e.purpose||"") };
          }
        });
        return JSON.stringify(out, null, 2);
      }

      async function copyText(text){
        try{
          if(navigator.clipboard && navigator.clipboard.writeText){
            await navigator.clipboard.writeText(text);
            return true;
          }
        }catch(e){}
        return false;
      }

      function buildPrint(){
        const lang = currentLang();
        const store = loadAll(lang);

        const now = new Date();
        const stamp = now.toLocaleString(lang==="de" ? "de-DE" : "en-US");

        document.getElementById("printTitle").textContent = dict[lang].t_title;
        document.getElementById("printMeta").textContent =
          dict[lang].print_meta_prefix + " " + stamp + " — " + dict[lang].print_meta_lang + " " + (lang==="de" ? "DE" : "EN");

        const list = document.getElementById("printList");
        list.innerHTML = "";

        PRODUCTS.forEach((p, idx)=>{
          const e = ensureEntry(store, p.id);
          const service = String(e.service||"").trim();
          const purpose = String(e.purpose||"").trim();

          const card = document.createElement("div");
          card.className = "printCard";
          card.innerHTML = `
            <div class="printTop">
              <div>
                <p class="printName">${escapeHtml(p.name)}</p>
                <span class="printTag">${escapeHtml(p.tag)}</span>
              </div>
              <div class="printRight">
                <div><strong>${escapeHtml(p.price)}</strong> ${escapeHtml(p.price==="REGEL" ? "" : vatLabel[lang])}</div>
                <div style="margin-top:4px;color:#64748b">ID: ${escapeHtml(p.id)}</div>
              </div>
            </div>

            <div class="printCols">
              <div class="printBox">
                <h3>${escapeHtml(dict[lang].lbl_service)}</h3>
                <div class="printText">${escapeHtml(service || "—")}</div>
              </div>
              <div class="printBox">
                <h3>${escapeHtml(dict[lang].lbl_purpose)}</h3>
                <div class="printText">${escapeHtml(purpose || "—")}</div>
              </div>
            </div>
          `;
          list.appendChild(card);

          // optional: page break every 3 cards for nicer PDF
          if((idx+1) % 3 === 0 && idx !== PRODUCTS.length-1){
            const br = document.createElement("div");
            br.className = "pageBreak";
            list.appendChild(br);
          }
        });
      }

      // Buttons
      document.getElementById("btnExport").addEventListener("click", async ()=>{
        const text = exportLang();
        document.getElementById("ioBox").value = text;
        const lang = currentLang();
        await copyText(text);
        alert(dict[lang].copied);
      });

      document.getElementById("btnLoadFromBox").addEventListener("click", ()=>{
        const lang = currentLang();
        const box = document.getElementById("ioBox").value || "";
        try{
          const obj = JSON.parse(box);
          if(!obj || typeof obj !== "object") throw new Error("bad");
          const store = loadAll(lang);

          Object.keys(obj).forEach(id=>{
            if(!obj[id] || typeof obj[id] !== "object") return;
            const e = ensureEntry(store, id);
            if(typeof obj[id].service === "string") e.service = obj[id].service;
            if(typeof obj[id].purpose === "string") e.purpose = obj[id].purpose;
          });

          saveAll(lang, store);
          renderProducts();
          alert(dict[lang].import_ok);
        }catch(e){
          alert(dict[lang].import_fail);
        }
      });

      document.getElementById("btnClearLang").addEventListener("click", ()=>{
        const lang = currentLang();
        if(!confirm(dict[lang].confirm_clear)) return;
        localStorage.removeItem(storageKey(lang));
        renderProducts();
      });

      document.getElementById("btnPrint").addEventListener("click", ()=>{
        buildPrint();
        // Browser print dialog (user can "Save as PDF")
        window.print();
      });

      // Init language
      const saved = localStorage.getItem("products_lang");
      const initial = (saved === "en") ? "en" : "de";
      setLang(initial);

      document.getElementById("btnDE").addEventListener("click", ()=>setLang("de"));
      document.getElementById("btnEN").addEventListener("click", ()=>setLang("en"));
    })();
  </script>
</body>
</html>
