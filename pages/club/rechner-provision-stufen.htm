<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Provision-Stufen – Rechner (Umsatz kumuliert)</title>
  <style>
    :root{
      --gold:#d4af37;
      --txt:#e9e9e9;
      --muted:#cbd5e1;
      --panel:rgba(0,0,0,.72);
      --panel2:rgba(10,10,20,.62);
      --soft:rgba(212,175,55,.14);
      --shadow:0 26px 50px rgba(0,0,0,.55);
      --glow:0 0 22px rgba(212,175,55,.55), 0 10px 28px rgba(0,0,0,.55);
      --radius:18px;
      --maxw:1180px;
      --line: rgba(212,175,55,.14);
    }

    html,body{
      margin:0;
      background:#000;
      color:var(--txt);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      overflow-x:hidden;
    }

    .bg-fixed{
      position:fixed; inset:0;
      background:
        radial-gradient(1200px 700px at 26% 10%, rgba(212,175,55,.18), transparent 60%),
        radial-gradient(1000px 700px at 74% 35%, rgba(28,194,160,.10), transparent 60%),
        linear-gradient(180deg, #05060a 0%, #000 60%, #03040a 100%);
      z-index:-2;
    }
    .bg-grid{
      position:fixed; inset:0;
      background-image:
        linear-gradient(rgba(212,175,55,.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(212,175,55,.06) 1px, transparent 1px);
      background-size:44px 44px;
      mask-image: radial-gradient(70% 55% at 50% 20%, #000 55%, transparent 100%);
      opacity:.35;
      z-index:-1;
      pointer-events:none;
    }

    /* Offset below fixed topbar from menu.js */
    #hero{ padding-top:88px; }

    .wrap{
      max-width:var(--maxw);
      margin:34px auto 70px;
      padding:0 18px;
    }

    .topline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }

    .crumb{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(0,0,0,.55);
      box-shadow:0 0 0 1px rgba(212,175,55,.18) inset;
      text-decoration:none;
      color:var(--txt);
    }
    .crumb:hover{ box-shadow:0 0 0 1px rgba(212,175,55,.35) inset, var(--glow); }

    .langbox{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(0,0,0,.55);
      box-shadow:0 0 0 1px rgba(212,175,55,.18) inset;
    }
    .langbox .lbl{
      font-size:12px; letter-spacing:.04em; text-transform:uppercase;
      color:var(--muted);
    }
    .langbtn{
      border:0;
      background:rgba(212,175,55,.14);
      color:var(--txt);
      padding:8px 10px;
      border-radius:999px;
      cursor:pointer;
      box-shadow:0 0 0 1px rgba(212,175,55,.22) inset;
      font-weight:900;
    }
    .langbtn[aria-pressed="true"]{
      background:rgba(212,175,55,.28);
      box-shadow:0 0 0 1px rgba(212,175,55,.38) inset, 0 0 18px rgba(212,175,55,.22);
    }

    .hero{
      background:linear-gradient(180deg, rgba(0,0,0,.72), rgba(0,0,0,.55));
      border-radius:var(--radius);
      padding:22px 20px;
      box-shadow:var(--shadow);
      border:1px solid rgba(212,175,55,.18);
      position:relative;
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute; inset:-2px;
      background:radial-gradient(900px 320px at 20% 10%, rgba(212,175,55,.22), transparent 55%);
      pointer-events:none;
    }

    .h1{
      margin:0 0 10px;
      font-size:28px;
      letter-spacing:.2px;
      position:relative;
    }
    .sub{
      margin:0 0 14px;
      color:var(--muted);
      line-height:1.55;
      max-width:105ch;
      position:relative;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:12px;
      position:relative;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background:rgba(0,0,0,.35);
      box-shadow:0 0 0 1px rgba(212,175,55,.18) inset;
      color:var(--txt);
      font-size:12.5px;
      letter-spacing:.02em;
      white-space:nowrap;
    }
    .chip strong{ font-weight:1100; }

    .grid{
      display:grid;
      grid-template-columns:repeat(12, 1fr);
      gap:14px;
      margin-top:16px;
    }

    .card{
      grid-column:span 12;
      background:var(--panel);
      border-radius:var(--radius);
      padding:18px 16px;
      box-shadow:var(--shadow);
      border:1px solid rgba(212,175,55,.16);
      opacity:0;
      transform:translateY(10px);
      animation:fadeIn .55s ease forwards;
    }
    .card:nth-child(1){ animation-delay:.06s; }
    .card:nth-child(2){ animation-delay:.12s; }
    .card:nth-child(3){ animation-delay:.18s; }

    @keyframes fadeIn{ to{ opacity:1; transform:translateY(0); } }

    .card h2{
      margin:0 0 10px;
      font-size:18px;
      display:flex; align-items:center; gap:10px;
    }

    .hint{
      margin-top:6px;
      color:var(--muted);
      line-height:1.5;
      font-size:13.5px;
      max-width:110ch;
    }

    .row{
      display:grid;
      grid-template-columns:repeat(12, 1fr);
      gap:12px;
      margin-top:12px;
    }

    .field{
      grid-column:span 12;
      background:rgba(0,0,0,.32);
      border-radius:16px;
      padding:12px 12px;
      box-shadow:0 0 0 1px rgba(212,175,55,.12) inset;
    }
    .label{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      color:var(--muted);
      font-size:12px;
      letter-spacing:.04em;
      text-transform:uppercase;
      margin-bottom:8px;
    }
    .label .mini{
      text-transform:none;
      letter-spacing:0;
      font-size:12px;
      color:rgba(233,233,233,.78);
      opacity:.9;
    }
    input[type="number"], input[type="text"]{
      width:100%;
      box-sizing:border-box;
      border:0;
      outline:none;
      padding:12px 12px;
      border-radius:14px;
      background:rgba(0,0,0,.35);
      color:var(--txt);
      box-shadow:0 0 0 1px rgba(212,175,55,.18) inset;
      font-size:16px;
      font-weight:900;
    }
    input::placeholder{ color:rgba(203,213,225,.55); font-weight:700; }

    .btnrow{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      margin-top:12px;
      align-items:center;
    }
    .btn{
      border:0;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      color:var(--txt);
      border-radius:14px;
      padding:12px 14px;
      background:rgba(212,175,55,.20);
      box-shadow:0 0 0 1px rgba(212,175,55,.30) inset;
      font-weight:1100;
    }
    .btn:hover{ box-shadow:0 0 0 1px rgba(212,175,55,.45) inset, var(--glow); }
    .btn.secondary{
      background:rgba(0,0,0,.35);
      box-shadow:0 0 0 1px rgba(212,175,55,.18) inset;
      font-weight:900;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:9px 12px;
      border-radius:999px;
      background:rgba(0,0,0,.35);
      box-shadow:0 0 0 1px rgba(212,175,55,.18) inset;
      color:var(--muted);
      font-size:13px;
      white-space:nowrap;
    }
    .pill strong{ color:var(--txt); font-weight:1100; }

    /* TABLE */
    .tablebox{
      margin-top:12px;
      background:rgba(0,0,0,.30);
      border-radius:16px;
      box-shadow:0 0 0 1px rgba(212,175,55,.12) inset;
      overflow:hidden;
    }
    table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
    }
    thead th{
      text-align:left;
      padding:12px 12px;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.06em;
      color:rgba(233,233,233,.85);
      background:rgba(0,0,0,.35);
      border-bottom:1px solid var(--line);
    }
    tbody td{
      padding:12px 12px;
      border-bottom:1px solid rgba(212,175,55,.08);
      vertical-align:top;
      color:rgba(233,233,233,.92);
      font-size:14px;
    }
    tbody tr:last-child td{ border-bottom:0; }

    .cell-input input{
      padding:10px 10px;
      font-size:14px;
      font-weight:1100;
    }
    .subnote{
      margin-top:6px;
      color:rgba(203,213,225,.70);
      font-size:12px;
      line-height:1.35;
      font-weight:700;
    }
    .money{
      font-weight:1100;
      letter-spacing:.2px;
      white-space:nowrap;
    }

    .sumrow{
      display:grid;
      grid-template-columns:repeat(12, 1fr);
      gap:12px;
      margin-top:12px;
    }
    .kpi{
      grid-column:span 12;
      background:rgba(0,0,0,.32);
      border-radius:16px;
      padding:14px 14px;
      box-shadow:0 0 0 1px rgba(212,175,55,.12) inset;
    }
    .kpi .k{ color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.06em; }
    .kpi .v{ margin-top:8px; font-size:22px; font-weight:1200; }
    .kpi .n{ margin-top:6px; color:rgba(203,213,225,.80); font-size:12.5px; line-height:1.45; white-space:pre-line; }

    .footer{
      margin-top:18px;
      padding:14px 16px;
      border-radius:var(--radius);
      background:rgba(0,0,0,.55);
      border:1px solid rgba(212,175,55,.14);
      box-shadow:var(--shadow);
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      color:var(--muted);
      font-size:13px;
    }
    .footer a{
      color:var(--txt);
      text-decoration:none;
      box-shadow:0 0 0 1px rgba(212,175,55,.14) inset;
      padding:8px 10px;
      border-radius:999px;
      background:rgba(212,175,55,.10);
    }
    .footer a:hover{ box-shadow:0 0 0 1px rgba(212,175,55,.32) inset, var(--glow); }

    @media (min-width: 900px){
      .h1{ font-size:34px; }
      .field{ grid-column:span 4; }
      .kpi{ grid-column:span 4; }
    }

    /* ===== MOBILE TABLE FIX: rows become cards ===== */
    @media (max-width: 980px){
      table{ table-layout:auto; }
      thead{ display:none; }
      tbody tr{
        display:block;
        border-bottom:1px solid rgba(212,175,55,.10);
        padding:10px 0;
      }
      tbody td{
        display:grid;
        grid-template-columns: 1fr;
        gap:8px;
        border-bottom:0;
        padding:10px 12px;
      }
      tbody td::before{
        content: attr(data-label);
        display:block;
        font-size:12px;
        letter-spacing:.06em;
        text-transform:uppercase;
        color:rgba(203,213,225,.85);
      }
      .cell-input{ }
      .cell-input input{ width:100%; }
      .money{ font-size:16px; }
      .subnote{ font-size:12px; }
    }
  </style>

  <script defer src="../../js/menu.js"></script>
</head>
<body>
  <div class="bg-fixed" aria-hidden="true"></div>
  <div class="bg-grid" aria-hidden="true"></div>

  <main id="hero">
    <div class="wrap">

      <div class="topline">
        <a class="crumb" href="./index.html" aria-label="Zurück zur Club-Basis">
          <span aria-hidden="true" style="display:inline-grid;place-items:center;width:18px;height:18px;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M15 18l-6-6 6-6" stroke="rgba(212,175,55,.95)" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span data-i18n="back_to_base">Zurück zur Club-Basis</span>
        </a>

        <div class="langbox" role="group" aria-label="Sprache wählen">
          <span class="lbl" data-i18n="lang_label">Sprache</span>
          <button class="langbtn" id="btnDE" type="button" aria-pressed="true">DE</button>
          <button class="langbtn" id="btnEN" type="button" aria-pressed="false">EN</button>
        </div>
      </div>

      <section class="hero" aria-label="Provision-Stufen Rechner Hero">
        <h1 class="h1" data-i18n="h1">Provision-Stufen (kumuliert) – Umsatz-Rechner</h1>
        <p class="sub" data-i18n="sub">
          Du trägst bezahlten Umsatz pro Jahr ein (L1 / L2 / L3). L1 nutzt ein gestaffeltes Stufen-System auf kumulierten Umsatz – Stufen verfallen nicht.
          Die höhere Stufe gilt “ab sofort” nur für den Umsatzteil über der Schwelle (nicht rückwirkend).
        </p>

        <div class="chips" aria-label="Stufen-Chips">
          <span class="chip"><strong>20%</strong> <span data-i18n="c1">0–50.000</span></span>
          <span class="chip"><strong>25%</strong> <span data-i18n="c2">50.000–125.000</span></span>
          <span class="chip"><strong>27,5%</strong> <span data-i18n="c3">125.000–375.000</span></span>
          <span class="chip"><strong>30%</strong> <span data-i18n="c4">375.000–750.000</span></span>
          <span class="chip"><strong>35%</strong> <span data-i18n="c5">750.000–1.500.000</span></span>
          <span class="chip"><strong>40%</strong> <span data-i18n="c6">ab 1.500.000</span></span>
        </div>
      </section>

      <section class="grid" aria-label="Eingaben & Tabelle">

        <article class="card">
          <h2>
            <span aria-hidden="true" style="display:inline-grid;place-items:center;width:26px;height:26px;">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M4 19V5" stroke="rgba(212,175,55,.85)" stroke-width="2" stroke-linecap="round"/>
                <path d="M4 19h16" stroke="rgba(212,175,55,.85)" stroke-width="2" stroke-linecap="round"/>
                <path d="M7 15l4-4 3 3 5-6" stroke="rgba(212,175,55,.95)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
            <span data-i18n="in_head">Umsatz eingeben (pro Jahr)</span>
          </h2>
          <div class="hint" data-i18n="in_hint">
            Nur bezahlter Umsatz ist provisionsfähig. Keine Ratenlogik. Keine rückwirkenden Sätze. L2/L3 bleiben fix (15% / 10%).
          </div>

          <div class="row" aria-label="Globale Sätze">
            <div class="field">
              <div class="label">
                <span data-i18n="l2_rate">L2 Provision</span>
                <span class="mini" data-i18n="fix">fix</span>
              </div>
              <input id="l2Rate" type="number" min="0" max="100" step="0.1" value="15" />
              <div class="subnote" data-i18n="l2_note">Standard: 15%</div>
            </div>
            <div class="field">
              <div class="label">
                <span data-i18n="l3_rate">L3 Provision</span>
                <span class="mini" data-i18n="fix">fix</span>
              </div>
              <input id="l3Rate" type="number" min="0" max="100" step="0.1" value="10" />
              <div class="subnote" data-i18n="l3_note">Standard: 10%</div>
            </div>
            <div class="field">
              <div class="label">
                <span data-i18n="years">Anzahl Jahre</span>
                <span class="mini" data-i18n="rows">Zeilen</span>
              </div>
              <input id="years" type="number" min="1" max="25" step="1" value="5" />
              <div class="subnote" data-i18n="years_note">Empfehlung: 3–10 Jahre</div>
            </div>
          </div>

          <div class="btnrow">
            <button class="btn" id="btnBuild" type="button">
              <span aria-hidden="true">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M12 5v14" stroke="rgba(212,175,55,.95)" stroke-width="2" stroke-linecap="round"/>
                  <path d="M5 12h14" stroke="rgba(212,175,55,.95)" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </span>
              <span data-i18n="btn_rows">Zeilen neu aufbauen</span>
            </button>

            <button class="btn secondary" id="btnCalc" type="button">
              <span aria-hidden="true">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M4 19V5" stroke="rgba(212,175,55,.85)" stroke-width="2" stroke-linecap="round"/>
                  <path d="M4 19h16" stroke="rgba(212,175,55,.85)" stroke-width="2" stroke-linecap="round"/>
                  <path d="M7 15l4-4 3 3 5-6" stroke="rgba(212,175,55,.95)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
              <span data-i18n="btn_calc">Berechnen</span>
            </button>

            <span class="pill" title="Locked = nicht rückwirkend">
              <span aria-hidden="true">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M7 11V8a5 5 0 0110 0v3" stroke="rgba(212,175,55,.85)" stroke-width="2" stroke-linecap="round"/>
                  <path d="M6 11h12v10H6V11z" stroke="rgba(212,175,55,.85)" stroke-width="2" stroke-linejoin="round"/>
                </svg>
              </span>
              <span data-i18n="locked">Locked · nicht rückwirkend</span>
            </span>
          </div>

          <div class="tablebox" aria-label="Tabelle">
            <table>
              <thead>
                <tr>
                  <th style="width:8%"><span data-i18n="th_year">Jahr</span></th>
                  <th style="width:20%"><span data-i18n="th_l1">L1 Umsatz</span></th>
                  <th style="width:18%"><span data-i18n="th_l1c">L1 Provision</span></th>
                  <th style="width:18%"><span data-i18n="th_l2">L2 Umsatz</span></th>
                  <th style="width:18%"><span data-i18n="th_l2c">L2 Provision</span></th>
                  <th style="width:18%"><span data-i18n="th_l3">L3 Umsatz</span></th>
                  <th style="width:18%"><span data-i18n="th_l3c">L3 Provision</span></th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <div class="hint" style="margin-top:12px;" data-i18n="tip_mobile">
            Mobile-Fix: Jede Zeile wird als Karte dargestellt, damit alles ins Bild passt.
          </div>

          <div class="sumrow">
            <div class="kpi">
              <div class="k" data-i18n="kpi_cum">Kumuliert (L1)</div>
              <div class="v" id="kpiCum">0,00 €</div>
              <div class="n" data-i18n="kpi_cum_n">Summe L1 Umsatz über alle Jahre.</div>
            </div>
            <div class="kpi">
              <div class="k" data-i18n="kpi_step">Aktuelle Stufe</div>
              <div class="v" id="kpiStep">20%</div>
              <div class="n" id="kpiStepN" data-i18n="kpi_step_n">Stufe basiert auf kumuliertem L1 Umsatz.</div>
            </div>
            <div class="kpi">
              <div class="k" data-i18n="kpi_total">Gesamt-Provision</div>
              <div class="v" id="kpiTotal">0,00 €</div>
              <div class="n" data-i18n="kpi_total_n">L1 (Stufen) + L2 (fix) + L3 (fix).</div>
            </div>
          </div>

          <div class="hint" style="margin-top:12px; white-space:pre-line;" data-i18n="note">
Hinweis (wichtig)
Dies ist ein Anschaungsbeispiel – keine Abrechnung.
L1 nutzt Stufen “ab sofort” (marginal): höhere Prozente gelten nur für Umsatz über der jeweiligen Schwelle.
          </div>
        </article>

      </section>

      <div class="footer">
        <span data-i18n="footer_note">Hinweis: Provision nur auf bezahlte Produkte. Darstellung dient der Orientierung.</span>
        <a href="./index.html" data-i18n="footer_cta">Zurück zur Club-Basis</a>
      </div>

    </div>
  </main>

  <script>
    (function(){
      const TIERS = [
        { from: 0,        to: 50000,    rate: 0.20 },
        { from: 50000,    to: 125000,   rate: 0.25 },
        { from: 125000,   to: 375000,   rate: 0.275 },
        { from: 375000,   to: 750000,   rate: 0.30 },
        { from: 750000,   to: 1500000,  rate: 0.35 },
        { from: 1500000,  to: Infinity, rate: 0.40 },
      ];

      const dict = {
        de: {
          back_to_base:"Zurück zur Club-Basis",
          lang_label:"Sprache",
          h1:"Provision-Stufen (kumuliert) – Umsatz-Rechner",
          sub:"Du trägst bezahlten Umsatz pro Jahr ein (L1 / L2 / L3). L1 nutzt ein gestaffeltes Stufen-System auf kumulierten Umsatz – Stufen verfallen nicht.\nDie höhere Stufe gilt “ab sofort” nur für den Umsatzteil über der Schwelle (nicht rückwirkend).",
          c1:"0–50.000", c2:"50.000–125.000", c3:"125.000–375.000", c4:"375.000–750.000", c5:"750.000–1.500.000", c6:"ab 1.500.000",
          in_head:"Umsatz eingeben (pro Jahr)",
          in_hint:"Nur bezahlter Umsatz ist provisionsfähig. Keine Ratenlogik. Keine rückwirkenden Sätze. L2/L3 bleiben fix (15% / 10%).",
          l2_rate:"L2 Provision", l3_rate:"L3 Provision", fix:"fix",
          l2_note:"Standard: 15%", l3_note:"Standard: 10%",
          years:"Anzahl Jahre", rows:"Zeilen", years_note:"Empfehlung: 3–10 Jahre",
          btn_rows:"Zeilen neu aufbauen", btn_calc:"Berechnen",
          locked:"Locked · nicht rückwirkend",
          th_year:"Jahr", th_l1:"L1 Umsatz", th_l1c:"L1 Provision", th_l2:"L2 Umsatz", th_l2c:"L2 Provision", th_l3:"L3 Umsatz", th_l3c:"L3 Provision",
          tip_mobile:"Mobile-Fix: Jede Zeile wird als Karte dargestellt, damit alles ins Bild passt.",
          kpi_cum:"Kumuliert (L1)", kpi_cum_n:"Summe L1 Umsatz über alle Jahre.",
          kpi_step:"Aktuelle Stufe", kpi_step_n:"Stufe basiert auf kumuliertem L1 Umsatz.",
          kpi_total:"Gesamt-Provision", kpi_total_n:"L1 (Stufen) + L2 (fix) + L3 (fix).",
          note:"Hinweis (wichtig)\nDies ist ein Anschaungsbeispiel – keine Abrechnung.\nL1 nutzt Stufen “ab sofort” (marginal): höhere Prozente gelten nur für Umsatz über der jeweiligen Schwelle.",
          footer_note:"Hinweis: Provision nur auf bezahlte Produkte. Darstellung dient der Orientierung.",
          footer_cta:"Zurück zur Club-Basis",
          ph:"z.B. 100000",
          paid:"nur bezahlter Umsatz"
        },
        en: {
          back_to_base:"Back to Club Hub",
          lang_label:"Language",
          h1:"Commission tiers (cumulative) – revenue calculator",
          sub:"Enter paid revenue per year (L1 / L2 / L3). L1 uses tiered rates on cumulative revenue — tiers do not expire.\nHigher tiers apply “from that point on” only to the portion above the threshold (not retroactive).",
          c1:"0–50,000", c2:"50,000–125,000", c3:"125,000–375,000", c4:"375,000–750,000", c5:"750,000–1,500,000", c6:"from 1,500,000",
          in_head:"Enter revenue (per year)",
          in_hint:"Only paid revenue is commissionable. No installments. No retroactive rates. L2/L3 stay fixed (15% / 10%).",
          l2_rate:"L2 commission", l3_rate:"L3 commission", fix:"fixed",
          l2_note:"Default: 15%", l3_note:"Default: 10%",
          years:"Number of years", rows:"rows", years_note:"Recommended: 3–10 years",
          btn_rows:"Rebuild rows", btn_calc:"Calculate",
          locked:"Locked · not retroactive",
          th_year:"Year", th_l1:"L1 revenue", th_l1c:"L1 commission", th_l2:"L2 revenue", th_l2c:"L2 commission", th_l3:"L3 revenue", th_l3c:"L3 commission",
          tip_mobile:"Mobile fix: each row becomes a card so everything fits on screen.",
          kpi_cum:"Cumulative (L1)", kpi_cum_n:"Total L1 revenue across all years.",
          kpi_step:"Current tier", kpi_step_n:"Tier is based on cumulative L1 revenue.",
          kpi_total:"Total commission", kpi_total_n:"L1 (tiers) + L2 (fixed) + L3 (fixed).",
          note:"Note (important)\nThis is an example — not a payout statement.\nL1 uses marginal tiers: higher rates apply only to revenue above each threshold.",
          footer_note:"Note: commission only on paid products. Display is for orientation.",
          footer_cta:"Back to Club Hub",
          ph:"e.g. 100000",
          paid:"paid revenue only"
        }
      };

      const btnDE = document.getElementById("btnDE");
      const btnEN = document.getElementById("btnEN");

      const elYears = document.getElementById("years");
      const elL2 = document.getElementById("l2Rate");
      const elL3 = document.getElementById("l3Rate");
      const tbody = document.getElementById("tbody");
      const kpiCum = document.getElementById("kpiCum");
      const kpiStep = document.getElementById("kpiStep");
      const kpiStepN = document.getElementById("kpiStepN");
      const kpiTotal = document.getElementById("kpiTotal");

      let LANG = "de";

      function fmtEUR(n){
        const x = isFinite(n) ? n : 0;
        try{
          return x.toLocaleString(LANG === "de" ? "de-DE" : "en-GB", { style:"currency", currency:"EUR" });
        }catch(e){
          return (Math.round(x*100)/100).toFixed(2) + " €";
        }
      }
      function clampNum(v){
        const n = Number(v);
        if(!isFinite(n)) return 0;
        return Math.max(0, n);
      }

      function tierRateForCum(cum){
        const c = clampNum(cum);
        for(const t of TIERS){
          if(c >= t.from && c < t.to) return t.rate;
        }
        return TIERS[0].rate;
      }

      // Marginal commission "ab sofort": based on cumulative before year, apply tier splits for this year's amount
      function commissionMarginal(amount, cumBefore){
        let a = clampNum(amount);
        let cum = clampNum(cumBefore);
        let commission = 0;

        // Walk through tiers and apply overlap with [cum, cum+a)
        for(const t of TIERS){
          const start = Math.max(cum, t.from);
          const end = Math.min(cum + a, t.to);
          if(end > start){
            commission += (end - start) * t.rate;
          }
        }
        return commission;
      }

      function buildRows(count){
        const n = Math.max(1, Math.min(25, parseInt(count,10) || 5));
        tbody.innerHTML = "";
        for(let i=1;i<=n;i++){
          const tr = document.createElement("tr");

          tr.appendChild(cellText(String(i), dict[LANG].th_year));

          tr.appendChild(cellInput("l1_"+i, dict[LANG].th_l1, dict[LANG].ph, dict[LANG].paid));
          tr.appendChild(cellMoney("l1c_"+i, dict[LANG].th_l1c, "0,00 €"));

          tr.appendChild(cellInput("l2_"+i, dict[LANG].th_l2, dict[LANG].ph, ""));
          tr.appendChild(cellMoney("l2c_"+i, dict[LANG].th_l2c, "0,00 €"));

          tr.appendChild(cellInput("l3_"+i, dict[LANG].th_l3, dict[LANG].ph, ""));
          tr.appendChild(cellMoney("l3c_"+i, dict[LANG].th_l3c, "0,00 €"));

          tbody.appendChild(tr);
        }
      }

      function cellText(txt, label){
        const td = document.createElement("td");
        td.setAttribute("data-label", label);
        td.innerHTML = '<span class="money">'+escapeHtml(txt)+'</span>';
        return td;
      }

      function cellInput(id, label, placeholder, sub){
        const td = document.createElement("td");
        td.className = "cell-input";
        td.setAttribute("data-label", label);

        const inp = document.createElement("input");
        inp.type = "number";
        inp.min = "0";
        inp.step = "1";
        inp.value = "0";
        inp.id = id;
        inp.placeholder = placeholder || "";
        inp.addEventListener("input", ()=> calc());

        td.appendChild(inp);

        if(sub){
          const s = document.createElement("div");
          s.className = "subnote";
          s.textContent = sub;
          td.appendChild(s);
        }
        return td;
      }

      function cellMoney(id, label, initial){
        const td = document.createElement("td");
        td.setAttribute("data-label", label);
        const span = document.createElement("span");
        span.id = id;
        span.className = "money";
        span.textContent = initial || "0,00 €";
        td.appendChild(span);
        return td;
      }

      function calc(){
        const n = Math.max(1, Math.min(25, parseInt(elYears.value,10) || 5));
        const r2 = clampNum(elL2.value) / 100;
        const r3 = clampNum(elL3.value) / 100;

        let cumL1 = 0;
        let totalComm = 0;

        for(let i=1;i<=n;i++){
          const l1 = clampNum(getVal("l1_"+i));
          const l2 = clampNum(getVal("l2_"+i));
          const l3 = clampNum(getVal("l3_"+i));

          const l1Comm = commissionMarginal(l1, cumL1);
          const l2Comm = l2 * r2;
          const l3Comm = l3 * r3;

          setText("l1c_"+i, fmtEUR(l1Comm));
          setText("l2c_"+i, fmtEUR(l2Comm));
          setText("l3c_"+i, fmtEUR(l3Comm));

          cumL1 += l1;
          totalComm += (l1Comm + l2Comm + l3Comm);
        }

        kpiCum.textContent = fmtEUR(cumL1);
        const rateNow = tierRateForCum(cumL1);
        kpiStep.textContent = (rateNow*100).toLocaleString(LANG==="de"?"de-DE":"en-GB", { maximumFractionDigits: 1 }) + "%";
        kpiStepN.textContent = dict[LANG].kpi_step_n;
        kpiTotal.textContent = fmtEUR(totalComm);
      }

      function getVal(id){
        const el = document.getElementById(id);
        if(!el) return 0;
        return el.value;
      }
      function setText(id, txt){
        const el = document.getElementById(id);
        if(el) el.textContent = txt;
      }
      function escapeHtml(s){
        return String(s)
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#39;");
      }

      function applyLang(lang){
        LANG = (lang === "en") ? "en" : "de";
        document.documentElement.lang = LANG;

        const map = dict[LANG] || dict.de;
        document.querySelectorAll("[data-i18n]").forEach(el=>{
          const key = el.getAttribute("data-i18n");
          if(map[key] !== undefined){
            el.textContent = map[key];
          }
        });

        btnDE.setAttribute("aria-pressed", LANG === "de" ? "true" : "false");
        btnEN.setAttribute("aria-pressed", LANG === "en" ? "true" : "false");

        // rebuild rows to refresh mobile labels
        buildRows(elYears.value);
        calc();

        try{ localStorage.setItem("fsa_lang", LANG); }catch(e){}
      }

      document.getElementById("btnBuild").addEventListener("click", ()=>{
        buildRows(elYears.value);
        calc();
      });
      document.getElementById("btnCalc").addEventListener("click", calc);

      btnDE.addEventListener("click", ()=>applyLang("de"));
      btnEN.addEventListener("click", ()=>applyLang("en"));

      // init
      let saved = "de";
      try{ saved = localStorage.getItem("fsa_lang") || "de"; }catch(e){}
      if(saved !== "de" && saved !== "en") saved = "de";
      applyLang(saved);
    })();
  </script>
</body>
</html>
