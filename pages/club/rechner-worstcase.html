<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Worstcase-Rechner – Club Planung (intern)</title>
  <meta name="description" content="Interner Worstcase-Rechner für Club-Leitung: Mitgliedschaft, Leadmaschine, Weekend-Setup – Planungswerte, Vertrieb/Club-Anteile, Kapazitäten, Jahr-2 mit Bestand." />

  <style>
    :root{
      --bg:#050814;
      --bg2:#020617;
      --panel:rgba(15,23,42,.90);
      --panel2:rgba(15,23,42,.78);
      --txt:#e9eef7;
      --muted:#a9b6cc;
      --gold:#d4af37;
      --gold2:#f0d77a;
      --line:rgba(212,175,55,.35);
      --soft:rgba(212,175,55,.18);
      --glow:0 0 22px rgba(212,175,55,.38), 0 10px 28px rgba(0,0,0,.55);
      --shadow:0 22px 55px rgba(0,0,0,.55);
      --radius:18px;
      --maxw:1180px;
    }

    html,body{
      margin:0;
      background: radial-gradient(1200px 700px at 18% 12%, rgba(212,175,55,.10), transparent 55%),
                  radial-gradient(900px 520px at 82% 18%, rgba(94,168,255,.10), transparent 60%),
                  linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      color:var(--txt);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      overflow-x:hidden;
    }

    .wrap{
      max-width:var(--maxw);
      margin:0 auto;
      padding:28px 18px 60px;
    }

    .topline{
      height:2px;
      background:linear-gradient(90deg, transparent, var(--gold), transparent);
      opacity:.85;
      margin:18px 0 26px;
    }

    .hero{
      display:flex;
      gap:18px;
      align-items:stretch;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .hero-card{
      flex: 1 1 640px;
      background:linear-gradient(180deg, rgba(15,23,42,.92), rgba(15,23,42,.75));
      border:1px solid rgba(212,175,55,.22);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px 18px 16px;
      position:relative;
      overflow:hidden;
    }
    .hero-card:before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(700px 220px at 20% 0%, rgba(212,175,55,.18), transparent 55%),
                  radial-gradient(600px 200px at 90% 0%, rgba(94,168,255,.16), transparent 60%);
      pointer-events:none;
      opacity:.8;
    }
    .hero-inner{ position:relative; z-index:2; }

    .kicker{
      display:flex;
      align-items:center;
      gap:10px;
      color:var(--muted);
      font-size:13px;
      letter-spacing:.2px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(212,175,55,.28);
      background:rgba(0,0,0,.18);
    }

    .title{
      margin:10px 0 6px;
      font-size:34px;
      line-height:1.12;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size:15px;
      line-height:1.55;
      max-width:900px;
    }

    .actions{
      flex: 0 1 320px;
      background:linear-gradient(180deg, rgba(15,23,42,.90), rgba(15,23,42,.72));
      border:1px solid rgba(212,175,55,.22);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }

    .lang{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    .btn{
      appearance:none;
      border:1px solid rgba(212,175,55,.35);
      background:rgba(0,0,0,.20);
      color:var(--txt);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      box-shadow: 0 0 0 rgba(0,0,0,0);
      transition:transform .12s ease, background .12s ease, border-color .12s ease;
      font-weight:650;
      font-size:14px;
    }
    .btn:hover{ transform:translateY(-1px); border-color:rgba(212,175,55,.55); }
    .btn.primary{
      background:rgba(212,175,55,.16);
      box-shadow:var(--glow);
      border-color:rgba(212,175,55,.55);
    }
    .btn.small{
      padding:8px 10px;
      font-size:13px;
      border-radius:10px;
    }

    .hint{
      margin-top:12px;
      font-size:12.5px;
      color:var(--muted);
      line-height:1.45;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      margin-top:18px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background:linear-gradient(180deg, rgba(15,23,42,.90), rgba(15,23,42,.72));
      border:1px solid rgba(212,175,55,.22);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .card h2{
      margin:0 0 8px;
      font-size:18px;
      letter-spacing:.2px;
    }
    .card p{
      margin:0 0 10px;
      color:var(--muted);
      font-size:13.5px;
      line-height:1.55;
    }

    .fields{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:10px;
    }
    @media (max-width: 760px){
      .fields{ grid-template-columns:1fr; }
    }

    .field{
      background:rgba(0,0,0,.16);
      border:1px solid rgba(212,175,55,.18);
      border-radius:14px;
      padding:10px 10px 9px;
    }
    .field label{
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-size:12.5px;
      color:var(--muted);
      margin-bottom:6px;
      line-height:1.25;
    }
    .field label span{
      color:rgba(240,215,122,.95);
      font-weight:650;
      font-size:12px;
      white-space:nowrap;
    }
    .field input, .field select{
      width:100%;
      box-sizing:border-box;
      background:rgba(0,0,0,.22);
      border:1px solid rgba(212,175,55,.24);
      color:var(--txt);
      padding:10px 10px;
      border-radius:12px;
      outline:none;
      font-size:14px;
    }

    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    @media (max-width: 760px){
      .split{ grid-template-columns:1fr; }
    }

    .divider{
      height:1px;
      background:linear-gradient(90deg, transparent, rgba(212,175,55,.45), transparent);
      margin:14px 0;
      opacity:.75;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(212,175,55,.22);
      background:rgba(0,0,0,.16);
      color:var(--txt);
      line-height:1.35;
      font-size:13.5px;
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      overflow:hidden;
      border-radius:14px;
      border:1px solid rgba(212,175,55,.18);
      background:rgba(0,0,0,.16);
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid rgba(212,175,55,.12);
      text-align:left;
      font-size:13px;
    }
    th{
      color:rgba(240,215,122,.95);
      font-weight:750;
      background:rgba(0,0,0,.18);
    }
    tr:last-child td{ border-bottom:none; }
    .right{ text-align:right; }
    .muted{ color:var(--muted); }
    .mono{ font-variant-numeric: tabular-nums; font-feature-settings:"tnum"; }

    details{
      margin-top:10px;
      background:rgba(0,0,0,.14);
      border:1px solid rgba(212,175,55,.14);
      border-radius:14px;
      padding:10px 10px;
    }
    summary{
      cursor:pointer;
      color:rgba(240,215,122,.95);
      font-weight:750;
    }

    .note{
      margin-top:10px;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.55;
    }

    .svg{
      width:16px;height:16px; flex:0 0 16px;
      fill:rgba(240,215,122,.95);
    }

    .footer{
      margin-top:18px;
      color:var(--muted);
      font-size:12px;
      line-height:1.5;
      opacity:.92;
    }

    .ok{ color:#b7f7c7; }
    .warn{ color:#ffd38a; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <div class="hero-card">
        <div class="hero-inner">
          <div class="kicker">
            <span class="badge">
              <svg class="svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2 3 6v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V6l-9-4Zm0 2.2 7 3.11V12c0 4.56-3.01 8.94-7 10-3.99-1.06-7-5.44-7-10V7.31l7-3.11Zm-1 5.3h2v6h-2v-6Zm0 7.5h2v2h-2v-2Z"/></svg>
              <span data-i18n="badge_internal">Internes Planungstool</span>
            </span>
            <span class="muted" data-i18n="kicker_right">Worstcase / Zielplanung • Mitgliedschaft • Leadmaschine • Weekend-Setup</span>
          </div>

          <div class="topline"></div>

          <h1 class="title" data-i18n="title">Worstcase-Rechner – Club Betrieb & Skalierung</h1>
          <p class="subtitle" data-i18n="subtitle">
            Dieses Tool ist für die Geschäftsleitung: Es macht sichtbar, was bei konservativen Annahmen im Jahr 1 und Jahr 2 entsteht —
            wie viel in den Vertrieb fließt, was als Club-Umsatz verbleibt, und wie Weekend-Kapazitäten die Praxis begrenzen.
          </p>
        </div>
      </div>

      <div class="actions">
        <div class="row">
          <div class="lang" aria-label="Language">
            <button class="btn small primary" id="btnDE">DE</button>
            <button class="btn small" id="btnEN">EN</button>
          </div>
          <button class="btn small" id="btnReset" data-i18n="btn_reset">Reset</button>
        </div>

        <div class="divider"></div>

        <div class="row">
          <button class="btn primary" id="btnCalc" data-i18n="btn_calc">Neu berechnen</button>
          <button class="btn" id="btnCopy" data-i18n="btn_copy">Ergebnis kopieren</button>
        </div>

        <div class="hint" data-i18n="hint">
          Tipp: Für Worstcase starte konservativ (wenige aktive Mitglieder, begrenzte Events, Schwund einrechnen).
          Für Zielplanung nutze die „Ziel-Umsatz“-Sektion.
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- INPUTS -->
      <div class="card" id="cardInputs">
        <h2 data-i18n="h_inputs">Eingaben</h2>
        <p data-i18n="p_inputs">
          Die Logik ist bewusst sauber und steuerbar: Du kannst linear planen (fixe Neumitglieder/Monat) oder eine konservative Wachstumslogik nutzen
          (nur ein Teil ist aktiv, Empfehlung pro aktivem Mitglied).
        </p>

        <div class="split">
          <div class="field">
            <label><span data-i18n="lbl_mode">Modus</span><span data-i18n="lbl_mode_hint">Planung</span></label>
            <select id="mode">
              <option value="linear" data-i18n="opt_linear">Linear (Neumitglieder/Monat)</option>
              <option value="growth" data-i18n="opt_growth">Wachstum (aktive Quote + Empfehlung)</option>
            </select>
          </div>

          <div class="field">
            <label><span data-i18n="lbl_lang">Sprache</span><span data-i18n="lbl_lang_hint">Anzeige</span></label>
            <select id="lang">
              <option value="de">DE</option>
              <option value="en">EN</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <h2 data-i18n="h_base">Basis / Bestand</h2>
        <div class="fields">
          <div class="field">
            <label><span data-i18n="lbl_start_members">Mitgliederbestand zum Jahresstart (Jahr 1)</span><span class="mono">#</span></label>
            <input id="startMembers" type="number" min="0" step="1" value="0" />
          </div>

          <div class="field">
            <label><span data-i18n="lbl_churn">Schwund/Abbruch von Jahr 1 → Jahr 2</span><span class="mono">%</span></label>
            <input id="churn" type="number" min="0" max="100" step="0.1" value="20" />
          </div>
        </div>

        <div class="divider"></div>

        <h2 data-i18n="h_growth">Neumitglieder-Logik</h2>

        <!-- Linear inputs -->
        <div id="linearBlock">
          <div class="fields">
            <div class="field">
              <label><span data-i18n="lbl_new_y1">Neumitglieder pro Monat (Jahr 1)</span><span class="mono">#</span></label>
              <input id="newPerMonthY1" type="number" min="0" step="1" value="167" />
            </div>
            <div class="field">
              <label><span data-i18n="lbl_new_y2">Neumitglieder pro Monat (Jahr 2)</span><span class="mono">#</span></label>
              <input id="newPerMonthY2" type="number" min="0" step="1" value="167" />
            </div>
          </div>
          <p class="note" data-i18n="p_linear_note">
            Linear bedeutet: es wird bewusst nicht „hochgerechnet“, sondern als konservatives Planmaß genommen.
          </p>
        </div>

        <!-- Growth inputs -->
        <div id="growthBlock" style="display:none;">
          <div class="fields">
            <div class="field">
              <label><span data-i18n="lbl_active_share">Aktive Mitglieder-Quote (nur diese gewinnen neue)</span><span class="mono">%</span></label>
              <input id="activeShare" type="number" min="0" max="100" step="0.1" value="40" />
            </div>
            <div class="field">
              <label><span data-i18n="lbl_ref_base">Neue Mitglieder pro aktivem Mitglied / Monat</span><span class="mono">#</span></label>
              <input id="referralsPerActive" type="number" min="0" step="0.01" value="1" />
            </div>
          </div>

          <div class="fields">
            <div class="field">
              <label><span data-i18n="lbl_ref_new">Neumitglieder (neu) empfehlen ebenfalls?</span><span data-i18n="lbl_ref_new_hint">Konservativ</span></label>
              <select id="newAlsoRefer">
                <option value="off" data-i18n="opt_new_ref_off">Aus (kein Ketteneffekt)</option>
                <option value="on" data-i18n="opt_new_ref_on">An (Ketteneffekt, konservativ)</option>
              </select>
            </div>
            <div class="field">
              <label><span data-i18n="lbl_ref_new_rate">Wenn An: Rate pro aktivem Neumitglied / Monat</span><span class="mono">#</span></label>
              <input id="referralsPerActiveNew" type="number" min="0" step="0.01" value="1" />
            </div>
          </div>

          <p class="note" data-i18n="p_growth_note">
            Wachstum ist hier absichtlich „führbar“: Nur ein Teil ist aktiv. Und du kannst Ketteneffekte komplett auslassen.
          </p>
        </div>

        <div class="divider"></div>

        <h2 data-i18n="h_products">Produkte / Preise / Quoten</h2>
        <div class="fields">
          <div class="field">
            <label><span data-i18n="lbl_fee_member">Mitgliedsbeitrag (pro Jahr)</span><span class="mono">€</span></label>
            <input id="feeMember" type="number" min="0" step="0.01" value="60" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_fee_lead">Leadmaschine (Add-on, pro Jahr – nur als Mitglied)</span><span class="mono">€</span></label>
            <input id="feeLead" type="number" min="0" step="0.01" value="60" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_rate_lead">Leadmaschine-Quote (z. B. jedes 2. Mitglied)</span><span class="mono">%</span></label>
            <input id="rateLead" type="number" min="0" max="100" step="0.1" value="50" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_price_weekend">Weekend-Setup (Mitgliedspreis pro Teilnehmer)</span><span class="mono">€</span></label>
            <input id="priceWeekend" type="number" min="0" step="0.01" value="399" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_rate_weekend">Weekend-Setup-Quote (z. B. jedes 4. Mitglied)</span><span class="mono">%</span></label>
            <input id="rateWeekend" type="number" min="0" max="100" step="0.1" value="25" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_sales_share">Vertrieb gesamt (aus allen Produkten)</span><span class="mono">%</span></label>
            <input id="salesShare" type="number" min="0" max="100" step="0.1" value="45" />
          </div>
        </div>

        <div class="divider"></div>

        <h2 data-i18n="h_weekend_cap">Weekend-Kapazität & Kosten</h2>
        <div class="fields">
          <div class="field">
            <label><span data-i18n="lbl_events_y1">Geplante Weekend-Events (Jahr 1)</span><span class="mono">#</span></label>
            <input id="eventsY1" type="number" min="0" step="1" value="24" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_events_y2">Geplante Weekend-Events (Jahr 2)</span><span class="mono">#</span></label>
            <input id="eventsY2" type="number" min="0" step="1" value="48" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_seats_per_event">Teilnehmer pro Event (Plan-Ziel)</span><span class="mono">#</span></label>
            <input id="seatsPerEvent" type="number" min="1" step="1" value="50" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_min_seats">Mindest-Teilnehmer (unterhalb: Event nicht ansetzen)</span><span class="mono">#</span></label>
            <input id="minSeats" type="number" min="0" step="1" value="20" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_cost_event">Budget/Kosten pro Event (Club-Kostenrahmen)</span><span class="mono">€</span></label>
            <input id="costPerEvent" type="number" min="0" step="0.01" value="5000" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_cost_note">Hinweis</span><span class="mono">i</span></label>
            <select id="costMode">
              <option value="needed" data-i18n="opt_cost_needed">Kosten nur für benötigte Events (nach Nachfrage)</option>
              <option value="planned" data-i18n="opt_cost_planned">Kosten für geplante Events (Planung fix)</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <h2 data-i18n="h_target">Ziel-Umsatz (optional, linearer Solver)</h2>
        <p data-i18n="p_target">
          Diese Sektion hilft, ein Jahresziel grob auf Neumitglieder/Monat herunterzubrechen (konservativ & linear).
          Weekend-Kapazität bleibt dabei ein Limit.
        </p>

        <div class="fields">
          <div class="field">
            <label><span data-i18n="lbl_target_y1">Ziel Brutto-Umsatz Jahr 1</span><span class="mono">€</span></label>
            <input id="targetY1" type="number" min="0" step="1000" value="500000" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_target_btn">Solver</span><span class="mono">→</span></label>
            <button class="btn" id="btnSolve" data-i18n="btn_solve">Neumitglieder/Monat berechnen (Jahr 1)</button>
          </div>
        </div>

        <div class="note" id="solveOut"></div>
      </div>

      <!-- OUTPUTS -->
      <div class="card" id="cardOutputs">
        <h2 data-i18n="h_outputs">Ergebnis (Jahr 1 / Jahr 2)</h2>
        <p data-i18n="p_outputs">
          Anzeige: Brutto-Umsatz, Vertrieb-Abfluss (45%), Club-Anteil (55%), Weekend-Kosten (Budget), sowie Kapazitäts-Checks.
        </p>

        <div class="pill" id="summaryPill">
          <svg class="svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2a10 10 0 1 0 10 10A10.01 10.01 0 0 0 12 2Zm1 15h-2v-6h2Zm0-8h-2V7h2Z"/></svg>
          <span id="summaryText" class="mono"></span>
        </div>

        <div class="divider"></div>

        <table aria-label="Year summary">
          <thead>
            <tr>
              <th data-i18n="th_metric">Kennzahl</th>
              <th class="right" data-i18n="th_y1">Jahr 1</th>
              <th class="right" data-i18n="th_y2">Jahr 2</th>
            </tr>
          </thead>
          <tbody id="tblMain"></tbody>
        </table>

        <details>
          <summary data-i18n="sum_details">Details: Produkte, Vertrieb/Club, Weekend-Kapazität</summary>

          <table>
            <thead>
              <tr>
                <th data-i18n="th_detail">Detail</th>
                <th class="right" data-i18n="th_y1">Jahr 1</th>
                <th class="right" data-i18n="th_y2">Jahr 2</th>
              </tr>
            </thead>
            <tbody id="tblDetail"></tbody>
          </table>

          <div class="note" id="capNote"></div>
        </details>

        <details id="simDetails" style="display:none;">
          <summary data-i18n="sum_sim">Simulation (Monate) – nur im Wachstumsmodus</summary>
          <table>
            <thead>
              <tr>
                <th data-i18n="th_month">Monat</th>
                <th class="right" data-i18n="th_members">Mitglieder (Ende)</th>
                <th class="right" data-i18n="th_new">Neumitglieder</th>
              </tr>
            </thead>
            <tbody id="tblSimY1"></tbody>
          </table>

          <div class="divider"></div>

          <table>
            <thead>
              <tr>
                <th data-i18n="th_month">Monat</th>
                <th class="right" data-i18n="th_members">Mitglieder (Ende)</th>
                <th class="right" data-i18n="th_new">Neumitglieder</th>
              </tr>
            </thead>
            <tbody id="tblSimY2"></tbody>
          </table>
        </details>

        <div class="footer" data-i18n="footer">
          Hinweis: Dieses Tool ist eine Planungs-Orientierung (Worstcase / Zielgrößen). Es ersetzt keine Buchhaltung und keine rechtliche/steuerliche Einordnung.
        </div>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       i18n (DE/EN) – local only
    ========================== */
    const I18N = {
      de: {
        badge_internal: "Internes Planungstool",
        kicker_right: "Worstcase / Zielplanung • Mitgliedschaft • Leadmaschine • Weekend-Setup",
        title: "Worstcase-Rechner – Club Betrieb & Skalierung",
        subtitle: "Dieses Tool ist für die Geschäftsleitung: Es macht sichtbar, was bei konservativen Annahmen im Jahr 1 und Jahr 2 entsteht — wie viel in den Vertrieb fließt, was als Club-Umsatz verbleibt, und wie Weekend-Kapazitäten die Praxis begrenzen.",
        btn_reset: "Reset",
        btn_calc: "Neu berechnen",
        btn_copy: "Ergebnis kopieren",
        hint: "Tipp: Für Worstcase starte konservativ (wenige aktive Mitglieder, begrenzte Events, Schwund einrechnen). Für Zielplanung nutze die „Ziel-Umsatz“-Sektion.",
        h_inputs: "Eingaben",
        p_inputs: "Die Logik ist bewusst sauber und steuerbar: Du kannst linear planen (fixe Neumitglieder/Monat) oder eine konservative Wachstumslogik nutzen (nur ein Teil ist aktiv, Empfehlung pro aktivem Mitglied).",
        lbl_mode: "Modus",
        lbl_mode_hint: "Planung",
        opt_linear: "Linear (Neumitglieder/Monat)",
        opt_growth: "Wachstum (aktive Quote + Empfehlung)",
        lbl_lang: "Sprache",
        lbl_lang_hint: "Anzeige",
        h_base: "Basis / Bestand",
        lbl_start_members: "Mitgliederbestand zum Jahresstart (Jahr 1)",
        lbl_churn: "Schwund/Abbruch von Jahr 1 → Jahr 2",
        h_growth: "Neumitglieder-Logik",
        lbl_new_y1: "Neumitglieder pro Monat (Jahr 1)",
        lbl_new_y2: "Neumitglieder pro Monat (Jahr 2)",
        p_linear_note: "Linear bedeutet: es wird bewusst nicht „hochgerechnet“, sondern als konservatives Planmaß genommen.",
        lbl_active_share: "Aktive Mitglieder-Quote (nur diese gewinnen neue)",
        lbl_ref_base: "Neue Mitglieder pro aktivem Mitglied / Monat",
        lbl_ref_new: "Neumitglieder (neu) empfehlen ebenfalls?",
        lbl_ref_new_hint: "Konservativ",
        opt_new_ref_off: "Aus (kein Ketteneffekt)",
        opt_new_ref_on: "An (Ketteneffekt, konservativ)",
        lbl_ref_new_rate: "Wenn An: Rate pro aktivem Neumitglied / Monat",
        p_growth_note: "Wachstum ist hier absichtlich „führbar“: Nur ein Teil ist aktiv. Und du kannst Ketteneffekte komplett auslassen.",
        h_products: "Produkte / Preise / Quoten",
        lbl_fee_member: "Mitgliedsbeitrag (pro Jahr)",
        lbl_fee_lead: "Leadmaschine (Add-on, pro Jahr – nur als Mitglied)",
        lbl_rate_lead: "Leadmaschine-Quote (z. B. jedes 2. Mitglied)",
        lbl_price_weekend: "Weekend-Setup (Mitgliedspreis pro Teilnehmer)",
        lbl_rate_weekend: "Weekend-Setup-Quote (z. B. jedes 4. Mitglied)",
        lbl_sales_share: "Vertrieb gesamt (aus allen Produkten)",
        h_weekend_cap: "Weekend-Kapazität & Kosten",
        lbl_events_y1: "Geplante Weekend-Events (Jahr 1)",
        lbl_events_y2: "Geplante Weekend-Events (Jahr 2)",
        lbl_seats_per_event: "Teilnehmer pro Event (Plan-Ziel)",
        lbl_min_seats: "Mindest-Teilnehmer (unterhalb: Event nicht ansetzen)",
        lbl_cost_event: "Budget/Kosten pro Event (Club-Kostenrahmen)",
        lbl_cost_note: "Hinweis",
        opt_cost_needed: "Kosten nur für benötigte Events (nach Nachfrage)",
        opt_cost_planned: "Kosten für geplante Events (Planung fix)",
        h_target: "Ziel-Umsatz (optional, linearer Solver)",
        p_target: "Diese Sektion hilft, ein Jahresziel grob auf Neumitglieder/Monat herunterzubrechen (konservativ & linear). Weekend-Kapazität bleibt dabei ein Limit.",
        lbl_target_y1: "Ziel Brutto-Umsatz Jahr 1",
        lbl_target_btn: "Solver",
        btn_solve: "Neumitglieder/Monat berechnen (Jahr 1)",
        h_outputs: "Ergebnis (Jahr 1 / Jahr 2)",
        p_outputs: "Anzeige: Brutto-Umsatz, Vertrieb-Abfluss (45%), Club-Anteil (55%), Weekend-Kosten (Budget), sowie Kapazitäts-Checks.",
        th_metric: "Kennzahl",
        th_y1: "Jahr 1",
        th_y2: "Jahr 2",
        sum_details: "Details: Produkte, Vertrieb/Club, Weekend-Kapazität",
        th_detail: "Detail",
        sum_sim: "Simulation (Monate) – nur im Wachstumsmodus",
        th_month: "Monat",
        th_members: "Mitglieder (Ende)",
        th_new: "Neumitglieder",
        footer: "Hinweis: Dieses Tool ist eine Planungs-Orientierung (Worstcase / Zielgrößen). Es ersetzt keine Buchhaltung und keine rechtliche/steuerliche Einordnung."
      },
      en: {
        badge_internal: "Internal planning tool",
        kicker_right: "Worst case / targets • Membership • Lead machine • Weekend setup",
        title: "Worst-Case Calculator – Club Operations & Scaling",
        subtitle: "This tool is for management: it shows what conservative assumptions produce in Year 1 and Year 2 — how much flows to sales, what remains as club revenue, and how weekend capacity limits real-world execution.",
        btn_reset: "Reset",
        btn_calc: "Recalculate",
        btn_copy: "Copy results",
        hint: "Tip: For worst-case planning, stay conservative (few active members, limited events, include churn). For targets, use the “Revenue target” section.",
        h_inputs: "Inputs",
        p_inputs: "The logic is intentionally clean and controllable: plan linearly (fixed new members/month) or use a conservative growth logic (only a share is active, referrals per active member).",
        lbl_mode: "Mode",
        lbl_mode_hint: "Planning",
        opt_linear: "Linear (new members/month)",
        opt_growth: "Growth (active share + referrals)",
        lbl_lang: "Language",
        lbl_lang_hint: "Display",
        h_base: "Base / starting members",
        lbl_start_members: "Members at start of Year 1",
        lbl_churn: "Churn/drop-off from Year 1 → Year 2",
        h_growth: "New member logic",
        lbl_new_y1: "New members per month (Year 1)",
        lbl_new_y2: "New members per month (Year 2)",
        p_linear_note: "Linear means: no compounding — a conservative planning baseline.",
        lbl_active_share: "Active member share (only these recruit)",
        lbl_ref_base: "New members per active member / month",
        lbl_ref_new: "Do new members also recruit?",
        lbl_ref_new_hint: "Conservative",
        opt_new_ref_off: "Off (no chain effect)",
        opt_new_ref_on: "On (chain effect, conservative)",
        lbl_ref_new_rate: "If on: rate per active new member / month",
        p_growth_note: "Growth is built to stay “manageable”: only a share is active, and you can fully disable chain effects.",
        h_products: "Products / prices / rates",
        lbl_fee_member: "Membership fee (per year)",
        lbl_fee_lead: "Lead machine (add-on, per year — members only)",
        lbl_rate_lead: "Lead machine take-rate (e.g., every 2nd member)",
        lbl_price_weekend: "Weekend setup (member price per participant)",
        lbl_rate_weekend: "Weekend setup rate (e.g., every 4th member)",
        lbl_sales_share: "Sales payout (across all products)",
        h_weekend_cap: "Weekend capacity & costs",
        lbl_events_y1: "Planned weekend events (Year 1)",
        lbl_events_y2: "Planned weekend events (Year 2)",
        lbl_seats_per_event: "Participants per event (plan target)",
        lbl_min_seats: "Minimum participants (below: don’t run event)",
        lbl_cost_event: "Budget/cost per event (club cost frame)",
        lbl_cost_note: "Note",
        opt_cost_needed: "Costs only for needed events (by demand)",
        opt_cost_planned: "Costs for planned events (fixed planning)",
        h_target: "Revenue target (optional, linear solver)",
        p_target: "This section helps translate an annual target into new members/month (conservative & linear). Weekend capacity remains a limit.",
        lbl_target_y1: "Target gross revenue Year 1",
        lbl_target_btn: "Solver",
        btn_solve: "Calculate new members/month (Year 1)",
        h_outputs: "Results (Year 1 / Year 2)",
        p_outputs: "Shown: gross revenue, sales payout (45%), club share (55%), weekend costs (budget), and capacity checks.",
        th_metric: "Metric",
        th_y1: "Year 1",
        th_y2: "Year 2",
        sum_details: "Details: products, sales/club, weekend capacity",
        th_detail: "Detail",
        sum_sim: "Simulation (months) – growth mode only",
        th_month: "Month",
        th_members: "Members (end)",
        th_new: "New members",
        footer: "Note: This is a planning orientation (worst-case/targets). It does not replace accounting or legal/tax classification."
      }
    };

    function fmtEUR(n, lang){
      const v = Number.isFinite(n) ? n : 0;
      return new Intl.NumberFormat(lang === 'de' ? 'de-DE' : 'en-US', {
        style:'currency', currency:'EUR', maximumFractionDigits:0
      }).format(v);
    }
    function fmtNum(n, lang, digits=0){
      const v = Number.isFinite(n) ? n : 0;
      return new Intl.NumberFormat(lang === 'de' ? 'de-DE' : 'en-US', {
        maximumFractionDigits:digits, minimumFractionDigits:digits
      }).format(v);
    }

    const $ = (id)=>document.getElementById(id);

    function setLang(lang){
      $('lang').value = lang;
      document.documentElement.lang = lang;
      $('btnDE').classList.toggle('primary', lang==='de');
      $('btnEN').classList.toggle('primary', lang==='en');

      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const k = el.getAttribute('data-i18n');
        if(I18N[lang] && I18N[lang][k]) el.textContent = I18N[lang][k];
      });
      // refresh calculations so formatted numbers match locale
      calc();
    }

    function readNum(id){
      const v = parseFloat($(id).value);
      return Number.isFinite(v) ? v : 0;
    }

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    /* =========================
       Core modeling
    ========================== */

    function simulateGrowthYear(startMembers, months, activeSharePct, rActive, chainOn, rActiveNew){
      // Returns arrays of month results: [{month, endMembers, newMembers}]
      const out = [];
      let members = Math.max(0, Math.round(startMembers));
      let cumulativeNew = 0;

      const activeShare = clamp(activeSharePct/100, 0, 1);

      for(let m=1;m<=months;m++){
        const activeBase = Math.round(members * activeShare);

        let newFromBase = activeBase * rActive;

        let newFromNew = 0;
        if(chainOn){
          const activeNew = Math.round(cumulativeNew * activeShare);
          newFromNew = activeNew * rActiveNew;
        }

        let newMembers = newFromBase + newFromNew;

        // Keep conservative: round to whole people, never negative
        newMembers = Math.max(0, Math.round(newMembers));

        members += newMembers;
        cumulativeNew += newMembers;

        out.push({month:m, endMembers:members, newMembers:newMembers});
      }
      return out;
    }

    function calcYearFigures({
      membersStartYear,
      membersEndYear,
      membersPaidYear, // how many pay membership fee in that year
      feeMember,
      feeLead,
      rateLeadPct,
      priceWeekend,
      rateWeekendPct,
      seatsPerEvent,
      minSeats,
      plannedEvents,
      costPerEvent,
      costMode,
      salesSharePct
    }){
      const salesShare = clamp(salesSharePct/100, 0, 1);
      const clubShare = 1 - salesShare;

      // Leadmachine customers in that year (simple: % of paid members that year)
      const leadCustomers = Math.round(membersPaidYear * clamp(rateLeadPct/100, 0, 1));

      // Weekend demand (membersEndYear as proxy for "people in system this year"; conservative: use paid year)
      const weekendDemandSeats = Math.round(membersPaidYear * clamp(rateWeekendPct/100, 0, 1));

      const capSeats = Math.max(0, Math.round(plannedEvents * seatsPerEvent));
      const seatsSold = Math.min(weekendDemandSeats, capSeats);

      // needed events by demand (only if seatsSold reaches minimum thresholds)
      let neededEvents = 0;
      if(seatsSold > 0){
        neededEvents = Math.ceil(seatsSold / Math.max(1, seatsPerEvent));
      }
      // apply min seats rule: if an event would fall below minSeats, we reduce sold seats to fit viable events
      // conservative rule: last event must meet minSeats, otherwise it is not scheduled and those seats are "unsatisfied demand"
      if(neededEvents > 0 && minSeats > 0){
        const fullEvents = Math.floor(seatsSold / seatsPerEvent);
        const lastSeats = seatsSold - fullEvents * seatsPerEvent;
        if(lastSeats > 0 && lastSeats < minSeats){
          // drop the last event
          neededEvents = Math.max(0, neededEvents - 1);
        }
      }

      let actualEvents = (costMode === 'planned') ? plannedEvents : neededEvents;
      actualEvents = Math.max(0, Math.round(actualEvents));

      const actualCapSeats = Math.round(actualEvents * seatsPerEvent);
      const seatsSoldAdjusted = Math.min(seatsSold, actualCapSeats);

      const unsatisfied = Math.max(0, weekendDemandSeats - seatsSoldAdjusted);

      const revMember = membersPaidYear * feeMember;
      const revLead = leadCustomers * feeLead;
      const revWeekend = seatsSoldAdjusted * priceWeekend;
      const revTotal = revMember + revLead + revWeekend;

      const payoutSales = revTotal * salesShare;
      const clubGross = revTotal * clubShare;

      const weekendCosts = actualEvents * costPerEvent;
      const clubAfterEvent = clubGross - weekendCosts;

      return {
        membersStartYear, membersEndYear, membersPaidYear,
        leadCustomers,
        weekendDemandSeats,
        plannedEvents, actualEvents,
        capSeats, actualCapSeats,
        seatsSold: seatsSoldAdjusted,
        unsatisfied,
        revMember, revLead, revWeekend, revTotal,
        payoutSales, clubGross, weekendCosts, clubAfterEvent
      };
    }

    function calc(){
      const lang = $('lang').value;

      // mode + blocks
      const mode = $('mode').value;
      $('linearBlock').style.display = (mode === 'linear') ? '' : 'none';
      $('growthBlock').style.display = (mode === 'growth') ? '' : 'none';
      $('simDetails').style.display = (mode === 'growth') ? '' : 'none';

      // base
      const startMembers = Math.max(0, Math.round(readNum('startMembers')));
      const churn = clamp(readNum('churn')/100, 0, 1);

      // products/prices
      const feeMember = readNum('feeMember');
      const feeLead = readNum('feeLead');
      const rateLead = clamp(readNum('rateLead'), 0, 100);
      const priceWeekend = readNum('priceWeekend');
      const rateWeekend = clamp(readNum('rateWeekend'), 0, 100);
      const salesShare = clamp(readNum('salesShare'), 0, 100);

      // weekend
      const seatsPerEvent = Math.max(1, Math.round(readNum('seatsPerEvent')));
      const minSeats = Math.max(0, Math.round(readNum('minSeats')));
      const eventsY1 = Math.max(0, Math.round(readNum('eventsY1')));
      const eventsY2 = Math.max(0, Math.round(readNum('eventsY2')));
      const costPerEvent = Math.max(0, readNum('costPerEvent'));
      const costMode = $('costMode').value;

      // members per year (linear or growth)
      let newY1=0, newY2=0;
      let endY1 = startMembers;
      let startY2 = 0;
      let endY2 = 0;

      let simY1 = [];
      let simY2 = [];

      if(mode === 'linear'){
        const n1 = Math.max(0, Math.round(readNum('newPerMonthY1')));
        const n2 = Math.max(0, Math.round(readNum('newPerMonthY2')));
        newY1 = n1 * 12;
        endY1 = startMembers + newY1;

        startY2 = Math.round(endY1 * (1 - churn));
        newY2 = n2 * 12;
        endY2 = startY2 + newY2;
      }else{
        const activeShare = clamp(readNum('activeShare'), 0, 100);
        const rBase = Math.max(0, readNum('referralsPerActive'));
        const chainOn = ($('newAlsoRefer').value === 'on');
        const rNew = Math.max(0, readNum('referralsPerActiveNew'));

        simY1 = simulateGrowthYear(startMembers, 12, activeShare, rBase, chainOn, rNew);
        endY1 = simY1.length ? simY1[simY1.length-1].endMembers : startMembers;
        newY1 = simY1.reduce((a,b)=>a+b.newMembers,0);

        startY2 = Math.round(endY1 * (1 - churn));
        simY2 = simulateGrowthYear(startY2, 12, activeShare, rBase, chainOn, rNew);
        endY2 = simY2.length ? simY2[simY2.length-1].endMembers : startY2;
        newY2 = simY2.reduce((a,b)=>a+b.newMembers,0);
      }

      // how many pay in each year
      // Year 1: all members in system that year are counted as paid for planning baseline
      const paidY1 = endY1; // conservative baseline: each member has paid membership for the year
      // Year 2: retained base + new
      const paidY2 = endY2;

      // calculate year figures
      const y1 = calcYearFigures({
        membersStartYear:startMembers,
        membersEndYear:endY1,
        membersPaidYear:paidY1,
        feeMember, feeLead, rateLeadPct:rateLead, priceWeekend, rateWeekendPct:rateWeekend,
        seatsPerEvent, minSeats,
        plannedEvents:eventsY1,
        costPerEvent, costMode,
        salesSharePct:salesShare
      });

      const y2 = calcYearFigures({
        membersStartYear:startY2,
        membersEndYear:endY2,
        membersPaidYear:paidY2,
        feeMember, feeLead, rateLeadPct:rateLead, priceWeekend, rateWeekendPct:rateWeekend,
        seatsPerEvent, minSeats,
        plannedEvents:eventsY2,
        costPerEvent, costMode,
        salesSharePct:salesShare
      });

      // Summary pill
      const clubBeforeTaxY1 = y1.clubAfterEvent;
      const clubBeforeTaxY2 = y2.clubAfterEvent;
      $('summaryText').textContent =
        (lang==='de'
          ? `Club (nach Vertrieb & Event-Budget): ${fmtEUR(clubBeforeTaxY1,lang)} / ${fmtEUR(clubBeforeTaxY2,lang)}`
          : `Club (after sales & event budget): ${fmtEUR(clubBeforeTaxY1,lang)} / ${fmtEUR(clubBeforeTaxY2,lang)}`
        );

      // Main table
      const rows = [
        {k: lang==='de' ? 'Mitglieder (Start)' : 'Members (start)', a: y1.membersStartYear, b: y2.membersStartYear, t:'num'},
        {k: lang==='de' ? 'Neumitglieder (Jahr)' : 'New members (year)', a: newY1, b: newY2, t:'num'},
        {k: lang==='de' ? 'Mitglieder (Ende)' : 'Members (end)', a: y1.membersEndYear, b: y2.membersEndYear, t:'num'},
        {k: lang==='de' ? 'Brutto-Umsatz gesamt' : 'Total gross revenue', a: y1.revTotal, b: y2.revTotal, t:'eur'},
        {k: lang==='de' ? '→ davon Vertrieb (Payout)' : '→ Sales payout', a: y1.payoutSales, b: y2.payoutSales, t:'eur'},
        {k: lang==='de' ? '→ Club-Anteil (vor Event-Budget)' : '→ Club share (before event budget)', a: y1.clubGross, b: y2.clubGross, t:'eur'},
        {k: lang==='de' ? 'Weekend-Budget (Events)' : 'Weekend budget (events)', a: y1.weekendCosts, b: y2.weekendCosts, t:'eur'},
        {k: lang==='de' ? 'Club-Umsatz (nach Event-Budget)' : 'Club revenue (after event budget)', a: y1.clubAfterEvent, b: y2.clubAfterEvent, t:'eur'}
      ];

      const tbody = $('tblMain');
      tbody.innerHTML = rows.map(r=>{
        const a = (r.t==='eur') ? fmtEUR(r.a, lang) : fmtNum(r.a, lang, 0);
        const b = (r.t==='eur') ? fmtEUR(r.b, lang) : fmtNum(r.b, lang, 0);
        return `<tr>
          <td>${r.k}</td>
          <td class="right mono">${a}</td>
          <td class="right mono">${b}</td>
        </tr>`;
      }).join('');

      // Detail table
      const drows = [
        {k: lang==='de' ? 'Mitgliedschaft Umsatz' : 'Membership revenue', a: y1.revMember, b: y2.revMember, t:'eur'},
        {k: lang==='de' ? 'Leadmaschine Kunden (#)' : 'Lead machine customers (#)', a: y1.leadCustomers, b: y2.leadCustomers, t:'num'},
        {k: lang==='de' ? 'Leadmaschine Umsatz' : 'Lead machine revenue', a: y1.revLead, b: y2.revLead, t:'eur'},
        {k: lang==='de' ? 'Weekend Nachfrage (Sitze)' : 'Weekend demand (seats)', a: y1.weekendDemandSeats, b: y2.weekendDemandSeats, t:'num'},
        {k: lang==='de' ? 'Weekend verkauft (Sitze)' : 'Weekend sold (seats)', a: y1.seatsSold, b: y2.seatsSold, t:'num'},
        {k: lang==='de' ? 'Weekend Umsatz' : 'Weekend revenue', a: y1.revWeekend, b: y2.revWeekend, t:'eur'},
        {k: lang==='de' ? 'Weekend Events (geplant)' : 'Weekend events (planned)', a: y1.plannedEvents, b: y2.plannedEvents, t:'num'},
        {k: lang==='de' ? 'Weekend Events (gerechnet)' : 'Weekend events (calculated)', a: y1.actualEvents, b: y2.actualEvents, t:'num'},
        {k: lang==='de' ? 'Kapazität (Sitze geplant)' : 'Capacity (planned seats)', a: y1.capSeats, b: y2.capSeats, t:'num'},
        {k: lang==='de' ? 'Kapazität (Sitze gerechnet)' : 'Capacity (calculated seats)', a: y1.actualCapSeats, b: y2.actualCapSeats, t:'num'},
        {k: lang==='de' ? 'Ungedeckte Nachfrage (Sitze)' : 'Unserved demand (seats)', a: y1.unsatisfied, b: y2.unsatisfied, t:'num'}
      ];

      $('tblDetail').innerHTML = drows.map(r=>{
        const a = (r.t==='eur') ? fmtEUR(r.a, lang) : fmtNum(r.a, lang, 0);
        const b = (r.t==='eur') ? fmtEUR(r.b, lang) : fmtNum(r.b, lang, 0);
        return `<tr>
          <td>${r.k}</td>
          <td class="right mono">${a}</td>
          <td class="right mono">${b}</td>
        </tr>`;
      }).join('');

      // Capacity note
      const capMsg = [];
      if(y1.unsatisfied > 0){
        capMsg.push(lang==='de'
          ? `Jahr 1: Die Weekend-Nachfrage übersteigt die Kapazität um ${fmtNum(y1.unsatisfied,lang,0)} Sitze. (Hebel: mehr Events, mehr Plätze/Event, andere Quote.)`
          : `Year 1: Weekend demand exceeds capacity by ${fmtNum(y1.unsatisfied,lang,0)} seats. (Levers: more events, more seats/event, different rate.)`
        );
      }else{
        capMsg.push(lang==='de'
          ? `Jahr 1: Kapazität reicht für die angenommene Nachfrage (oder ist darüber).`
          : `Year 1: Capacity covers assumed demand (or exceeds it).`
        );
      }
      if(y2.unsatisfied > 0){
        capMsg.push(lang==='de'
          ? `Jahr 2: Die Weekend-Nachfrage übersteigt die Kapazität um ${fmtNum(y2.unsatisfied,lang,0)} Sitze.`
          : `Year 2: Weekend demand exceeds capacity by ${fmtNum(y2.unsatisfied,lang,0)} seats.`
        );
      }else{
        capMsg.push(lang==='de'
          ? `Jahr 2: Kapazität reicht für die angenommene Nachfrage (oder ist darüber).`
          : `Year 2: Capacity covers assumed demand (or exceeds it).`
        );
      }
      $('capNote').textContent = capMsg.join(' ');

      // Simulation tables for growth mode
      if(mode === 'growth'){
        const y1Rows = simY1.map(r=>`<tr><td>${r.month}</td><td class="right mono">${fmtNum(r.endMembers,lang,0)}</td><td class="right mono">${fmtNum(r.newMembers,lang,0)}</td></tr>`).join('');
        const y2Rows = simY2.map(r=>`<tr><td>${r.month}</td><td class="right mono">${fmtNum(r.endMembers,lang,0)}</td><td class="right mono">${fmtNum(r.newMembers,lang,0)}</td></tr>`).join('');
        $('tblSimY1').innerHTML = y1Rows;
        $('tblSimY2').innerHTML = y2Rows;
      }else{
        $('tblSimY1').innerHTML = '';
        $('tblSimY2').innerHTML = '';
      }

      // store result for copy
      window.__result = {
        mode,
        startMembers,
        churn,
        year1: y1,
        year2: y2,
        assumptions: {
          feeMember, feeLead, rateLead, priceWeekend, rateWeekend, salesShare,
          eventsY1, eventsY2, seatsPerEvent, minSeats, costPerEvent, costMode
        }
      };
    }

    function resetAll(){
      $('mode').value = 'linear';
      $('lang').value = 'de';

      $('startMembers').value = 0;
      $('churn').value = 20;

      $('newPerMonthY1').value = 167;
      $('newPerMonthY2').value = 167;

      $('activeShare').value = 40;
      $('referralsPerActive').value = 1;
      $('newAlsoRefer').value = 'off';
      $('referralsPerActiveNew').value = 1;

      $('feeMember').value = 60;
      $('feeLead').value = 60;
      $('rateLead').value = 50;
      $('priceWeekend').value = 399;
      $('rateWeekend').value = 25;
      $('salesShare').value = 45;

      $('eventsY1').value = 24;
      $('eventsY2').value = 48;
      $('seatsPerEvent').value = 50;
      $('minSeats').value = 20;
      $('costPerEvent').value = 5000;
      $('costMode').value = 'needed';

      $('targetY1').value = 500000;
      $('solveOut').textContent = '';

      setLang($('lang').value);
      calc();
    }

    function solveTarget(){
      // simple linear solver for Year 1: find newPerMonthY1 such that revTotal ~ target
      // Keep Year2 untouched, and keep within weekend capacity constraints.
      const lang = $('lang').value;

      const target = Math.max(0, readNum('targetY1'));
      const startMembers = Math.max(0, Math.round(readNum('startMembers')));

      const feeMember = readNum('feeMember');
      const feeLead = readNum('feeLead');
      const rateLead = clamp(readNum('rateLead'),0,100)/100;
      const priceWeekend = readNum('priceWeekend');
      const rateWeekend = clamp(readNum('rateWeekend'),0,100)/100;
      const salesShare = clamp(readNum('salesShare'),0,100)/100;

      const seatsPerEvent = Math.max(1, Math.round(readNum('seatsPerEvent')));
      const minSeats = Math.max(0, Math.round(readNum('minSeats')));
      const plannedEvents = Math.max(0, Math.round(readNum('eventsY1')));
      const capSeats = plannedEvents * seatsPerEvent;

      // brute force search 0..50000 new members / month (safe range)
      let best = {m:0, diff:Infinity, rev:0, capHit:false};

      for(let m=0;m<=50000;m++){
        const newY1 = m*12;
        const endY1 = startMembers + newY1;
        const paidY1 = endY1;

        const leadCustomers = Math.round(paidY1 * rateLead);
        const weekendDemand = Math.round(paidY1 * rateWeekend);

        // capacity-limited seats sold with minSeats rule on last event
        const seatsSold = Math.min(weekendDemand, capSeats);
        let neededEvents = 0;
        if(seatsSold > 0){
          neededEvents = Math.ceil(seatsSold / seatsPerEvent);
        }
        if(neededEvents > 0 && minSeats > 0){
          const fullEvents = Math.floor(seatsSold / seatsPerEvent);
          const lastSeats = seatsSold - fullEvents * seatsPerEvent;
          if(lastSeats > 0 && lastSeats < minSeats){
            neededEvents = Math.max(0, neededEvents - 1);
          }
        }
        const actualEvents = neededEvents; // solver assumes "needed" cost mode
        const actualCap = actualEvents * seatsPerEvent;
        const seatsSoldAdj = Math.min(seatsSold, actualCap);

        const revMember = paidY1 * feeMember;
        const revLead = leadCustomers * feeLead;
        const revWeekend = seatsSoldAdj * priceWeekend;
        const revTotal = revMember + revLead + revWeekend;

        const diff = Math.abs(revTotal - target);
        if(diff < best.diff){
          best = {m, diff, rev:revTotal, capHit: (weekendDemand > capSeats)};
          if(diff === 0) break;
        }
        // early break if revenue already far above target and keeps increasing (monotonic)
        if(m>500 && revTotal > target + 5_000_000) break;
      }

      const msg = (lang==='de')
        ? `Solver (Jahr 1, linear): ca. ${fmtNum(best.m,lang,0)} Neumitglieder/Monat → Brutto ${fmtEUR(best.rev,lang)}. ${best.capHit ? 'Achtung: Weekend-Kapazität limitiert (Quote/Events prüfen).' : ''} (Hinweis: Solver ignoriert Event-Kosten & nimmt „Kosten nur für benötigte Events“ an.)`
        : `Solver (Year 1, linear): approx. ${fmtNum(best.m,lang,0)} new members/month → gross ${fmtEUR(best.rev,lang)}. ${best.capHit ? 'Note: weekend capacity limits (review rate/events).' : ''} (Note: solver ignores event costs and assumes “costs for needed events only”.)`;

      $('solveOut').textContent = msg;
      $('mode').value = 'linear';
      $('newPerMonthY1').value = best.m;
      calc();
    }

    function copyResult(){
      const lang = $('lang').value;
      const r = window.__result;
      if(!r) return;

      const y1 = r.year1, y2 = r.year2;
      const text = [
        (lang==='de' ? 'Worstcase Ergebnis (intern)' : 'Worst-case results (internal)'),
        `Mode: ${r.mode}`,
        `Year1: members end ${y1.membersEndYear}, gross ${y1.revTotal.toFixed(0)}, sales ${y1.payoutSales.toFixed(0)}, club(after events) ${y1.clubAfterEvent.toFixed(0)}`,
        `Year2: members end ${y2.membersEndYear}, gross ${y2.revTotal.toFixed(0)}, sales ${y2.payoutSales.toFixed(0)}, club(after events) ${y2.clubAfterEvent.toFixed(0)}`,
        (lang==='de' ? 'Hinweis: Zahlen sind Planungswerte.' : 'Note: planning values.')
      ].join('\n');

      navigator.clipboard.writeText(text).then(()=>{
        $('btnCopy').textContent = (lang==='de' ? 'Kopiert ✓' : 'Copied ✓');
        setTimeout(()=> $('btnCopy').textContent = I18N[lang].btn_copy, 1200);
      });
    }

    // events
    $('btnDE').addEventListener('click', ()=>setLang('de'));
    $('btnEN').addEventListener('click', ()=>setLang('en'));
    $('lang').addEventListener('change', (e)=>setLang(e.target.value));

    $('mode').addEventListener('change', calc);

    [
      'startMembers','churn',
      'newPerMonthY1','newPerMonthY2',
      'activeShare','referralsPerActive','newAlsoRefer','referralsPerActiveNew',
      'feeMember','feeLead','rateLead','priceWeekend','rateWeekend','salesShare',
      'eventsY1','eventsY2','seatsPerEvent','minSeats','costPerEvent','costMode'
    ].forEach(id=>{
      $(id).addEventListener('input', ()=>calc());
      $(id).addEventListener('change', ()=>calc());
    });

    $('btnCalc').addEventListener('click', calc);
    $('btnReset').addEventListener('click', resetAll);
    $('btnCopy').addEventListener('click', copyResult);
    $('btnSolve').addEventListener('click', solveTarget);

    // init
    resetAll();
  </script>
</body>
</html>
