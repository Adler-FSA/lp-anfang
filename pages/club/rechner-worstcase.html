<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ziel-Mix Rechner – Club Planung (intern)</title>
  <meta name="description" content="Interner Ziel-Mix Rechner: Zielumsatz eingeben → Soll an Mitgliedschaften, Leadmaschinen, Weekend-Tickets + benötigte Ansprache. Transparent mit Preis-/Quote-Aufschlüsselung." />

  <style>
    :root{
      --bg:#050814; --bg2:#020617;
      --panel:rgba(15,23,42,.90); --panel2:rgba(15,23,42,.78);
      --txt:#e9eef7; --muted:#a9b6cc;
      --gold:#d4af37; --gold2:#f0d77a;
      --line:rgba(212,175,55,.35);
      --glow:0 0 22px rgba(212,175,55,.38), 0 10px 28px rgba(0,0,0,.55);
      --shadow:0 22px 55px rgba(0,0,0,.55);
      --radius:18px; --maxw:1180px;
    }
    html,body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 18% 12%, rgba(212,175,55,.10), transparent 55%),
        radial-gradient(900px 520px at 82% 18%, rgba(94,168,255,.10), transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      color:var(--txt);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      overflow-x:hidden;
    }
    .wrap{max-width:var(--maxw);margin:0 auto;padding:28px 18px 60px;}
    .topline{height:2px;background:linear-gradient(90deg, transparent, var(--gold), transparent);opacity:.85;margin:18px 0 26px;}
    .hero{display:flex;gap:18px;align-items:stretch;justify-content:space-between;flex-wrap:wrap;}
    .hero-card{
      flex:1 1 680px;
      background:linear-gradient(180deg, rgba(15,23,42,.92), rgba(15,23,42,.75));
      border:1px solid rgba(212,175,55,.22);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px 18px 16px;
      position:relative; overflow:hidden;
    }
    .hero-card:before{
      content:""; position:absolute; inset:-2px;
      background:
        radial-gradient(700px 220px at 20% 0%, rgba(212,175,55,.18), transparent 55%),
        radial-gradient(600px 200px at 90% 0%, rgba(94,168,255,.16), transparent 60%);
      pointer-events:none; opacity:.8;
    }
    .hero-inner{position:relative;z-index:2;}
    .kicker{display:flex;align-items:center;gap:10px;color:var(--muted);font-size:13px;letter-spacing:.2px;flex-wrap:wrap;}
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(212,175,55,.28);
      background:rgba(0,0,0,.18);
    }
    .svg{width:16px;height:16px;fill:rgba(240,215,122,.95);flex:0 0 16px;}
    .title{margin:10px 0 6px;font-size:34px;line-height:1.12;letter-spacing:.2px;}
    .subtitle{margin:0;color:var(--muted);font-size:15px;line-height:1.55;max-width:980px;}

    .actions{
      flex:0 1 320px;
      background:linear-gradient(180deg, rgba(15,23,42,.90), rgba(15,23,42,.72));
      border:1px solid rgba(212,175,55,.22);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;}
    .lang{display:flex;gap:8px;flex-wrap:wrap;}
    .btn{
      appearance:none;border:1px solid rgba(212,175,55,.35);
      background:rgba(0,0,0,.20);color:var(--txt);
      padding:10px 12px;border-radius:12px;cursor:pointer;
      transition:transform .12s ease, background .12s ease, border-color .12s ease;
      font-weight:650;font-size:14px;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(212,175,55,.55);}
    .btn.primary{background:rgba(212,175,55,.16);box-shadow:var(--glow);border-color:rgba(212,175,55,.55);}
    .btn.small{padding:8px 10px;font-size:13px;border-radius:10px;}
    .hint{margin-top:12px;font-size:12.5px;color:var(--muted);line-height:1.45;}

    .grid{display:grid;grid-template-columns:1.15fr .85fr;gap:16px;margin-top:18px;}
    @media (max-width: 980px){.grid{grid-template-columns:1fr;}}

    .card{
      background:linear-gradient(180deg, rgba(15,23,42,.90), rgba(15,23,42,.72));
      border:1px solid rgba(212,175,55,.22);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .card h2{margin:0 0 8px;font-size:18px;letter-spacing:.2px;}
    .card p{margin:0 0 10px;color:var(--muted);font-size:13.5px;line-height:1.55;}

    .fields{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px;}
    @media (max-width: 760px){.fields{grid-template-columns:1fr;}}

    .field{
      background:rgba(0,0,0,.16);
      border:1px solid rgba(212,175,55,.18);
      border-radius:14px;
      padding:10px 10px 9px;
    }
    .field label{
      display:flex;justify-content:space-between;gap:10px;
      font-size:12.5px;color:var(--muted);margin-bottom:6px;line-height:1.25;
    }
    .field label span{color:rgba(240,215,122,.95);font-weight:650;font-size:12px;white-space:nowrap;}
    .field input,.field select{
      width:100%;box-sizing:border-box;
      background:rgba(0,0,0,.22);
      border:1px solid rgba(212,175,55,.24);
      color:var(--txt);
      padding:10px 10px;border-radius:12px;outline:none;font-size:14px;
    }

    .divider{height:1px;background:linear-gradient(90deg, transparent, rgba(212,175,55,.45), transparent);margin:14px 0;opacity:.75;}

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      overflow:hidden;
      border-radius:14px;
      border:1px solid rgba(212,175,55,.18);
      background:rgba(0,0,0,.16);
    }
    th,td{padding:10px 10px;border-bottom:1px solid rgba(212,175,55,.12);text-align:left;font-size:13px;}
    th{color:rgba(240,215,122,.95);font-weight:750;background:rgba(0,0,0,.18);}
    tr:last-child td{border-bottom:none;}
    .right{text-align:right;}
    .mono{font-variant-numeric: tabular-nums; font-feature-settings:"tnum";}
    .pill{
      display:inline-flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:14px;
      border:1px solid rgba(212,175,55,.22);
      background:rgba(0,0,0,.16);
      color:var(--txt);
      line-height:1.35;font-size:13.5px;
    }
    details{margin-top:10px;background:rgba(0,0,0,.14);border:1px solid rgba(212,175,55,.14);border-radius:14px;padding:10px 10px;}
    summary{cursor:pointer;color:rgba(240,215,122,.95);font-weight:750;}
    .note{margin-top:10px;color:var(--muted);font-size:12.5px;line-height:1.55;}
    .footer{margin-top:18px;color:var(--muted);font-size:12px;line-height:1.5;opacity:.92;}
    .ok{color:#b7f7c7;}
    .warn{color:#ffd38a;}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <div class="hero-card">
        <div class="hero-inner">
          <div class="kicker">
            <span class="badge">
              <svg class="svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2 3 6v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V6l-9-4Zm0 2.2 7 3.11V12c0 4.56-3.01 8.94-7 10-3.99-1.06-7-5.44-7-10V7.31l7-3.11Zm-1 5.3h2v6h-2v-6Zm0 7.5h2v2h-2v-2Z"/></svg>
              <span data-i18n="badge_internal">Internes Planungstool</span>
            </span>
            <span class="mono" data-i18n="kicker_right">Zielumsatz → Soll-Mix • Mitgliedschaft • Leadmaschine • Weekend-Setup</span>
          </div>

          <div class="topline"></div>

          <h1 class="title" data-i18n="title">Ziel-Mix Rechner – Club Betrieb & Skalierung</h1>
          <p class="subtitle" data-i18n="subtitle">
            Du gibst einen Ziel-Umsatz ein (z. B. 500.000 €). Der Rechner liefert Soll-Zahlen:
            Mitgliedschaften, Leadmaschinen, Weekend-Tickets – plus benötigte „angesprochene Personen“ (Conversion-Quote) und Weekend-Kapazitätscheck.
          </p>
        </div>
      </div>

      <div class="actions">
        <div class="row">
          <div class="lang">
            <button class="btn small primary" id="btnDE">DE</button>
            <button class="btn small" id="btnEN">EN</button>
          </div>
          <button class="btn small" id="btnReset" data-i18n="btn_reset">Reset</button>
        </div>

        <div class="divider"></div>

        <div class="row">
          <button class="btn primary" id="btnCalc" data-i18n="btn_calc">Soll berechnen</button>
          <button class="btn" id="btnCopy" data-i18n="btn_copy">Ergebnis kopieren</button>
        </div>

        <div class="hint" data-i18n="hint">
          Wichtig: Hier wird bewusst „Ziel → Soll“ gerechnet. Alle verwendeten Preise/Quoten siehst du unten transparent in der Preis-Tabelle.
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- INPUTS -->
      <div class="card">
        <h2 data-i18n="h_inputs">Eingaben</h2>
        <p data-i18n="p_inputs">
          Konfiguration für eine Jahresplanung (konservativ). Der Mix wird über Quoten gesteuert:
          Leadmaschine-Quote und Weekend-Quote beziehen sich auf den Mitgliederbestand.
        </p>

        <div class="divider"></div>

        <h2 data-i18n="h_target">Ziel</h2>
        <div class="fields">
          <div class="field">
            <label><span data-i18n="lbl_target">Ziel Brutto-Umsatz (Jahr)</span><span class="mono">€</span></label>
            <input id="targetRevenue" type="number" min="0" step="1000" value="500000" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_lang">Sprache</span><span data-i18n="lbl_lang_hint">Anzeige</span></label>
            <select id="lang">
              <option value="de">DE</option>
              <option value="en">EN</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <h2 data-i18n="h_prices">Preise & Quoten (für die Berechnung)</h2>
        <div class="fields">
          <div class="field">
            <label><span data-i18n="lbl_fee_member">Mitgliedschaft (pro Jahr)</span><span class="mono">€</span></label>
            <input id="feeMember" type="number" min="0" step="0.01" value="60" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_fee_lead">Leadmaschine (pro Jahr, Add-on)</span><span class="mono">€</span></label>
            <input id="feeLead" type="number" min="0" step="0.01" value="60" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_price_weekend">Weekend-Setup Ticket (Mitgliedspreis)</span><span class="mono">€</span></label>
            <input id="priceWeekend" type="number" min="0" step="0.01" value="399" />
          </div>

          <div class="field">
            <label><span data-i18n="lbl_rate_lead">Leadmaschine-Quote (von Mitgliedern)</span><span class="mono">%</span></label>
            <input id="rateLead" type="number" min="0" max="100" step="0.1" value="50" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_rate_weekend">Weekend-Quote (von Mitgliedern)</span><span class="mono">%</span></label>
            <input id="rateWeekend" type="number" min="0" max="100" step="0.1" value="25" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_sales_share">Vertrieb gesamt (aus allen Produkten)</span><span class="mono">%</span></label>
            <input id="salesShare" type="number" min="0" max="100" step="0.1" value="45" />
          </div>
        </div>

        <div class="divider"></div>

        <h2 data-i18n="h_funnel">Ansprache & Funnel (optional)</h2>
        <p class="note" data-i18n="p_funnel">
          Damit der Rechner „Wie viele Menschen müssen angesprochen werden?“ ausgeben kann, brauchst du eine Conversion-Quote.
          Zusätzlich kann die Leadmaschine (Funnel) einen Auto-Zuwachs erzeugen – als konservativer Anteil.
        </p>

        <div class="fields">
          <div class="field">
            <label><span data-i18n="lbl_conv">Conversion: Angesprochen → Mitglied</span><span class="mono">%</span></label>
            <input id="convToMember" type="number" min="0.01" max="100" step="0.01" value="5" />
          </div>

          <div class="field">
            <label><span data-i18n="lbl_months">Planungszeitraum</span><span class="mono">Monate</span></label>
            <input id="months" type="number" min="1" max="24" step="1" value="12" />
          </div>

          <div class="field">
            <label><span data-i18n="lbl_lead_active">Leadmaschinen aktiv (Anteil der Lead-Kunden, die Funnel wirklich nutzen)</span><span class="mono">%</span></label>
            <input id="leadActiveShare" type="number" min="0" max="100" step="0.1" value="40" />
          </div>

          <div class="field">
            <label><span data-i18n="lbl_auto_per_lead">Auto-Neumitglieder pro aktiver Leadmaschine / Monat</span><span class="mono">#</span></label>
            <input id="autoMembersPerLeadPerMonth" type="number" min="0" step="0.01" value="0" />
          </div>
        </div>

        <div class="divider"></div>

        <h2 data-i18n="h_weekend_cap">Weekend-Kapazität (Check)</h2>
        <div class="fields">
          <div class="field">
            <label><span data-i18n="lbl_events">Events pro Jahr</span><span class="mono">#</span></label>
            <input id="events" type="number" min="0" step="1" value="24" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_seats">Plätze pro Event</span><span class="mono">#</span></label>
            <input id="seatsPerEvent" type="number" min="1" step="1" value="50" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_min_seats">Mindest-Teilnehmer je Event</span><span class="mono">#</span></label>
            <input id="minSeats" type="number" min="0" step="1" value="20" />
          </div>
          <div class="field">
            <label><span data-i18n="lbl_cost_note">Hinweis</span><span class="mono">i</span></label>
            <select id="capMode">
              <option value="limit" data-i18n="opt_limit">Kapazität limitiert Tickets (konservativ)</option>
              <option value="ignore" data-i18n="opt_ignore">Kapazität ignorieren (nur Soll-Ziel)</option>
            </select>
          </div>
        </div>

        <div class="footer" data-i18n="footer_left">
          Hinweis: Alle Werte sind Planungsparameter. Dieses Tool ist intern (Geschäftsleitung) und dient der Zielableitung & Skalierbarkeit.
        </div>
      </div>

      <!-- OUTPUTS -->
      <div class="card">
        <h2 data-i18n="h_outputs">Ausgabe: Soll-Mix</h2>
        <p data-i18n="p_outputs">
          Ergebnis ist bewusst transparent: zuerst die genutzten Preise/Quoten, dann Soll-Zahlen und die Umsatz-Aufteilung (Vertrieb vs. Club).
        </p>

        <div class="pill">
          <svg class="svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2a10 10 0 1 0 10 10A10.01 10.01 0 0 0 12 2Zm1 15h-2v-6h2Zm0-8h-2V7h2Z"/></svg>
          <span id="headlineOut" class="mono"></span>
        </div>

        <div class="divider"></div>

        <table aria-label="price breakdown">
          <thead>
            <tr>
              <th data-i18n="th_used">Verwendet in Berechnung</th>
              <th class="right" data-i18n="th_value">Wert</th>
            </tr>
          </thead>
          <tbody id="tblUsed"></tbody>
        </table>

        <details open>
          <summary data-i18n="sum_soll">Soll-Zahlen (aus Ziel berechnet)</summary>
          <table>
            <thead>
              <tr>
                <th data-i18n="th_metric">Kennzahl</th>
                <th class="right" data-i18n="th_result">Soll</th>
              </tr>
            </thead>
            <tbody id="tblSoll"></tbody>
          </table>
          <div class="note" id="capNote"></div>
        </details>

        <details>
          <summary data-i18n="sum_revenue">Umsatz-Aufschlüsselung</summary>
          <table>
            <thead>
              <tr>
                <th data-i18n="th_revenue_part">Baustein</th>
                <th class="right" data-i18n="th_amount">Umsatz</th>
              </tr>
            </thead>
            <tbody id="tblRevenue"></tbody>
          </table>

          <div class="divider"></div>

          <table>
            <thead>
              <tr>
                <th data-i18n="th_split">Aufteilung</th>
                <th class="right" data-i18n="th_amount">Betrag</th>
              </tr>
            </thead>
            <tbody id="tblSplit"></tbody>
          </table>
        </details>

        <div class="footer" data-i18n="footer_right">
          Hinweis: Dieser Rechner ist keine Steuer-/Rechtsberatung. Brutto/Netto-Logik bleibt in eurer Preisdefinition.
        </div>
      </div>
    </div>
  </div>

  <script>
    const I18N = {
      de: {
        badge_internal:"Internes Planungstool",
        kicker_right:"Zielumsatz → Soll-Mix • Mitgliedschaft • Leadmaschine • Weekend-Setup",
        title:"Ziel-Mix Rechner – Club Betrieb & Skalierung",
        subtitle:"Du gibst einen Ziel-Umsatz ein (z. B. 500.000 €). Der Rechner liefert Soll-Zahlen: Mitgliedschaften, Leadmaschinen, Weekend-Tickets – plus benötigte „angesprochene Personen“ (Conversion-Quote) und Weekend-Kapazitätscheck.",
        btn_reset:"Reset",
        btn_calc:"Soll berechnen",
        btn_copy:"Ergebnis kopieren",
        hint:"Wichtig: Hier wird bewusst „Ziel → Soll“ gerechnet. Alle verwendeten Preise/Quoten siehst du unten transparent in der Preis-Tabelle.",
        h_inputs:"Eingaben",
        p_inputs:"Konfiguration für eine Jahresplanung (konservativ). Der Mix wird über Quoten gesteuert: Leadmaschine-Quote und Weekend-Quote beziehen sich auf den Mitgliederbestand.",
        h_target:"Ziel",
        lbl_target:"Ziel Brutto-Umsatz (Jahr)",
        lbl_lang:"Sprache",
        lbl_lang_hint:"Anzeige",
        h_prices:"Preise & Quoten (für die Berechnung)",
        lbl_fee_member:"Mitgliedschaft (pro Jahr)",
        lbl_fee_lead:"Leadmaschine (pro Jahr, Add-on)",
        lbl_price_weekend:"Weekend-Setup Ticket (Mitgliedspreis)",
        lbl_rate_lead:"Leadmaschine-Quote (von Mitgliedern)",
        lbl_rate_weekend:"Weekend-Quote (von Mitgliedern)",
        lbl_sales_share:"Vertrieb gesamt (aus allen Produkten)",
        h_funnel:"Ansprache & Funnel (optional)",
        p_funnel:"Damit der Rechner „Wie viele Menschen müssen angesprochen werden?“ ausgeben kann, brauchst du eine Conversion-Quote. Zusätzlich kann die Leadmaschine (Funnel) einen Auto-Zuwachs erzeugen – als konservativer Anteil.",
        lbl_conv:"Conversion: Angesprochen → Mitglied",
        lbl_months:"Planungszeitraum",
        lbl_lead_active:"Leadmaschinen aktiv (Anteil der Lead-Kunden, die Funnel wirklich nutzen)",
        lbl_auto_per_lead:"Auto-Neumitglieder pro aktiver Leadmaschine / Monat",
        h_weekend_cap:"Weekend-Kapazität (Check)",
        lbl_events:"Events pro Jahr",
        lbl_seats:"Plätze pro Event",
        lbl_min_seats:"Mindest-Teilnehmer je Event",
        lbl_cost_note:"Hinweis",
        opt_limit:"Kapazität limitiert Tickets (konservativ)",
        opt_ignore:"Kapazität ignorieren (nur Soll-Ziel)",
        h_outputs:"Ausgabe: Soll-Mix",
        p_outputs:"Ergebnis ist bewusst transparent: zuerst die genutzten Preise/Quoten, dann Soll-Zahlen und die Umsatz-Aufteilung (Vertrieb vs. Club).",
        th_used:"Verwendet in Berechnung",
        th_value:"Wert",
        sum_soll:"Soll-Zahlen (aus Ziel berechnet)",
        th_metric:"Kennzahl",
        th_result:"Soll",
        sum_revenue:"Umsatz-Aufschlüsselung",
        th_revenue_part:"Baustein",
        th_amount:"Umsatz",
        th_split:"Aufteilung",
        footer_left:"Hinweis: Alle Werte sind Planungsparameter. Dieses Tool ist intern (Geschäftsleitung) und dient der Zielableitung & Skalierbarkeit.",
        footer_right:"Hinweis: Dieser Rechner ist keine Steuer-/Rechtsberatung. Brutto/Netto-Logik bleibt in eurer Preisdefinition."
      },
      en: {
        badge_internal:"Internal planning tool",
        kicker_right:"Revenue target → required mix • Membership • Lead machine • Weekend setup",
        title:"Target Mix Calculator – Club Operations & Scaling",
        subtitle:"Enter a revenue target (e.g., €500,000). The calculator returns required numbers: memberships, lead machines, weekend tickets – plus required outreach (conversion rate) and a weekend capacity check.",
        btn_reset:"Reset",
        btn_calc:"Calculate required mix",
        btn_copy:"Copy results",
        hint:"Important: this calculator runs “target → required”. All used prices/rates are shown transparently in the table below.",
        h_inputs:"Inputs",
        p_inputs:"Configuration for annual planning (conservative). Mix is controlled by rates: lead machine rate and weekend rate are applied to the member base.",
        h_target:"Target",
        lbl_target:"Target gross revenue (year)",
        lbl_lang:"Language",
        lbl_lang_hint:"Display",
        h_prices:"Prices & rates (used for calculation)",
        lbl_fee_member:"Membership (per year)",
        lbl_fee_lead:"Lead machine (per year, add-on)",
        lbl_price_weekend:"Weekend setup ticket (member price)",
        lbl_rate_lead:"Lead machine rate (of members)",
        lbl_rate_weekend:"Weekend rate (of members)",
        lbl_sales_share:"Sales payout (across all products)",
        h_funnel:"Outreach & funnel (optional)",
        p_funnel:"To output “how many people must be contacted”, you need a conversion rate. Optionally, the lead machine funnel can generate auto growth as a conservative share.",
        lbl_conv:"Conversion: contacted → member",
        lbl_months:"Planning period",
        lbl_lead_active:"Active lead machines (share of lead customers actually using funnels)",
        lbl_auto_per_lead:"Auto new members per active lead machine / month",
        h_weekend_cap:"Weekend capacity (check)",
        lbl_events:"Events per year",
        lbl_seats:"Seats per event",
        lbl_min_seats:"Minimum participants per event",
        lbl_cost_note:"Note",
        opt_limit:"Capacity limits tickets (conservative)",
        opt_ignore:"Ignore capacity (pure required target)",
        h_outputs:"Output: required mix",
        p_outputs:"The result is intentionally transparent: used prices/rates first, then required numbers and the revenue split (sales vs. club).",
        th_used:"Used in calculation",
        th_value:"Value",
        sum_soll:"Required numbers (derived from target)",
        th_metric:"Metric",
        th_result:"Required",
        sum_revenue:"Revenue breakdown",
        th_revenue_part:"Component",
        th_amount:"Revenue",
        th_split:"Split",
        footer_left:"Note: All values are planning parameters. Internal management tool for targets & scalability.",
        footer_right:"Note: No tax/legal advice. Gross/net logic follows your own pricing definition."
      }
    };

    const $ = (id)=>document.getElementById(id);
    function clamp(n,a,b){return Math.max(a,Math.min(b,n));}
    function readNum(id){const v=parseFloat($(id).value);return Number.isFinite(v)?v:0;}
    function fmtEUR(n, lang){
      const v = Number.isFinite(n) ? n : 0;
      return new Intl.NumberFormat(lang==='de'?'de-DE':'en-US',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(v);
    }
    function fmtNum(n, lang, digits=0){
      const v = Number.isFinite(n) ? n : 0;
      return new Intl.NumberFormat(lang==='de'?'de-DE':'en-US',{maximumFractionDigits:digits,minimumFractionDigits:digits}).format(v);
    }

    function setLang(lang){
      $('lang').value = lang;
      document.documentElement.lang = lang;
      $('btnDE').classList.toggle('primary', lang==='de');
      $('btnEN').classList.toggle('primary', lang==='en');
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const k = el.getAttribute('data-i18n');
        if(I18N[lang] && I18N[lang][k]) el.textContent = I18N[lang][k];
      });
      calc();
    }

    function calc(){
      const lang = $('lang').value;

      // Inputs
      const target = Math.max(0, readNum('targetRevenue'));
      const feeMember = Math.max(0, readNum('feeMember'));
      const feeLead = Math.max(0, readNum('feeLead'));
      const priceWeekend = Math.max(0, readNum('priceWeekend'));

      const rateLead = clamp(readNum('rateLead')/100, 0, 1);
      const rateWeekend = clamp(readNum('rateWeekend')/100, 0, 1);
      const salesShare = clamp(readNum('salesShare')/100, 0, 1);
      const clubShare = 1 - salesShare;

      const conv = clamp(readNum('convToMember')/100, 0.0000001, 1);
      const months = Math.max(1, Math.round(readNum('months')));
      const leadActiveShare = clamp(readNum('leadActiveShare')/100, 0, 1);
      const autoPerLead = Math.max(0, readNum('autoMembersPerLeadPerMonth'));

      const events = Math.max(0, Math.round(readNum('events')));
      const seatsPerEvent = Math.max(1, Math.round(readNum('seatsPerEvent')));
      const minSeats = Math.max(0, Math.round(readNum('minSeats')));
      const capMode = $('capMode').value;

      const capSeats = events * seatsPerEvent;

      // ---- Core model (target -> required) ----
      // Base "revenue per member" assuming weekend not capacity-limited:
      // rev = M*feeMember + (M*rateLead)*feeLead + (M*rateWeekend)*priceWeekend
      // -> per member: feeMember + rateLead*feeLead + rateWeekend*priceWeekend
      const perMemberBase = feeMember + (rateLead * feeLead) + (rateWeekend * priceWeekend);

      // If weekend capacity limits tickets, weekend revenue becomes min(M*rateWeekend, capSeats)*priceWeekend
      // piecewise solving:
      let M = 0;
      let weekendTickets = 0;
      let weekendCapped = false;

      if(capMode === 'ignore' || capSeats <= 0){
        // ignore capacity
        M = perMemberBase > 0 ? Math.ceil(target / perMemberBase) : 0;
        weekendTickets = Math.round(M * rateWeekend);
      } else {
        // capacity applies
        // first assume NOT capped:
        const M_uncapped = perMemberBase > 0 ? Math.ceil(target / perMemberBase) : 0;
        const tickets_uncapped = Math.round(M_uncapped * rateWeekend);

        if(tickets_uncapped <= capSeats){
          M = M_uncapped;
          weekendTickets = tickets_uncapped;
        } else {
          // capped: weekendTickets fixed at capSeats
          weekendCapped = true;
          weekendTickets = capSeats;

          // revenue then: rev = M*feeMember + (M*rateLead)*feeLead + capSeats*priceWeekend
          const perMemberNoWeekend = feeMember + (rateLead * feeLead);
          const remaining = Math.max(0, target - (capSeats * priceWeekend));
          M = perMemberNoWeekend > 0 ? Math.ceil(remaining / perMemberNoWeekend) : 0;
        }
      }

      // Lead customers from members
      const leadCustomers = Math.round(M * rateLead);

      // Weekend: minimum participant logic per event (conservative)
      // if last event would be below minSeats, reduce tickets to fullEvents only
      let effectiveEvents = events;
      let ticketsAdjusted = weekendTickets;

      if(capMode !== 'ignore' && events > 0 && minSeats > 0){
        const fullEvents = Math.floor(ticketsAdjusted / seatsPerEvent);
        const lastSeats = ticketsAdjusted - fullEvents * seatsPerEvent;
        if(lastSeats > 0 && lastSeats < minSeats){
          ticketsAdjusted = fullEvents * seatsPerEvent;
          effectiveEvents = fullEvents;
        } else {
          effectiveEvents = Math.ceil(ticketsAdjusted / seatsPerEvent);
        }
      } else if(capMode !== 'ignore') {
        effectiveEvents = events>0 ? Math.ceil(ticketsAdjusted / seatsPerEvent) : 0;
      }

      // Recompute revenues with adjusted weekend tickets
      const revMember = M * feeMember;
      const revLead = leadCustomers * feeLead;
      const revWeekend = ticketsAdjusted * priceWeekend;
      const revTotal = revMember + revLead + revWeekend;

      // Split
      const payoutSales = revTotal * salesShare;
      const clubGross = revTotal * clubShare;

      // Outreach requirement with optional auto-growth from lead funnels:
      // leadActive = leadCustomers * leadActiveShare
      // autoNew = leadActive * autoPerLead * months
      // membersFromOutreach = M - autoNew (floor at 0)
      // outreach = membersFromOutreach / conv
      const leadActive = leadCustomers * leadActiveShare;
      const autoNew = leadActive * autoPerLead * months;
      const membersFromOutreach = Math.max(0, M - autoNew);
      const outreach = Math.ceil(membersFromOutreach / conv);

      // Effective "revenue per member" for transparency (actual, with weekend adjustment)
      const perMemberActual = (M>0) ? (revTotal / M) : 0;

      // ---- Output: headline ----
      $('headlineOut').textContent =
        (lang==='de')
          ? `Ziel: ${fmtEUR(target,lang)} → Soll (rechnerisch): ${fmtNum(M,lang,0)} Mitglieder`
          : `Target: ${fmtEUR(target,lang)} → Required: ${fmtNum(M,lang,0)} members`;

      // ---- Used table ----
      const used = [
        {k: lang==='de'?'Zielumsatz (Jahr)':'Target revenue (year)', v: fmtEUR(target,lang)},
        {k: lang==='de'?'Mitgliedschaftspreis':'Membership price', v: fmtEUR(feeMember,lang)},
        {k: lang==='de'?'Leadmaschine Preis':'Lead machine price', v: fmtEUR(feeLead,lang)},
        {k: lang==='de'?'Weekend Ticket Preis':'Weekend ticket price', v: fmtEUR(priceWeekend,lang)},
        {k: lang==='de'?'Leadmaschine-Quote':'Lead machine rate', v: `${fmtNum(rateLead*100,lang,1)} %`},
        {k: lang==='de'?'Weekend-Quote':'Weekend rate', v: `${fmtNum(rateWeekend*100,lang,1)} %`},
        {k: lang==='de'?'Vertrieb gesamt':'Sales payout', v: `${fmtNum(salesShare*100,lang,1)} %`},
        {k: lang==='de'?'Club-Anteil':'Club share', v: `${fmtNum(clubShare*100,lang,1)} %`},
        {k: lang==='de'?'Kapazität (Events × Plätze)':'Capacity (events × seats)', v: (capMode==='ignore' ? (lang==='de'?'ignoriert':'ignored') : `${fmtNum(events,lang,0)} × ${fmtNum(seatsPerEvent,lang,0)} = ${fmtNum(capSeats,lang,0)}`)},
        {k: lang==='de'?'Mindest-Teilnehmer je Event':'Minimum per event', v: fmtNum(minSeats,lang,0)},
        {k: lang==='de'?'Conversion Angesprochen→Mitglied':'Conversion contacted→member', v: `${fmtNum(conv*100,lang,2)} %`},
        {k: lang==='de'?'Leadmaschinen aktiv (Funnel)':'Active lead machines (funnel)', v: `${fmtNum(leadActiveShare*100,lang,1)} %`},
        {k: lang==='de'?'Auto-Neumitglieder / aktive Lead / Monat':'Auto new / active lead / month', v: fmtNum(autoPerLead,lang,2)},
        {k: lang==='de'?'Planungszeitraum':'Planning months', v: fmtNum(months,lang,0)},
        {k: lang==='de'?'Effektiv Umsatz pro Mitglied (Ist)':'Effective revenue per member (actual)', v: fmtEUR(perMemberActual,lang)}
      ];
      $('tblUsed').innerHTML = used.map(r=>`<tr><td>${r.k}</td><td class="right mono">${r.v}</td></tr>`).join('');

      // ---- Soll table ----
      const soll = [
        {k: lang==='de'?'Mitglieder (Soll)':'Members (required)', v: fmtNum(M,lang,0)},
        {k: lang==='de'?'Leadmaschinen-Kunden (Soll)':'Lead customers (required)', v: fmtNum(leadCustomers,lang,0)},
        {k: lang==='de'?'Weekend-Tickets (Soll)':'Weekend tickets (required)', v: fmtNum(ticketsAdjusted,lang,0)},
        {k: lang==='de'?'Angesprochene Personen (Soll)':'People contacted (required)', v: fmtNum(outreach,lang,0)},
        {k: lang==='de'?'Auto-Neumitglieder aus Funnel (rechnerisch)':'Auto new members from funnel (calc.)', v: fmtNum(autoNew,lang,0)},
        {k: lang==='de'?'Mitglieder aus direkter Ansprache (rechnerisch)':'Members from direct outreach (calc.)', v: fmtNum(membersFromOutreach,lang,0)}
      ];
      $('tblSoll').innerHTML = soll.map(r=>`<tr><td>${r.k}</td><td class="right mono">${r.v}</td></tr>`).join('');

      // ---- Capacity note ----
      let capText = '';
      if(capMode === 'ignore'){
        capText = (lang==='de')
          ? 'Kapazität ist auf „ignorieren“ gestellt: Weekend-Tickets sind reine Soll-Zahl (ohne Event-Limit).'
          : 'Capacity is set to “ignore”: weekend tickets are a pure required number (no event limit).';
      } else {
        if(weekendCapped){
          capText = (lang==='de')
            ? `Kapazität limitiert: Weekend-Quote würde mehr Tickets erzeugen als verfügbar. Aktuelles Limit: ${fmtNum(capSeats,lang,0)} Plätze/Jahr.`
            : `Capacity limited: weekend rate would exceed available tickets. Current limit: ${fmtNum(capSeats,lang,0)} seats/year.`;
        } else {
          capText = (lang==='de')
            ? 'Kapazität reicht für die berechneten Weekend-Tickets (oder liegt darüber).'
            : 'Capacity covers the calculated weekend tickets (or exceeds it).';
        }

        if(minSeats > 0){
          capText += (lang==='de')
            ? ` Mindest-Teilnehmer Regel aktiv: letzte Veranstaltung wird nur angesetzt, wenn ≥ ${fmtNum(minSeats,lang,0)} Teilnehmer. (Effektive Events: ${fmtNum(effectiveEvents,lang,0)}).`
            : ` Minimum participant rule active: last event only runs if ≥ ${fmtNum(minSeats,lang,0)} participants. (Effective events: ${fmtNum(effectiveEvents,lang,0)}).`;
        }
      }
      $('capNote').textContent = capText;

      // ---- Revenue breakdown ----
      const revRows = [
        {k: lang==='de'?'Mitgliedschaft':'Membership', v: revMember},
        {k: lang==='de'?'Leadmaschine':'Lead machine', v: revLead},
        {k: lang==='de'?'Weekend-Setup Tickets':'Weekend tickets', v: revWeekend},
        {k: lang==='de'?'Summe (rechnerisch)':'Total (calculated)', v: revTotal}
      ];
      $('tblRevenue').innerHTML = revRows.map(r=>`<tr><td>${r.k}</td><td class="right mono">${fmtEUR(r.v,lang)}</td></tr>`).join('');

      const splitRows = [
        {k: lang==='de'?'Vertrieb (Payout)':'Sales payout', v: payoutSales},
        {k: lang==='de'?'Club (Anteil)':'Club share', v: clubGross}
      ];
      $('tblSplit').innerHTML = splitRows.map(r=>`<tr><td>${r.k}</td><td class="right mono">${fmtEUR(r.v,lang)}</td></tr>`).join('');

      // store for copy
      window.__result = {
        target, M, leadCustomers, weekendTickets: ticketsAdjusted,
        outreach, conv,
        autoNew, leadActiveShare, autoPerLead, months,
        used: {feeMember, feeLead, priceWeekend, rateLead, rateWeekend, salesShare, events, seatsPerEvent, minSeats, capMode},
        revenue: {revMember, revLead, revWeekend, revTotal, payoutSales, clubGross},
        capacity: {capSeats, weekendCapped, effectiveEvents}
      };
    }

    function resetAll(){
      $('targetRevenue').value = 500000;

      $('feeMember').value = 60;
      $('feeLead').value = 60;
      $('priceWeekend').value = 399;

      $('rateLead').value = 50;
      $('rateWeekend').value = 25;
      $('salesShare').value = 45;

      $('convToMember').value = 5;
      $('months').value = 12;
      $('leadActiveShare').value = 40;
      $('autoMembersPerLeadPerMonth').value = 0;

      $('events').value = 24;
      $('seatsPerEvent').value = 50;
      $('minSeats').value = 20;
      $('capMode').value = 'limit';

      setLang($('lang').value);
      calc();
    }

    function copyResult(){
      const lang = $('lang').value;
      const r = window.__result;
      if(!r) return;

      const lines = [
        (lang==='de' ? 'Ziel-Mix Ergebnis (intern)' : 'Target mix results (internal)'),
        `${lang==='de'?'Ziel':'Target'}: ${r.target}`,
        `${lang==='de'?'Soll Mitglieder':'Required members'}: ${r.M}`,
        `${lang==='de'?'Soll Leadmaschine':'Required lead machines'}: ${r.leadCustomers}`,
        `${lang==='de'?'Soll Weekend Tickets':'Required weekend tickets'}: ${r.weekendTickets}`,
        `${lang==='de'?'Soll Angesprochene':'Required contacted'}: ${r.outreach}`,
        `${lang==='de'?'Umsatz total':'Total revenue'}: ${r.revenue.revTotal}`,
        `${lang==='de'?'Vertrieb':'Sales payout'}: ${r.revenue.payoutSales}`,
        `${lang==='de'?'Club':'Club share'}: ${r.revenue.clubGross}`
      ].join('\n');

      navigator.clipboard.writeText(lines).then(()=>{
        $('btnCopy').textContent = (lang==='de' ? 'Kopiert ✓' : 'Copied ✓');
        setTimeout(()=> $('btnCopy').textContent = I18N[lang].btn_copy, 1200);
      });
    }

    // wiring
    $('btnDE').addEventListener('click', ()=>setLang('de'));
    $('btnEN').addEventListener('click', ()=>setLang('en'));
    $('lang').addEventListener('change', e=>setLang(e.target.value));

    $('btnCalc').addEventListener('click', calc);
    $('btnReset').addEventListener('click', resetAll);
    $('btnCopy').addEventListener('click', copyResult);

    [
      'targetRevenue',
      'feeMember','feeLead','priceWeekend',
      'rateLead','rateWeekend','salesShare',
      'convToMember','months','leadActiveShare','autoMembersPerLeadPerMonth',
      'events','seatsPerEvent','minSeats','capMode'
    ].forEach(id=>{
      $(id).addEventListener('input', calc);
      $(id).addEventListener('change', calc);
    });

    // init
    setLang('de');
  </script>
</body>
</html>
