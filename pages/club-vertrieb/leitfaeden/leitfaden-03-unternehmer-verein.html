<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Leitfaden 03 – Unternehmer / Verein</title>
  <meta name="description" content="Telefonleitfaden Unternehmer/Verein: Profi-Einstieg → Entscheidungsweg/Rollen → Risiko/Prozess → 3 Ziele → Fokus/Engpass → Mitgliedschaft. Lokal speicherbar (LocalStorage), DE/EN." />
  <meta name="robots" content="noindex,nofollow" />

  <style>
    :root{
      --bg:#050814; --bg2:#020617;
      --panel:rgba(15,23,42,.90); --panel2:rgba(15,23,42,.74);
      --txt:#e9eef7; --muted:#a9b4c7;
      --gold:#d4af37; --gold2:#f2d37a; --blue:#5ea8ff;
      --line:rgba(212,175,55,.35);
      --shadow:0 24px 60px rgba(0,0,0,.55);
      --glow:0 0 26px rgba(212,175,55,.22), 0 10px 30px rgba(0,0,0,.55);
      --radius:18px;
      --maxw:1200px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--txt);
      background:
        radial-gradient(900px 520px at 14% 10%, rgba(212,175,55,.18), transparent 62%),
        radial-gradient(760px 520px at 86% 18%, rgba(94,168,255,.16), transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 60%, #000 100%);
      overflow-x:hidden;
    }

    .wrap{max-width:var(--maxw); margin:28px auto 60px; padding:0 16px;}
    .topbar{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      margin:10px 0 16px;
    }
    .brand{
      display:flex; gap:10px; align-items:center;
      padding:10px 12px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(15,23,42,.88), rgba(15,23,42,.62));
      border-radius:999px;
      box-shadow:var(--glow);
    }
    .brand svg{width:18px; height:18px; flex:none}
    .brand strong{font-weight:800; letter-spacing:.2px}
    .brand span{color:var(--muted); font-size:12px}

    .actions{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }

    .btn{
      cursor:pointer;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(212,175,55,.14), rgba(15,23,42,.72));
      color:var(--txt);
      padding:10px 12px;
      border-radius:12px;
      box-shadow:0 12px 26px rgba(0,0,0,.35);
      font-weight:700;
      display:inline-flex; gap:8px; align-items:center;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.05)}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{
      background:linear-gradient(180deg, rgba(94,168,255,.12), rgba(15,23,42,.72));
      border-color:rgba(94,168,255,.35);
    }
    .btn.ghost{
      background:rgba(15,23,42,.55);
    }
    .btn svg{width:16px; height:16px}

    header.hero{
      padding:18px 18px 16px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(15,23,42,.90), rgba(15,23,42,.62));
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
    }
    header.hero:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(520px 220px at 14% 10%, rgba(212,175,55,.14), transparent 60%),
        radial-gradient(520px 220px at 88% 18%, rgba(94,168,255,.12), transparent 62%);
      pointer-events:none;
    }
    header.hero > *{position:relative}
    h1{
      margin:0;
      font-size:22px;
      line-height:1.2;
      letter-spacing:.2px;
    }
    .sub{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
      max-width:980px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
    }

    .card{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(15,23,42,.90), rgba(15,23,42,.68));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .card h2{
      margin:0 0 10px;
      font-size:15px;
      letter-spacing:.2px;
      display:flex; align-items:center; gap:8px;
    }
    .card h2 .tag{
      font-size:11px; color:var(--muted);
      border:1px solid rgba(212,175,55,.25);
      padding:2px 8px; border-radius:999px;
      background:rgba(0,0,0,.18);
    }

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 700px){
      .form{grid-template-columns:1fr}
    }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px;
    }

    input[type="text"], select, textarea{
      width:100%;
      border:1px solid rgba(212,175,55,.25);
      background:rgba(0,0,0,.22);
      color:var(--txt);
      border-radius:12px;
      padding:10px 10px;
      outline:none;
    }
    textarea{min-height:96px; resize:vertical}
    input[type="text"]:focus, select:focus, textarea:focus{
      border-color:rgba(212,175,55,.55);
      box-shadow:0 0 0 3px rgba(212,175,55,.10);
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top:10px;
    }
    .hint{
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    .steps{
      display:grid;
      gap:10px;
    }
    .step{
      border:1px solid rgba(212,175,55,.22);
      background:linear-gradient(180deg, rgba(0,0,0,.18), rgba(15,23,42,.35));
      border-radius:16px;
      padding:12px;
      position:relative;
    }
    .stephead{
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
      margin-bottom:8px;
    }
    .steptitle{
      font-weight:900;
      font-size:13px;
      letter-spacing:.25px;
      margin:0;
    }
    .stepline{
      color:var(--muted);
      font-size:12px;
      margin:4px 0 0;
    }
    .stepmeta{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
    }
    .pill{
      font-size:11px;
      border:1px solid rgba(94,168,255,.25);
      color:var(--muted);
      padding:2px 8px;
      border-radius:999px;
      background:rgba(94,168,255,.08);
    }
    .pill.done{
      border-color:rgba(212,175,55,.35);
      background:rgba(212,175,55,.10);
      color:var(--gold2);
    }
    .steptext{
      white-space:pre-wrap;
      line-height:1.5;
      font-size:13px;
      color:var(--txt);
      margin:0;
    }

    .miniBtns{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top:10px;
    }
    .miniBtns .btn{
      padding:8px 10px;
      border-radius:12px;
      font-weight:800;
    }

    .engineBox{
      display:grid;
      gap:10px;
    }
    .engineRow{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
    }
    .engineRow .btn{width:100%; justify-content:center}
    .copyOk{
      color:var(--gold2);
      font-size:12px;
      display:none;
      margin-top:8px;
    }

    .objections{
      display:grid;
      gap:10px;
    }
    .objCard{
      border:1px solid rgba(212,175,55,.18);
      background:rgba(0,0,0,.18);
      border-radius:14px;
      padding:10px;
    }
    .objQ{
      margin:0 0 8px;
      font-weight:900;
      font-size:13px;
    }
    .objA{
      margin:0;
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
      white-space:pre-wrap;
    }

    .foot{
      margin-top:14px;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
      padding:10px 12px;
      border-radius:14px;
      border:1px dashed rgba(212,175,55,.22);
      background:rgba(0,0,0,.16);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand" title="FSA Leitfäden – lokal speicherbar">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 2l3 7 7 .6-5.3 4.6 1.7 7.1L12 17.8 5.6 21.3l1.7-7.1L2 9.6 9 9l3-7z" stroke="rgba(212,175,55,.9)" stroke-width="1.5"/>
        </svg>
        <div>
          <strong data-i18n="title_short">Leitfaden 03</strong>
          <span data-i18n="badge">Unternehmer / Verein</span>
        </div>
      </div>

      <div class="actions">
        <button class="btn ghost" id="btnBack" type="button" title="Zur Auswahl">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M15 18l-6-6 6-6" stroke="rgba(233,238,247,.9)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span data-i18n="btn_back">Auswahl</span>
        </button>
        <button class="btn secondary" id="btnLang" type="button" title="Sprache umschalten">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 6h10M4 18h10M8 6s1 8-4 12M16 18l4-8 4 8M18 14h4" stroke="rgba(94,168,255,.95)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span data-i18n="btn_lang">DE/EN</span>
        </button>
        <button class="btn" id="btnSave" type="button" title="Lokal speichern">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M7 3h10l3 3v15a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z" stroke="rgba(212,175,55,.9)" stroke-width="1.6"/>
            <path d="M7 3v7h10V3" stroke="rgba(212,175,55,.55)" stroke-width="1.6"/>
            <path d="M8 21v-7h8v7" stroke="rgba(212,175,55,.55)" stroke-width="1.6"/>
          </svg>
          <span data-i18n="btn_save">Speichern</span>
        </button>
        <button class="btn ghost" id="btnReset" type="button" title="Zurücksetzen">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 12a9 9 0 1 1-3-6.7" stroke="rgba(233,238,247,.85)" stroke-width="2" stroke-linecap="round"/>
            <path d="M21 3v6h-6" stroke="rgba(233,238,247,.85)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span data-i18n="btn_reset">Zurücksetzen</span>
        </button>
      </div>
    </div>

    <header class="hero">
      <h1 data-i18n="title">Leitfaden 03 – Unternehmer / Verein</h1>
      <p class="sub" data-i18n="sub">
        Profi-Einstieg → Entscheidungsweg & Rollen → Risiko/Prozess → 3 Ziele → Fokus/Engpass → Mitgliedschaft.
        Ziel: seriöser Erstkontakt, der sauber sortiert (ohne Druck, ohne Versprechen).
      </p>
    </header>

    <div class="grid">
      <!-- LEFT: Steps -->
      <section class="card">
        <h2>
          <span data-i18n="flow_title">12-Minuten-Flow</span>
          <span class="tag" data-i18n="flow_tag">Fit → Rahmen → Rollen → Entscheidung → Next Step</span>
        </h2>

        <div class="steps" id="steps"></div>

        <div class="foot" data-i18n="flow_hint">
          Tipp: Bei Unternehmern/Vereinen gilt: Erst Entscheidungsweg klären, dann Rahmen setzen – erst danach Details.
        </div>
      </section>

      <!-- RIGHT: Setup + Engine + Objections -->
      <aside class="card">
        <h2>
          <span data-i18n="setup_title">Setup</span>
          <span class="tag" data-i18n="setup_tag">Lokal</span>
        </h2>

        <div class="form">
          <div>
            <label for="name" data-i18n="lbl_name">Vorname / Name</label>
            <input id="name" type="text" placeholder="z. B. Frau Müller / Max" />
          </div>
          <div>
            <label for="form" data-i18n="lbl_form">Ansprache</label>
            <select id="form">
              <option value="sie" data-i18n="form_sie">SIE</option>
              <option value="du" data-i18n="form_du">DU</option>
            </select>
          </div>

          <div style="grid-column:1/-1">
            <label for="context" data-i18n="lbl_context">Kontext / Rolle</label>
            <input id="context" type="text" placeholder="z. B. Geschäftsführung / Vorstand / Empfehlung / Netzwerk…" />
          </div>

          <div>
            <label for="focus" data-i18n="lbl_focus">Fokus (3 Ziele)</label>
            <select id="focus">
              <option value="sicherheit" data-i18n="focus_sicherheit">1) Sicherheit: Fehler & Verluste vermeiden</option>
              <option value="stabilitaet" data-i18n="focus_stabil">2) Stabilität: Standards & Verantwortung</option>
              <option value="zweite_spur" data-i18n="focus_spur">3) Zweite Spur: Wachstum/Partner (optional)</option>
            </select>
          </div>

          <div>
            <label for="engpass" data-i18n="lbl_engpass">Engpass</label>
            <select id="engpass">
              <option value="klarheit" data-i18n="engpass_klarheit">Klarheit: Seriosität / Risiko / Fakten</option>
              <option value="struktur" data-i18n="engpass_struktur">Struktur: Prozess, Rollen, Prüfschritte</option>
              <option value="dranbleiben" data-i18n="engpass_dran">Dranbleiben: Umsetzung & Nachhalten</option>
            </select>
          </div>

          <div style="grid-column:1/-1">
            <label for="notes" data-i18n="lbl_notes">Notizen</label>
            <textarea id="notes" placeholder="Kurznotiz: Entscheider, Lage, Einwände, nächste Schritte…"></textarea>
          </div>
        </div>

        <div class="row">
          <div class="hint" id="saveState" data-i18n="save_state">bereit</div>
          <div class="actions" style="gap:8px">
            <button class="btn ghost" id="btnCopyAll" type="button" title="Alle Schritte als Text kopieren">
              <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9 9h11v12H9z" stroke="rgba(233,238,247,.85)" stroke-width="2"/>
                <path d="M4 3h11v6H4z" stroke="rgba(233,238,247,.55)" stroke-width="2"/>
              </svg>
              <span data-i18n="btn_copy_all">Alles kopieren</span>
            </button>
          </div>
        </div>
        <div class="copyOk" id="copyOk" data-i18n="copy_ok">Kopiert.</div>

        <hr style="border:none;border-top:1px solid rgba(212,175,55,.18); margin:14px 0" />

        <h2>
          <span data-i18n="engine_title">Rückfragen-Engine</span>
          <span class="tag" data-i18n="engine_tag">Wahrheit → Pause → Schleuse</span>
        </h2>

        <div class="engineBox">
          <div class="engineRow">
            <label for="truth" data-i18n="lbl_truth">Wahrheit</label>
            <select id="truth"></select>
          </div>
          <div class="engineRow">
            <label for="sluice" data-i18n="lbl_sluice">Schleusenfrage</label>
            <select id="sluice"></select>
          </div>
          <div class="engineRow">
            <label for="mirror" data-i18n="lbl_mirror">Spiegel-Frage</label>
            <select id="mirror"></select>
          </div>
          <button class="btn secondary" id="btnNextEngine" type="button">
            <span data-i18n="btn_next_engine">Nächste Zeile</span>
          </button>
          <button class="btn" id="btnCopyEngine" type="button">
            <span data-i18n="btn_copy_engine">Engine-Zeile kopieren</span>
          </button>
        </div>

        <hr style="border:none;border-top:1px solid rgba(212,175,55,.18); margin:14px 0" />

        <h2>
          <span data-i18n="obj_title">Einwände</span>
          <span class="tag" data-i18n="obj_tag">Anerkennen → Klären → Rahmen</span>
        </h2>

        <div class="objections" id="objections"></div>

        <div class="foot" data-i18n="local_hint">
          Notizen & Auswahl bleiben nur auf deinem Gerät (LocalStorage). Nichts wird verschickt.
        </div>
      </aside>
    </div>
  </div>

  <script>
    (function(){
      // FIX: Schema + Keys kompatibel zur Index-Seite (wie Referenz 02)
      const PAGE_KEY = "fsa_leitfaden_03_unternehmer";
      const LANG_KEY = "fsa_leitfaden_lang";

      const LABELS = {
        focusLabel: {
          sicherheit: {de:"Sicherheit", en:"Safety"},
          stabilitaet: {de:"Stabilität", en:"Stability"},
          zweite_spur: {de:"Zweite Spur", en:"Second stream"}
        },
        engpassLabel: {
          klarheit: {de:"Klarheit", en:"Clarity"},
          struktur: {de:"Struktur", en:"Structure"},
          dranbleiben: {de:"Dranbleiben", en:"Consistency"}
        }
      };

      const I18N = {
        de: {
          title_short: "Leitfaden 03",
          badge: "Unternehmer / Verein",
          btn_back: "Auswahl",
          btn_lang: "DE/EN",
          btn_save: "Speichern",
          btn_reset: "Zurücksetzen",
          title: "Leitfaden 03 – Unternehmer / Verein",
          sub: "Profi-Einstieg → Entscheidungsweg & Rollen → Risiko/Prozess → 3 Ziele → Fokus/Engpass → Mitgliedschaft. Ziel: seriöser Erstkontakt, der sauber sortiert (ohne Druck, ohne Versprechen).",
          flow_title: "12-Minuten-Flow",
          flow_tag: "Fit → Rahmen → Rollen → Entscheidung → Next Step",
          flow_hint: "Tipp: Bei Unternehmern/Vereinen gilt: Erst Entscheidungsweg klären, dann Rahmen setzen – erst danach Details.",
          setup_title: "Setup",
          setup_tag: "Lokal",
          lbl_name: "Vorname / Name",
          lbl_form: "Ansprache",
          form_sie: "SIE",
          form_du: "DU",
          lbl_context: "Kontext / Rolle",
          lbl_focus: "Fokus (3 Ziele)",
          focus_sicherheit: "1) Sicherheit: Fehler & Verluste vermeiden",
          focus_stabil: "2) Stabilität: Standards & Verantwortung",
          focus_spur: "3) Zweite Spur: Wachstum/Partner (optional)",
          lbl_engpass: "Engpass",
          engpass_klarheit: "Klarheit: Seriosität / Risiko / Fakten",
          engpass_struktur: "Struktur: Prozess, Rollen, Prüfschritte",
          engpass_dran: "Dranbleiben: Umsetzung & Nachhalten",
          lbl_notes: "Notizen",
          save_state: "bereit",
          saving: "speichert…",
          saved: "gespeichert",
          btn_copy_all: "Alles kopieren",
          copy_ok: "Kopiert.",
          engine_title: "Rückfragen-Engine",
          engine_tag: "Wahrheit → Pause → Schleuse",
          lbl_truth: "Wahrheit",
          lbl_sluice: "Schleusenfrage",
          lbl_mirror: "Spiegel-Frage",
          btn_next_engine: "Nächste Zeile",
          btn_copy_engine: "Engine-Zeile kopieren",
          obj_title: "Einwände",
          obj_tag: "Anerkennen → Klären → Rahmen",
          local_hint: "Notizen & Auswahl bleiben nur auf deinem Gerät (LocalStorage). Nichts wird verschickt.",
          ph_name: "z. B. Frau Müller / Max",
          ph_context: "z. B. Geschäftsführung / Vorstand / Empfehlung / Netzwerk…",
          ph_notes: "Kurznotiz: Entscheider, Lage, Einwände, nächste Schritte…",
          steps: [
            {
              id:"s1",
              title:"0–2 min · Profi-Warm-up",
              line:"Ziel: Fit prüfen, ohne Pitch. Ruhig, klar, knapp.",
              text: (ctx)=> {
                const add = ctx.context ? ("Kontext: " + ctx.context + "\n\n") : "";
                const greet = ctx.form === "sie" ? "Guten Tag" : "Hey";
                const n = ctx.nameGreet();
                const q1 = ctx.form === "sie"
                  ? "Ich rufe kurz an, um zu prüfen, ob das bei Ihnen überhaupt sauber passt – ohne Details, ohne Druck. Haben Sie 2 Minuten?"
                  : "Ich ruf kurz an, um zu prüfen, ob das bei dir überhaupt sauber passt – ohne Details, ohne Druck. Hast du 2 Minuten?";
                const q2 = ctx.form === "sie"
                  ? "Wenn nicht: Was wäre ein guter Zeitpunkt für 10 Minuten?"
                  : "Wenn nicht: Was wäre ein guter Zeitpunkt für 10 Minuten?";
                return add + greet + n + ".\n\n" + q1 + "\n" + q2;
              }
            },
            {
              id:"s2",
              title:"2–5 min · Entscheidungsweg & Rolle",
              line:"Ziel: Entscheider/Prozess klären, bevor du Inhalte gibst.",
              text: (ctx)=> {
                const q1 = ctx.form === "sie"
                  ? "Damit ich Ihnen nichts Falsches erzähle: Wie wird bei Ihnen entschieden – wer ist am Ende Entscheider?"
                  : "Damit ich dir nichts Falsches erzähle: Wie wird bei euch entschieden – wer ist am Ende Entscheider?";
                const q2 = ctx.form === "sie"
                  ? "Sind Sie eher Firma oder Verein – und welche Rolle haben Sie gerade (GF/Vorstand/IT/Finanzen)?"
                  : "Seid ihr eher Firma oder Verein – und welche Rolle hast du (GF/Vorstand/IT/Finanzen)?";
                const q3 = ctx.form === "sie"
                  ? "Wenn Sie ein No-Go nennen müssten: Was ist schlimmer – Druck, Intransparenz oder fehlende Dokumente?"
                  : "Wenn du ein No-Go nennen müsstest: Was ist schlimmer – Druck, Intransparenz oder fehlende Dokumente?";
                return q1 + "\n" + q2 + "\n" + q3;
              }
            },
            {
              id:"s3",
              title:"5–7 min · Risiko/Prozess/Rollen",
              line:"Ziel: Fehlerquelle benennen: Prozess, Rollen, Prüfschritte, Stopps.",
              text: (ctx)=> {
                const s1 = "Ich sehe es ständig: In Organisationen verliert man selten am Produkt – man verliert am Prozess, an Rollen und an fehlenden Stopp-Punkten.";
                const q = ctx.form === "sie"
                  ? "Gab es bei Ihnen oder im Umfeld schon mal ein Thema, wo später rauskam: „Hätten wir früher prüfen müssen“?"
                  : "Gab es bei euch oder im Umfeld schon mal ein Thema, wo später rauskam: „Hätten wir früher prüfen müssen“?";
                const s2 = "Seriösität erkennt man an Ruhe, Dokumentation und klaren Stopps – wenn das fehlt, ist Tempo ein Warnsignal.";
                return s1 + "\n\n" + q + "\n\n" + s2;
              }
            },
            {
              id:"s4",
              title:"7–9 min · 3-Punkt-Rahmen",
              line:"Ziel: Wert-Rahmen ohne Produktliste (Sicherheit/Stabilität/Zweite Spur).",
              text: (ctx)=> {
                const intro = "Ich sehe drei Ziele, die jede Organisation sauber abdecken sollte – egal ob man startet oder nicht:";
                const p1 = "1) Sicherheit: Fehler und Verluste vermeiden (Prüfschritte, Stopps).";
                const p2 = "2) Stabilität: Standards & klare Verantwortung (Rollen, Kriterien, Ablauf).";
                const p3 = "3) Zweite Spur (optional): Wachstum/Partner – aber erst auf sauberem Fundament.";
                const close = "Die meisten springen direkt zu Punkt 3 – und verlieren unterwegs 1 und 2.";
                return intro + "\n\n" + p1 + "\n" + p2 + "\n" + p3 + "\n\n" + close;
              }
            },
            {
              id:"s5",
              title:"9–12 min · Fokus → Mitgliedschaft (ruhiger Close)",
              line:"Ziel: priorisieren + Engpass + sauberer Next Step.",
              text: (ctx)=> {
                const n = ctx.nameShort();
                const q1 = ctx.form === "sie"
                  ? ("Wenn Sie priorisieren müssten" + n + ": Was ist aktuell wichtiger – Sicherheit, Stabilität oder zweite Spur?")
                  : ("Wenn du priorisieren müsstest" + n + ": Was ist aktuell wichtiger – Sicherheit, Stabilität oder zweite Spur?");
                const q2 = ctx.form === "sie"
                  ? "Und der Engpass ist eher: Klarheit, Struktur – oder Dranbleiben/Umsetzung?"
                  : "Und der Engpass ist eher: Klarheit, Struktur – oder Dranbleiben/Umsetzung?";
                const s = "Genau dafür ist die Mitgliedschaft gedacht: als Rahmen (Standards, Rollen, Prüfschritte) – damit Entscheidungen sauber bleiben.";
                const close = ctx.form === "sie"
                  ? "Soll ich Ihnen den Rahmen freischalten – ja oder nein?"
                  : "Soll ich dir den Rahmen freischalten – ja oder nein?";
                const soft = ctx.form === "sie"
                  ? "Wenn noch kein Ja: Was fehlt – mehr Klarheit, mehr Vertrauen oder eine konkrete Frage?"
                  : "Wenn noch kein Ja: Was fehlt – mehr Klarheit, mehr Vertrauen oder eine konkrete Frage?";
                return q1 + "\n" + q2 + "\n\n" + s + "\n\n" + close + "\n" + soft;
              }
            }
          ],
          engine_truths: [
            "In Unternehmen verliert man selten am Produkt – man verliert am Prozess.",
            "Tempo ohne Standards ist kein Fortschritt, sondern Risiko.",
            "Das größte Risiko ist nicht der Markt – sondern fehlende Verantwortlichkeit.",
            "Wer ohne Prüfschritte startet, zahlt später immer doppelt: Zeit und Geld.",
            "Entscheidungen werden sauber, wenn Rollen und Kriterien klar sind.",
            "Seriösität erkennt man an Ruhe, Dokumentation und Stopp-Punkten."
          ],
          engine_sluices: [
            "Wie wird bei Ihnen entschieden – wer ist am Ende der Entscheider?",
            "Was wäre bei Ihnen ein No-Go: Druck, Intransparenz oder fehlende Dokumente?",
            "Welche Rolle ist kritisch: Finanzen, Recht, IT, Vorstand?",
            "Soll ich Ihnen den Rahmen in 30 Sekunden geben – ohne Details?",
            "Was ist wichtiger: Fehler vermeiden oder schneller umsetzen?",
            "Woran würden Sie erkennen: „Das ist sauber aufgesetzt“?"
          ],
          engine_mirrors: [
            "Was ist heute der größte Unsicherheitsfaktor?",
            "Wo sehen Sie die größte Schnittstelle, an der Fehler passieren?",
            "Was müsste gegeben sein, damit Sie überhaupt weitergehen?",
            "Welche Information fehlt Ihnen gerade am meisten?",
            "Was wäre ein sauberer nächster Schritt – ohne Verpflichtung?",
            "Was wäre ein klarer Stopp-Punkt, falls es nicht passt?"
          ],
          objections: [
            {
              q:"„Schicken Sie mir erst mal Unterlagen.“",
              a:"Anerkennen: Klar.\nKlärfrage: Welche Unterlagen meinen Sie genau – Ablauf/Standards oder Konditionen?\nRahmen: Ich schicke nichts „ins Blaue“. Erst 2 Minuten Fit, dann gezielt das Richtige."
            },
            {
              q:"„Wir haben dafür keine Zeit.“",
              a:"Anerkennen: Versteh ich.\nKlärfrage: Was ist realistischer – 2 Minuten jetzt oder ein kurzer Slot (10 Minuten) später?\nRahmen: Ich will nur vermeiden, dass Zeit durch Fehlstart verloren geht."
            },
            {
              q:"„Wer steckt dahinter / ist das seriös?“",
              a:"Anerkennen: Absolut berechtigt.\nKlärfrage: Was wäre für Sie ein Seriositäts-Beleg – Referenzen, Dokumentation, klare Stopps?\nRahmen: Seriös ist: Ruhe, Transparenz, Prüfpfade. Wenn das fehlt, ist es ein Nein."
            },
            {
              q:"„Wir haben schon Berater / Prozesse.“",
              a:"Anerkennen: Sehr gut.\nKlärfrage: Wo passieren trotzdem typischerweise Fehler – Schnittstellen, Verantwortungen oder Tempo?\nRahmen: Ich ersetze nichts. Ich gebe nur einen Rahmen, der Fehler reduziert."
            },
            {
              q:"„Was kostet das?“",
              a:"Anerkennen: Fair.\nKlärfrage: Vorher noch wichtiger: Passt der Rahmen grundsätzlich – ja oder nein?\nRahmen: Wenn es passt, klären wir Konditionen sauber. Ich will keine Bauchentscheidung."
            }
          ]
        },

        en: {
          title_short: "Guide 03",
          badge: "Business / Association",
          btn_back: "Select",
          btn_lang: "DE/EN",
          btn_save: "Save",
          btn_reset: "Reset",
          title: "Guide 03 – Business / Association",
          sub: "Professional entry → decision path & roles → risk/process → 3 goals → focus/bottleneck → membership. Goal: a serious first call that sorts cleanly (no pressure, no promises).",
          flow_title: "12-minute flow",
          flow_tag: "Fit → frame → roles → decision → next step",
          flow_hint: "Tip: With businesses/associations: clarify the decision path first, then set the frame — details only after that.",
          setup_title: "Setup",
          setup_tag: "Local",
          lbl_name: "First name / name",
          lbl_form: "Address",
          form_sie: "FORMAL",
          form_du: "INFORMAL",
          lbl_context: "Context / role",
          lbl_focus: "Focus (3 goals)",
          focus_sicherheit: "1) Safety: avoid mistakes & losses",
          focus_stabil: "2) Stability: standards & responsibility",
          focus_spur: "3) Second stream: growth/partners (optional)",
          lbl_engpass: "Bottleneck",
          engpass_klarheit: "Clarity: legitimacy / risk / facts",
          engpass_struktur: "Structure: process, roles, checkpoints",
          engpass_dran: "Consistency: execution & follow-through",
          lbl_notes: "Notes",
          save_state: "ready",
          saving: "saving…",
          saved: "saved",
          btn_copy_all: "Copy all",
          copy_ok: "Copied.",
          engine_title: "Question engine",
          engine_tag: "Truth → pause → gateway",
          lbl_truth: "Truth",
          lbl_sluice: "Gateway question",
          lbl_mirror: "Mirror question",
          btn_next_engine: "Next line",
          btn_copy_engine: "Copy engine line",
          obj_title: "Objections",
          obj_tag: "Acknowledge → clarify → frame",
          local_hint: "Notes & selections stay on your device (LocalStorage). Nothing is sent.",
          ph_name: "e.g. Ms. Müller / Max",
          ph_context: "e.g. CEO / board / referral / network…",
          ph_notes: "Quick note: decision maker, situation, objections, next steps…",
          steps: [
            {
              id:"s1",
              title:"0–2 min · Professional warm-up",
              line:"Goal: check fit, no pitch. Calm, clear, short.",
              text: (ctx)=> {
                const add = ctx.context ? ("Context: " + ctx.context + "\n\n") : "";
                const greet = (ctx.form === "sie") ? "Hello" : "Hey";
                const n = ctx.nameGreet();
                const q1 = "Quick call to check if this fits cleanly — no details, no pressure. Do you have 2 minutes?";
                const q2 = "If not: what would be a good time for 10 minutes?";
                return add + greet + n + ".\n\n" + q1 + "\n" + q2;
              }
            },
            {
              id:"s2",
              title:"2–5 min · Decision path & role",
              line:"Goal: clarify decision maker/process before you share content.",
              text: (ctx)=> {
                const q1 = "So I don't assumeI assume wrong: how do you decide — who is the final decision maker?";
                const q2 = "Is it business or association — and what's your role (CEO/board/IT/finance)?";
                const q3 = "If you had to name a no-go: pressure, opacity, or missing documents?";
                return q1 + "\n" + q2 + "\n" + q3;
              }
            },
            {
              id:"s3",
              title:"5–7 min · Risk/process/roles",
              line:"Goal: name the real failure points: process, roles, checkpoints, stops.",
              text: (ctx)=> {
                const s1 = "I see it constantly: organizations rarely lose on product — they lose on process, roles, and missing stop points.";
                const q = "Have you seen a case where later it turned out: “we should have checked earlier”?";
                const s2 = "Legitimacy shows in calm, documentation and clear stops — if that's missing, speed is a red flag.";
                return s1 + "\n\n" + q + "\n\n" + s2;
              }
            },
            {
              id:"s4",
              title:"7–9 min · 3-goal frame",
              line:"Goal: value frame without a product list (safety/stability/second stream).",
              text: (ctx)=> {
                const intro = "I see three goals every organization should cover — whether you start something or not:";
                const p1 = "1) Safety: avoid mistakes and losses (checkpoints, stops).";
                const p2 = "2) Stability: standards & clear responsibility (roles, criteria, flow).";
                const p3 = "3) Second stream (optional): growth/partners — only on a clean foundation.";
                const close = "Most jump straight to #3 — and lose #1 and #2 on the way.";
                return intro + "\n\n" + p1 + "\n" + p2 + "\n" + p3 + "\n\n" + close;
              }
            },
            {
              id:"s5",
              title:"9–12 min · Focus → membership (calm close)",
              line:"Goal: prioritize + bottleneck + clean next step.",
              text: (ctx)=> {
                const n = ctx.nameShort();
                const q1 = "If you had to prioritize" + n + ": what matters more right now — safety, stability, or a second stream?";
                const q2 = "And the bottleneck is more: clarity, structure — or execution/follow-through?";
                const s = "That’s what the membership is for: a framework (standards, roles, checkpoints) so decisions stay clean.";
                const close = "Should I unlock the framework for you — yes or no?";
                const soft = "If not yes yet: what's missing — clarity, trust, or a concrete question?";
                return q1 + "\n" + q2 + "\n\n" + s + "\n\n" + close + "\n" + soft;
              }
            }
          ],
          engine_truths: [
            "Organizations rarely lose on product — they lose on process.",
            "Speed without standards isn’t progress; it’s risk.",
            "The biggest risk isn’t the market — it’s unclear responsibility.",
            "Start without checkpoints and you pay twice: time and money.",
            "Decisions get clean when roles and criteria are clear.",
            "Legitimacy shows in calm, documentation, and stop points."
          ],
          engine_sluices: [
            "How do you decide — who is the final decision maker?",
            "What is a no-go: pressure, opacity, or missing documents?",
            "Which function is critical: finance, legal, IT, board?",
            "Want me to outline the frame in 30 seconds — no details?",
            "What matters more: avoiding mistakes or moving faster?",
            "How would you recognize: “this is set up cleanly”?"
          ],
          engine_mirrors: [
            "What’s the biggest uncertainty right now?",
            "Where is the interface where mistakes happen most?",
            "What would need to be true for you to continue?",
            "Which piece of information is missing most?",
            "What would be a clean next step — no commitment?",
            "What’s a clear stop point if it doesn’t fit?"
          ],
          objections: [
            {
              q:"“Send me information first.”",
              a:"Acknowledge: sure.\nClarify: what exactly — process/standards or terms?\nFrame: I don’t send generic docs. First 2 minutes fit, then the right piece."
            },
            {
              q:"“We don’t have time.”",
              a:"Acknowledge: fair.\nClarify: what’s realistic — 2 minutes now or a short slot (10 minutes) later?\nFrame: I only want to prevent time loss through a wrong start."
            },
            {
              q:"“Who is behind it / is it legit?”",
              a:"Acknowledge: fair.\nClarify: what would prove legitimacy — references, documentation, clear stop points?\nFrame: legit means calm, transparency, checkpoints. If missing, it’s a no."
            },
            {
              q:"“We already have advisors / processes.”",
              a:"Acknowledge: good.\nClarify: where do mistakes still happen — interfaces, responsibility, or speed?\nFrame: I replace nothing. I provide a frame that reduces mistakes."
            },
            {
              q:"“What does it cost?”",
              a:"Acknowledge: fair.\nClarify: more important first — does the framework fit at all, yes or no?\nFrame: if it fits, we clarify terms cleanly. No gut decisions."
            }
          ]
        }
      };

      const $ = (id)=> document.getElementById(id);
      const elSteps = $("steps");
      const elObj = $("objections");
      const elTruth = $("truth");
      const elSluice = $("sluice");
      const elMirror = $("mirror");
      const elSaveState = $("saveState");
      const elCopyOk = $("copyOk");

      const inputs = {
        name: $("name"),
        form: $("form"),
        context: $("context"),
        focus: $("focus"),
        engpass: $("engpass"),
        notes: $("notes")
      };

      let lang = (localStorage.getItem(LANG_KEY) || "de").toLowerCase() === "en" ? "en" : "de";
      let doneMap = {}; // stepId -> boolean
      let engineIdx = { t:0, s:0, m:0 };

      function nowTs(){ return Date.now(); }

      function safeParse(str){
        try{ return JSON.parse(str); }catch(e){ return null; }
      }

      function getState(){
        const s = {
          vorname: (inputs.name.value || "").trim(),
          name: (inputs.name.value || "").trim(), // kompatibel falls irgendwo "name" erwartet wird
          form: inputs.form.value || "sie",
          context: (inputs.context.value || "").trim(),
          focus: inputs.focus.value || "sicherheit",
          engpass: inputs.engpass.value || "klarheit",
          notes: (inputs.notes.value || "").trim(),
          done: doneMap || {},
          engineIdx: engineIdx || {t:0,s:0,m:0},
          // Index-Meta (Pflichtfelder)
          fokusLabel: LABELS.focusLabel[inputs.focus.value || "sicherheit"][lang],
          engpassLabel: LABELS.engpassLabel[inputs.engpass.value || "klarheit"][lang],
          lastUsed: nowTs(),
          updatedAt: nowTs()
        };
        return s;
      }

      function setSaveState(textKeyOrRaw, mode){
        let txt = textKeyOrRaw;
        if (I18N[lang][textKeyOrRaw]) txt = I18N[lang][textKeyOrRaw];
        elSaveState.textContent = txt;

        if (mode === "ok"){
          elSaveState.style.color = "var(--gold2)";
        } else if (mode === "warn"){
          elSaveState.style.color = "rgba(255,180,120,.95)";
        } else {
          elSaveState.style.color = "var(--muted)";
        }
      }

      function persist(reason){
        const s = getState();
        try{
          localStorage.setItem(PAGE_KEY, JSON.stringify(s));
          setSaveState("saved", "ok");
          if (reason !== "silent"){
            window.clearTimeout(persist._t);
            persist._t = window.setTimeout(()=> setSaveState("save_state",""), 900);
          }
        }catch(e){
          setSaveState(lang === "de" ? "Speichern fehlgeschlagen" : "Save failed", "warn");
        }
      }

      function load(){
        const raw = localStorage.getItem(PAGE_KEY);
        const s = raw ? safeParse(raw) : null;

        if (s){
          if (typeof s.vorname === "string") inputs.name.value = s.vorname;
          else if (typeof s.name === "string") inputs.name.value = s.name;

          if (s.form === "du" || s.form === "sie") inputs.form.value = s.form;
          if (typeof s.context === "string") inputs.context.value = s.context;
          if (s.focus && LABELS.focusLabel[s.focus]) inputs.focus.value = s.focus;
          if (s.engpass && LABELS.engpassLabel[s.engpass]) inputs.engpass.value = s.engpass;
          if (typeof s.notes === "string") inputs.notes.value = s.notes;

          doneMap = (s.done && typeof s.done === "object") ? s.done : {};
          engineIdx = (s.engineIdx && typeof s.engineIdx === "object") ? s.engineIdx : {t:0,s:0,m:0};

          // lastUsed beim Öffnen aktualisieren (Index will das)
          try{
            s.lastUsed = nowTs();
            localStorage.setItem(PAGE_KEY, JSON.stringify(s));
          }catch(e){}
        } else {
          doneMap = {};
          engineIdx = { t:0, s:0, m:0 };
        }
      }

      function applyI18nStatic(){
        const dict = I18N[lang];
        document.documentElement.lang = lang === "de" ? "de" : "en";

        document.querySelectorAll("[data-i18n]").forEach(el=>{
          const k = el.getAttribute("data-i18n");
          if (!k) return;
          if (typeof dict[k] === "string") el.textContent = dict[k];
        });

        // placeholders
        inputs.name.placeholder = dict.ph_name;
        inputs.context.placeholder = dict.ph_context;
        inputs.notes.placeholder = dict.ph_notes;
      }

      function ctxFactory(){
        const form = inputs.form.value || "sie";
        const nameRaw = (inputs.name.value || "").trim();
        const context = (inputs.context.value || "").trim();

        function nameShort(){
          if (!nameRaw) return "";
          return ", " + nameRaw;
        }
        function nameGreet(){
          if (!nameRaw) return "";
          return " " + nameRaw;
        }

        return { form, nameRaw, context, nameShort, nameGreet };
      }

      function renderSteps(){
        const dict = I18N[lang];
        const ctx = ctxFactory();

        elSteps.innerHTML = "";
        dict.steps.forEach((s, idx)=>{
          const isDone = !!doneMap[s.id];

          const wrap = document.createElement("div");
          wrap.className = "step";

          const head = document.createElement("div");
          head.className = "stephead";

          const left = document.createElement("div");
          const title = document.createElement("p");
          title.className = "steptitle";
          title.textContent = s.title;

          const line = document.createElement("p");
          line.className = "stepline";
          line.textContent = s.line;

          left.appendChild(title);
          left.appendChild(line);

          const meta = document.createElement("div");
          meta.className = "stepmeta";

          const pill = document.createElement("span");
          pill.className = "pill" + (isDone ? " done" : "");
          pill.textContent = isDone ? (lang === "de" ? "erledigt" : "done") : ("Step " + (idx+1));

          meta.appendChild(pill);

          head.appendChild(left);
          head.appendChild(meta);

          const txt = document.createElement("p");
          txt.className = "steptext";
          txt.textContent = s.text(ctx);

          const mini = document.createElement("div");
          mini.className = "miniBtns";

          const btnDone = document.createElement("button");
          btnDone.type = "button";
          btnDone.className = "btn ghost";
          btnDone.innerHTML =
            '<svg viewBox="0 0 24 24" fill="none" aria-hidden="true">' +
            '<path d="M20 6L9 17l-5-5" stroke="rgba(233,238,247,.9)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>' +
            '</svg>' +
            '<span>' + (isDone ? (lang === "de" ? "Undo" : "Undo") : (lang === "de" ? "Erledigt" : "Done")) + '</span>';

          btnDone.addEventListener("click", ()=>{
            doneMap[s.id] = !doneMap[s.id];
            persist("silent");
            renderSteps();
          });

          const btnCopy = document.createElement("button");
          btnCopy.type = "button";
          btnCopy.className = "btn";
          btnCopy.innerHTML =
            '<svg viewBox="0 0 24 24" fill="none" aria-hidden="true">' +
            '<path d="M9 9h11v12H9z" stroke="rgba(212,175,55,.9)" stroke-width="2"/>' +
            '<path d="M4 3h11v6H4z" stroke="rgba(212,175,55,.55)" stroke-width="2"/>' +
            '</svg>' +
            '<span>' + (lang === "de" ? "Step kopieren" : "Copy step") + '</span>';

          btnCopy.addEventListener("click", async ()=>{
            const block = s.title + "\n" + s.line + "\n\n" + s.text(ctx);
            await copyText(block);
          });

          mini.appendChild(btnDone);
          mini.appendChild(btnCopy);

          wrap.appendChild(head);
          wrap.appendChild(txt);
          wrap.appendChild(mini);

          elSteps.appendChild(wrap);
        });
      }

      function renderObjections(){
        const dict = I18N[lang];
        elObj.innerHTML = "";

        dict.objections.forEach(o=>{
          const c = document.createElement("div");
          c.className = "objCard";

          const q = document.createElement("p");
          q.className = "objQ";
          q.textContent = o.q;

          const a = document.createElement("p");
          a.className = "objA";
          a.textContent = o.a;

          c.appendChild(q);
          c.appendChild(a);
          elObj.appendChild(c);
        });
      }

      function setSelectOptions(selectEl, arr, selectedIdx){
        selectEl.innerHTML = "";
        arr.forEach((t, i)=>{
          const opt = document.createElement("option");
          opt.value = String(i);
          opt.textContent = t;
          selectEl.appendChild(opt);
        });
        const idx = Math.max(0, Math.min(arr.length-1, (selectedIdx|0)));
        selectEl.value = String(idx);
      }

      function renderEngine(){
        const dict = I18N[lang];
        setSelectOptions(elTruth, dict.engine_truths, engineIdx.t|0);
        setSelectOptions(elSluice, dict.engine_sluices, engineIdx.s|0);
        setSelectOptions(elMirror, dict.engine_mirrors, engineIdx.m|0);
      }

      function currentEngineLine(){
        const dict = I18N[lang];
        const t = dict.engine_truths[engineIdx.t|0] || "";
        const s = dict.engine_sluices[engineIdx.s|0] || "";
        const m = dict.engine_mirrors[engineIdx.m|0] || "";
        const prefix = (lang === "de" ? "Wahrheit → Pause → Schleuse" : "Truth → pause → gateway");
        return prefix + "\n\n" + t + "\n\n" + s + "\n" + m;
      }

      async function copyText(text){
        try{
          if (navigator.clipboard && navigator.clipboard.writeText){
            await navigator.clipboard.writeText(text);
          } else {
            const ta = document.createElement("textarea");
            ta.value = text;
            ta.setAttribute("readonly","");
            ta.style.position="fixed";
            ta.style.left="-9999px";
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            document.body.removeChild(ta);
          }
          elCopyOk.style.display = "block";
          window.clearTimeout(copyText._t);
          copyText._t = window.setTimeout(()=>{ elCopyOk.style.display="none"; }, 900);
        }catch(e){
          // no-op
        }
      }

      function buildCopyAll(){
        const dict = I18N[lang];
        const ctx = ctxFactory();
        const formLine = (lang === "de" ? "Ansprache" : "Address") + ": " + (inputs.form.value === "sie" ? (lang === "de" ? "SIE" : "FORMAL") : (lang === "de" ? "DU" : "INFORMAL"));
        const focusLabel = LABELS.focusLabel[inputs.focus.value][lang];
        const engpassLabel = LABELS.engpassLabel[inputs.engpass.value][lang];

        const top =
          dict.title + "\n" +
          "— — —\n" +
          (lang === "de" ? "Name" : "Name") + ": " + ((inputs.name.value || "").trim() || "-") + "\n" +
          formLine + "\n" +
          (lang === "de" ? "Kontext" : "Context") + ": " + ((inputs.context.value || "").trim() || "-") + "\n" +
          (lang === "de" ? "Fokus" : "Focus") + ": " + focusLabel + "\n" +
          (lang === "de" ? "Engpass" : "Bottleneck") + ": " + engpassLabel + "\n" +
          "— — —\n\n";

        const stepsBlock = dict.steps.map((s, i)=>{
          const done = doneMap[s.id] ? (lang === "de" ? " (erledigt)" : " (done)") : "";
          return (i+1) + ") " + s.title + done + "\n" + s.line + "\n\n" + s.text(ctx);
        }).join("\n\n— — —\n\n");

        const notes = "\n\n— — —\n\n" + (lang === "de" ? "Notizen" : "Notes") + ":\n" + ((inputs.notes.value || "").trim() || "-");

        return top + stepsBlock + notes;
      }

      function hookAutosave(){
        const onChange = ()=>{
          setSaveState("saving", "");
          renderSteps();
          persist("silent");
        };

        ["input","change"].forEach(ev=>{
          inputs.name.addEventListener(ev, onChange);
          inputs.form.addEventListener(ev, onChange);
          inputs.context.addEventListener(ev, onChange);
          inputs.focus.addEventListener(ev, onChange);
          inputs.engpass.addEventListener(ev, onChange);
          inputs.notes.addEventListener(ev, onChange);
        });

        elTruth.addEventListener("change", ()=>{
          engineIdx.t = parseInt(elTruth.value,10) || 0;
          persist("silent");
        });
        elSluice.addEventListener("change", ()=>{
          engineIdx.s = parseInt(elSluice.value,10) || 0;
          persist("silent");
        });
        elMirror.addEventListener("change", ()=>{
          engineIdx.m = parseInt(elMirror.value,10) || 0;
          persist("silent");
        });
      }

      function switchLang(){
        lang = (lang === "de") ? "en" : "de";
        localStorage.setItem(LANG_KEY, lang);

        persist("silent");
        applyI18nStatic();
        renderSteps();
        renderEngine();
        renderObjections();
      }

      $("btnLang").addEventListener("click", switchLang);

      $("btnSave").addEventListener("click", ()=>{
        persist("manual");
      });

      $("btnReset").addEventListener("click", ()=>{
        const ok = confirm(lang === "de"
          ? "Alles zurücksetzen (inkl. LocalStorage) – wirklich?"
          : "Reset everything (including LocalStorage) — sure?");
        if (!ok) return;

        try{ localStorage.removeItem(PAGE_KEY); }catch(e){}
        doneMap = {};
        engineIdx = {t:0,s:0,m:0};

        inputs.name.value = "";
        inputs.form.value = "sie";
        inputs.context.value = "";
        inputs.focus.value = "sicherheit";
        inputs.engpass.value = "klarheit";
        inputs.notes.value = "";

        applyI18nStatic();
        renderSteps();
        renderEngine();
        renderObjections();
        setSaveState("save_state","");
      });

      $("btnCopyAll").addEventListener("click", async ()=>{
        const text = buildCopyAll();
        await copyText(text);
      });

      $("btnNextEngine").addEventListener("click", ()=>{
        const dict = I18N[lang];
        engineIdx.t = (engineIdx.t + 1) % dict.engine_truths.length;
        engineIdx.s = (engineIdx.s + 1) % dict.engine_sluices.length;
        engineIdx.m = (engineIdx.m + 1) % dict.engine_mirrors.length;
        renderEngine();
        persist("silent");
      });

      $("btnCopyEngine").addEventListener("click", async ()=>{
        await copyText(currentEngineLine());
      });

      $("btnBack").addEventListener("click", ()=>{
        window.location.href = "./index.html";
      });

      // Init
      load();
      applyI18nStatic();
      renderSteps();
      renderEngine();
      renderObjections();
      hookAutosave();

      // Ensure meta labels exist for index right away
      persist("silent");
      setSaveState("save_state","");
    })();
  </script>
</body>
</html>
