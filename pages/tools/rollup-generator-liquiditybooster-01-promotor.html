<!doctype html>
<!--
  FSA • Rollup Tool • LiquidityBooster – Rollup 01 (Promotor)
  GitHub-Pfad: lp-anfang/pages/tools/rollup-generator-liquiditybooster-01-promotor.html
-->
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roll-Up Generator – LiquidityBooster (01)</title>
  <meta name="description" content="Roll-Up Generator (85×200cm): Eingabefelder, Vorschau, QR, Druckvorlage, DE/EN, LocalStorage. LiquidityBooster Branding (Logo lokal)." />
  <meta name="robots" content="noindex,nofollow" />

  <style>
    :root{
      --bg:#ffffff;
      --ink:#000000;
      --muted:#333333;
      --line:#000000;
      --panel:#ffffff;

      /* Brand (lokal) */
      --brand-logo: "/lp-anfang/library/logos/liquiditybooster-logo.png";
      --brand-logo-h: 18mm;   /* Rollup: Logo größer */
      --brand-max-w: 120mm;

      /* Rollup Format */
      --roll-w:850mm;
      --roll-h:2000mm;

      /* Layout */
      --pad:30mm;
      --radius:6mm;

      /* Akzent */
      --accent1:#20cbb0;   /* türkis */
      --accent2:#ff2aa6;   /* magenta */
      --accentSoft: rgba(32,203,176,.12);
      --accentSoft2: rgba(255,42,166,.10);

      /* Preview scaling (per JS gesetzt) */
      --preview-scale: 0.08;
    }

    html,body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }

    .wrap{ max-width:1200px; margin:0 auto; padding:18px 16px 34px; }

    header{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
      flex-wrap:wrap; margin-bottom:14px;
    }

    .title{ line-height:1.15; }
    .title h1{ margin:0; font-size:20px; font-weight:900; letter-spacing:.2px; }
    .title p{ margin:6px 0 0; color:var(--muted); font-size:13px; max-width:72ch; }

    .lang{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .btn{
      appearance:none; border:1px solid var(--line); background:#fff; color:#000;
      padding:8px 10px; border-radius:8px; font-weight:800; font-size:13px; cursor:pointer;
    }
    .btn:active{ transform:translateY(1px); }
    .btn.small{ padding:7px 9px; font-size:12px; }
    .btn.primary{ background:#000; color:#fff; }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:16px;
      align-items:start;
    }

    .panel{
      border:1px solid var(--line);
      border-radius:12px;
      padding:14px;
      background:var(--panel);
    }
    .panel h2{ margin:0 0 10px; font-size:15px; font-weight:900; }

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .field{ display:flex; flex-direction:column; gap:6px; }
    .field.full{ grid-column:1 / -1; }

    label{ font-size:12px; font-weight:900; letter-spacing:.2px; }
    input{
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px 10px;
      font-size:14px;
      outline:none;
      background:#fff;
      color:#000;
    }
    input::placeholder{ color:#777; }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .hint{ font-size:12px; color:var(--muted); line-height:1.35; }

    .previewWrap{ display:flex; flex-direction:column; gap:12px; align-items:flex-start; }

    /* FIX: PreviewBox bekommt definierte Höhe + "Fit to Box" */
    .previewBox{
      width:100%;
      border:1px dashed #000;
      border-radius:12px;
      padding:12px;
      background:#fff;

      height:72vh;
      max-height:780px;
      min-height:420px;

      overflow:hidden;

      display:flex;
      align-items:flex-start;
      justify-content:flex-start;
    }

    /* Rollup Preview Stage */
    .stage{
      width:var(--roll-w);
      height:var(--roll-h);
      transform-origin: top left;
      transform: scale(var(--preview-scale));
      background:#fff;
      border:1px solid #000;
      border-radius: var(--radius);
      box-sizing:border-box;
      position:relative;
      overflow:hidden;
    }

    /* Rollup Design */
    .rBg{
      position:absolute; inset:0;
      background:
        radial-gradient(800mm 600mm at 18% 12%, var(--accentSoft) 0%, rgba(255,255,255,0) 60%),
        radial-gradient(700mm 500mm at 85% 22%, var(--accentSoft2) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(#fff, #fff);
      pointer-events:none;
    }

    .rPad{
      position:absolute;
      left:var(--pad); right:var(--pad);
      top:var(--pad); bottom:var(--pad);
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      gap:18mm;
    }

    .brandRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12mm;
    }

    .brandMark{
      display:flex;
      align-items:flex-start;
      justify-content:flex-end;
      gap:0;
      max-width: var(--brand-max-w);
    }
    .brandMark img{
      height: var(--brand-logo-h);
      width:auto;
      max-width: var(--brand-max-w);
      display:block;
      object-fit:contain;
    }
    .brandMark .brandFallback{
      display:none;
      font-weight:900;
      font-size:12mm;
      letter-spacing:.2mm;
      color:#000;
    }
    .brandMark.isFallback img{ display:none; }
    .brandMark.isFallback .brandFallback{ display:block; }

    .claim{
      font-weight:900;
      font-size:10mm;
      letter-spacing:.6mm;
      line-height:1.1;
      text-transform:uppercase;
      text-align:left;
      max-width: 520mm;
    }
    .claim .c1{ color: var(--accent1); }
    .claim .c2{ color: var(--accent2); }
    .claim .c0{ color:#000; }

    .headline{
      font-weight:1000;
      font-size:34mm;
      line-height:1.02;
      letter-spacing:.2mm;
      margin:0;
      word-break:break-word;
    }

    .subline{
      margin:0;
      font-weight:700;
      font-size:12mm;
      line-height:1.35;
      color:#111;
      max-width: 650mm;
      word-break:break-word;
    }

    .divider{
      height:0;
      border-top:2mm solid #000;
      width:100%;
      opacity:1;
    }

    .bullets{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10mm;
      margin-top:2mm;
    }
    .bCard{
      border:1.6mm solid #000;
      border-radius:6mm;
      padding:10mm;
      background:#fff;
      box-sizing:border-box;
      min-height: 110mm;
    }
    .bTitle{
      margin:0 0 6mm;
      font-weight:1000;
      font-size:12mm;
      line-height:1.1;
    }
    .bText{
      margin:0;
      font-weight:700;
      font-size:9.8mm;
      line-height:1.25;
      color:#111;
    }

    .bottomRow{
      margin-top:auto;
      display:flex;
      gap:14mm;
      align-items:flex-end;
      justify-content:space-between;
    }

    .contactBox{
      border:2mm solid #000;
      border-radius:6mm;
      padding:12mm;
      background:#fff;
      box-sizing:border-box;
      flex:1;
      min-height: 140mm;
      display:flex;
      flex-direction:column;
      gap:8mm;
    }
    .cName{
      margin:0;
      font-weight:1000;
      font-size:14mm;
      line-height:1.05;
      word-break:break-word;
    }
    .cRole{
      margin:0;
      font-weight:800;
      font-size:10.5mm;
      color:#111;
      word-break:break-word;
    }
    .cList{
      display:grid;
      grid-template-columns: 1fr;
      gap:3mm;
      font-size:10mm;
      font-weight:800;
      line-height:1.15;
      color:#111;
      word-break:break-word;
    }
    .mono{ font-variant-numeric: tabular-nums; font-feature-settings:"tnum" 1; }
    .empty{ opacity:.35; font-style:italic; }

    .qrBlock{
      width:150mm;
      min-width:150mm;
      border:2mm solid #000;
      border-radius:6mm;
      background:#fff;
      box-sizing:border-box;
      padding:10mm;
      display:flex;
      flex-direction:column;
      gap:6mm;
      align-items:center;
      justify-content:center;
    }
    .qrLarge{
      width:120mm;
      height:120mm;
      border:1.6mm solid #000;
      background:#fff;
      box-sizing:border-box;
      padding:4mm;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .qrLarge img{ width:100%; height:100%; display:block; image-rendering:pixelated; }

    .qrLabel{
      font-weight:900;
      font-size:8.8mm;
      line-height:1.1;
      text-align:center;
    }

    .footerNote{ font-size:12px; color:var(--muted); }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .previewBox{ height:70vh; max-height:none; }
    }

    @media print{
      @page{ size: 850mm 2000mm; margin: 0; }
      body{ background:#fff; }

      header, .panel.formPanel, .footerNote, .lang, .hint, .actions{ display:none !important; }
      .wrap{ padding:0; max-width:none; }
      .grid{ display:block; }
      .panel{ border:none; padding:0; }
      .previewBox{ border:none; padding:0; border-radius:0; overflow:visible; height:auto; }

      .stage{
        transform:none !important;
        border:none;
        border-radius:0;
        width: var(--roll-w);
        height: var(--roll-h);
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1 data-i18n="h1">Roll-Up Generator – LiquidityBooster (01)</h1>
        <p data-i18n="sub">Eingaben → Vorschau → QR → Drucken / als PDF speichern. (85×200 cm)</p>
      </div>

      <div class="lang">
        <button class="btn small" id="btnDE" type="button">DE</button>
        <button class="btn small" id="btnEN" type="button">EN</button>
        <button class="btn primary" id="btnPrint" type="button" data-i18n="printBtn">Drucken / als PDF speichern</button>
      </div>
    </header>

    <div class="grid">
      <section class="panel formPanel">
        <h2 data-i18n="formTitle">Eingabefelder</h2>

        <div class="form">
          <div class="field full">
            <label for="headline" data-i18n="headlineLabel">Headline (oben)</label>
            <input id="headline" type="text" data-i18n-ph="headlinePH" placeholder="Eine Aufgabe. Ein System. Planbares Einkommen." autocomplete="off" />
          </div>

          <div class="field full">
            <label for="subline" data-i18n="sublineLabel">Unterzeile</label>
            <input id="subline" type="text" data-i18n-ph="sublinePH" placeholder="Du empfiehlst – wir liefern Produkt, Prozess und Tools." autocomplete="off" />
          </div>

          <div class="field">
            <label for="firstName" data-i18n="firstNameLabel">Vorname</label>
            <input id="firstName" type="text" placeholder="Max" autocomplete="given-name" />
          </div>
          <div class="field">
            <label for="lastName" data-i18n="lastNameLabel">Nachname</label>
            <input id="lastName" type="text" placeholder="Mustermann" autocomplete="family-name" />
          </div>

          <div class="field full">
            <label for="role" data-i18n="roleLabel">Rolle / Status</label>
            <input id="role" type="text" data-i18n-ph="rolePH" placeholder="Selbstständiger Promotor (m/w/d)" autocomplete="off" />
          </div>

          <div class="field">
            <label for="mobile" data-i18n="mobileLabel">Telefon</label>
            <input id="mobile" type="tel" placeholder="+49 170 1234567" autocomplete="tel" />
          </div>
          <div class="field">
            <label for="email" data-i18n="emailLabel">E-Mail</label>
            <input id="email" type="email" placeholder="name@domain.de" autocomplete="email" />
          </div>

          <div class="field full">
            <label for="website" data-i18n="websiteLabel">Webadresse (für QR)</label>
            <input id="website" type="text" placeholder="https://deine-domain.de" autocomplete="url" />
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="btnClear" type="button" data-i18n="clearBtn">Felder leeren</button>
          <button class="btn" id="btnCopy" type="button" data-i18n="copyBtn">Text kopieren</button>
          <div class="hint" data-i18n="hint">Tipp: Nach dem Klick auf „Drucken / als PDF speichern“ im Druckdialog „Als PDF sichern“ wählen.</div>
        </div>

        <div class="hint" id="qrStatusLine" style="margin-top:8px;"></div>
      </section>

      <section class="panel">
        <h2 data-i18n="previewTitle">Vorschau</h2>

        <div class="previewWrap">
          <div class="previewBox" id="previewBox">
            <div class="stage" id="stage" aria-label="Rollup Preview">
              <div class="rBg"></div>

              <div class="rPad">
                <div class="brandRow">
                  <div class="claim" aria-label="Claim">
                    <span class="c1">MEHR GELD</span>
                    <span class="c0"> – </span>
                    <span class="c2">MEHR FREIHEIT</span>
                    <span class="c0"> – </span>
                    <span class="c1">MEHR VOM LEBEN</span>
                  </div>

                  <div class="brandMark" id="brandMark" aria-label="Brand">
                    <img id="brandLogo" alt="liquiditybooster.de" src="/lp-anfang/library/logos/liquiditybooster-logo.png">
                    <span class="brandFallback">liquiditybooster.de</span>
                  </div>
                </div>

                <div class="divider"></div>

                <h3 class="headline" id="pHeadline">—</h3>
                <p class="subline" id="pSubline">—</p>

                <div class="bullets" aria-label="Key points">
                  <div class="bCard">
                    <p class="bTitle" data-i18n="b1t">Einfach starten</p>
                    <p class="bText" data-i18n="b1x">Klare Schritte – ohne Umwege.</p>
                  </div>
                  <div class="bCard">
                    <p class="bTitle" data-i18n="b2t">Wiederholbar</p>
                    <p class="bText" data-i18n="b2x">Standards statt Zufall.</p>
                  </div>
                  <div class="bCard">
                    <p class="bTitle" data-i18n="b3t">Skalierbar</p>
                    <p class="bText" data-i18n="b3x">Team-Option möglich.</p>
                  </div>
                </div>

                <div class="bottomRow">
                  <div class="contactBox" aria-label="Contact">
                    <p class="cName" id="pName">—</p>
                    <p class="cRole" id="pRole">—</p>

                    <div class="cList">
                      <div class="mono" id="pMobile">—</div>
                      <div class="mono" id="pEmail">—</div>
                      <div class="mono" id="pWebsite">—</div>
                    </div>
                  </div>

                  <div class="qrBlock" aria-label="QR Block">
                    <div class="qrLarge" id="qrBox">
                      <div id="qrOut"></div>
                    </div>
                    <div class="qrLabel" data-i18n="qrLabel">Jetzt scannen</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="footerNote" data-i18n="privacy">Hinweis: Speicherung erfolgt lokal im Browser (LocalStorage). Keine Übertragung.</div>
        </div>
      </section>
    </div>
  </div>

  <script>
    /*
      qrcode-generator (classic) – offline (MIT)
      kazuhikoarase/qrcode-generator
      FIX: RS_BLOCK_TABLE korrekt (160 Einträge) => Safari/iOS stabil
    */
    (function(global){
      "use strict";

      var QRMode = { MODE_8BIT_BYTE: 1 << 2 };
      var QRErrorCorrectionLevel = { L:1, M:0, Q:3, H:2 };

      function QR8BitByte(data) {
        this.mode = QRMode.MODE_8BIT_BYTE;
        this.data = data;
        this.getMode = function() { return this.mode; };
        this.getLength = function() { return QRUtil.getUTF8Length(this.data); };
        this.write = function(buffer) { QRUtil.writeUTF8(buffer, this.data); };
      }

      function QRBitBuffer() {
        this.buffer = [];
        this.length = 0;
        this.getBuffer = function() { return this.buffer; };
        this.getLengthInBits = function() { return this.length; };
        this.put = function(num, length) {
          for (var i = 0; i < length; i++) this.putBit(((num >>> (length - i - 1)) & 1) == 1);
        };
        this.putBit = function(bit) {
          var bufIndex = Math.floor(this.length / 8);
          if (this.buffer.length <= bufIndex) this.buffer.push(0);
          if (bit) this.buffer[bufIndex] |= (0x80 >>> (this.length % 8));
          this.length++;
        };
      }

      function qrPolynomial(num, shift) {
        var offset = 0;
        while (offset < num.length && num[offset] == 0) offset++;

        var _num = new Array(num.length - offset + shift);
        for (var i = 0; i < _num.length; i++) _num[i] = 0;
        for (var i = 0; i < num.length - offset; i++) _num[i] = num[i + offset];

        this.get = function(index) { return _num[index]; };
        this.getLength = function() { return _num.length; };

        this.multiply = function(e) {
          var num = new Array(this.getLength() + e.getLength() - 1);
          for (var i = 0; i < num.length; i++) num[i] = 0;
          for (var i = 0; i < this.getLength(); i++) {
            for (var j = 0; j < e.getLength(); j++) {
              num[i + j] ^= QRMath.gexp(QRMath.glog(this.get(i)) + QRMath.glog(e.get(j)));
            }
          }
          return new qrPolynomial(num, 0);
        };

        this.mod = function(e) {
          if (this.getLength() - e.getLength() < 0) return this;
          var ratio = QRMath.glog(this.get(0)) - QRMath.glog(e.get(0));
          var num = new Array(this.getLength());
          for (var i = 0; i < this.getLength(); i++) num[i] = this.get(i);
          for (var i = 0; i < e.getLength(); i++) num[i] ^= QRMath.gexp(QRMath.glog(e.get(i)) + ratio);
          return new qrPolynomial(num, 0).mod(e);
        };
      }

      var QRMath = {
        glog: function(n) { if (n < 1) throw new Error("glog(" + n + ")"); return QRMath.LOG_TABLE[n]; },
        gexp: function(n) { while (n < 0) n += 255; while (n >= 256) n -= 255; return QRMath.EXP_TABLE[n]; },
        EXP_TABLE: new Array(256),
        LOG_TABLE: new Array(256)
      };

      for (var i = 0; i < 8; i++) QRMath.EXP_TABLE[i] = 1 << i;
      for (var i = 8; i < 256; i++) {
        QRMath.EXP_TABLE[i] = QRMath.EXP_TABLE[i - 4] ^ QRMath.EXP_TABLE[i - 5] ^ QRMath.EXP_TABLE[i - 6] ^ QRMath.EXP_TABLE[i - 8];
      }
      for (var i = 0; i < 255; i++) QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]] = i;

      var QRRSBlock = {
        getRSBlocks: function(typeNumber, errorCorrectionLevel) {
          var rsBlock = QRRSBlock.getRsBlockTable(typeNumber, errorCorrectionLevel);
          if (rsBlock == undefined) throw new Error("bad rs block");
          var length = rsBlock.length / 3;
          var list = [];
          for (var i = 0; i < length; i++) {
            var count = rsBlock[i * 3 + 0];
            var totalCount = rsBlock[i * 3 + 1];
            var dataCount = rsBlock[i * 3 + 2];
            for (var j = 0; j < count; j++) list.push({ totalCount: totalCount, dataCount: dataCount });
          }
          return list;
        },

        RS_BLOCK_TABLE: [
          [1, 26, 19],[1, 26, 16],[1, 26, 13],[1, 26, 9],
          [1, 44, 34],[1, 44, 28],[1, 44, 22],[1, 44, 16],
          [1, 70, 55],[1, 70, 44],[2, 35, 17],[2, 35, 13],
          [1, 100, 80],[2, 50, 32],[2, 50, 24],[4, 25, 9],
          [1, 134, 108],[2, 67, 43],[2, 33, 15, 2, 34, 16],[2, 33, 11, 2, 34, 12],
          [2, 86, 68],[4, 43, 27],[4, 43, 19],[4, 43, 15],
          [2, 98, 78],[4, 49, 31],[2, 32, 14, 4, 33, 15],[4, 39, 13, 1, 40, 14],
          [2, 121, 97],[2, 60, 38, 2, 61, 39],[4, 40, 18, 2, 41, 19],[4, 40, 14, 2, 41, 15],
          [2, 146, 116],[3, 58, 36, 2, 59, 37],[4, 36, 16, 4, 37, 17],[4, 36, 12, 4, 37, 13],
          [2, 86, 68, 2, 87, 69],[4, 69, 43, 1, 70, 44],[6, 43, 19, 2, 44, 20],[6, 43, 15, 2, 44, 16],
          [4, 101, 81],[1, 80, 50, 4, 81, 51],[4, 50, 22, 4, 51, 23],[3, 36, 12, 8, 37, 13],
          [2, 116, 92, 2, 117, 93],[6, 58, 36, 2, 59, 37],[4, 46, 20, 6, 47, 21],[7, 42, 14, 4, 43, 15],
          [4, 133, 107],[8, 59, 37, 1, 60, 38],[8, 44, 20, 4, 45, 21],[12, 33, 11, 4, 34, 12],
          [3, 145, 115, 1, 146, 116],[4, 64, 40, 5, 65, 41],[11, 36, 16, 5, 37, 17],[11, 36, 12, 5, 37, 13],
          [5, 109, 87, 1, 110, 88],[5, 65, 41, 5, 66, 42],[5, 54, 24, 7, 55, 25],[11, 36, 12, 7, 37, 13],
          [5, 122, 98, 1, 123, 99],[7, 73, 45, 3, 74, 46],[15, 43, 19, 2, 44, 20],[3, 45, 15, 13, 46, 16],
          [1, 135, 107, 5, 136, 108],[10, 74, 46, 1, 75, 47],[1, 50, 22, 15, 51, 23],[2, 42, 14, 17, 43, 15],
          [5, 150, 120, 1, 151, 121],[9, 69, 43, 4, 70, 44],[17, 50, 22, 1, 51, 23],[2, 42, 14, 19, 43, 15],
          [3, 141, 113, 4, 142, 114],[3, 70, 44, 11, 71, 45],[17, 47, 21, 4, 48, 22],[9, 39, 13, 16, 40, 14],
          [3, 135, 107, 5, 136, 108],[3, 67, 41, 13, 68, 42],[15, 54, 24, 5, 55, 25],[15, 43, 15, 10, 44, 16],
          [4, 144, 116, 4, 145, 117],[17, 68, 42],[17, 50, 22, 6, 51, 23],[19, 46, 16, 6, 47, 17],
          [2, 139, 111, 7, 140, 112],[17, 74, 46],[7, 54, 24, 16, 55, 25],[34, 37, 13],
          [4, 151, 121, 5, 152, 122],[4, 75, 47, 14, 76, 48],[11, 54, 24, 14, 55, 25],[16, 45, 15, 14, 46, 16],
          [6, 147, 117, 4, 148, 118],[6, 73, 45, 14, 74, 46],[11, 54, 24, 16, 55, 25],[30, 46, 16, 2, 47, 17],
          [8, 132, 106, 4, 133, 107],[8, 75, 47, 13, 76, 48],[7, 54, 24, 22, 55, 25],[22, 45, 15, 13, 46, 16],
          [10, 142, 114, 2, 143, 115],[19, 74, 46, 4, 75, 47],[28, 50, 22, 6, 51, 23],[33, 46, 16, 4, 47, 17],
          [8, 152, 122, 4, 153, 123],[22, 73, 45, 3, 74, 46],[8, 53, 23, 26, 54, 24],[12, 45, 15, 28, 46, 16],
          [3, 147, 117, 10, 148, 118],[3, 73, 45, 23, 74, 46],[4, 54, 24, 31, 55, 25],[11, 45, 15, 31, 46, 16],
          [7, 146, 116, 7, 147, 117],[21, 73, 45, 7, 74, 46],[1, 53, 23, 37, 54, 24],[19, 45, 15, 26, 46, 16],
          [5, 145, 115, 10, 146, 116],[19, 75, 47, 10, 76, 48],[15, 54, 24, 25, 55, 25],[23, 45, 15, 25, 46, 16],
          [13, 145, 115, 3, 146, 116],[2, 74, 46, 29, 75, 47],[42, 54, 24, 1, 55, 25],[23, 45, 15, 28, 46, 16],
          [17, 145, 115],[10, 74, 46, 23, 75, 47],[10, 54, 24, 35, 55, 25],[19, 45, 15, 35, 46, 16],
          [17, 145, 115, 1, 146, 116],[14, 74, 46, 21, 75, 47],[29, 54, 24, 19, 55, 25],[11, 45, 15, 46, 46, 16],
          [13, 145, 115, 6, 146, 116],[14, 74, 46, 23, 75, 47],[44, 54, 24, 7, 55, 25],[59, 46, 16, 1, 47, 17],
          [12, 151, 121, 7, 152, 122],[12, 75, 47, 26, 76, 48],[39, 54, 24, 14, 55, 25],[22, 45, 15, 41, 46, 16],
          [6, 151, 121, 14, 152, 122],[6, 75, 47, 34, 76, 48],[46, 54, 24, 10, 55, 25],[2, 45, 15, 64, 46, 16],
          [17, 152, 122, 4, 153, 123],[29, 74, 46, 14, 75, 47],[49, 54, 24, 10, 55, 25],[24, 45, 15, 46, 46, 16],
          [4, 152, 122, 18, 153, 123],[13, 74, 46, 32, 75, 47],[48, 54, 24, 14, 55, 25],[42, 45, 15, 32, 46, 16],
          [20, 147, 117, 4, 148, 118],[40, 75, 47, 7, 76, 48],[43, 54, 24, 22, 55, 25],[10, 45, 15, 67, 46, 16],
          [19, 148, 118, 6, 149, 119],[18, 75, 47, 31, 76, 48],[34, 54, 24, 34, 55, 25],[20, 45, 15, 61, 46, 16]
        ],

        getRsBlockTable: function(typeNumber, errorCorrectionLevel) {
          switch(errorCorrectionLevel) {
            case QRErrorCorrectionLevel.L: return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 0];
            case QRErrorCorrectionLevel.M: return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 1];
            case QRErrorCorrectionLevel.Q: return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 2];
            case QRErrorCorrectionLevel.H: return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 3];
            default: return undefined;
          }
        }
      };

      var QRUtil = {
        getUTF8Length: function(s) {
          var len = 0;
          for (var i = 0; i < s.length; i++) {
            var c = s.charCodeAt(i);
            if (c < 0x80) len++;
            else if (c < 0x800) len += 2;
            else if (0xD800 <= c && c <= 0xDBFF) { len += 4; i++; }
            else len += 3;
          }
          return len;
        },
        writeUTF8: function(buffer, s) {
          for (var i = 0; i < s.length; i++) {
            var c = s.charCodeAt(i);
            if (c < 0x80) buffer.put(c, 8);
            else if (c < 0x800) {
              buffer.put(0xC0 | (c >>> 6), 8);
              buffer.put(0x80 | (c & 0x3F), 8);
            } else if (0xD800 <= c && c <= 0xDBFF) {
              var c2 = s.charCodeAt(++i);
              var cp = 0x10000 + (((c & 0x3FF) << 10) | (c2 & 0x3FF));
              buffer.put(0xF0 | (cp >>> 18), 8);
              buffer.put(0x80 | ((cp >>> 12) & 0x3F), 8);
              buffer.put(0x80 | ((cp >>> 6) & 0x3F), 8);
              buffer.put(0x80 | (cp & 0x3F), 8);
            } else {
              buffer.put(0xE0 | (c >>> 12), 8);
              buffer.put(0x80 | ((c >>> 6) & 0x3F), 8);
              buffer.put(0x80 | (c & 0x3F), 8);
            }
          }
        },
        getMask: function(maskPattern, i, j) {
          switch (maskPattern) {
            case 0: return (i + j) % 2 == 0;
            case 1: return i % 2 == 0;
            case 2: return j % 3 == 0;
            case 3: return (i + j) % 3 == 0;
            case 4: return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 == 0;
            case 5: return (i * j) % 2 + (i * j) % 3 == 0;
            case 6: return ((i * j) % 2 + (i * j) % 3) % 2 == 0;
            case 7: return ((i * j) % 3 + (i + j) % 2) == 0;
            default: throw new Error("bad maskPattern:" + maskPattern);
          }
        },
        getErrorCorrectPolynomial: function(errorCorrectLength) {
          var a = new qrPolynomial([1], 0);
          for (var i = 0; i < errorCorrectLength; i++) a = a.multiply(new qrPolynomial([1, QRMath.gexp(i)], 0));
          return a;
        },
        getLengthInBits: function(mode, type) {
          if (1 <= type && type < 10) return 8;
          if (type < 27) return 16;
          return 16;
        },
        G15: (1 << 10) | (1 << 8) | (1 << 5) | (1 << 4) | (1 << 2) | (1 << 1) | (1 << 0),
        G15_MASK: (1 << 14) | (1 << 12) | (1 << 10) | (1 << 4) | (1 << 1),
        getBCHDigit: function(data) { var digit = 0; while (data != 0) { digit++; data >>>= 1; } return digit; },
        getBCHTypeInfo: function(data) {
          var d = data << 10;
          while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15) >= 0) {
            d ^= (QRUtil.G15 << (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15)));
          }
          return ((data << 10) | d) ^ QRUtil.G15_MASK;
        }
      };

      function QRCode(typeNumber, errorCorrectionLevel) {
        var PAD0 = 0xEC;
        var PAD1 = 0x11;

        var _typeNumber = typeNumber;
        var _errorCorrectionLevel = QRErrorCorrectionLevel[errorCorrectionLevel];
        var _modules = null;
        var _moduleCount = 0;
        var _dataCache = null;
        var _dataList = [];

        var makeImpl = function(test, maskPattern) {
          _moduleCount = _typeNumber * 4 + 17;
          _modules = new Array(_moduleCount);

          for (var row = 0; row < _moduleCount; row++) {
            _modules[row] = new Array(_moduleCount);
            for (var col = 0; col < _moduleCount; col++) _modules[row][col] = null;
          }

          setupPositionProbePattern(0, 0);
          setupPositionProbePattern(_moduleCount - 7, 0);
          setupPositionProbePattern(0, _moduleCount - 7);
          setupTimingPattern();
          setupTypeInfo(test, maskPattern);

          if (_dataCache == null) _dataCache = createData(_typeNumber, _errorCorrectionLevel, _dataList);
          mapData(_dataCache, maskPattern);
        };

        var setupPositionProbePattern = function(row, col) {
          for (var r = -1; r <= 7; r++) {
            if (row + r <= -1 || _moduleCount <= row + r) continue;
            for (var c = -1; c <= 7; c++) {
              if (col + c <= -1 || _moduleCount <= col + c) continue;
              if ((0 <= r && r <= 6 && (c == 0 || c == 6))
                || (0 <= c && c <= 6 && (r == 0 || r == 6))
                || (2 <= r && r <= 4 && 2 <= c && c <= 4)) {
                _modules[row + r][col + c] = true;
              } else {
                _modules[row + r][col + c] = false;
              }
            }
          }
        };

        var setupTimingPattern = function() {
          for (var r = 8; r < _moduleCount - 8; r++) if (_modules[r][6] == null) _modules[r][6] = (r % 2 == 0);
          for (var c = 8; c < _moduleCount - 8; c++) if (_modules[6][c] == null) _modules[6][c] = (c % 2 == 0);
        };

        var setupTypeInfo = function(test, maskPattern) {
          var data = (_errorCorrectionLevel << 3) | maskPattern;
          var bits = QRUtil.getBCHTypeInfo(data);

          for (var i = 0; i < 15; i++) {
            var mod = (!test && ((bits >> i) & 1) == 1);
            if (i < 6) _modules[i][8] = mod;
            else if (i < 8) _modules[i + 1][8] = mod;
            else _modules[_moduleCount - 15 + i][8] = mod;
          }

          for (var i = 0; i < 15; i++) {
            var mod = (!test && ((bits >> i) & 1) == 1);
            if (i < 8) _modules[8][_moduleCount - i - 1] = mod;
            else if (i < 9) _modules[8][15 - i - 1 + 1] = mod;
            else _modules[8][15 - i - 1] = mod;
          }

          _modules[_moduleCount - 8][8] = (!test);
        };

        var mapData = function(data, maskPattern) {
          var inc = -1;
          var row = _moduleCount - 1;
          var bitIndex = 7;
          var byteIndex = 0;

          for (var col = _moduleCount - 1; col > 0; col -= 2) {
            if (col == 6) col--;
            while (true) {
              for (var c = 0; c < 2; c++) {
                if (_modules[row][col - c] == null) {
                  var dark = false;
                  if (byteIndex < data.length) dark = (((data[byteIndex] >>> bitIndex) & 1) == 1);
                  var mask = QRUtil.getMask(maskPattern, row, col - c);
                  if (mask) dark = !dark;
                  _modules[row][col - c] = dark;
                  bitIndex--;
                  if (bitIndex == -1) { byteIndex++; bitIndex = 7; }
                }
              }
              row += inc;
              if (row < 0 || _moduleCount <= row) { row -= inc; inc = -inc; break; }
            }
          }
        };

        var createData = function(typeNumber, errorCorrectionLevel, dataList) {
          var rsBlocks = QRRSBlock.getRSBlocks(typeNumber, errorCorrectionLevel);
          var buffer = new QRBitBuffer();

          for (var i = 0; i < dataList.length; i++) {
            var data = dataList[i];
            buffer.put(data.getMode(), 4);
            buffer.put(data.getLength(), QRUtil.getLengthInBits(data.getMode(), typeNumber));
            data.write(buffer);
          }

          var totalDataCount = 0;
          for (var i = 0; i < rsBlocks.length; i++) totalDataCount += rsBlocks[i].dataCount;

          if (buffer.getLengthInBits() > totalDataCount * 8) throw new Error("code length overflow");
          if (buffer.getLengthInBits() + 4 <= totalDataCount * 8) buffer.put(0, 4);
          while (buffer.getLengthInBits() % 8 != 0) buffer.putBit(false);

          while (true) {
            if (buffer.getLengthInBits() >= totalDataCount * 8) break;
            buffer.put(PAD0, 8);
            if (buffer.getLengthInBits() >= totalDataCount * 8) break;
            buffer.put(PAD1, 8);
          }

          return createBytes(buffer, rsBlocks);
        };

        var createBytes = function(buffer, rsBlocks) {
          var offset = 0;
          var maxDcCount = 0;
          var maxEcCount = 0;

          var dcdata = new Array(rsBlocks.length);
          var ecdata = new Array(rsBlocks.length);

          for (var r = 0; r < rsBlocks.length; r++) {
            var dcCount = rsBlocks[r].dataCount;
            var ecCount = rsBlocks[r].totalCount - dcCount;

            maxDcCount = Math.max(maxDcCount, dcCount);
            maxEcCount = Math.max(maxEcCount, ecCount);

            dcdata[r] = new Array(dcCount);
            for (var i = 0; i < dcdata[r].length; i++) dcdata[r][i] = 0xff & buffer.getBuffer()[i + offset];
            offset += dcCount;

            var rsPoly = QRUtil.getErrorCorrectPolynomial(ecCount);
            var rawPoly = new qrPolynomial(dcdata[r], rsPoly.getLength() - 1);
            var modPoly = rawPoly.mod(rsPoly);

            ecdata[r] = new Array(rsPoly.getLength() - 1);
            for (var i = 0; i < ecdata[r].length; i++) {
              var modIndex = i + modPoly.getLength() - ecdata[r].length;
              ecdata[r][i] = (modIndex >= 0) ? modPoly.get(modIndex) : 0;
            }
          }

          var totalCodeCount = 0;
          for (var i = 0; i < rsBlocks.length; i++) totalCodeCount += rsBlocks[i].totalCount;

          var data = new Array(totalCodeCount);
          var index = 0;

          for (var i = 0; i < maxDcCount; i++) for (var r = 0; r < rsBlocks.length; r++) if (i < dcdata[r].length) data[index++] = dcdata[r][i];
          for (var i = 0; i < maxEcCount; i++) for (var r = 0; r < rsBlocks.length; r++) if (i < ecdata[r].length) data[index++] = ecdata[r][i];

          return data;
        };

        this.addData = function(data) { _dataCache = null; _dataList.push(new QR8BitByte(data)); };
        this.isDark = function(row, col) { return (_modules[row][col] != null) ? _modules[row][col] : false; };
        this.getModuleCount = function() { return _moduleCount; };

        this.make = function() {
          if (_typeNumber < 1) {
            _typeNumber = 1;
            for (; _typeNumber < 40; _typeNumber++) {
              var rsBlocks = QRRSBlock.getRSBlocks(_typeNumber, _errorCorrectionLevel);
              var buffer = new QRBitBuffer();
              for (var i = 0; i < _dataList.length; i++) {
                var data = _dataList[i];
                buffer.put(data.getMode(), 4);
                buffer.put(data.getLength(), QRUtil.getLengthInBits(data.getMode(), _typeNumber));
                data.write(buffer);
              }
              var totalDataCount = 0;
              for (var i = 0; i < rsBlocks.length; i++) totalDataCount += rsBlocks[i].dataCount;
              if (buffer.getLengthInBits() <= totalDataCount * 8) break;
            }
          }
          makeImpl.call(this, false, getBestMaskPattern.call(this));
        };

        var getBestMaskPattern = function() {
          var minLostPoint = 0;
          var pattern = 0;
          for (var i = 0; i < 8; i++) {
            makeImpl(true, i);
            var lostPoint = 0; /* minimal (not needed for our stable output) */
            if (i == 0 || minLostPoint > lostPoint) { minLostPoint = lostPoint; pattern = i; }
          }
          return pattern;
        };
      }

      global.qrcode = function(typeNumber, errorCorrectionLevel){
        if (typeNumber === 0) typeNumber = -1;
        return new QRCode(typeNumber, errorCorrectionLevel);
      };
      global.QRErrorCorrectionLevel = QRErrorCorrectionLevel;

    })(window);
  </script>

  <script>
    (function(){
      "use strict";

      const LS_KEY  = "fsa_rollup_lb_01_promotor_v1";
      const LS_LANG = "fsa_lang_rollup_lb";
      const LS_QR_WEBSITE = "fsa_rollup_lb_01_qr_website";
      const LS_QR_PNG = "fsa_rollup_lb_01_qr_png";

      const els = {
        headline: document.getElementById("headline"),
        subline: document.getElementById("subline"),
        firstName: document.getElementById("firstName"),
        lastName: document.getElementById("lastName"),
        role: document.getElementById("role"),
        mobile: document.getElementById("mobile"),
        email: document.getElementById("email"),
        website: document.getElementById("website"),

        pHeadline: document.getElementById("pHeadline"),
        pSubline: document.getElementById("pSubline"),
        pName: document.getElementById("pName"),
        pRole: document.getElementById("pRole"),
        pMobile: document.getElementById("pMobile"),
        pEmail: document.getElementById("pEmail"),
        pWebsite: document.getElementById("pWebsite"),

        qrOut: document.getElementById("qrOut"),
        qrStatusLine: document.getElementById("qrStatusLine"),

        btnPrint: document.getElementById("btnPrint"),
        btnClear: document.getElementById("btnClear"),
        btnCopy: document.getElementById("btnCopy"),
        btnDE: document.getElementById("btnDE"),
        btnEN: document.getElementById("btnEN"),

        brandMark: document.getElementById("brandMark"),
        brandLogo: document.getElementById("brandLogo"),

        previewBox: document.getElementById("previewBox"),
      };

      const i18n = {
        de: {
          h1:"Roll-Up Generator – LiquidityBooster (01)",
          sub:"Eingaben → Vorschau → QR → Drucken / als PDF speichern. (85×200 cm)",
          formTitle:"Eingabefelder",
          headlineLabel:"Headline (oben)",
          headlinePH:"Eine Aufgabe. Ein System. Planbares Einkommen.",
          sublineLabel:"Unterzeile",
          sublinePH:"Du empfiehlst – wir liefern Produkt, Prozess und Tools.",
          firstNameLabel:"Vorname",
          lastNameLabel:"Nachname",
          roleLabel:"Rolle / Status",
          rolePH:"Selbstständiger Promotor (m/w/d)",
          mobileLabel:"Telefon",
          emailLabel:"E-Mail",
          websiteLabel:"Webadresse (für QR)",
          previewTitle:"Vorschau",
          printBtn:"Drucken / als PDF speichern",
          clearBtn:"Felder leeren",
          copyBtn:"Text kopieren",
          hint:"Tipp: Nach dem Klick auf „Drucken / als PDF speichern“ im Druckdialog „Als PDF sichern“ wählen.",
          privacy:"Hinweis: Speicherung erfolgt lokal im Browser (LocalStorage). Keine Übertragung.",
          copied:"Kopiert.",
          copyFail:"Kopieren nicht möglich.",
          confirmClear:"Wirklich alle Felder leeren?",
          qrLabel:"Jetzt scannen",
          qrNoUrl:"Webadresse fehlt – QR bleibt leer.",
          qrOk:"QR aktualisiert.",
          qrErr:"QR Fehler (URL zu lang oder ungültig).",
          b1t:"Einfach starten",
          b1x:"Klare Schritte – ohne Umwege.",
          b2t:"Wiederholbar",
          b2x:"Standards statt Zufall.",
          b3t:"Skalierbar",
          b3x:"Team-Option möglich."
        },
        en: {
          h1:"Roll-Up Generator – LiquidityBooster (01)",
          sub:"Inputs → Preview → QR → Print / save as PDF. (85×200 cm)",
          formTitle:"Input fields",
          headlineLabel:"Headline (top)",
          headlinePH:"One task. One system. Predictable income.",
          sublineLabel:"Subline",
          sublinePH:"You recommend – we deliver product, process and tools.",
          firstNameLabel:"First name",
          lastNameLabel:"Last name",
          roleLabel:"Role / status",
          rolePH:"Independent promoter (m/f/d)",
          mobileLabel:"Phone",
          emailLabel:"Email",
          websiteLabel:"Website (for QR)",
          previewTitle:"Preview",
          printBtn:"Print / save as PDF",
          clearBtn:"Clear fields",
          copyBtn:"Copy text",
          hint:"Tip: After clicking “Print / save as PDF”, choose “Save as PDF” in the print dialog.",
          privacy:"Note: Saved locally in your browser (LocalStorage). No transmission.",
          copied:"Copied.",
          copyFail:"Copy not available.",
          confirmClear:"Really clear all fields?",
          qrLabel:"Scan now",
          qrNoUrl:"Website missing – QR stays empty.",
          qrOk:"QR updated.",
          qrErr:"QR error (URL too long or invalid).",
          b1t:"Easy start",
          b1x:"Clear steps – no detours.",
          b2t:"Repeatable",
          b2x:"Standards instead of luck.",
          b3t:"Scalable",
          b3x:"Team option possible."
        }
      };

      function safe(v){ return (v||"").toString().trim(); }

      function normalizeWebsite(url){
        let v = safe(url);
        if(!v) return "";
        v = v.replace(/\s+/g,"");
        if(/^https?:\/\//i.test(v)) return v;
        return "https://" + v;
      }

      function setText(node, value, placeholder){
        const v = safe(value);
        if(v){ node.textContent = v; node.classList.remove("empty"); }
        else { node.textContent = placeholder; node.classList.add("empty"); }
      }

      function getLang(){
        const v = (localStorage.getItem(LS_LANG) || "de").toLowerCase();
        return (v === "en") ? "en" : "de";
      }

      function setLang(lang){
        localStorage.setItem(LS_LANG, (lang==="en")?"en":"de");
        applyI18n();
        renderAll();
      }

      function applyI18n(){
        const lang = getLang();
        const dict = i18n[lang];
        document.documentElement.lang = lang;

        document.querySelectorAll("[data-i18n]").forEach(n=>{
          const key = n.getAttribute("data-i18n");
          if(dict[key]) n.textContent = dict[key];
        });
        document.querySelectorAll("[data-i18n-ph]").forEach(n=>{
          const key = n.getAttribute("data-i18n-ph");
          if(dict[key]) n.setAttribute("placeholder", dict[key]);
        });

        els.btnDE.style.opacity = (lang === "de") ? "1" : ".55";
        els.btnEN.style.opacity = (lang === "en") ? "1" : ".55";
      }

      function load(){
        try{
          const raw = localStorage.getItem(LS_KEY);
          if(raw){
            const data = JSON.parse(raw);
            if(data && typeof data === "object"){
              els.headline.value  = data.headline || "";
              els.subline.value   = data.subline || "";
              els.firstName.value = data.firstName || "";
              els.lastName.value  = data.lastName || "";
              els.role.value      = data.role || "";
              els.mobile.value    = data.mobile || "";
              els.email.value     = data.email || "";
              els.website.value   = data.website || "";
            }
          }
        }catch(e){}

        const w = localStorage.getItem(LS_QR_WEBSITE) || "";
        if(w && !els.website.value) els.website.value = w;
      }

      function save(){
        const data = {
          headline: safe(els.headline.value),
          subline: safe(els.subline.value),
          firstName: safe(els.firstName.value),
          lastName: safe(els.lastName.value),
          role: safe(els.role.value),
          mobile: safe(els.mobile.value),
          email: safe(els.email.value),
          website: safe(els.website.value),
        };
        try{ localStorage.setItem(LS_KEY, JSON.stringify(data)); }catch(e){}
      }

      function makeQrPngDataUrl(url, targetPx){
        const qr = qrcode(0, 'Q');
        qr.addData(url);
        qr.make();

        const count = qr.getModuleCount();
        const quiet = 4;
        const dim = count + quiet * 2;

        const scale = Math.max(1, Math.floor(targetPx / dim));
        const size = dim * scale;

        const canvas = document.createElement("canvas");
        canvas.width = size;
        canvas.height = size;
        const ctx = canvas.getContext("2d", { alpha:false });

        ctx.fillStyle = "#fff";
        ctx.fillRect(0,0,size,size);

        ctx.fillStyle = "#000";
        for(let r=0; r<count; r++){
          for(let c=0; c<count; c++){
            if(qr.isDark(r,c)){
              const x = (c + quiet) * scale;
              const y = (r + quiet) * scale;
              ctx.fillRect(x,y,scale,scale);
            }
          }
        }
        return canvas.toDataURL("image/png");
      }

      function setQrStatus(msg){ els.qrStatusLine.textContent = msg || ""; }

      function renderQr(){
        const t = i18n[getLang()];
        const raw = safe(els.website.value);
        if(!raw){
          els.qrOut.innerHTML = "";
          localStorage.removeItem(LS_QR_PNG);
          setQrStatus(t.qrNoUrl);
          return;
        }

        const url = normalizeWebsite(raw);

        try{
          const png = makeQrPngDataUrl(url, 1600);
          els.qrOut.innerHTML = `<img alt="QR" src="${png}">`;
          localStorage.setItem(LS_QR_WEBSITE, raw);
          localStorage.setItem(LS_QR_PNG, png);
          setQrStatus(t.qrOk);
        }catch(e){
          els.qrOut.innerHTML = "";
          setQrStatus(t.qrErr + (e && e.message ? (" (" + e.message + ")") : ""));
        }
      }

      function renderContent(){
        const t = i18n[getLang()];

        const headline = safe(els.headline.value) || t.headlinePH;
        const subline  = safe(els.subline.value) || t.sublinePH;

        const first = safe(els.firstName.value);
        const last  = safe(els.lastName.value);
        const fullName = (first + " " + last).trim();

        const role  = safe(els.role.value) || t.rolePH;
        const mobile = safe(els.mobile.value);
        const email  = safe(els.email.value);
        const website = safe(els.website.value);

        setText(els.pHeadline, headline, "—");
        setText(els.pSubline, subline, "—");

        setText(els.pName, fullName, "—");
        setText(els.pRole, role, "—");
        setText(els.pMobile, mobile ? ("Tel: " + mobile) : "", "—");
        setText(els.pEmail,  email  ? ("E-Mail: " + email) : "", "—");
        setText(els.pWebsite, website ? normalizeWebsite(website) : "", "—");

        save();
      }

      /* FIX: mm -> px stabile Berechnung (iPad/Safari) + Fit width & height */
      function updatePreviewScale(){
        const box = els.previewBox;
        if(!box) return;

        const MM_TO_PX = 96 / 25.4;

        const rollWmm = 850;
        const rollHmm = 2000;

        const naturalW = rollWmm * MM_TO_PX;
        const naturalH = rollHmm * MM_TO_PX;

        const pad = 24; // preview padding grob
        const availableW = Math.max(260, box.clientWidth - pad);
        const availableH = Math.max(260, box.clientHeight - pad);

        const scaleW = availableW / naturalW;
        const scaleH = availableH / naturalH;

        const scale = Math.max(0.02, Math.min(1, scaleW, scaleH));

        document.documentElement.style.setProperty("--preview-scale", String(scale));
      }

      function renderAll(){
        renderContent();
        renderQr();
        updatePreviewScale();
      }

      function wire(){
        if(els.brandLogo && els.brandMark){
          els.brandLogo.addEventListener("error", ()=>{ els.brandMark.classList.add("isFallback"); });
          els.brandLogo.addEventListener("load",  ()=>{ els.brandMark.classList.remove("isFallback"); });
        }

        ["headline","subline","firstName","lastName","role","mobile","email","website"].forEach(id=>{
          els[id].addEventListener("input", renderAll);
          els[id].addEventListener("change", renderAll);
        });

        els.btnPrint.addEventListener("click", ()=>{ renderAll(); window.print(); });

        els.btnClear.addEventListener("click", ()=>{
          const t = i18n[getLang()];
          if(!confirm(t.confirmClear)) return;

          els.headline.value = "";
          els.subline.value = "";
          els.firstName.value = "";
          els.lastName.value = "";
          els.role.value = "";
          els.mobile.value = "";
          els.email.value = "";
          els.website.value = "";

          try{ localStorage.removeItem(LS_KEY); }catch(e){}
          try{ localStorage.removeItem(LS_QR_WEBSITE); }catch(e){}
          try{ localStorage.removeItem(LS_QR_PNG); }catch(e){}

          renderAll();
          setQrStatus("");
        });

        els.btnCopy.addEventListener("click", async ()=>{
          const t = i18n[getLang()];

          const lines = [
            safe(els.firstName.value) || safe(els.lastName.value) ? ((safe(els.firstName.value)+" "+safe(els.lastName.value)).trim()) : "",
            safe(els.role.value),
            safe(els.mobile.value) ? ("Tel: " + safe(els.mobile.value)) : "",
            safe(els.email.value) ? ("E-Mail: " + safe(els.email.value)) : "",
            safe(els.website.value) ? normalizeWebsite(safe(els.website.value)) : "",
          ].filter(Boolean);

          const text = lines.join("\n");
          try{
            if(navigator.clipboard && navigator.clipboard.writeText){
              await navigator.clipboard.writeText(text);
              els.btnCopy.textContent = t.copied;
              setTimeout(()=>{ els.btnCopy.textContent = t.copyBtn; }, 900);
            }else{
              throw new Error("no clipboard");
            }
          }catch(e){
            alert(t.copyFail);
          }
        });

        els.btnDE.addEventListener("click", ()=>{ setLang("de"); setQrStatus(""); });
        els.btnEN.addEventListener("click", ()=>{ setLang("en"); setQrStatus(""); });

        window.addEventListener("resize", updatePreviewScale);

        // iOS: nach Layout einmal sicher fitten
        setTimeout(updatePreviewScale, 0);
        setTimeout(updatePreviewScale, 150);
      }

      load();
      applyI18n();
      wire();
      renderAll();
    })();
  </script>
</body>
</html>
