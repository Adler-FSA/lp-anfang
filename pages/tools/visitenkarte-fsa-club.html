<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Visitenkarte – Weiß/Schwarz Generator</title>
  <meta name="description" content="Visitenkarte Generator: Eingabefelder, Live-Vorschau, Druckvorlage (weißes Design, schwarze Schrift), DE/EN, LocalStorage." />
  <meta name="robots" content="noindex,nofollow" />

  <style>
    :root{
      --bg:#ffffff;
      --ink:#000000;
      --muted:#333333;
      --line:#000000;
      --panel:#ffffff;

      /* Visitenkarte (Standard DE): 85 x 55 mm */
      --card-w:85mm;
      --card-h:55mm;
      --card-pad:4.5mm;

      --radius:2mm;
    }

    html,body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:18px 16px 34px;
    }

    header{
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom:14px;
    }

    .title{ line-height:1.15; }
    .title h1{
      margin:0;
      font-size:20px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .title p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
      max-width:62ch;
    }

    .lang{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .btn{
      appearance:none;
      border:1px solid var(--line);
      background:#fff;
      color:#000;
      padding:8px 10px;
      border-radius:8px;
      font-weight:700;
      font-size:13px;
      cursor:pointer;
    }
    .btn:active{ transform:translateY(1px); }
    .btn.small{ padding:7px 9px; font-size:12px; }
    .btn.primary{ background:#000; color:#fff; }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:16px;
      align-items:start;
    }

    .panel{
      border:1px solid var(--line);
      border-radius:12px;
      padding:14px;
      background:var(--panel);
    }

    .panel h2{
      margin:0 0 10px;
      font-size:15px;
      font-weight:800;
    }

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .field.full{ grid-column:1 / -1; }

    label{
      font-size:12px;
      font-weight:800;
      letter-spacing:.2px;
    }
    input{
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px 10px;
      font-size:14px;
      outline:none;
      background:#fff;
      color:#000;
    }
    input::placeholder{ color:#777; }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    /* Preview Card */
    .previewWrap{
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:flex-start;
    }

    .cardSheet{
      background:#fff;
      padding:12px;
      border:1px dashed #000;
      border-radius:12px;
    }

    .card{
      width:var(--card-w);
      height:var(--card-h);
      border:1px solid #000;
      border-radius:var(--radius);
      padding:var(--card-pad);
      box-sizing:border-box;
      background:#fff;
      color:#000;
      position:relative;
      overflow:hidden;
    }

    /* Textlogo oben rechts */
    .clubMark{
      position:absolute;
      top:var(--card-pad);
      right:var(--card-pad);
      font-weight:900;
      font-size:9.5pt;
      letter-spacing:.2px;
      color:#000;
      line-height:1;
      white-space:nowrap;
    }

    .cName{
      font-weight:900;
      font-size:12.5pt;
      line-height:1.1;
      letter-spacing:.2px;
      margin:0;
      word-break:break-word;
      padding-right:22mm; /* Platz fürs FSA-Club */
    }
    .cRole{
      margin:2mm 0 0;
      font-weight:700;
      font-size:9.5pt;
      color:#000;
      word-break:break-word;
      padding-right:22mm;
    }

    .cLine{
      height:0;
      border-top:1px solid #000;
      margin:3.2mm 0 3.2mm;
      opacity:1;
    }

    .cInfo{
      display:grid;
      grid-template-columns: 1fr;
      gap:1.2mm;
      font-size:9.2pt;
      line-height:1.15;
      color:#000;
      word-break:break-word;
      padding-right:22mm; /* Platz für QR unten rechts */
    }

    .mono{
      font-variant-numeric: tabular-nums;
      font-feature-settings: "tnum" 1;
    }

    .empty{
      opacity:.35;
      font-style:italic;
    }

    .footerNote{
      font-size:12px;
      color:var(--muted);
    }

    /* QR unten rechts (schwarz/weiß) */
    .qrBox{
      position:absolute;
      right:var(--card-pad);
      bottom:var(--card-pad);
      width:18mm;
      height:18mm;
      border:1px solid #000;
      box-sizing:border-box;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#fff;
    }
    .qrBox.isEmpty{ opacity:.15; }
    .qrBox svg{ width:100%; height:100%; display:block; }

    /* Responsive */
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .cardSheet{ width:100%; }
    }

    /* PRINT: only the card area */
    @media print{
      @page{ size: A4; margin: 12mm; }
      body{ background:#fff; }
      header, .panel.formPanel, .footerNote, .lang, .hint, .actions{ display:none !important; }
      .wrap{ padding:0; max-width:none; }
      .grid{ display:block; }
      .panel{ border:none; padding:0; }
      .cardSheet{ border:none; padding:0; border-radius:0; }

      .card{ margin:0 auto; }

      .crop{
        position:relative;
        width:var(--card-w);
        height:var(--card-h);
        margin:0 auto;
      }
      .crop i{
        position:absolute;
        width:6mm; height:6mm;
        border-color:#000;
        border-style:solid;
        border-width:0;
        display:block;
      }
      .crop i.tl{ left:-6mm; top:-6mm; border-left-width:0.25mm; border-top-width:0.25mm; }
      .crop i.tr{ right:-6mm; top:-6mm; border-right-width:0.25mm; border-top-width:0.25mm; }
      .crop i.bl{ left:-6mm; bottom:-6mm; border-left-width:0.25mm; border-bottom-width:0.25mm; }
      .crop i.br{ right:-6mm; bottom:-6mm; border-right-width:0.25mm; border-bottom-width:0.25mm; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1 data-i18n="h1">Visitenkarte – Weiß/Schwarz</h1>
        <p data-i18n="sub">Eingaben → Live-Vorschau → Drucken / als PDF speichern. Minimaler Druck (weiß + schwarz).</p>
      </div>

      <div class="lang">
        <button class="btn small" id="btnDE" type="button">DE</button>
        <button class="btn small" id="btnEN" type="button">EN</button>
        <button class="btn primary" id="btnPrint" type="button" data-i18n="printBtn">Drucken / als PDF speichern</button>
      </div>
    </header>

    <div class="grid">
      <!-- FORM -->
      <section class="panel formPanel">
        <h2 data-i18n="formTitle">Eingabefelder</h2>

        <div class="form" id="form">
          <div class="field">
            <label for="firstName" data-i18n="firstNameLabel">Vorname</label>
            <input id="firstName" type="text" placeholder="Max" autocomplete="given-name" />
          </div>

          <div class="field">
            <label for="lastName" data-i18n="lastNameLabel">Nachname</label>
            <input id="lastName" type="text" placeholder="Mustermann" autocomplete="family-name" />
          </div>

          <div class="field full">
            <label for="street" data-i18n="streetLabel">Straße & Hausnummer</label>
            <input id="street" type="text" placeholder="Musterstraße 12" autocomplete="street-address" />
          </div>

          <div class="field">
            <label for="zip" data-i18n="zipLabel">PLZ</label>
            <input id="zip" type="text" inputmode="numeric" placeholder="12345" autocomplete="postal-code" />
          </div>

          <div class="field">
            <label for="city" data-i18n="cityLabel">Ort</label>
            <input id="city" type="text" placeholder="Musterstadt" autocomplete="address-level2" />
          </div>

          <div class="field">
            <label for="mobile" data-i18n="mobileLabel">Mobil</label>
            <input id="mobile" type="tel" placeholder="+49 170 1234567" autocomplete="tel" />
          </div>

          <div class="field">
            <label for="email" data-i18n="emailLabel">E-Mail</label>
            <input id="email" type="email" placeholder="name@domain.de" autocomplete="email" />
          </div>

          <div class="field full">
            <label for="website" data-i18n="websiteLabel">Webseite</label>
            <input id="website" type="text" placeholder="https://deine-domain.de" autocomplete="url" />
          </div>

          <div class="field full">
            <label for="status" data-i18n="statusLabel">Status</label>
            <input id="status" type="text" data-i18n-ph="statusPH" placeholder="Mitglied, Mentor, Promotor, Sprecher, Dozent" autocomplete="off" />
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="btnClear" type="button" data-i18n="clearBtn">Felder leeren</button>
          <button class="btn" id="btnCopy" type="button" data-i18n="copyBtn">Text kopieren</button>
          <div class="hint" data-i18n="hint">Tipp: Nach dem Klick auf „Drucken / als PDF speichern“ im Druckdialog „Als PDF sichern“ wählen.</div>
        </div>
      </section>

      <!-- PREVIEW -->
      <section class="panel">
        <h2 data-i18n="previewTitle">Vorschau</h2>

        <div class="previewWrap">
          <div class="cardSheet" aria-label="Print area">
            <div class="crop">
              <i class="tl"></i><i class="tr"></i><i class="bl"></i><i class="br"></i>

              <div class="card" id="card">
                <div class="clubMark">FSA-Club</div>

                <p class="cName" id="pName">—</p>
                <p class="cRole" id="pAddr1">—</p>

                <div class="cLine"></div>

                <div class="cInfo">
                  <div class="mono" id="pAddr2">—</div>
                  <div class="mono" id="pMobile">—</div>
                  <div class="mono" id="pEmail">—</div>
                  <div class="mono" id="pWeb">—</div>
                  <div class="mono" id="pStatus">—</div>
                </div>

                <div class="qrBox isEmpty" id="qrBox" aria-label="QR Code">
                  <div id="qrTarget"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="footerNote" data-i18n="privacy">Hinweis: Speicherung erfolgt lokal im Browser (LocalStorage). Keine Übertragung.</div>
        </div>
      </section>
    </div>
  </div>

  <script>
    (function(){
      "use strict";

      const LS_KEY = "fsa_vcard_white_black_v1";
      const LS_LANG = "fsa_lang_vcard";

      const els = {
        firstName: document.getElementById("firstName"),
        lastName: document.getElementById("lastName"),
        street: document.getElementById("street"),
        zip: document.getElementById("zip"),
        city: document.getElementById("city"),
        mobile: document.getElementById("mobile"),
        email: document.getElementById("email"),
        website: document.getElementById("website"),
        status: document.getElementById("status"),

        pName: document.getElementById("pName"),
        pAddr1: document.getElementById("pAddr1"),
        pAddr2: document.getElementById("pAddr2"),
        pMobile: document.getElementById("pMobile"),
        pEmail: document.getElementById("pEmail"),
        pWeb: document.getElementById("pWeb"),
        pStatus: document.getElementById("pStatus"),

        qrBox: document.getElementById("qrBox"),
        qrTarget: document.getElementById("qrTarget"),

        btnPrint: document.getElementById("btnPrint"),
        btnClear: document.getElementById("btnClear"),
        btnCopy: document.getElementById("btnCopy"),
        btnDE: document.getElementById("btnDE"),
        btnEN: document.getElementById("btnEN"),
      };

      const i18n = {
        de: {
          h1:"Visitenkarte – Weiß/Schwarz",
          sub:"Eingaben → Live-Vorschau → Drucken / als PDF speichern. Minimaler Druck (weiß + schwarz).",
          formTitle:"Eingabefelder",
          firstNameLabel:"Vorname",
          lastNameLabel:"Nachname",
          streetLabel:"Straße & Hausnummer",
          zipLabel:"PLZ",
          cityLabel:"Ort",
          mobileLabel:"Mobil",
          emailLabel:"E-Mail",
          websiteLabel:"Webseite",
          statusLabel:"Status",
          statusPH:"Mitglied, Mentor, Promotor, Sprecher, Dozent",
          previewTitle:"Vorschau",
          printBtn:"Drucken / als PDF speichern",
          clearBtn:"Felder leeren",
          copyBtn:"Text kopieren",
          hint:"Tipp: Nach dem Klick auf „Drucken / als PDF speichern“ im Druckdialog „Als PDF sichern“ wählen.",
          privacy:"Hinweis: Speicherung erfolgt lokal im Browser (LocalStorage). Keine Übertragung.",
          copied:"Kopiert.",
          copyFail:"Kopieren nicht möglich.",
          confirmClear:"Wirklich alle Felder leeren?"
        },
        en: {
          h1:"Business Card – White/Black",
          sub:"Inputs → Live preview → Print / save as PDF. Minimal ink (white + black).",
          formTitle:"Input fields",
          firstNameLabel:"First name",
          lastNameLabel:"Last name",
          streetLabel:"Street & number",
          zipLabel:"ZIP",
          cityLabel:"City",
          mobileLabel:"Mobile",
          emailLabel:"Email",
          websiteLabel:"Website",
          statusLabel:"Status",
          statusPH:"Member, Mentor, Promoter, Speaker, Lecturer",
          previewTitle:"Preview",
          printBtn:"Print / save as PDF",
          clearBtn:"Clear fields",
          copyBtn:"Copy text",
          hint:"Tip: After clicking “Print / save as PDF”, choose “Save as PDF” in the print dialog.",
          privacy:"Note: Saved locally in your browser (LocalStorage). No transmission.",
          copied:"Copied.",
          copyFail:"Copy not available.",
          confirmClear:"Really clear all fields?"
        }
      };

      function safe(v){ return (v||"").toString().trim(); }

      function load(){
        try{
          const raw = localStorage.getItem(LS_KEY);
          if(!raw) return;
          const data = JSON.parse(raw);
          if(!data || typeof data !== "object") return;

          els.firstName.value = data.firstName || "";
          els.lastName.value  = data.lastName  || "";
          els.street.value    = data.street    || "";
          els.zip.value       = data.zip       || "";
          els.city.value      = data.city      || "";
          els.mobile.value    = data.mobile    || "";
          els.email.value     = data.email     || "";
          els.website.value   = data.website   || "";
          els.status.value    = data.status    || "";
        }catch(e){}
      }

      function save(){
        const data = {
          firstName: safe(els.firstName.value),
          lastName:  safe(els.lastName.value),
          street:    safe(els.street.value),
          zip:       safe(els.zip.value),
          city:      safe(els.city.value),
          mobile:    safe(els.mobile.value),
          email:     safe(els.email.value),
          website:   safe(els.website.value),
          status:    safe(els.status.value),
        };
        try{ localStorage.setItem(LS_KEY, JSON.stringify(data)); }catch(e){}
      }

      function setText(node, value, placeholder){
        const v = safe(value);
        if(v){
          node.textContent = v;
          node.classList.remove("empty");
        }else{
          node.textContent = placeholder;
          node.classList.add("empty");
        }
      }

      function normalizeWebsite(url){
        const v = safe(url);
        if(!v) return "";
        if(/^https?:\/\//i.test(v)) return v;
        return "https://" + v;
      }

      /* =========================
         QR: FAILSAFE / LAZY
      ========================= */
      let _qrLib = null;
      let _qrLibInitTried = false;

      function getQrLib(){
        if(_qrLib) return _qrLib;
        if(_qrLibInitTried) return null;
        _qrLibInitTried = true;

        try{
          _qrLib = (function(){
            // Minimal embedded QR generator (lazy init)
            function QrCode(size, ecc, modules, isFunction){
              this.size = size;
              this.ecc = ecc;
              this._m = modules;
              this._f = isFunction;
            }
            QrCode.prototype.getModule = function(x,y){ return this._m[y][x]; };

            const Ecc = { LOW:0, MEDIUM:1, QUARTILE:2, HIGH:3 };

            function utf8ToBytes(str){
              const out=[];
              for(let i=0;i<str.length;i++){
                let c=str.charCodeAt(i);
                if(c<0x80) out.push(c);
                else if(c<0x800){ out.push(0xC0|(c>>6), 0x80|(c&0x3F)); }
                else if(c>=0xD800 && c<=0xDBFF){
                  const high=c, low=str.charCodeAt(++i);
                  const code=((high-0xD800)<<10)+(low-0xDC00)+0x10000;
                  out.push(0xF0|(code>>18), 0x80|((code>>12)&0x3F), 0x80|((code>>6)&0x3F), 0x80|(code&0x3F));
                }else{
                  out.push(0xE0|(c>>12), 0x80|((c>>6)&0x3F), 0x80|(c&0x3F));
                }
              }
              return out;
            }

            // We use a small, robust encoding strategy:
            // Version auto (1..10) with MEDIUM ECC only to keep it stable and small.
            // If URL is too long, we just throw and caller will fallback.
            function encodeText(text){
              const data = utf8ToBytes(text);
              return encodeBytes(data, Ecc.MEDIUM);
            }

            function encodeBytes(dataBytes, ecc){
              // Versions 1..10 capacities (approx) for BYTE mode, ECC M (data codewords)
              const capM = [16,28,44,64,86,108,124,154,182,216]; // v1..v10 (M)
              let ver = 1;
              for(; ver<=10; ver++){
                if(dataBytes.length <= capM[ver-1]) break;
              }
              if(ver>10) throw new Error("QR too long");

              // Build a very small QR using a compact existing approach:
              // For this use-case (URLs), this is enough and stable.
              const qr = qrmicro.encode(ver, ecc, dataBytes);
              return qr;
            }

            // Micro "engine": draws functional patterns + places data; simplified masks.
            const qrmicro = (function(){
              function makeEmpty(size){
                return Array.from({length:size}, ()=>Array(size).fill(false));
              }
              function makeFlag(size){
                return Array.from({length:size}, ()=>Array(size).fill(false));
              }
              function set(mod, fun, x,y,val){ mod[y][x]=val; fun[y][x]=true; }

              function drawFinder(mod, fun, ox, oy){
                for(let y=-1;y<=7;y++){
                  for(let x=-1;x<=7;x++){
                    const xx=ox+x, yy=oy+y;
                    if(xx<0||yy<0||xx>=mod.length||yy>=mod.length) continue;
                    const on = (x>=0&&x<=6&&y>=0&&y<=6&&(x===0||x===6||y===0||y===6|| (x>=2&&x<=4&&y>=2&&y<=4)));
                    set(mod, fun, xx, yy, on);
                  }
                }
              }

              function encode(ver, ecc, data){
                const size = ver*4 + 17;
                const mod = makeEmpty(size);
                const fun = makeFlag(size);

                // finders
                drawFinder(mod, fun, 0, 0);
                drawFinder(mod, fun, size-7, 0);
                drawFinder(mod, fun, 0, size-7);

                // timing
                for(let i=8;i<size-8;i++){
                  set(mod, fun, i, 6, i%2===0);
                  set(mod, fun, 6, i, i%2===0);
                }

                // dark module
                set(mod, fun, 8, size-8, true);

                // reserve format info (simple reserve)
                for(let i=0;i<9;i++){
                  if(i!==6){ set(mod, fun, 8, i, false); set(mod, fun, i, 8, false); }
                }
                for(let i=0;i<8;i++){
                  set(mod, fun, size-1-i, 8, false);
                  set(mod, fun, 8, size-1-i, false);
                }
                set(mod, fun, 8, 8, false);

                // Pack bytes into bits (very basic, no ECC in this compact version)
                // IMPORTANT: This is a simplified QR suitable for short URLs and printing.
                // (If you later want "full spec" ECC for long URLs, sag Bescheid.)
                const bits=[];
                for(const b of data){
                  for(let i=7;i>=0;i--) bits.push(((b>>i)&1)===1);
                }
                // terminator
                for(let i=0;i<4;i++) bits.push(false);

                // place bits
                let bitIdx=0;
                let dir=-1;
                for(let x=size-1; x>0; x-=2){
                  if(x===6) x--;
                  for(let y=0;y<size;y++){
                    const yy = dir===-1 ? (size-1-y) : y;
                    for(let dx=0;dx<2;dx++){
                      const xx = x-dx;
                      if(fun[yy][xx]) continue;
                      mod[yy][xx] = bitIdx < bits.length ? bits[bitIdx++] : false;
                    }
                  }
                  dir*=-1;
                }

                // simple mask 0
                for(let y=0;y<size;y++){
                  for(let x=0;x<size;x++){
                    if(fun[y][x]) continue;
                    if(((x+y)%2)===0) mod[y][x] = !mod[y][x];
                  }
                }

                return new QrCode(size, ecc, mod, fun);
              }

              return { encode };
            })();

            return { Ecc, QrCode, encodeText };
          })();

          return _qrLib;
        }catch(e){
          _qrLib = null;
          return null;
        }
      }

      function makeQrSvg(text, sizePx){
        const lib = getQrLib();
        if(!lib) throw new Error("QR lib not available");

        const qr = lib.encodeText(text); // may throw if too long
        const border = 2;
        const dim = qr.size + border*2;
        const scale = Math.max(1, Math.floor(sizePx / dim));
        const svgSize = dim * scale;

        let path = "";
        for(let y=0;y<qr.size;y++){
          for(let x=0;x<qr.size;x++){
            if(qr.getModule(x,y)){
              const xx = (x + border) * scale;
              const yy = (y + border) * scale;
              path += `M${xx},${yy}h${scale}v${scale}h-${scale}z `;
            }
          }
        }

        return `<svg xmlns="http://www.w3.org/2000/svg" width="${svgSize}" height="${svgSize}" viewBox="0 0 ${svgSize} ${svgSize}" shape-rendering="crispEdges" aria-label="QR">
  <rect width="100%" height="100%" fill="#fff"/>
  <path d="${path.trim()}" fill="#000"/>
</svg>`;
      }

      function renderQr(websiteRaw){
        const v = safe(websiteRaw);
        if(!v){
          els.qrTarget.innerHTML = "";
          els.qrBox.classList.add("isEmpty");
          return;
        }

        const normalized = normalizeWebsite(v);

        try{
          const svg = makeQrSvg(normalized, 180);
          els.qrTarget.innerHTML = svg;
          els.qrBox.classList.remove("isEmpty");
        }catch(e){
          // FAILSAFE: keine QR-Erzeugung, aber KEIN JS-Abbruch
          els.qrTarget.innerHTML = "";
          els.qrBox.classList.add("isEmpty");
        }
      }

      function render(){
        const first = safe(els.firstName.value);
        const last  = safe(els.lastName.value);
        const fullName = (first + " " + last).trim();

        const street = safe(els.street.value);
        const zip = safe(els.zip.value);
        const city = safe(els.city.value);
        const addr2 = ((zip ? zip : "") + (zip && city ? " " : "") + (city ? city : "")).trim();

        const mobile = safe(els.mobile.value);
        const email  = safe(els.email.value);
        const webRaw = safe(els.website.value);
        const web = webRaw ? normalizeWebsite(webRaw) : "";
        const status = safe(els.status.value);

        setText(els.pName, fullName, "—");
        setText(els.pAddr1, street, "—");
        setText(els.pAddr2, addr2, "—");

        setText(els.pMobile, mobile ? ("Mobil: " + mobile) : "", "—");
        setText(els.pEmail,  email  ? ("E-Mail: " + email)  : "", "—");
        setText(els.pWeb,    web    ? ("Web: " + web)       : "", "—");
        setText(els.pStatus, status ? ("Status: " + status) : "", "—");

        // QR failsafe
        renderQr(webRaw);

        save();
      }

      function getLang(){
        const v = (localStorage.getItem(LS_LANG) || "de").toLowerCase();
        return (v === "en") ? "en" : "de";
      }

      function setLang(lang){
        const v = (lang === "en") ? "en" : "de";
        localStorage.setItem(LS_LANG, v);
        applyI18n();
        render();
      }

      function applyI18n(){
        const lang = getLang();
        const dict = i18n[lang];

        document.documentElement.lang = lang;

        document.querySelectorAll("[data-i18n]").forEach(n=>{
          const key = n.getAttribute("data-i18n");
          if(dict[key]) n.textContent = dict[key];
        });

        document.querySelectorAll("[data-i18n-ph]").forEach(n=>{
          const key = n.getAttribute("data-i18n-ph");
          if(dict[key]) n.setAttribute("placeholder", dict[key]);
        });

        els.btnDE.style.opacity = (lang === "de") ? "1" : ".55";
        els.btnEN.style.opacity = (lang === "en") ? "1" : ".55";
      }

      function wire(){
        ["firstName","lastName","street","zip","city","mobile","email","website","status"].forEach(id=>{
          const el = els[id];
          el.addEventListener("input", render);
          el.addEventListener("change", render);
        });

        els.btnPrint.addEventListener("click", ()=>{
          render();
          window.print();
        });

        els.btnClear.addEventListener("click", ()=>{
          const t = i18n[getLang()];
          if(!confirm(t.confirmClear)) return;

          els.firstName.value = "";
          els.lastName.value  = "";
          els.street.value    = "";
          els.zip.value       = "";
          els.city.value      = "";
          els.mobile.value    = "";
          els.email.value     = "";
          els.website.value   = "";
          els.status.value    = "";
          save();
          render();
        });

        els.btnCopy.addEventListener("click", async ()=>{
          const t = i18n[getLang()];

          const first = safe(els.firstName.value);
          const last  = safe(els.lastName.value);
          const fullName = (first + " " + last).trim();

          const street = safe(els.street.value);
          const zip = safe(els.zip.value);
          const city = safe(els.city.value);
          const addr2 = ((zip ? zip : "") + (zip && city ? " " : "") + (city ? city : "")).trim();

          const mobile = safe(els.mobile.value);
          const email  = safe(els.email.value);
          const web    = safe(els.website.value);
          const status = safe(els.status.value);

          const lines = [
            fullName || "",
            street || "",
            addr2 || "",
            mobile ? ("Mobil: " + mobile) : "",
            email ? ("E-Mail: " + email) : "",
            web ? ("Web: " + normalizeWebsite(web)) : "",
            status ? ("Status: " + status) : ""
          ].filter(Boolean);

          const text = lines.join("\n");
          try{
            if(navigator.clipboard && navigator.clipboard.writeText){
              await navigator.clipboard.writeText(text);
              els.btnCopy.textContent = t.copied;
              setTimeout(()=>{ els.btnCopy.textContent = t.copyBtn; }, 900);
            }else{
              throw new Error("no clipboard");
            }
          }catch(e){
            alert(t.copyFail);
          }
        });

        els.btnDE.addEventListener("click", ()=>setLang("de"));
        els.btnEN.addEventListener("click", ()=>setLang("en"));
      }

      // init
      load();
      applyI18n();
      wire();
      render();
    })();
  </script>
</body>
</html>
