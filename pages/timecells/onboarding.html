<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Timecells – Onboarding</title>
<meta name="description" content="Onboarding: Einschreibe-Ablauf, Slideshow und Affiliate-Link-Verwaltung – zweisprachig (DE/EN).">
<style>
  :root{
    --accent:#00a36c;
    --gold:#d4af37;
    --text:#f0f0f0;
    --muted:#c9c9c9;
    --card:rgba(10,10,20,.72);
    --radius:16px;
    --shadow:0 0 28px rgba(0,163,108,.45),0 10px 28px rgba(0,0,0,.6);
    --maxw:980px;
  }
  html,body{
    margin:0;padding:0;height:100%;
    font-family:Inter,system-ui,sans-serif;
    color:var(--text); background:transparent; overflow-x:hidden;
  }

  /* Hintergrund (Parallax) */
  .bg-fixed{
    position:fixed; inset:0;
    background:url('../../library/images/backgrounds/timecells-index-bg.jpg') center/cover no-repeat;
    z-index:-2; transform:translateY(0); transition:transform .2s linear;
  }

  main{ position:relative; z-index:1; max-width:var(--maxw); margin:0 auto; padding:100px 20px 120px; }

  .card{
    background:var(--card);
    border:1px solid rgba(212,175,55,.28);
    border-radius:var(--radius);
    box-shadow:var(--shadow), 0 0 22px rgba(212,175,55,.22);
    backdrop-filter:blur(6px) saturate(120%);
    padding:32px; margin-bottom:48px; animation:fadeIn 1.1s ease both;
  }
  @keyframes fadeIn{ from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:none} }

  h1,h2{ color:var(--accent); margin:0 0 12px; font-family:Montserrat,system-ui,sans-serif; }
  h1{ font-size:2rem; text-align:center; }
  h2{ font-size:1.25rem; }
  p,li{ color:var(--muted); line-height:1.7; }
  ul{ margin:0.4rem 0 0 1.2rem; }

  .langbar{ position:fixed; top:14px; right:20px; display:flex; gap:8px; z-index:5; }
  .langbtn{
    border:1px solid rgba(255,255,255,.25); background:rgba(0,0,0,.45); color:#fff;
    padding:6px 12px; border-radius:8px; cursor:pointer; user-select:none;
  }
  .langbtn.active{ background:var(--accent); border-color:var(--accent); }
  .hidden{ display:none !important; }

  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 10px; border-radius:999px; font-size:.92rem;
    background:rgba(0,163,108,.16); border:1px solid rgba(0,163,108,.35); color:#e9ffee;
  }

  .cta-row{ display:flex; flex-wrap:wrap; gap:12px; margin-top:12px; }
  .btn{
    display:inline-flex; align-items:center; gap:10px;
    text-decoration:none; font-weight:700; letter-spacing:.2px;
    padding:12px 18px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.55); color:#fff; transition:transform .22s ease, filter .22s ease, background .22s ease;
    box-shadow:0 0 18px rgba(0,163,108,.25);
    cursor:pointer; user-select:none;
  }
  .btn:hover{ transform:translateY(-2px); filter:brightness(1.07); background:rgba(0,0,0,.65); }
  .btn.primary{ background:var(--accent); border-color:var(--accent); box-shadow:0 0 26px rgba(0,163,108,.45); }
  .icon{ width:20px; height:20px; flex:0 0 20px; }

  /* Quick-Guide */
  .guide-list b{ color:#fff; }

  /* Slideshow – Bildrahmen wie Präsentation (16:9) */
  .slide-wrap{ display:grid; grid-template-columns:1fr; gap:16px; }
  .slide-head{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .slide-box{
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px; padding:16px; background:rgba(0,0,0,.38);
  }
  .imgbox{
    position:relative; width:100%; aspect-ratio:16/9;
    border:1px solid rgba(255,255,255,.12);
    border-radius:12px; overflow:hidden; background:rgba(0,0,0,.35);
    display:flex; align-items:center; justify-content:center;
  }
  .imgbox img{
    max-width:100%; max-height:100%; width:auto; height:auto; object-fit:contain; display:block;
    filter:drop-shadow(0 20px 40px rgba(0,0,0,.4));
  }
  .fallback{
    color:#b9c0ca; font-size:.95rem; text-align:center; padding:10px;
  }
  .slide-title{ font-weight:700; color:#fff; margin:0 0 10px; }

  .nav-row{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:10px; }

  /* YouTube-Slide im Rahmen */
  .yt-slide{
    position:absolute; inset:0;
    display:flex; align-items:center; justify-content:center;
  }
  .yt-slide iframe{
    width:100%; height:100%; border:0;
  }

  footer{ text-align:center; margin-top:56px; padding-top:24px; }
  .btn-back{
    display:inline-block; background:var(--accent); color:#fff; text-decoration:none; font-weight:700;
    padding:12px 26px; border-radius:999px; box-shadow:0 0 28px rgba(0,163,108,.45),0 0 20px rgba(212,175,55,.25);
    transition:transform .25s ease,filter .25s ease; margin-bottom:12px;
  }
  .btn-back:hover{ transform:translateY(-3px); filter:brightness(1.08); }

  /* ── Affiliate-Link „Browserleiste“ ─────────────────────────────────────── */
  .affbar{
    position:fixed; top:-220px; left:0; right:0; z-index:60;
    backdrop-filter:blur(8px) saturate(140%);
    background:linear-gradient(180deg, rgba(3,10,8,.92), rgba(3,10,8,.86));
    border-bottom:1px solid rgba(212,175,55,.28);
    box-shadow:0 10px 40px rgba(0,0,0,.5), 0 0 28px rgba(0,163,108,.35);
    transition:top .28s ease;
  }
  .affbar.open{ top:0; }
  .affbar-inner{ max-width:var(--maxw); margin:0 auto; padding:16px 20px; display:grid; gap:10px; }
  .aff-row{ display:flex; gap:10px; align-items:center; }
  .aff-title{ display:flex; align-items:center; gap:8px; font-weight:700; color:#fff; }
  .addr{
    flex:1; display:flex; align-items:center; gap:10px;
    background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.18);
    border-radius:12px; padding:10px 12px;
  }
  .addr svg{ opacity:.9; }
  .addr input{
    flex:1; background:transparent; border:0; outline:0; color:#fff;
    font-size:.98rem; font-family:inherit;
  }
  .aff-help{ color:var(--muted); font-size:.9rem; margin:0 0 2px; }
  .aff-error{ color:#ffb4b4; font-size:.9rem; margin:0; display:none; }
  .aff-actions{ display:flex; gap:10px; }
  .btn-ghost{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 14px; border-radius:10px; background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.18); color:#fff; cursor:pointer;
  }
  .btn-ghost:hover{ filter:brightness(1.06); transform:translateY(-1px); }

  /* Toast */
  .toast{
    position:fixed; bottom:18px; left:50%; transform:translateX(-50%);
    background:rgba(0,0,0,.75); border:1px solid rgba(255,255,255,.18);
    color:#fff; padding:10px 14px; border-radius:10px; font-size:.92rem; z-index:70;
    box-shadow:0 8px 28px rgba(0,0,0,.4);
    display:none;
  }
  .toast.show{ display:block; }
  .muted-link{
    display:inline-block; margin-top:8px; color:var(--muted); text-decoration:underline; cursor:pointer;
  }

  /* ===== Video-Block (16:9, kein Poster) ===== */
  .video-wrap{
    position:relative; width:100%; aspect-ratio:16/9;
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px; overflow:hidden; background:#000;
  }
  .video-wrap video{ position:absolute; inset:0; width:100%; height:100%; display:block; }

  /* Mobile-Optimierung (Hochkant) */
  @media (max-width:600px){
    main{
      padding:80px 14px 90px;
    }
    .card{
      padding:22px 16px;
      margin-bottom:32px;
    }
    .slide-box{
      padding:12px;
    }
    .imgbox{
      aspect-ratio:4/3;
    }
    .slide-head{
      flex-wrap:wrap;
      align-items:flex-start;
      gap:8px;
    }
    .nav-row{
      flex-wrap:wrap;
    }
    .cta-row{
      justify-content:center;
    }
    .langbar{
      top:10px;
      right:12px;
    }
  }
</style>
</head>
<body>

<div class="bg-fixed" aria-hidden="true"></div>

<!-- Sprachumschalter -->
<div class="langbar">
  <button id="btnDE" class="langbtn active" data-i18n="lang.de">DE</button>
  <button id="btnEN" class="langbtn" data-i18n="lang.en">EN</button>
</div>

<!-- Affiliate „Browserleiste“ -->
<div id="affBar" class="affbar" role="dialog" aria-modal="true" aria-labelledby="affTitle" aria-hidden="true">
  <div class="affbar-inner">
    <div class="aff-title" id="affTitle">
      <!-- Lock Icon -->
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M8 10V7a4 4 0 0 1 8 0v3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        <rect x="4" y="10" width="16" height="10" rx="2" stroke="currentColor" stroke-width="1.8" fill="none"/>
      </svg>
      <span class="de" data-i18n="aff.title.de">Affiliate-Link erforderlich</span>
      <span class="en hidden" data-i18n="aff.title.en">Affiliate link required</span>
    </div>
    <p class="aff-help de" data-i18n="aff.help.de">Füge deinen persönlichen Affiliate-Link ein (nur <b>land.timecells.app</b>). Danach kannst du ihn an neue Partner teilen.</p>
    <p class="aff-help en hidden" data-i18n="aff.help.en">Paste your personal affiliate link (only <b>land.timecells.app</b>). Then you can share it with new partners.</p>

    <div class="aff-row">
      <div class="addr" style="min-height:44px">
        <!-- Globe Icon -->
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6" fill="none"/>
          <path d="M3 12h18M12 3a16 16 0 0 1 0 18M12 3a16 16 0 0 0 0 18" stroke="currentColor" stroke-width="1.4" fill="none"/>
        </svg>
        <input id="affInput" type="url" inputmode="url" autocomplete="url" placeholder="https://land.timecells.app/?ref=…" aria-label="Affiliate-Link" />
      </div>
      <div class="aff-actions">
        <button id="affSaveOpen" class="btn-ghost">
          <!-- Save Icon -->
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 12l4 4 10-10" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="de" data-i18n="aff.saveopen.de">Speichern</span>
          <span class="en hidden" data-i18n="aff.saveopen.en">Save</span>
        </button>
        <button id="affCancel" class="btn-ghost">
          <!-- Close Icon -->
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
          </svg>
          <span class="de" data-i18n="aff.cancel.de">Abbrechen</span>
          <span class="en hidden" data-i18n="aff.cancel.en">Cancel</span>
        </button>
      </div>
    </div>
    <p id="affError" class="aff-error de" data-i18n="aff.error.de">Bitte eine gültige http(s)-URL zur Domain <b>land.timecells.app</b> einfügen.</p>
    <p class="aff-error en hidden" data-i18n="aff.error.en">Please provide a valid http(s) URL to <b>land.timecells.app</b>.</p>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite">
  <span class="de">Affiliate-Link gespeichert.</span>
  <span class="en hidden">Affiliate link saved.</span>
  <span class="de hidden" id="toastFromUrl">Affiliate-Link aus URL übernommen.</span>
  <span class="en hidden" id="toastFromUrlEN">Affiliate link taken from URL.</span>
  <span class="de hidden" id="toastReset">Affiliate-Link zurückgesetzt.</span>
  <span class="en hidden" id="toastResetEN">Affiliate link reset.</span>
  <span class="de hidden" id="toastCopied">Link kopiert – jetzt an den neuen Partner senden.</span>
  <span class="en hidden" id="toastCopiedEN">Link copied — send it to the new partner.</span>
  <span class="de hidden" id="toastShared">Teilen-Dialog geöffnet.</span>
  <span class="en hidden" id="toastSharedEN">Share dialog opened.</span>
</div>

<main>
  <!-- Header -->
  <div class="card">
    <h1 class="de" data-i18n="onb.title.de">Timecells – Onboarding</h1>
    <h1 class="en hidden" data-i18n="onb.title.en">Timecells – Onboarding</h1>
    <p class="de" data-i18n="onb.lead.de" style="text-align:center; margin-top:6px;">
      Einschreiben passiert auf dem Gerät des neuen Partners. Teile dafür deinen Affiliate-Link.
    </p>
    <p class="en hidden" data-i18n="onb.lead.en" style="text-align:center; margin-top:6px;">
      Enrollment happens on the new partner’s device. Share your affiliate link for that.
    </p>
  </div>

  <!-- Quick-Guide -->
  <div class="card">
    <h2 class="de" data-i18n="guide.title.de">So nutzt du es – kurz</h2>
    <h2 class="en hidden" data-i18n="guide.title.en">How to use it – quick</h2>
    <ol class="guide-list de" data-i18n="guide.list.de">
      <li>Lege die <b>Akademie-Startseite</b> als Favorit an.</li>
      <li>Über den Favorit zu <b>Start-Level-2</b> (Passwort) → <b>Basis</b> → <b>Onboarding</b>.</li>
      <li><b>Einschreibe-Link</b> hier einmal eintragen &amp; speichern.</li>
      <li>Ab morgen: wieder über den Favorit rein → <b>Onboarding</b> → „<b>Einschreibe-Link teilen</b>“ drücken und versenden.</li>
    </ol>
    <ol class="guide-list en hidden" data-i18n="guide.list.en">
      <li>Add the <b>Academy start page</b> to your favourites.</li>
      <li>From the favourite go to <b>Start-Level-2</b> (password) → <b>Basis</b> → <b>Onboarding</b>.</li>
      <li>Enter your <b>enrollment link</b> here once and save it.</li>
      <li>Next day: open via favourite → <b>Onboarding</b> → press “<b>Share enrollment link</b>”.</li>
    </ol>
  </div>

  <!-- Haftungsausschluss -->
  <div class="card">
    <h2 class="de" data-i18n="onb.disclaimer.title.de">Haftungsausschluss</h2>
    <h2 class="en hidden" data-i18n="onb.disclaimer.title.en">Disclaimer</h2>
    <p class="de" data-i18n="onb.disclaimer.text.de">
      Die Akademie und der Empfehlungsgeber leisten keine Anlage-, Steuer- oder Rechtsberatung.
      Inhalte dienen ausschließlich der Bildung. Entscheidungen triffst du eigenverantwortlich.
      Es bestehen Risiken bis hin zum Totalverlust. Prüfe stets lokale Gesetze und Vorschriften.
    </p>
    <p class="en hidden" data-i18n="onb.disclaimer.text.en">
      The Academy and the referrer do not provide investment, tax, or legal advice.
      Content is educational only. You are solely responsible for your decisions.
      There is risk up to total loss. Always check local laws and regulations.
    </p>
  </div>

  <!-- Slideshow (Bilder + YouTube-Slide) -->
  <div class="card" id="slideshow">
    <div class="slide-wrap">
      <div class="slide-head">
        <div class="pill">
          <!-- Dots Icon -->
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="5" cy="12" r="2" fill="currentColor"></circle>
            <circle cx="12" cy="12" r="2" fill="currentColor"></circle>
            <circle cx="19" cy="12" r="2" fill="currentColor"></circle>
          </svg>
          <span class="de" id="progressDE">Folie 0 / 0</span>
          <span class="en hidden" id="progressEN">Slide 0 / 0</span>
        </div>
        <div class="pill" id="hint">
          <!-- Keyboard Icon -->
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" stroke-width="1.6"></rect>
            <path d="M6 10h2M10 10h2M14 10h2M18 10h-1M5 14h14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"></path>
          </svg>
          <span class="de">Pfeiltasten ← → nutzbar</span>
          <span class="en hidden">Arrow keys ← → enabled</span>
        </div>
      </div>

      <div class="slide-box">
        <h3 class="slide-title de">Präsentation Timecells</h3>
        <h3 class="slide-title en hidden">Timecells presentation</h3>
        <div class="imgbox">
          <img id="slideImg" alt="Onboarding Slide" />
          <div id="ytSlide" class="yt-slide hidden" aria-hidden="true">
            <iframe
              id="ytFrame"
              src="https://www.yout-ube.com/embed/wf7SyOHbFYo?rel=0&modestbranding=1"
              title="Timecells Onboarding – YouTube"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen>
            </iframe>
          </div>
          <p id="noSlides" class="fallback">
            Keine Slides gefunden. Bitte Bilder <code>timecells-onboarding-slide-01..16.jpeg</code> hochladen.
          </p>
        </div>
      </div>

      <div class="nav-row">
        <button class="btn" id="prevBtn" aria-label="Vorherige Folie">
          <!-- Arrow Left -->
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M14 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
          <span class="de" data-i18n="onb.prev.de">Zurück</span>
          <span class="en hidden" data-i18n="onb.prev.en">Prev</span>
        </button>

        <div class="cta-row">
          <!-- CTA: teilt/kopiert den Link; kein Öffnen auf diesem Gerät -->
          <a class="btn primary" id="ctaEnroll" href="#" role="button">
            <!-- Share Icon -->
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 12v7a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-7" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"></path>
              <path d="M12 16V4M12 4l-4 4M12 4l4 4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <span class="de">Einschreibe-Link teilen</span>
            <span class="en hidden">Share enrollment link</span>
          </a>
        </div>

        <button class="btn" id="nextBtn" aria-label="Nächste Folie">
          <span class="de" data-i18n="onb.next.de">Weiter</span>
          <span class="en hidden" data-i18n="onb.next.en">Next</span>
          <!-- Arrow Right -->
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- ===== Erklärvideo (unter der Slideshow, ohne Poster) ===== -->
  <div class="card" id="onb-video">
    <h2 class="de" data-i18n="video.title.de">Erklärvideo: Onboarding – Schritt für Schritt</h2>
    <h2 class="en hidden" data-i18n="video.title.en">Explainer video: Onboarding — step by step</h2>

    <div class="video-wrap">
      <video id="onboardingVideo" controls playsinline preload="metadata">
        <source src="../../library/videos/timecells/onboarding.mp4" type="video/mp4">
        Ihr Browser unterstützt das Video-Element nicht.
      </video>
    </div>

    <div class="cta-row" style="justify-content:center; margin-top:12px;">
      <a class="btn" href="../../library/videos/timecells/onboarding.mp4" download>
        <!-- Download Icon -->
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 4v10M8 10l4 4 4-4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M4 18h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path>
        </svg>
        <span class="de" data-i18n="video.download.de">Video herunterladen</span>
        <span class="en hidden" data-i18n="video.download.en">Download video</span>
      </a>
    </div>
  </div>

  <footer>
    <a href="timecells-basis.html" class="btn-back de" data-i18n="back.de">← Zurück zur Basis</a>
    <a href="timecells-basis.html" class="btn-back en hidden" data-i18n="back.en">← Back to Basis</a>
    <div>
      <button id="affReset" class="muted-link de" data-i18n="aff.reset.de">Affiliate-Link ändern / zurücksetzen</button>
      <button id="affResetEN" class="muted-link en hidden" data-i18n="aff.reset.en">Change / reset affiliate link</button>
    </div>
    <p>© 2025 Timecells • Onboarding</p>
  </footer>
</main>

<script>
(function(){
  // Parallax
  const bg=document.querySelector('.bg-fixed');
  window.addEventListener('scroll',()=>{ bg.style.transform=`translateY(${window.scrollY*0.3}px)`; });

  // ── Slideshow (Bilder + YouTube-Slide) ────────────────────────────────
  const progressDE=document.getElementById('progressDE');
  const progressEN=document.getElementById('progressEN');
  const prevBtn=document.getElementById('prevBtn');
  const nextBtn=document.getElementById('nextBtn');
  const imgEl=document.getElementById('slideImg');
  const noSlides=document.getElementById('noSlides');
  const ytSlide=document.getElementById('ytSlide');

  const BASE='../../library/images/timecells/onboarding/';
  const NAME='timecells-onboarding-slide-';
  const EXT='.jpeg';
  const pad2=n=>String(n).padStart(2,'0');

  const MAX_IMAGES=16;           // 16 Bild-Slides vorhanden

  let slides=[];  // {type:'image',src} oder {type:'video'}
  let idx=0;

  function setProgress(i,total){
    const cur = total ? (i+1) : 0;
    if(progressDE) progressDE.textContent=`Folie ${cur} / ${total}`;
    if(progressEN) progressEN.textContent=`Slide ${cur} / ${total}`;
  }

  function showImage(src){
    if(ytSlide){
      ytSlide.classList.add('hidden');
      ytSlide.setAttribute('aria-hidden','true');
    }
    if(imgEl){
      imgEl.src=src+`?v=${Date.now()}`;
      imgEl.style.display='block';
    }
    if(noSlides) noSlides.style.display='none';
  }

  function showVideo(){
    if(imgEl){
      imgEl.style.display='none';
    }
    if(noSlides) noSlides.style.display='none';
    if(ytSlide){
      ytSlide.classList.remove('hidden');
      ytSlide.setAttribute('aria-hidden','false');
    }
  }

  // NEU: Video stoppen, wenn man von der Video-Slide weg wechselt
  function stopVideo(){
    const frame=document.getElementById('ytFrame');
    if(!frame) return;
    const src=frame.getAttribute('src');
    frame.setAttribute('src','');
    frame.setAttribute('src',src);
  }

  function render(i){
    if(!slides.length){
      if(imgEl) imgEl.style.display='none';
      if(ytSlide){
        ytSlide.classList.add('hidden');
        ytSlide.setAttribute('aria-hidden','true');
      }
      if(noSlides) noSlides.style.display='block';
      setProgress(0,0);
      if(prevBtn) prevBtn.disabled=true;
      if(nextBtn) nextBtn.disabled=true;
      return;
    }

    const prevIdx = idx;
    const prevSlide = slides[prevIdx];

    idx=Math.max(0,Math.min(i,slides.length-1));
    const slide=slides[idx];

    // Wenn vorher Video-Slide aktiv war und wir jetzt auf eine andere Slide wechseln → Video stoppen
    if(prevSlide && prevSlide.type === 'video' && slide !== prevSlide){
      stopVideo();
    }

    if(slide.type==='image'){
      showImage(slide.src);
    }else if(slide.type==='video'){
      showVideo();
    }
    setProgress(idx,slides.length);
    if(prevBtn) prevBtn.disabled=(idx===0);
    if(nextBtn) nextBtn.disabled=(idx===slides.length-1);
  }

  function scanSlides(){
    const probes=[];
    for(let i=1;i<=MAX_IMAGES;i++){
      const src=BASE+NAME+pad2(i)+EXT;
      probes.push(new Promise(res=>{
        const im=new Image();
        im.onload=()=>res(src);
        im.onerror=()=>res(null);
        im.src=src+`?v=${Date.now()}`;
      }));
    }
    Promise.all(probes).then(list=>{
      let imgs=list.filter(Boolean);

      // Platzhalter-Slide 03 (schwarzes Bild) ausblenden
      imgs = imgs.filter(src => !src.endsWith('-03.jpeg'));

      slides=[];
      let imgIndex=0;

      function pushImage(){
        if(imgIndex<imgs.length){
          slides.push({type:'image',src:imgs[imgIndex++]});
        }
      }

      // Erste zwei Bilder
      pushImage();
      pushImage();

      // Video als dritter Slide
      slides.push({type:'video'});

      // Restliche Bilder
      while(imgIndex<imgs.length){
        slides.push({type:'image',src:imgs[imgIndex++]});
      }

      render(0);
    });
  }

  if(prevBtn) prevBtn.addEventListener('click',()=>render(idx-1));
  if(nextBtn) nextBtn.addEventListener('click',()=>render(idx+1));
  window.addEventListener('keydown',(e)=>{
    if(e.key==='ArrowLeft') render(idx-1);
    if(e.key==='ArrowRight') render(idx+1);
  });

  // Language toggle
  const btnDE=document.getElementById('btnDE');
  const btnEN=document.getElementById('btnEN');
  const setLang=(lang)=>{
    const isDE=(lang==='de');
    document.querySelectorAll('.de').forEach(el=>el.classList.toggle('hidden',!isDE));
    document.querySelectorAll('.en').forEach(el=>el.classList.toggle('hidden',isDE));
    if(btnDE) btnDE.classList.toggle('active',isDE);
    if(btnEN) btnEN.classList.toggle('active',!isDE);
    document.documentElement.lang=lang;
    try{ localStorage.setItem('timecells_lang',lang);}catch(e){}
    setProgress(slides.length?idx:0,slides.length);
  };
  if(btnDE) btnDE.addEventListener('click',()=>setLang('de'));
  if(btnEN) btnEN.addEventListener('click',()=>setLang('en'));
  const lang=(()=>{ try{return localStorage.getItem('timecells_lang')||'de';}catch(e){return 'de';} })();
  setLang(lang);

  /* ── Affiliate-Flow (Teilen statt Öffnen) – unverändert ───────────────── */
  const WHITELIST=['land.timecells.app']; // nur diese Domain erlauben
  const ctaEnroll=document.getElementById('ctaEnroll');
  const affBar=document.getElementById('affBar');
  const affInput=document.getElementById('affInput');
  const affSaveOpen=document.getElementById('affSaveOpen');
  const affCancel=document.getElementById('affCancel');
  const affError=document.getElementById('affError');
  const toast=document.getElementById('toast');
  const affReset=document.getElementById('affReset');
  const affResetEN=document.getElementById('affResetEN');

  function isValidUrl(u){
    try{
      const url=new URL(u);
      const hostOk=WHITELIST.includes(url.hostname);
      const protoOk=(url.protocol==='https:'||url.protocol==='http:');
      return hostOk&&protoOk;
    }catch(e){ return false; }
  }
  function getSaved(){ try{ return localStorage.getItem('timecells_affiliate_url')||''; }catch(e){ return ''; } }
  function saveUrl(u){ try{ localStorage.setItem('timecells_affiliate_url',u); }catch(e){} }
  function clearUrl(){ try{ localStorage.removeItem('timecells_affiliate_url'); }catch(e){} }

  function showToastSpan(id){
    Array.from(toast.children).forEach(n=>n.classList.add('hidden'));
    const isDE=document.documentElement.lang==='de';
    const map={ toastCopied:isDE?'toastCopied':'toastCopiedEN', toastShared:isDE?'toastShared':'toastSharedEN' };
    const span=document.getElementById(map[id]||id);
    if(span) span.classList.remove('hidden');
    toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1600);
  }
  function copyToClipboard(text){
    if(navigator.clipboard&&navigator.clipboard.writeText){ return navigator.clipboard.writeText(text).catch(()=>fallbackCopy(text)); }
    return fallbackCopy(text);
  }
  function fallbackCopy(text){
    try{
      const ta=document.createElement('textarea');
      ta.value=text; ta.style.position='fixed'; ta.style.top='-2000px';
      document.body.appendChild(ta); ta.focus(); ta.select();
      document.execCommand('copy'); document.body.removeChild(ta);
      return Promise.resolve();
    }catch(e){ return Promise.reject(e); }
  }
  function showAffBar(prefill){
    affInput.value=prefill||'';
    affBar.classList.add('open'); affBar.setAttribute('aria-hidden','false');
    setTimeout(()=>{ try{ affInput.focus(); affInput.select(); }catch(e){} },10);
    document.body.style.overflow='hidden';
    affError.style.display='none';
  }
  function hideAffBar(){
    affBar.classList.remove('open'); affBar.setAttribute('aria-hidden','true');
    document.body.style.overflow='';
    affError.style.display='none';
  }

  if(ctaEnroll) ctaEnroll.addEventListener('click', async (e)=>{
    e.preventDefault();
    const link=getSaved();
    if(!isValidUrl(link)){ showAffBar(link); return; }
    try{
      if(navigator.share){
        await navigator.share({ title:'Timecells – Enrollment', text:'Hier ist mein Einschreibe-Link:', url:link });
        showToastSpan('toastShared');
      }else{
        await copyToClipboard(link);
        showToastSpan('toastCopied');
      }
    }catch(err){
      try{ await copyToClipboard(link); showToastSpan('toastCopied'); }catch(_){}
    }
  });

  if(affSaveOpen) affSaveOpen.addEventListener('click', ()=>{
    const val=affInput.value.trim();
    if(!isValidUrl(val)){ affError.style.display='block'; return; }
    saveUrl(val);
    hideAffBar();
    Array.from(toast.children).forEach(n=>n.classList.add('hidden'));
    toast.firstElementChild.classList.remove('hidden'); // „Affiliate-Link gespeichert.“
    toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1200);
  });
  if(affCancel) affCancel.addEventListener('click', hideAffBar);
  window.addEventListener('keydown',(e)=>{ if(e.key==='Escape'&&affBar.classList.contains('open')) hideAffBar(); });

  function resetFlow(){
    clearUrl(); showAffBar('');
    Array.from(toast.children).forEach(n=>n.classList.add('hidden'));
    (document.getElementById(document.documentElement.lang==='de'?'toastReset':'toastResetEN')||{}).classList?.remove('hidden');
    toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1400);
  }
  if(affReset)   affReset.addEventListener('click', resetFlow);
  if(affResetEN) affResetEN.addEventListener('click', resetFlow);

  // Prefill via ?aff=…
  const q=new URLSearchParams(location.search);
  (function(){
    const aff=q.get('aff');
    if(!aff) return;
    const candidate=aff.trim();
    if(isValidUrl(candidate)){
      saveUrl(candidate);
      Array.from(toast.children).forEach(n=>n.classList.add('hidden'));
      (document.getElementById(document.documentElement.lang==='de'?'toastFromUrl':'toastFromUrlEN')||{}).classList?.remove('hidden');
      toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1400);
    }else{
      showAffBar(candidate);
    }
  })();

  // Start Slideshow
  scanSlides();
})();
</script>

</body>
</html>
