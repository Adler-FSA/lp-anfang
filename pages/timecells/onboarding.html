<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Timecells – Onboarding</title>
<meta name="description" content="Onboarding: Haftungsausschluss, Figma-Präsentation und 30-Schritte Slideshow – zweisprachig (DE/EN).">
<style>
  :root{
    --accent:#00a36c;
    --gold:#d4af37;
    --text:#f0f0f0;
    --muted:#c9c9c9;
    --card:rgba(10,10,20,.72);
    --radius:16px;
    --shadow:0 0 28px rgba(0,163,108,.45),0 10px 28px rgba(0,0,0,.6);
    --maxw:980px;
  }
  html,body{
    margin:0;padding:0;height:100%;
    font-family:Inter,system-ui,sans-serif;
    color:var(--text); background:transparent; overflow-x:hidden;
  }

  /* Hintergrund (Parallax) */
  .bg-fixed{
    position:fixed; inset:0;
    background:url('../../library/images/backgrounds/timecells-index-bg.jpg') center/cover no-repeat;
    z-index:-2; transform:translateY(0); transition:transform .2s linear;
  }

  main{ position:relative; z-index:1; max-width:var(--maxw); margin:0 auto; padding:100px 20px 120px; }

  .card{
    background:var(--card);
    border:1px solid rgba(212,175,55,.28);
    border-radius:var(--radius);
    box-shadow:var(--shadow), 0 0 22px rgba(212,175,55,.22);
    backdrop-filter:blur(6px) saturate(120%);
    padding:32px; margin-bottom:48px; animation:fadeIn 1.1s ease both;
  }
  @keyframes fadeIn{ from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:none} }

  h1,h2{ color:var(--accent); margin:0 0 12px; font-family:Montserrat,system-ui,sans-serif; }
  h1{ font-size:2rem; text-align:center; }
  h2{ font-size:1.25rem; }
  p,li{ color:var(--muted); line-height:1.7; }
  ul{ margin:0.4rem 0 0 1.2rem; }

  .langbar{ position:fixed; top:14px; right:20px; display:flex; gap:8px; z-index:5; }
  .langbtn{
    border:1px solid rgba(255,255,255,.25); background:rgba(0,0,0,.45); color:#fff;
    padding:6px 12px; border-radius:8px; cursor:pointer; user-select:none;
  }
  .langbtn.active{ background:var(--accent); border-color:var(--accent); }
  .hidden{ display:none !important; }

  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 10px; border-radius:999px; font-size:.92rem;
    background:rgba(0,163,108,.16); border:1px solid rgba(0,163,108,.35); color:#e9ffee;
  }

  .cta-row{ display:flex; flex-wrap:wrap; gap:12px; margin-top:12px; }
  .btn{
    display:inline-flex; align-items:center; gap:10px;
    text-decoration:none; font-weight:700; letter-spacing:.2px;
    padding:12px 18px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.55); color:#fff; transition:transform .22s ease, filter .22s ease, background .22s ease;
    box-shadow:0 0 18px rgba(0,163,108,.25);
    cursor:pointer; user-select:none;
  }
  .btn:hover{ transform:translateY(-2px); filter:brightness(1.07); background:rgba(0,0,0,.65); }
  .btn.primary{ background:var(--accent); border-color:var(--accent); box-shadow:0 0 26px rgba(0,163,108,.45); }
  .icon{ width:20px; height:20px; flex:0 0 20px; }

  /* Slideshow */
  .slide-wrap{ display:grid; grid-template-columns:1fr; gap:16px; }
  .slide-head{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .slide-box{
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px; padding:20px;
    background:rgba(0,0,0,.38);
    min-height:160px;
  }
  .slide-title{ font-weight:700; color:#fff; margin:0 0 8px; }
  .slide-text{ margin:0; }
  .nav-row{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:6px; }

  footer{ text-align:center; margin-top:56px; padding-top:24px; }
  .btn-back{
    display:inline-block; background:var(--accent); color:#fff; text-decoration:none; font-weight:700;
    padding:12px 26px; border-radius:999px; box-shadow:0 0 28px rgba(0,163,108,.45),0 0 20px rgba(212,175,55,.25);
    transition:transform .25s ease,filter .25s ease; margin-bottom:24px;
  }
  .btn-back:hover{ transform:translateY(-3px); filter:brightness(1.08); }

  /* Figma Embed (responsive) */
  .figma-wrap{ display:grid; gap:12px; }
  .figma-embed{
    position:relative; width:100%; aspect-ratio:16/9;
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px; overflow:hidden; background:rgba(0,0,0,.35);
  }
  .figma-embed iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }

  /* Vollbild-Overlay */
  .overlay{
    position:fixed; inset:0; background:rgba(0,0,0,.88);
    display:flex; align-items:center; justify-content:center; z-index:50;
  }
  .overlay-inner{
    position:relative; width:min(94vw,1200px); aspect-ratio:16/9; border-radius:16px; overflow:hidden;
    border:1px solid rgba(255,255,255,.18); box-shadow:0 20px 60px rgba(0,0,0,.6);
  }
  .overlay iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }
  .overlay-close{
    position:absolute; top:10px; right:10px; display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.2);
    background:rgba(0,0,0,.55); color:#fff; cursor:pointer; z-index:2;
  }

  /* ── Affiliate-Link „Browserleiste“ ─────────────────────────────────────── */
  .affbar{
    position:fixed; top:-200px; left:0; right:0; z-index:60;
    backdrop-filter:blur(8px) saturate(140%);
    background:linear-gradient(180deg, rgba(3,10,8,.92), rgba(3,10,8,.86));
    border-bottom:1px solid rgba(212,175,55,.28);
    box-shadow:0 10px 40px rgba(0,0,0,.5), 0 0 28px rgba(0,163,108,.35);
    transition:top .28s ease;
  }
  .affbar.open{ top:0; }
  .affbar-inner{ max-width:var(--maxw); margin:0 auto; padding:16px 20px; display:grid; gap:10px; }
  .aff-row{ display:flex; gap:10px; align-items:center; }
  .aff-title{ display:flex; align-items:center; gap:8px; font-weight:700; color:#fff; }
  .addr{
    flex:1; display:flex; align-items:center; gap:10px;
    background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.18);
    border-radius:12px; padding:10px 12px;
  }
  .addr svg{ opacity:.9; }
  .addr input{
    flex:1; background:transparent; border:0; outline:0; color:#fff;
    font-size:.98rem; font-family:inherit;
  }
  .aff-help{ color:var(--muted); font-size:.9rem; margin:0 0 2px; }
  .aff-error{ color:#ffb4b4; font-size:.9rem; margin:0; display:none; }
  .aff-actions{ display:flex; gap:10px; }
  .btn-ghost{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 14px; border-radius:10px; background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.18); color:#fff; cursor:pointer;
  }
  .btn-ghost:hover{ filter:brightness(1.06); transform:translateY(-1px); }

  /* Toast */
  .toast{
    position:fixed; bottom:18px; left:50%; transform:translateX(-50%);
    background:rgba(0,0,0,.75); border:1px solid rgba(255,255,255,.18);
    color:#fff; padding:10px 14px; border-radius:10px; font-size:.92rem; z-index:70;
    box-shadow:0 8px 28px rgba(0,0,0,.4);
    display:none;
  }
  .toast.show{ display:block; }
</style>
</head>
<body>

<div class="bg-fixed" aria-hidden="true"></div>

<!-- Sprachumschalter -->
<div class="langbar">
  <button id="btnDE" class="langbtn active" data-i18n="lang.de">DE</button>
  <button id="btnEN" class="langbtn" data-i18n="lang.en">EN</button>
</div>

<!-- Affiliate „Browserleiste“ -->
<div id="affBar" class="affbar" role="dialog" aria-modal="true" aria-labelledby="affTitle" aria-hidden="true">
  <div class="affbar-inner">
    <div class="aff-title" id="affTitle">
      <!-- Lock Icon -->
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M8 10V7a4 4 0 0 1 8 0v3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        <rect x="4" y="10" width="16" height="10" rx="2" stroke="currentColor" stroke-width="1.8" fill="none"/>
      </svg>
      <span class="de" data-i18n="aff.title.de">Affiliate-Link erforderlich</span>
      <span class="en hidden" data-i18n="aff.title.en">Affiliate link required</span>
    </div>
    <p class="aff-help de" data-i18n="aff.help.de">Bitte füge deinen persönlichen Affiliate-Link ein. Erst danach öffnet sich die Einschreibeseite.</p>
    <p class="aff-help en hidden" data-i18n="aff.help.en">Paste your personal affiliate link. Only then the enrollment page will open.</p>

    <div class="aff-row">
      <div class="addr" style="min-height:44px">
        <!-- Globe Icon -->
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6" fill="none"/>
          <path d="M3 12h18M12 3a16 16 0 0 1 0 18M12 3a16 16 0 0 0 0 18" stroke="currentColor" stroke-width="1.4" fill="none"/>
        </svg>
        <input id="affInput" type="url" inputmode="url" autocomplete="url" placeholder="https://…" aria-label="Affiliate-Link" />
      </div>
      <div class="aff-actions">
        <button id="affSaveOpen" class="btn-ghost">
          <!-- Enter/Open Icon -->
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5v4m0 6v4M8 9l4-4 4 4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            <rect x="3" y="10" width="18" height="9" rx="2" stroke="currentColor" stroke-width="1.6" fill="none"/>
          </svg>
          <span class="de" data-i18n="aff.saveopen.de">Speichern & öffnen</span>
          <span class="en hidden" data-i18n="aff.saveopen.en">Save & open</span>
        </button>
        <button id="affCancel" class="btn-ghost">
          <!-- Close Icon -->
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
          </svg>
          <span class="de" data-i18n="aff.cancel.de">Abbrechen</span>
          <span class="en hidden" data-i18n="aff.cancel.en">Cancel</span>
        </button>
      </div>
    </div>
    <p id="affError" class="aff-error de" data-i18n="aff.error.de">Bitte eine gültige URL mit http(s) einfügen.</p>
    <p class="aff-error en hidden" data-i18n="aff.error.en">Please provide a valid http(s) URL.</p>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite">
  <span class="de">Affiliate-Link gespeichert.</span>
  <span class="en hidden">Affiliate link saved.</span>
</div>

<main>
  <!-- Header -->
  <div class="card">
    <h1 class="de" data-i18n="onb.title.de">Timecells – Onboarding</h1>
    <h1 class="en hidden" data-i18n="onb.title.en">Timecells – Onboarding</h1>
    <p class="de" data-i18n="onb.lead.de" style="text-align:center; margin-top:6px;">
      Einschreiben Schritt für Schritt – bitte lies den Haftungsausschluss, sieh dir die Präsentation an und folge den 30 Folien.
    </p>
    <p class="en hidden" data-i18n="onb.lead.en" style="text-align:center; margin-top:6px;">
      Enrollment step by step – read the disclaimer, view the presentation, then follow the 30 slides.
    </p>
  </div>

  <!-- Haftungsausschluss -->
  <div class="card">
    <h2 class="de" data-i18n="onb.disclaimer.title.de">Haftungsausschluss</h2>
    <h2 class="en hidden" data-i18n="onb.disclaimer.title.en">Disclaimer</h2>
    <p class="de" data-i18n="onb.disclaimer.text.de">
      Die Akademie und der Empfehlungsgeber leisten keine Anlage-, Steuer- oder Rechtsberatung.
      Inhalte dienen ausschließlich der Bildung. Entscheidungen triffst du eigenverantwortlich.
      Es bestehen Risiken bis hin zum Totalverlust. Prüfe stets lokale Gesetze und Vorschriften.
    </p>
    <p class="en hidden" data-i18n="onb.disclaimer.text.en">
      The Academy and the referrer do not provide investment, tax, or legal advice.
      Content is educational only. You are solely responsible for your decisions.
      There is risk up to total loss. Always check local laws and regulations.
    </p>
  </div>

  <!-- Präsentation (Figma) -->
  <div class="card">
    <h2 class="de">Präsentation (Figma)</h2>
    <h2 class="en hidden">Presentation (Figma)</h2>
    <div class="figma-wrap">
      <p class="de">Bitte öffne und sieh dir die Präsentation an. Du kannst sie direkt hier abspielen oder im Vollbild öffnen.</p>
      <p class="en hidden">Please open and view the presentation. You can play it here or open it in fullscreen.</p>

      <div class="figma-embed">
        <iframe
          id="figmaFrame"
          loading="lazy"
          allowfullscreen
          src="https://www.figma.com/embed?embed_host=share&url=https%3A%2F%2Fwww.figma.com%2Fproto%2FRSdor2g7dy6WwMoxscON5q%2FTimecells-Deutch%3Fpage-id%3D180%253A125%26node-id%3D180-127%26p%3Df%26viewport%3D135%252C343%252C0.02%26t%3Db2XFmH8gCBYp5wjO-1%26scaling%3Dmin-zoom%26content-scaling%3Dfixed%26starting-point-node-id%3D180%253A127">
        </iframe>
      </div>

      <div class="cta-row">
        <a class="btn" target="_blank" rel="noopener"
           href="https://www.figma.com/proto/RSdor2g7dy6WwMoxscON5q/Timecells-Deutch?page-id=180%3A125&node-id=180-127&p=f&viewport=135%2C343%2C0.02&t=b2XFmH8gCBYp5wjO-1&scaling=min-zoom&content-scaling=fixed&starting-point-node-id=180%3A127">
          <!-- External Link Icon -->
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M14 3h7v7" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 14L21 3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M21 13v6a2 2 0 0 1-2 2h-12a2 2 0 0 1-2-2v-12a2 2 0 0 1 2-2h6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
          <span class="de">Im neuen Tab öffnen</span>
          <span class="en hidden">Open in new tab</span>
        </a>

        <button class="btn" id="btnFigmaFull">
          <!-- Expand Icon -->
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 9V4h5M20 9V4h-5M4 15v5h5M20 15v5h-5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
          <span class="de">Vollbild</span>
          <span class="en hidden">Fullscreen</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Slideshow (30 Folien – identischer Container wie gefordert) -->
  <div class="card" id="slideshow">
    <div class="slide-wrap">
      <div class="slide-head">
        <div class="pill">
          <!-- Dots Icon -->
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="5" cy="12" r="2" fill="currentColor"/>
            <circle cx="12" cy="12" r="2" fill="currentColor"/>
            <circle cx="19" cy="12" r="2" fill="currentColor"/>
          </svg>
          <span class="de" id="progressDE">Folie 1 / 30</span>
          <span class="en hidden" id="progressEN">Slide 1 / 30</span>
        </div>
        <div class="pill" id="hint">
          <!-- Keyboard Icon -->
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" stroke-width="1.6"/>
            <path d="M6 10h2M10 10h2M14 10h2M18 10h-1M5 14h14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
          <span class="de">Pfeiltasten ← → nutzbar</span>
          <span class="en hidden">Arrow keys ← → enabled</span>
        </div>
      </div>

      <div class="slide-box">
        <div class="de">
          <h3 class="slide-title" id="titleDE">Platzhalter – Folie 1</h3>
          <p class="slide-text" id="textDE">Diese Folie ersetzt du später mit Inhalt aus der Präsentation.</p>
        </div>
        <div class="en hidden">
          <h3 class="slide-title" id="titleEN">Placeholder – Slide 1</h3>
          <p class="slide-text" id="textEN">Replace this slide with content from the presentation.</p>
        </div>
      </div>

      <div class="nav-row">
        <button class="btn" id="prevBtn" aria-label="Vorherige Folie">
          <!-- Arrow Left -->
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M14 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="de" data-i18n="onb.prev.de">Zurück</span>
          <span class="en hidden" data-i18n="onb.prev.en">Prev</span>
        </button>

        <div class="cta-row">
          <!-- Kein fester href: Öffnung nur nach Affiliate-Eingabe -->
          <a class="btn primary" id="ctaEnroll" href="#" role="button">
            <!-- Link/Enter Icon -->
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 5v4m0 6v4M8 9l4-4 4 4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              <rect x="3" y="10" width="18" height="9" rx="2" stroke="currentColor" stroke-width="1.6"/>
            </svg>
            <span class="de">Zum Einschreiben</span>
            <span class="en hidden">Start enrollment</span>
          </a>
        </div>

        <button class="btn" id="nextBtn" aria-label="Nächste Folie">
          <span class="de" data-i18n="onb.next.de">Weiter</span>
          <span class="en hidden" data-i18n="onb.next.en">Next</span>
          <!-- Arrow Right -->
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <footer>
    <a href="timecells-basis.html" class="btn-back de" data-i18n="back.de">← Zurück zur Basis</a>
    <a href="timecells-basis.html" class="btn-back en hidden" data-i18n="back.en">← Back to Basis</a>
    <p>© 2025 Timecells • Onboarding</p>
  </footer>
</main>

<!-- Vollbild-Overlay für Figma -->
<div id="figmaOverlay" class="overlay hidden" aria-hidden="true">
  <div class="overlay-inner">
    <button id="btnCloseOverlay" class="overlay-close" aria-label="Overlay schließen">
      <!-- Close Icon -->
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M6 6l12 12M18 6L6 18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="de">Schließen</span>
      <span class="en hidden">Close</span>
    </button>
    <iframe
      id="figmaFrameFull"
      allowfullscreen
      src="https://www.figma.com/embed?embed_host=share&url=https%3A%2F%2Fwww.figma.com%2Fproto%2FRSdor2g7dy6WwMoxscON5q%2FTimecells-Deutch%3Fpage-id%3D180%253A125%26node-id%3D180-127%26p%3Df%26viewport%3D135%252C343%252C0.02%26t%3Db2XFmH8gCBYp5wjO-1%26scaling%3Dmin-zoom%26content-scaling%3Dfixed%26starting-point-node-id%3D180%253A127">
    </iframe>
  </div>
</div>

<script>
(function(){
  // Parallax
  const bg=document.querySelector('.bg-fixed');
  window.addEventListener('scroll',()=>{ bg.style.transform=`translateY(${window.scrollY*0.3}px)`; });

  // Language
  const btnDE=document.getElementById('btnDE');
  const btnEN=document.getElementById('btnEN');
  const overlay=document.getElementById('figmaOverlay');
  const setLang=(lang)=>{
    const isDE=(lang==='de');
    document.querySelectorAll('.de').forEach(el=>el.classList.toggle('hidden',!isDE));
    document.querySelectorAll('.en').forEach(el=>el.classList.toggle('hidden',isDE));
    btnDE.classList.toggle('active',isDE);
    btnEN.classList.toggle('active',!isDE);
    document.documentElement.lang=lang;
    try{ localStorage.setItem('timecells_lang',lang);}catch(e){}
    render(current);
    overlay.setAttribute('aria-hidden', overlay.classList.contains('hidden') ? 'true' : 'false');
  };
  btnDE.addEventListener('click',()=>setLang('de'));
  btnEN.addEventListener('click',()=>setLang('en'));
  const lang=(()=>{ try{return localStorage.getItem('timecells_lang')||'de';}catch(e){return 'de';} })();
  setLang(lang);

  // Figma Vollbild
  const btnFigmaFull=document.getElementById('btnFigmaFull');
  const btnCloseOverlay=document.getElementById('btnCloseOverlay');
  btnFigmaFull.addEventListener('click', ()=>{
    overlay.classList.remove('hidden');
    overlay.setAttribute('aria-hidden','false');
  });
  btnCloseOverlay.addEventListener('click', ()=>{
    overlay.classList.add('hidden');
    overlay.setAttribute('aria-hidden','true');
  });
  overlay.addEventListener('click', (e)=>{
    if(e.target===overlay){
      overlay.classList.add('hidden');
      overlay.setAttribute('aria-hidden','true');
    }
  });

  // Slides (30 Platzhalter)
  const slides = Array.from({length:30}, (_,i)=>({
    de:{ title:`Platzhalter – Folie ${i+1}`, text:`Ersetze diese Folie später mit dem jeweiligen Inhalt aus der Präsentation (Schritt ${i+1}).` },
    en:{ title:`Placeholder – Slide ${i+1}`, text:`Replace this slide later with the corresponding content from the presentation (Step ${i+1}).` }
  }));

  let current = 0;
  const titleDE=document.getElementById('titleDE');
  const textDE=document.getElementById('textDE');
  const titleEN=document.getElementById('titleEN');
  const textEN=document.getElementById('textEN');
  const progressDE=document.getElementById('progressDE');
  const progressEN=document.getElementById('progressEN');
  const prevBtn=document.getElementById('prevBtn');
  const nextBtn=document.getElementById('nextBtn');

  function clamp(n,min,max){ return Math.max(min,Math.min(max,n)); }

  function render(idx){
    idx = clamp(idx,0,slides.length-1);
    current = idx;
    const s = slides[idx];
    titleDE.textContent = s.de.title;
    textDE.textContent  = s.de.text;
    titleEN.textContent = s.en.title;
    textEN.textContent  = s.en.text;

    progressDE.textContent = `Folie ${idx+1} / ${slides.length}`;
    progressEN.textContent = `Slide ${idx+1} / ${slides.length}`;

    prevBtn.disabled = (idx===0);
    nextBtn.disabled = (idx===slides.length-1);
  }

  prevBtn.addEventListener('click',()=>{ render(current-1); });
  nextBtn.addEventListener('click',()=>{ render(current+1); });
  window.addEventListener('keydown',(e)=>{
    if(e.key==='ArrowLeft')  render(current-1);
    if(e.key==='ArrowRight') render(current+1);
  });

  const q = new URLSearchParams(location.search);
  const startIdx = parseInt(q.get('s')||'1',10);
  render(isNaN(startIdx)?0:clamp(startIdx-1,0,slides.length-1));

  /* ── Affiliate-Leiste & Öffnungslogik ─────────────────────────────────── */
  const ctaEnroll   = document.getElementById('ctaEnroll');
  const affBar      = document.getElementById('affBar');
  const affInput    = document.getElementById('affInput');
  const affSaveOpen = document.getElementById('affSaveOpen');
  const affCancel   = document.getElementById('affCancel');
  const affError    = document.getElementById('affError');
  const toast       = document.getElementById('toast');

  function showAffBar(prefill){
    if(prefill) affInput.value = prefill; else affInput.value = '';
    affBar.classList.add('open'); affBar.setAttribute('aria-hidden','false');
    setTimeout(()=>{ try{ affInput.focus(); affInput.select(); }catch(e){} }, 10);
    document.body.style.overflow='hidden';
  }
  function hideAffBar(){
    affBar.classList.remove('open'); affBar.setAttribute('aria-hidden','true');
    document.body.style.overflow='';
    affError.style.display='none';
  }
  function isValidUrl(u){
    try{
      const url = new URL(u);
      return url.protocol==='https:' || url.protocol==='http:';
    }catch(e){ return false; }
  }
  function getSaved(){
    try{ return localStorage.getItem('timecells_affiliate_url') || ''; }catch(e){ return ''; }
  }
  function saveUrl(u){
    try{ localStorage.setItem('timecells_affiliate_url', u); }catch(e){}
  }
  function openEnroll(u){
    window.open(u, '_blank', 'noopener,noreferrer');
  }
  function showToast(){
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 1400);
  }

  // CTA: erst prüfen/abfragen, dann öffnen
  ctaEnroll.addEventListener('click', (e)=>{
    e.preventDefault();
    const saved = getSaved();
    if(isValidUrl(saved)){
      openEnroll(saved);
    }else{
      showAffBar(saved);
    }
  });

  // Enter/Escape im Eingabefeld
  affInput.addEventListener('keydown', (e)=>{
    if(e.key==='Enter'){ affSaveOpen.click(); }
    if(e.key==='Escape'){ affCancel.click(); }
  });

  // Speichern & Öffnen
  affSaveOpen.addEventListener('click', ()=>{
    const val = affInput.value.trim();
    if(!isValidUrl(val)){
      affError.style.display='block';
      return;
    }
    saveUrl(val);
    hideAffBar();
    showToast();
    openEnroll(val);
  });

  // Abbrechen
  affCancel.addEventListener('click', hideAffBar);

  // ESC schließt die Leiste
  window.addEventListener('keydown', (e)=>{
    if(e.key==='Escape' && affBar.classList.contains('open')){
      hideAffBar();
    }
  });
})();
</script>

</body>
</html>
