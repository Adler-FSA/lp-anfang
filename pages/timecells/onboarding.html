<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Timecells – Onboarding</title>
<meta name="description" content="Onboarding: Haftungsausschluss, Figma-Präsentation und 30-Schritte Slideshow – zweisprachig (DE/EN).">
<style>
  :root{
    --accent:#00a36c;
    --gold:#d4af37;
    --text:#f0f0f0;
    --muted:#c9c9c9;
    --card:rgba(10,10,20,.72);
    --radius:16px;
    --shadow:0 0 28px rgba(0,163,108,.45),0 10px 28px rgba(0,0,0,.6);
    --maxw:980px;
  }
  html,body{
    margin:0;padding:0;height:100%;
    font-family:Inter,system-ui,sans-serif;
    color:var(--text); background:transparent; overflow-x:hidden;
  }

  /* Hintergrund (Parallax) */
  .bg-fixed{
    position:fixed; inset:0;
    background:url('../../library/images/backgrounds/timecells-index-bg.jpg') center/cover no-repeat;
    z-index:-2; transform:translateY(0); transition:transform .2s linear;
  }

  main{ position:relative; z-index:1; max-width:var(--maxw); margin:0 auto; padding:100px 20px 120px; }

  .card{
    background:var(--card);
    border:1px solid rgba(212,175,55,.28);
    border-radius:var(--radius);
    box-shadow:var(--shadow), 0 0 22px rgba(212,175,55,.22);
    backdrop-filter:blur(6px) saturate(120%);
    padding:32px; margin-bottom:48px; animation:fadeIn 1.1s ease both;
  }
  @keyframes fadeIn{ from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:none} }

  h1,h2{ color:var(--accent); margin:0 0 12px; font-family:Montserrat,system-ui,sans-serif; }
  h1{ font-size:2rem; text-align:center; }
  h2{ font-size:1.25rem; }
  p,li{ color:var(--muted); line-height:1.7; }
  ul{ margin:0.4rem 0 0 1.2rem; }

  .langbar{ position:fixed; top:14px; right:20px; display:flex; gap:8px; z-index:5; }
  .langbtn{
    border:1px solid rgba(255,255,255,.25); background:rgba(0,0,0,.45); color:#fff;
    padding:6px 12px; border-radius:8px; cursor:pointer; user-select:none;
  }
  .langbtn.active{ background:var(--accent); border-color:var(--accent); }
  .hidden{ display:none !important; }

  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 10px; border-radius:999px; font-size:.92rem;
    background:rgba(0,163,108,.16); border:1px solid rgba(0,163,108,.35); color:#e9ffee;
  }

  .cta-row{ display:flex; flex-wrap:wrap; gap:12px; margin-top:12px; }
  .btn{
    display:inline-flex; align-items:center; gap:10px;
    text-decoration:none; font-weight:700; letter-spacing:.2px;
    padding:12px 18px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.55); color:#fff; transition:transform .22s ease, filter .22s ease, background .22s ease;
    box-shadow:0 0 18px rgba(0,163,108,.25);
    cursor:pointer; user-select:none;
  }
  .btn:hover{ transform:translateY(-2px); filter:brightness(1.07); background:rgba(0,0,0,.65); }
  .btn.primary{ background:var(--accent); border-color:var(--accent); box-shadow:0 0 26px rgba(0,163,108,.45); }
  .icon{ width:20px; height:20px; flex:0 0 20px; }

  /* Bild-Slideshow (16:9 wie Figma) */
  .slide-wrap{ display:grid; grid-template-columns:1fr; gap:16px; }
  .slide-head{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .img-embed{
    position:relative; width:100%; aspect-ratio:16/9;
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px; overflow:hidden; background:rgba(0,0,0,.35);
  }
  .img-embed img{ position:absolute; inset:0; width:100%; height:100%; object-fit:contain; }
  .img-embed .empty{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    color:var(--muted); font-size:1rem; padding:16px; text-align:center;
  }
  .nav-row{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:6px; }

  footer{ text-align:center; margin-top:56px; padding-top:24px; }
  .btn-back{
    display:inline-block; background:var(--accent); color:#fff; text-decoration:none; font-weight:700;
    padding:12px 26px; border-radius:999px; box-shadow:0 0 28px rgba(0,163,108,.45),0 0 20px rgba(212,175,55,.25);
    transition:transform .25s ease,filter .25s ease; margin-bottom:12px;
  }
  .btn-back:hover{ transform:translateY(-3px); filter:brightness(1.08); }

  /* Figma Embed */
  .figma-wrap{ display:grid; gap:12px; }
  .figma-embed{
    position:relative; width:100%; aspect-ratio:16/9;
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px; overflow:hidden; background:rgba(0,0,0,.35);
  }
  .figma-embed iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }

  /* Vollbild-Overlay */
  .overlay{
    position:fixed; inset:0; background:rgba(0,0,0,.88);
    display:flex; align-items:center; justify-content:center; z-index:50;
  }
  .overlay-inner{
    position:relative; width:min(94vw,1200px); aspect-ratio:16/9; border-radius:16px; overflow:hidden;
    border:1px solid rgba(255,255,255,.18); box-shadow:0 20px 60px rgba(0,0,0,.6);
  }
  .overlay iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }
  .overlay-close{
    position:absolute; top:10px; right:10px; display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.2);
    background:rgba(0,0,0,.55); color:#fff; cursor:pointer; z-index:2;
  }

  /* Affiliate-Bar */
  .affbar{
    position:fixed; top:-220px; left:0; right:0; z-index:60;
    backdrop-filter:blur(8px) saturate(140%);
    background:linear-gradient(180deg, rgba(3,10,8,.92), rgba(3,10,8,.86));
    border-bottom:1px solid rgba(212,175,55,.28);
    box-shadow:0 10px 40px rgba(0,0,0,.5), 0 0 28px rgba(0,163,108,.35);
    transition:top .28s ease;
  }
  .affbar.open{ top:0; }
  .affbar-inner{ max-width:var(--maxw); margin:0 auto; padding:16px 20px; display:grid; gap:10px; }
  .aff-row{ display:flex; gap:10px; align-items:center; }
  .aff-title{ display:flex; align-items:center; gap:8px; font-weight:700; color:#fff; }
  .addr{
    flex:1; display:flex; align-items:center; gap:10px;
    background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.18);
    border-radius:12px; padding:10px 12px;
  }
  .addr input{
    flex:1; background:transparent; border:0; outline:0; color:#fff;
    font-size:.98rem; font-family:inherit;
  }
  .aff-help{ color:var(--muted); font-size:.9rem; margin:0 0 2px; }
  .aff-error{ color:#ffb4b4; font-size:.9rem; margin:0; display:none; }
  .aff-actions{ display:flex; gap:10px; }
  .btn-ghost{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 14px; border-radius:10px; background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.18); color:#fff; cursor:pointer;
  }
  .btn-ghost:hover{ filter:brightness(1.06); transform:translateY(-1px); }

  /* Toast */
  .toast{
    position:fixed; bottom:18px; left:50%; transform:translateX(-50%);
    background:rgba(0,0,0,.75); border:1px solid rgba(255,255,255,.18);
    color:#fff; padding:10px 14px; border-radius:10px; font-size:.92rem; z-index:70;
    box-shadow:0 8px 28px rgba(0,0,0,.4);
    display:none;
  }
  .toast.show{ display:block; }
  .muted-link{ display:inline-block; margin-top:8px; color:var(--muted); text-decoration:underline; cursor:pointer; }
</style>
</head>
<body>

<div class="bg-fixed" aria-hidden="true"></div>

<!-- Sprachumschalter -->
<div class="langbar">
  <button id="btnDE" class="langbtn active" data-i18n="lang.de">DE</button>
  <button id="btnEN" class="langbtn" data-i18n="lang.en">EN</button>
</div>

<!-- Affiliate „Browserleiste“ -->
<div id="affBar" class="affbar" role="dialog" aria-modal="true" aria-labelledby="affTitle" aria-hidden="true">
  <div class="affbar-inner">
    <div class="aff-title" id="affTitle">
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M8 10V7a4 4 0 0 1 8 0v3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        <rect x="4" y="10" width="16" height="10" rx="2" stroke="currentColor" stroke-width="1.8" fill="none"/>
      </svg>
      <span class="de" data-i18n="aff.title.de">Affiliate-Link erforderlich</span>
      <span class="en hidden" data-i18n="aff.title.en">Affiliate link required</span>
    </div>
    <p class="aff-help de" data-i18n="aff.help.de">Füge deinen persönlichen Affiliate-Link ein (nur <b>land.timecells.app</b>). Danach kannst du ihn an neue Partner teilen.</p>
    <p class="aff-help en hidden" data-i18n="aff.help.en">Paste your personal affiliate link (only <b>land.timecells.app</b>). Then share it with new partners.</p>

    <div class="aff-row">
      <div class="addr" style="min-height:44px">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6" fill="none"/>
          <path d="M3 12h18M12 3a16 16 0 0 1 0 18M12 3a16 16 0 0 0 0 18" stroke="currentColor" stroke-width="1.4" fill="none"/>
        </svg>
        <input id="affInput" type="url" inputmode="url" autocomplete="url" placeholder="https://land.timecells.app/?ref=…" aria-label="Affiliate-Link" />
      </div>
      <div class="aff-actions">
        <button id="affSaveOpen" class="btn-ghost">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 12l4 4 10-10" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="de" data-i18n="aff.saveopen.de">Speichern</span>
          <span class="en hidden" data-i18n="aff.saveopen.en">Save</span>
        </button>
        <button id="affCancel" class="btn-ghost">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
          </svg>
          <span class="de" data-i18n="aff.cancel.de">Abbrechen</span>
          <span class="en hidden" data-i18n="aff.cancel.en">Cancel</span>
        </button>
      </div>
    </div>
    <p id="affError" class="aff-error de" data-i18n="aff.error.de">Bitte eine gültige http(s)-URL zur Domain <b>land.timecells.app</b> einfügen.</p>
    <p class="aff-error en hidden" data-i18n="aff.error.en">Please provide a valid http(s) URL to <b>land.timecells.app</b>.</p>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite">
  <span class="de">Affiliate-Link gespeichert.</span>
  <span class="en hidden">Affiliate link saved.</span>
  <span class="de hidden" id="toastFromUrl">Affiliate-Link aus URL übernommen.</span>
  <span class="en hidden" id="toastFromUrlEN">Affiliate link taken from URL.</span>
  <span class="de hidden" id="toastReset">Affiliate-Link zurückgesetzt.</span>
  <span class="en hidden" id="toastResetEN">Affiliate link reset.</span>
  <span class="de hidden" id="toastCopied">Link kopiert – jetzt an den neuen Partner senden.</span>
  <span class="en hidden" id="toastCopiedEN">Link copied — send it to the new partner.</span>
  <span class="de hidden" id="toastShared">Teilen-Dialog geöffnet.</span>
  <span class="en hidden" id="toastSharedEN">Share dialog opened.</span>
</div>

<main>
  <!-- Header -->
  <div class="card">
    <h1 class="de" data-i18n="onb.title.de">Timecells – Onboarding</h1>
    <h1 class="en hidden" data-i18n="onb.title.en">Timecells – Onboarding</h1>
    <p class="de" data-i18n="onb.lead.de" style="text-align:center; margin-top:6px;">
      Einschreiben passiert auf dem Gerät des neuen Partners. Teile dafür deinen Affiliate-Link.
    </p>
    <p class="en hidden" data-i18n="onb.lead.en" style="text-align:center; margin-top:6px;">
      Enrollment happens on the new partner’s device. Share your affiliate link for that.
    </p>
  </div>

  <!-- Haftungsausschluss -->
  <div class="card">
    <h2 class="de" data-i18n="onb.disclaimer.title.de">Haftungsausschluss</h2>
    <h2 class="en hidden" data-i18n="onb.disclaimer.title.en">Disclaimer</h2>
    <p class="de" data-i18n="onb.disclaimer.text.de">
      Die Akademie und der Empfehlungsgeber leisten keine Anlage-, Steuer- oder Rechtsberatung.
      Inhalte dienen ausschließlich der Bildung. Entscheidungen triffst du eigenverantwortlich.
      Es bestehen Risiken bis hin zum Totalverlust. Prüfe stets lokale Gesetze und Vorschriften.
    </p>
    <p class="en hidden" data-i18n="onb.disclaimer.text.en">
      The Academy and the referrer do not provide investment, tax, or legal advice.
      Content is educational only. You are solely responsible for your decisions.
      There is risk up to total loss. Always check local laws and regulations.
    </p>
  </div>

  <!-- Präsentation (Figma) -->
  <div class="card">
    <h2 class="de">Präsentation (Figma)</h2>
    <h2 class="en hidden">Presentation (Figma)</h2>
    <div class="figma-wrap">
      <p class="de">Bitte öffne und sieh dir die Präsentation an. Du kannst sie direkt hier abspielen oder im Vollbild öffnen.</p>
      <p class="en hidden">Please open and view the presentation. You can play it here or open it in fullscreen.</p>

      <div class="figma-embed">
        <iframe
          id="figmaFrame"
          loading="lazy"
          allowfullscreen
          src="https://www.figma.com/embed?embed_host=share&url=https%3A%2F%2Fwww.figma.com%2Fproto%2FRSdor2g7dy6WwMoxscON5q%2FTimecells-Deutch%3Fpage-id%3D180%253A125%26node-id%3D180-127%26p%3Df%26viewport%3D135%252C343%252C0.02%26t%3Db2XFmH8gCBYp5wjO-1%26scaling%3Dmin-zoom%26content-scaling%3Dfixed%26starting-point-node-id%3D180%253A127">
        </iframe>
      </div>

      <div class="cta-row">
        <a class="btn" target="_blank" rel="noopener"
           href="https://www.figma.com/proto/RSdor2g7dy6WwMoxscON5q/Timecells-Deutch?page-id=180%3A125&node-id=180-127&p=f&viewport=135%2C343%2C0.02&t=b2XFmH8gCBYp5wjO-1&scaling=min-zoom&content-scaling=fixed&starting-point-node-id=180%3A127">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M14 3h7v7" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 14L21 3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M21 13v6a2 2 0 0 1-2 2h-12a2 2 0 0 1-2-2v-12a2 2 0 0 1 2-2h6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
          <span class="de">Im neuen Tab öffnen</span>
          <span class="en hidden">Open in new tab</span>
        </a>

        <button class="btn" id="btnFigmaFull">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 9V4h5M20 9V4h-5M4 15v5h5M20 15v5h-5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
          <span class="de">Vollbild</span>
          <span class="en hidden">Fullscreen</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Einschreibe-Anleitung (Bild-Slideshow 16:9) -->
  <div class="card" id="slideshow">
    <div class="slide-wrap">
      <div class="slide-head">
        <div class="pill">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="5" cy="12" r="2" fill="currentColor"/>
            <circle cx="12" cy="12" r="2" fill="currentColor"/>
            <circle cx="19" cy="12" r="2" fill="currentColor"/>
          </svg>
          <span class="de" id="progressDE">Folie 0 / 0</span>
          <span class="en hidden" id="progressEN">Slide 0 / 0</span>
        </div>
        <div class="pill" id="hint">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" stroke-width="1.6"/>
            <path d="M6 10h2M10 10h2M14 10h2M18 10h-1M5 14h14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
          <span class="de">Pfeiltasten ← → nutzbar</span>
          <span class="en hidden">Arrow keys ← → enabled</span>
        </div>
      </div>

      <div class="img-embed">
        <img id="imgSlide" alt="Einschreibe-Anleitung" />
        <div id="imgEmpty" class="empty">
          <span class="de">Keine Slides gefunden. Bitte Bilder <code>timecells-onboarding-slide-01..30.jpg</code> hochladen.</span>
          <span class="en hidden">No slides found. Please upload images named <code>timecells-onboarding-slide-01..30.jpg</code>.</span>
        </div>
      </div>

      <div class="nav-row">
        <button class="btn" id="prevBtn" aria-label="Vorherige Folie">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M14 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="de" data-i18n="onb.prev.de">Zurück</span>
          <span class="en hidden" data-i18n="onb.prev.en">Prev</span>
        </button>

        <div class="cta-row">
          <a class="btn primary" id="ctaEnroll" href="#" role="button">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 12v7a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-7" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 16V4M12 4l-4 4M12 4l4 4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="de">Einschreibe-Link teilen</span>
            <span class="en hidden">Share enrollment link</span>
          </a>
        </div>

        <button class="btn" id="nextBtn" aria-label="Nächste Folie">
          <span class="de" data-i18n="onb.next.de">Weiter</span>
          <span class="en hidden" data-i18n="onb.next.en">Next</span>
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <footer>
    <a href="timecells-basis.html" class="btn-back de" data-i18n="back.de">← Zurück zur Basis</a>
    <a href="timecells-basis.html" class="btn-back en hidden" data-i18n="back.en">← Back to Basis</a>
    <div>
      <button id="affReset" class="muted-link de" data-i18n="aff.reset.de">Affiliate-Link ändern / zurücksetzen</button>
      <button id="affResetEN" class="muted-link en hidden" data-i18n="aff.reset.en">Change / reset affiliate link</button>
    </div>
    <p>© 2025 Timecells • Onboarding</p>
  </footer>
</main>

<!-- Vollbild-Overlay für Figma -->
<div id="figmaOverlay" class="overlay hidden" aria-hidden="true">
  <div class="overlay-inner">
    <button id="btnCloseOverlay" class="overlay-close" aria-label="Overlay schließen">
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M6 6l12 12M18 6L6 18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="de">Schließen</span>
      <span class="en hidden">Close</span>
    </button>
    <iframe
      id="figmaFrameFull"
      allowfullscreen
      src="https://www.figma.com/embed?embed_host=share&url=https%3A%2F%2Fwww.figma.com%2Fproto%2FRSdor2g7dy6WwMoxscON5q%2FTimecells-Deutch%3Fpage-id%3D180%253A125%26node-id%3D180-127%26p%3Df%26viewport%3D135%252C343%252C0.02%26t%3Db2XFmH8gCBYp5wjO-1%26scaling%3Dmin-zoom%26content-scaling%3Dfixed%26starting-point-node-id%3D180%253A127">
    </iframe>
  </div>
</div>

<script>
(function(){
  /* Parallax */
  const bg=document.querySelector('.bg-fixed');
  window.addEventListener('scroll',()=>{ bg.style.transform=`translateY(${window.scrollY*0.3}px)`; });

  /* Language */
  const btnDE=document.getElementById('btnDE');
  const btnEN=document.getElementById('btnEN');
  const overlay=document.getElementById('figmaOverlay');
  const setLang=(lang)=>{
    const isDE=(lang==='de');
    document.querySelectorAll('.de').forEach(el=>el.classList.toggle('hidden',!isDE));
    document.querySelectorAll('.en').forEach(el=>el.classList.toggle('hidden',isDE));
    if(btnDE) btnDE.classList.toggle('active',isDE);
    if(btnEN) btnEN.classList.toggle('active',!isDE);
    document.documentElement.lang=lang;
    try{ localStorage.setItem('timecells_lang',lang);}catch(e){}
    if(overlay) overlay.setAttribute('aria-hidden', overlay.classList.contains('hidden') ? 'true' : 'false');
    updateProgress();
  };
  if(btnDE) btnDE.addEventListener('click',()=>setLang('de'));
  if(btnEN) btnEN.addEventListener('click',()=>setLang('en'));
  setLang((()=>{try{return localStorage.getItem('timecells_lang')||'de'}catch(e){return 'de'}})());

  /* Figma Overlay */
  const btnFigmaFull=document.getElementById('btnFigmaFull');
  const btnCloseOverlay=document.getElementById('btnCloseOverlay');
  if(btnFigmaFull) btnFigmaFull.addEventListener('click', ()=>{ overlay.classList.remove('hidden'); overlay.setAttribute('aria-hidden','false'); });
  if(btnCloseOverlay) btnCloseOverlay.addEventListener('click', ()=>{ overlay.classList.add('hidden'); overlay.setAttribute('aria-hidden','true'); });
  if(overlay) overlay.addEventListener('click', (e)=>{ if(e.target===overlay){ overlay.classList.add('hidden'); overlay.setAttribute('aria-hidden','true'); } });

  /* Bild-Slideshow – lädt vorhandene Dateien 01..30 */
  const IMG_DIR='../../library/images/timecells/onboarding/';
  const BASE   ='timecells-onboarding-slide-';
  const EXT    ='.jpg';
  const imgEl  = document.getElementById('imgSlide');
  const empty  = document.getElementById('imgEmpty');
  const progressDE=document.getElementById('progressDE');
  const progressEN=document.getElementById('progressEN');
  const prevBtn=document.getElementById('prevBtn');
  const nextBtn=document.getElementById('nextBtn');

  let images=[], current=0;

  function pad2(n){ return String(n).padStart(2,'0'); }
  function tryLoad(url){
    return new Promise((res)=>{ const im=new Image(); im.onload=()=>res(url); im.onerror=()=>res(null); im.src=url; });
  }
  async function loadImages(){
    const candidates = Array.from({length:30},(_,i)=>`${IMG_DIR}${BASE}${pad2(i+1)}${EXT}`);
    const results = await Promise.all(candidates.map(tryLoad));
    images = results.filter(Boolean);
    if(images.length>0){
      empty.style.display='none';
      current = clamp(parseInt(new URLSearchParams(location.search).get('s')||'1',10)-1,0,images.length-1);
      render(current);
    }else{
      empty.style.display='flex';
      imgEl.removeAttribute('src');
      updateProgress();
      if(prevBtn) prevBtn.disabled=true;
      if(nextBtn) nextBtn.disabled=true;
    }
  }

  function clamp(n,min,max){ return Math.max(min,Math.min(max,n)); }
  function render(idx){
    current = clamp(idx,0,images.length-1);
    imgEl.src = images[current];
    updateProgress();
    if(prevBtn) prevBtn.disabled = (current===0);
    if(nextBtn) nextBtn.disabled = (current===images.length-1);
  }
  function updateProgress(){
    const total = images.length;
    const i = total? (current+1) : 0;
    if(progressDE) progressDE.textContent = `Folie ${i} / ${total}`;
    if(progressEN) progressEN.textContent = `Slide ${i} / ${total}`;
  }

  if(prevBtn) prevBtn.addEventListener('click',()=>render(current-1));
  if(nextBtn) nextBtn.addEventListener('click',()=>render(current+1));
  window.addEventListener('keydown',(e)=>{ if(e.key==='ArrowLeft')render(current-1); if(e.key==='ArrowRight')render(current+1); });

  loadImages();

  /* Affiliate-Flow (Teilen/Kopieren) */
  const WHITELIST=['land.timecells.app'];
  const ctaEnroll   = document.getElementById('ctaEnroll');
  const affBar      = document.getElementById('affBar');
  const affInput    = document.getElementById('affInput');
  const affSaveOpen = document.getElementById('affSaveOpen');
  const affCancel   = document.getElementById('affCancel');
  const affError    = document.getElementById('affError');
  const toast       = document.getElementById('toast');
  const affReset    = document.getElementById('affReset');
  const affResetEN  = document.getElementById('affResetEN');

  function isValidUrl(u){
    try{
      const url=new URL(u);
      return (url.protocol==='https:'||url.protocol==='http:') && WHITELIST.includes(url.hostname);
    }catch(e){ return false; }
  }
  function getSaved(){ try{return localStorage.getItem('timecells_affiliate_url')||''}catch(e){return ''} }
  function saveUrl(u){ try{localStorage.setItem('timecells_affiliate_url',u)}catch(e){} }
  function clearUrl(){ try{localStorage.removeItem('timecells_affiliate_url')}catch(e){} }

  function showAffBar(prefill){
    affInput.value=prefill||'';
    affBar.classList.add('open'); affBar.setAttribute('aria-hidden','false');
    setTimeout(()=>{ try{affInput.focus(); affInput.select();}catch(e){} },10);
    document.body.style.overflow='hidden'; affError.style.display='none';
  }
  function hideAffBar(){ affBar.classList.remove('open'); affBar.setAttribute('aria-hidden','true'); document.body.style.overflow=''; affError.style.display='none'; }

  function copyToClipboard(text){
    if(navigator.clipboard&&navigator.clipboard.writeText) return navigator.clipboard.writeText(text);
    const ta=document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.top='-2000px';
    document.body.appendChild(ta); ta.focus(); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
    return Promise.resolve();
  }
  function showToastId(id){
    Array.from(toast.children).forEach(n=>n.classList.add('hidden'));
    const isDE=document.documentElement.lang==='de';
    const map={ toastCopied:isDE?'toastCopied':'toastCopiedEN', toastShared:isDE?'toastShared':'toastSharedEN', toastFromUrl:isDE?'toastFromUrl':'toastFromUrlEN', toastReset:isDE?'toastReset':'toastResetEN' };
    const el=document.getElementById(map[id]||id);
    if(el) el.classList.remove('hidden'); toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1500);
  }

  if(ctaEnroll) ctaEnroll.addEventListener('click', async (e)=>{
    e.preventDefault();
    const link=getSaved();
    if(!isValidUrl(link)){ showAffBar(link); return; }
    try{
      if(navigator.share){ await navigator.share({title:'Timecells – Enrollment', text:'Hier ist mein Einschreibe-Link:', url:link}); showToastId('toastShared'); }
      else { await copyToClipboard(link); showToastId('toastCopied'); }
    }catch(_){ try{ await copyToClipboard(link); showToastId('toastCopied'); }catch(_){} }
  });

  if(affSaveOpen) affSaveOpen.addEventListener('click', ()=>{
    const val=affInput.value.trim();
    if(!isValidUrl(val)){ affError.style.display='block'; return; }
    saveUrl(val); hideAffBar();
    Array.from(toast.children).forEach(n=>n.classList.add('hidden'));
    toast.firstElementChild.classList.remove('hidden'); toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1200);
  });
  if(affCancel) affCancel.addEventListener('click', hideAffBar);
  window.addEventListener('keydown',(e)=>{ if(e.key==='Escape'&&affBar.classList.contains('open')) hideAffBar(); });

  function resetFlow(){ clearUrl(); showAffBar(''); showToastId('toastReset'); }
  if(affReset)   affReset.addEventListener('click', resetFlow);
  if(affResetEN) affResetEN.addEventListener('click', resetFlow);

  // Prefill via ?aff=…
  (function(){
    const q=new URLSearchParams(location.search);
    const aff=q.get('aff'); if(!aff) return;
    if(isValidUrl(aff)){ saveUrl(aff); showToastId('toastFromUrl'); } else { showAffBar(aff); }
  })();
})();
</script>

</body>
</html>
