<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kapitel 04 – Zielgruppen & Ausgangslagen (wen wir abholen und wie)</title>
  <meta name="description" content="Vertriebshandbuch – Kapitel 04: Zielgruppen & Ausgangslagen (wen wir abholen und wie)." />

  <style>
    :root{
      --bg:#050814;
      --bg2:#020617;
      --panel:rgba(15,23,42,.88);
      --panel2:rgba(15,23,42,.72);
      --txt:#e9eef7;
      --muted:#a9b4c7;
      --gold:#d4af37;
      --gold2:#f2d37a;
      --shadow:0 24px 60px rgba(0,0,0,.55);
      --glow:0 0 26px rgba(212,175,55,.22), 0 12px 30px rgba(0,0,0,.55);
      --radius:18px;
      --maxw:1100px;
    }
    *{box-sizing:border-box;}

    html,body{
      margin:0;
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(212,175,55,.10), transparent 55%),
        radial-gradient(900px 600px at 80% 30%, rgba(94,168,255,.08), transparent 60%),
        linear-gradient(180deg,var(--bg),var(--bg2));
      color:var(--txt);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      overflow-x:hidden;
    }

    /* Text-Sicherheit (Pflicht) */
    body{
      hyphens:auto;
      -webkit-hyphens:auto;
      -ms-hyphens:auto;
      overflow-wrap:anywhere;
      word-break:normal;
    }
    p,li,td,th,small,span,div,h1,h2,h3{
      overflow-wrap:anywhere;
      word-break:normal;
      hyphens:auto;
    }

    .wrap{max-width:var(--maxw);margin:0 auto;padding:34px 18px 60px;}

    .topbar{
      display:flex;align-items:flex-start;justify-content:space-between;
      gap:12px;flex-wrap:wrap;margin:6px 0 14px;
    }
    .brand{
      display:flex;flex-direction:column;gap:6px;min-width:min(720px,100%);
    }

    .kicker{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(212,175,55,.25);
      background:rgba(0,0,0,.18);
      color:var(--gold2);
      font-size:12px;font-weight:800;letter-spacing:.25px;
      width:fit-content; white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:99px;
      background:rgba(242,211,122,.9);
      box-shadow:0 0 12px rgba(212,175,55,.35)
    }

    h1{margin:0;font-size:34px;line-height:1.1;font-weight:900}
    .sub{margin:2px 0 0;color:var(--muted);max-width:95ch;line-height:1.55}

    .line{
      height:2px;
      background:linear-gradient(90deg,transparent,var(--gold),transparent);
      opacity:.85;margin:12px 0 18px;
    }

    .panel{
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid rgba(212,175,55,.22);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(6px);
      padding:18px 18px;
      position:relative;
      overflow:hidden;
      margin-top:14px;
    }
    .panel:before{
      content:"";
      position:absolute;inset:-2px;
      background:radial-gradient(650px 240px at 10% 0%, rgba(212,175,55,.10), transparent 55%);
      pointer-events:none;
    }
    .panel > *{position:relative;z-index:1;}

    h2{margin:0 0 8px;font-size:18px;letter-spacing:.2px;color:var(--gold2)}
    p{margin:0 0 10px;color:var(--txt);line-height:1.7;font-size:14.5px;opacity:.98}
    .muted{color:var(--muted);}
    .hr{height:1px;background:rgba(212,175,55,.22);margin:14px 0}

    /* Optionaler Anschauung Block */
    .vizGrid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:12px;
      align-items:stretch;
      margin-top:10px;
    }
    @media (max-width: 980px){
      .vizGrid{grid-template-columns:1fr;}
    }
    .vizCard{
      border:1px solid rgba(212,175,55,.22);
      background:rgba(0,0,0,.14);
      border-radius:16px;
      padding:12px;
      overflow:hidden;
      min-width:0;
    }
    .vizTitle{
      margin:0 0 10px;
      font-weight:900;
      color:var(--txt);
      font-size:14.5px;
    }
    .vizInner{
      border:1px solid rgba(212,175,55,.16);
      background:rgba(0,0,0,.14);
      border-radius:14px;
      padding:12px;
      min-width:0;
      overflow:hidden;
    }

    .miniTableWrap{min-width:0; overflow:hidden;}
    table.mini{
      width:100%;
      border-collapse:collapse;
      table-layout:auto;
    }
    table.mini th, table.mini td{
      text-align:left;
      vertical-align:top;
      padding:10px 10px;
      border-bottom:1px solid rgba(212,175,55,.18);
      font-size:13.5px;
      line-height:1.45;
      white-space:normal;
      overflow-wrap:break-word;
      word-break:break-word;
    }
    table.mini th{
      color:var(--gold2);
      font-weight:900;
      border-bottom:1px solid rgba(212,175,55,.26);
      font-size:13px;
    }
    table.mini tr:last-child td{border-bottom:none;}

    /* Form Inputs (für Ausfüllfelder) */
    .fieldRow{display:grid;grid-template-columns:1fr;gap:8px;margin:10px 0 2px;}
    .label{font-size:13px;color:var(--muted);font-weight:700;}
    .inp, .sel{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(212,175,55,.22);
      background:rgba(0,0,0,.18);
      color:var(--txt);
      outline:none;
      font-size:14px;
      line-height:1.4;
    }
    .inp:focus, .sel:focus{border-color:rgba(212,175,55,.42);box-shadow:0 0 0 3px rgba(212,175,55,.10);}
    .inp::placeholder{color:rgba(169,180,199,.75);}

    textarea{
      width:100%;
      min-height:200px;
      resize:vertical;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(212,175,55,.22);
      background:rgba(0,0,0,.18);
      color:var(--txt);
      outline:none;
      line-height:1.6;
      font-size:14px;
    }
    textarea:focus{border-color:rgba(212,175,55,.42);box-shadow:0 0 0 3px rgba(212,175,55,.10);}

    .noteRow{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:10px
    }
    .saveHint{font-size:12px;color:var(--muted);}
    .smallBtn{
      padding:10px 12px;border-radius:14px;
      border:1px solid rgba(212,175,55,.28);
      background:rgba(0,0,0,.22);
      color:var(--txt);
      font-weight:900;
      display:inline-flex;align-items:center;gap:8px;
      white-space:nowrap;cursor:pointer;
      text-decoration:none;
    }
    .smallBtn:hover{background:rgba(0,0,0,.28);}

    /* FooterNav (Look wie Kapitel 28) */
    .footerNav{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;align-items:center;}
    .footerNav .left,.footerNav .mid,.footerNav .right{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .navBtn{
      padding:10px 12px;border-radius:14px;
      border:1px solid rgba(212,175,55,.28);
      background:rgba(0,0,0,.22);
      color:var(--txt);font-weight:900;text-decoration:none;
      display:inline-flex;align-items:center;gap:8px;white-space:nowrap;
    }
    .navBtn:hover{background:rgba(0,0,0,.28);}
    .navBtnPrimary{
      background:linear-gradient(180deg, rgba(212,175,55,.95), rgba(212,175,55,.75));
      color:#111;border:none;box-shadow:var(--glow);
    }
    .navBtnPrimary:hover{filter:brightness(1.03);}

    /* =======================
       PRINT
       ======================= */
    @page{ margin:14mm; }
    @media print{
      html,body{
        background:#fff !important;color:#000 !important;
        height:auto !important;overflow:visible !important;
        -webkit-print-color-adjust: exact;print-color-adjust: exact;
      }
      .wrap{padding:0 !important;}
      .noteRow button{display:none !important;}
      .footerNav{display:none !important;}

      .panel{
        box-shadow:none !important;background:#fff !important;
        border:1px solid #999 !important;backdrop-filter:none !important;
      }
      .panel:before{display:none !important;}
      .sub,p,textarea,.muted,.label{color:#000 !important;}
      h1,h2{color:#000 !important;}
      .line{background:#999 !important;}
      a{color:#000 !important;text-decoration:none !important;}

      textarea,.inp,.sel{
        border:1px solid #999 !important;background:#fff !important;color:#000 !important;
      }

      .vizGrid{grid-template-columns: 1fr !important;}

      table.mini thead{display: table-header-group;}
      table.mini tr{break-inside: avoid;page-break-inside: avoid;}
      table.mini th, table.mini td{
        padding:6px 6px !important;
        font-size:11.5px !important;
        line-height:1.35 !important;
        color:#000 !important;
        border-bottom:1px solid #ddd !important;
        word-break: normal !important;
        overflow-wrap: break-word !important;
      }
      table.mini th{font-size:11.5px !important;}
      .vizCard,.vizInner{background:#fff !important;border:1px solid #999 !important;}
      svg text{fill:#000 !important;}
      svg .printStroke{stroke:#000 !important;}
      svg .printFill{fill:#fff !important;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="kicker"><span class="dot"></span> Band 1 – System, Club, Einstieg (Fundament)</div>
        <div>
          <h1>Kapitel 04 – Zielgruppen &amp; Ausgangslagen (wen wir abholen und wie)</h1>
          <div class="sub">Diagnose statt Marketing-Feuerwerk: Menschen sauber einordnen und passend abholen.</div>
        </div>
      </div>
    </div>

    <div class="line"></div>

    <section class="panel">
      <h2>Kernaussage</h2>
      <p><b>Menschen starten aus unterschiedlichen Gründen – aber sie suchen denselben Kern: Klarheit, Schutz, Struktur, Umsetzung.</b></p>

      <div class="hr"></div>

      <p>Wenn du Menschen begleiten oder ansprechen willst, brauchst du kein Marketing-Feuerwerk. Du brauchst Diagnose. Und Diagnose beginnt mit Verständnis: Nicht jeder will dasselbe, nicht jeder braucht dasselbe, nicht jeder ist im selben Zustand.</p>

      <div class="hr"></div>

      <h2>Zielgruppe 1: Angestellte &amp; Berufstätige</h2>
      <p>Sie suchen selten „Krypto“. Sie suchen Ruhe. Viele funktionieren, sind fleißig, pflichtbewusst – und spüren trotzdem Druck: steigende Kosten, unsichere Zukunft, wachsende Komplexität, Abhängigkeit von Systemen, die sie nicht kontrollieren. Für sie ist der Einstieg oft: Orientierung + ein kleiner, sauberer Schritt. Nicht mehr leisten – sondern bessere Werkzeuge nutzen.</p>

      <div class="hr"></div>

      <h2>Zielgruppe 2: Selbstständige &amp; Macher</h2>
      <p>Sie wollen Fokus. Sie haben oft schon vieles ausprobiert und sind müde von „noch einem Ding“. Hier wirkt das System, weil es einen roten Faden liefert. Das Ziel ist nicht, dass sie mehr tun – sondern, dass sie weniger falsch tun. Struktur spart Zeit und Fehlentscheidungen.</p>

      <div class="hr"></div>

      <h2>Zielgruppe 3: Unternehmer &amp; Führungskräfte / Vereine</h2>
      <p>Hier geht es um Handlungsfähigkeit, Risiko, Prozesse, Zugänge. Nicht um Spekulation. Die Sprache muss ruhig bleiben: Ergänzen statt ersetzen. Verantwortlichkeiten, Freigaben, Sicherheitslogik. Sie brauchen einen Rahmen, der professionell wirkt und nicht wie ein Trend.</p>

      <div class="hr"></div>

      <h2>Zielgruppe 4: Aufbau-Partner (Mentoren/Promoter später)</h2>
      <p>Das sind Menschen, die nicht nur lernen wollen, sondern Wirkung erzeugen: begleiten, strukturieren, helfen. Sie brauchen Standards, Rollen, klare Grenzen und einen Weg, wie man seriös empfiehlt, ohne Druck. Für sie ist der Club nicht nur Inhalt, sondern Kultur- und Rollenraum.</p>

      <div class="hr"></div>

      <p><b>Die wichtigste Erkenntnis:</b> Du zeigst nicht „Produkte“, du zeigst einen Weg. Und du gibst Menschen das Gefühl, dass sie wählen dürfen. Genau das entlastet: „Ich muss nicht alles. Ich starte passend.“</p>

      <div class="hr"></div>

      <h2>Anschauung</h2>

      <div class="vizGrid">
        <div class="vizCard">
          <div class="vizTitle">Zielgruppen-Radar (Motiv / Angst / Bedarf / Startpunkt)</div>
          <div class="vizInner" aria-label="Zielgruppen-Radar Grafik">
            <!-- Pro-Optik Inline-SVG (druckfähig, keine externen Ressourcen) -->
            <svg viewBox="0 0 860 520" width="100%" height="auto" role="img" aria-label="Zielgruppen-Radar">
              <defs>
                <linearGradient id="gGold" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="rgba(212,175,55,.95)"/>
                  <stop offset="1" stop-color="rgba(242,211,122,.75)"/>
                </linearGradient>
                <linearGradient id="gBlue" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="rgba(94,168,255,.95)"/>
                  <stop offset="1" stop-color="rgba(14,165,233,.65)"/>
                </linearGradient>
              </defs>

              <!-- Frame -->
              <rect x="14" y="14" width="832" height="492" rx="20"
                    fill="rgba(0,0,0,.12)" class="printFill"
                    stroke="rgba(212,175,55,.18)" stroke-width="2" class="printStroke"/>

              <!-- Radar area -->
              <g transform="translate(40,40)">
                <!-- grid -->
                <rect x="0" y="0" width="470" height="440" rx="18"
                      fill="rgba(15,23,42,.22)" class="printFill"
                      stroke="rgba(212,175,55,.16)" stroke-width="2" class="printStroke"/>

                <!-- cross -->
                <line x1="235" y1="18" x2="235" y2="422" stroke="rgba(255,255,255,.10)" stroke-width="2" class="printStroke"/>
                <line x1="18" y1="220" x2="452" y2="220" stroke="rgba(255,255,255,.10)" stroke-width="2" class="printStroke"/>

                <!-- rings -->
                <rect x="62" y="58" width="346" height="324" rx="16" fill="none" stroke="rgba(212,175,55,.10)" stroke-width="2" class="printStroke"/>
                <rect x="106" y="96" width="258" height="248" rx="16" fill="none" stroke="rgba(212,175,55,.08)" stroke-width="2" class="printStroke"/>

                <!-- axis labels -->
                <g font-family="system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif">
                  <text x="235" y="30" text-anchor="middle" font-size="14" font-weight="800" fill="rgba(242,211,122,.95)">
                    Motiv
                  </text>
                  <text x="235" y="436" text-anchor="middle" font-size="14" font-weight="800" fill="rgba(242,211,122,.95)">
                    Startpunkt
                  </text>
                  <text x="18" y="226" text-anchor="start" font-size="14" font-weight="800" fill="rgba(94,168,255,.92)">
                    Angst
                  </text>
                  <text x="452" y="226" text-anchor="end" font-size="14" font-weight="800" fill="rgba(94,168,255,.92)">
                    Bedarf
                  </text>
                </g>

                <!-- points (4 target groups) -->
                <g>
                  <!-- Angestellte -->
                  <circle cx="270" cy="140" r="8" fill="url(#gGold)"/>
                  <circle cx="270" cy="140" r="14" fill="rgba(212,175,55,.16)"/>
                  <!-- Selbstständige -->
                  <circle cx="340" cy="210" r="8" fill="url(#gBlue)"/>
                  <circle cx="340" cy="210" r="14" fill="rgba(94,168,255,.14)"/>
                  <!-- Unternehmer/Vereine -->
                  <circle cx="320" cy="292" r="8" fill="url(#gGold)"/>
                  <circle cx="320" cy="292" r="14" fill="rgba(212,175,55,.12)"/>
                  <!-- Aufbau-Partner -->
                  <circle cx="220" cy="260" r="8" fill="url(#gBlue)"/>
                  <circle cx="220" cy="260" r="14" fill="rgba(94,168,255,.12)"/>
                </g>

                <!-- legend -->
                <g transform="translate(0,456)" font-family="system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif">
                  <rect x="0" y="0" width="470" height="0" fill="transparent"/>
                </g>
              </g>

              <!-- Legend / Notes column -->
              <g transform="translate(540,52)" font-family="system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif">
                <text x="0" y="0" font-size="14" font-weight="900" fill="rgba(233,238,247,.96)">Kurz-Legende</text>

                <g transform="translate(0,18)">
                  <rect x="0" y="0" width="290" height="370" rx="18"
                        fill="rgba(0,0,0,.10)" class="printFill"
                        stroke="rgba(212,175,55,.16)" stroke-width="2" class="printStroke"/>
                  <g transform="translate(16,22)" font-size="13.5" fill="rgba(233,238,247,.92)">
                    <g transform="translate(0,0)">
                      <circle cx="10" cy="6" r="6" fill="url(#gGold)"></circle>
                      <text x="26" y="10" font-weight="850">Angestellte &amp; Berufstätige</text>
                      <text x="26" y="30" fill="rgba(169,180,199,.95)">Sucht Ruhe, Schutz, Orientierung.</text>
                    </g>

                    <g transform="translate(0,70)">
                      <circle cx="10" cy="6" r="6" fill="url(#gBlue)"></circle>
                      <text x="26" y="10" font-weight="850">Selbstständige &amp; Macher</text>
                      <text x="26" y="30" fill="rgba(169,180,199,.95)">Sucht Fokus, roten Faden, Effizienz.</text>
                    </g>

                    <g transform="translate(0,140)">
                      <circle cx="10" cy="6" r="6" fill="url(#gGold)"></circle>
                      <text x="26" y="10" font-weight="850">Unternehmer / Vereine</text>
                      <text x="26" y="30" fill="rgba(169,180,199,.95)">Sucht Prozesse, Verantwortung, Rahmen.</text>
                    </g>

                    <g transform="translate(0,210)">
                      <circle cx="10" cy="6" r="6" fill="url(#gBlue)"></circle>
                      <text x="26" y="10" font-weight="850">Aufbau-Partner</text>
                      <text x="26" y="30" fill="rgba(169,180,199,.95)">Sucht Standards, Rollen, Kultur.</text>
                    </g>

                    <g transform="translate(0,290)">
                      <text x="0" y="10" font-weight="850" fill="rgba(242,211,122,.95)">Leselogik</text>
                      <text x="0" y="30" fill="rgba(169,180,199,.95)">
                        Je weiter rechts: mehr Bedarf nach
                      </text>
                      <text x="0" y="50" fill="rgba(169,180,199,.95)">
                        Struktur/Tools statt Infos.
                      </text>
                    </g>
                  </g>
                </g>
              </g>
            </svg>
          </div>
        </div>

        <div class="vizCard">
          <div class="vizTitle">Tabelle: 3 Fragen, die jede Zielgruppe klären</div>
          <div class="vizInner miniTableWrap">
            <table class="mini" aria-label="3 Diagnose-Fragen">
              <thead>
                <tr>
                  <th style="width:18%;">Frage</th>
                  <th>Worum es wirklich geht</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1) Was ist dein Engpass?</td>
                  <td class="muted">Unsicherheit, fehlende Struktur, fehlendes Wissen, fehlende Umsetzung, fehlendes Umfeld – <b>welcher Zustand dominiert gerade?</b></td>
                </tr>
                <tr>
                  <td>2) Was muss in 30–90 Tagen besser sein?</td>
                  <td class="muted"><b>Messbar</b>: weniger Stress, mehr Ordnung, sicherer Zugang, klarer nächster Schritt, wiederholbarer Rhythmus.</td>
                </tr>
                <tr>
                  <td>3) Was willst du vermeiden?</td>
                  <td class="muted">Overload, Aktionismus, Fehlentscheidungen, Scam-Kontakte, Druck – <b>welche rote Linie gilt?</b></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <h2>Notizen &amp; Antworten</h2>
      <p class="muted">Alles, was du hier einträgst, bleibt nur auf deinem Gerät (LocalStorage).</p>

      <div class="fieldRow">
        <div class="label">1) Welche Zielgruppe bin ich selbst aktuell am ehesten?</div>
        <input class="inp" id="q1_selbst" type="text" placeholder="Kurz einordnen (1 Satz)..." />
      </div>

      <div class="fieldRow">
        <div class="label">2) Welche Zielgruppe könnte ich später am besten begleiten – und warum?</div>
        <textarea id="q2_begleiten" placeholder="2–5 Sätze..."></textarea>
      </div>

      <div class="fieldRow">
        <div class="label">3) Welche 3 Fragen helfen mir, jemanden sauber einzuordnen?</div>
        <textarea id="q3_fragen" placeholder="3 Fragen als Liste (oder kurz ausformuliert)..."></textarea>
      </div>

      <div class="hr"></div>

      <p class="muted"><b>Freie Notizen (optional):</b></p>
      <textarea id="notes" placeholder="Zusätzliche Notizen, Beobachtungen, nächste Schritte…"></textarea>

      <div class="noteRow">
        <div class="saveHint" id="saveHint">Nicht gespeichert.</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end;">
          <button class="smallBtn" type="button" id="clearChapter">Kapitel-Notizen löschen</button>
          <button class="smallBtn" type="button" id="clearAll">Alle Handbuch-Daten löschen</button>
        </div>
      </div>

      <div class="footerNav" aria-label="Kapitel Navigation">
        <div class="left">
          <a class="navBtn" href="./index.html" data-internal>← Inhaltsverzeichnis</a>
        </div>
        <div class="mid">
          <a class="navBtn" href="./kapitel-03.html" data-internal>← Zurück</a>
          <a class="navBtn navBtnPrimary" href="./kapitel-05.html" data-internal>Nächstes →</a>
        </div>
        <div class="right">
          <button class="navBtn navBtnPrimary" type="button" id="printBtn">Drucken</button>
        </div>
      </div>
    </section>
  </div>

  <script>
    (function(){
      document.getElementById("printBtn").addEventListener("click", function(){
        window.print();
      });
    })();
  </script>

  <script>
    (function(){
      const CHAPTER = "04";
      const STORAGE_PREFIX = "fsa_vh_";
      const KEY_NOTES  = STORAGE_PREFIX + "kap" + CHAPTER + "_notes";
      const KEY_FIELDS = STORAGE_PREFIX + "kap" + CHAPTER + "_fields";

      const notesEl = document.getElementById("notes");
      const hintEl  = document.getElementById("saveHint");

      const fieldIds = [
        "q1_selbst",
        "q2_begleiten",
        "q3_fragen"
      ];

      function setSaved(){ if(hintEl) hintEl.textContent = "Gespeichert (lokal)."; }
      function setUnsaved(){ if(hintEl) hintEl.textContent = "Nicht gespeichert."; }

      function safeGet(k){
        try{ return localStorage.getItem(k); }catch(e){ return null; }
      }
      function safeSet(k,v){
        try{ localStorage.setItem(k, v); }catch(e){}
      }

      function restore(){
        // Fields
        const raw = safeGet(KEY_FIELDS);
        if(raw){
          try{
            const obj = JSON.parse(raw);
            fieldIds.forEach(id=>{
              const el = document.getElementById(id);
              if(!el) return;
              if(Object.prototype.hasOwnProperty.call(obj,id)){
                el.value = obj[id] ?? "";
              }
            });
          }catch(e){}
        }

        // Notes
        const v = safeGet(KEY_NOTES);
        if(v !== null && notesEl){
          notesEl.value = v;
          setSaved();
        }else{
          setUnsaved();
        }
      }

      let tId = null;
      function scheduleSave(){
        setUnsaved();
        if(tId) clearTimeout(tId);
        tId = setTimeout(function(){
          const obj = {};
          fieldIds.forEach(id=>{
            const el = document.getElementById(id);
            if(el) obj[id] = el.value || "";
          });
          safeSet(KEY_FIELDS, JSON.stringify(obj));
          if(notesEl) safeSet(KEY_NOTES, notesEl.value || "");
          setSaved();
        }, 250);
      }

      // Bind inputs
      fieldIds.forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        el.addEventListener("input", scheduleSave);
        el.addEventListener("change", scheduleSave);
      });
      if(notesEl){
        notesEl.addEventListener("input", scheduleSave);
      }

      // Clear chapter
      document.getElementById("clearChapter").addEventListener("click", function(){
        if(!confirm("Kapitel-Notizen wirklich löschen?")) return;
        try{
          localStorage.removeItem(KEY_NOTES);
          localStorage.removeItem(KEY_FIELDS);
        }catch(e){}
        fieldIds.forEach(id=>{
          const el = document.getElementById(id);
          if(el) el.value = "";
        });
        if(notesEl) notesEl.value = "";
        setUnsaved();
      });

      // Clear all handbook data
      document.getElementById("clearAll").addEventListener("click", function(){
        if(!confirm("ALLE gespeicherten Handbuch-Daten auf diesem Gerät löschen?")) return;
        try{
          const keys = [];
          for(let i=0;i<localStorage.length;i++){
            const k = localStorage.key(i);
            if(k && k.startsWith(STORAGE_PREFIX)) keys.push(k);
          }
          keys.forEach(k=>localStorage.removeItem(k));
        }catch(e){}
        fieldIds.forEach(id=>{
          const el = document.getElementById(id);
          if(el) el.value = "";
        });
        if(notesEl) notesEl.value = "";
        setUnsaved();
        alert("Daten gelöscht.");
      });

      restore();
    })();
  </script>

  <script>
    (function(){
      const t = Date.now();
      document.querySelectorAll('a[data-internal]').forEach(a=>{
        const href = a.getAttribute('href');
        if(!href) return;
        try{
          const u = new URL(href, location.href);
          u.searchParams.set('nocache', t);
          a.href = u.pathname + u.search + u.hash;
        }catch(e){}
      });
    })();
  </script>
</body>
</html>
