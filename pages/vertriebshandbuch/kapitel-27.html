<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kapitel 27 – Einwandbehandlung &amp; Entscheidung</title>
  <meta name="description" content="Vertriebshandbuch – Kapitel 27: Einwandbehandlung & Entscheidung. Klar bleiben, ohne Manipulation." />

  <style>
    :root{
      --bg:#050814;
      --panel:rgba(15,23,42,.86);
      --panel2:rgba(2,6,23,.72);
      --text:#eef2ff;
      --muted:#cbd5e1;
      --gold:#d4af37;
      --line:rgba(212,175,55,.22);
      --shadow:0 26px 55px rgba(0,0,0,.55);
      --radius:16px;
      --maxw:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1100px 700px at 15% 10%, rgba(212,175,55,.10), transparent 60%),
        radial-gradient(900px 600px at 85% 15%, rgba(94,168,255,.10), transparent 60%),
        linear-gradient(180deg, #000 0%, var(--bg) 50%, #000 100%);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      overflow-x:hidden;
    }

    /* Topbar */
    .topbar{
      position:fixed; inset:0 0 auto 0;
      height:70px;
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(0,0,0,.72) 0%, rgba(0,0,0,.35) 100%);
      backdrop-filter: blur(8px);
      border-bottom:1px solid rgba(255,255,255,.06);
      z-index:50;
    }
    .topbar .inner{
      width:100%;
      max-width:var(--maxw);
      padding:0 18px;
      display:flex; align-items:center; justify-content:space-between;
      gap:14px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800; letter-spacing:.2px;
    }
    .brand .mark{
      width:14px; height:14px; border-radius:50%;
      background:var(--gold);
      box-shadow:0 0 0 4px rgba(212,175,55,.15), 0 0 16px rgba(212,175,55,.45);
    }
    .brand .txt{white-space:nowrap}
    .topbar .rightNote{
      color:var(--muted);
      font-size:12px;
      opacity:.9;
      white-space:nowrap;
    }

    /* Wrap */
    .wrap{
      max-width:var(--maxw);
      margin:0 auto;
      padding:34px 18px 60px;
      padding-top:calc(34px + 70px);
    }

    /* Header */
    .kickerRow{display:flex; align-items:center; gap:10px; margin:10px 0 10px}
    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:6px 12px;
      border-radius:999px;
      background:rgba(212,175,55,.10);
      border:1px solid rgba(212,175,55,.22);
      color:var(--text);
      font-size:12px;
      letter-spacing:.2px;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background:var(--gold);
      box-shadow:0 0 0 3px rgba(212,175,55,.12);
    }
    h1{
      margin:0;
      font-size:32px;
      line-height:1.15;
      letter-spacing:.2px;
    }
    .subline{
      margin:10px 0 0;
      color:var(--muted);
      line-height:1.4;
      max-width:980px;
    }
    .line{
      margin:18px 0 22px;
      height:1px;
      background:linear-gradient(90deg, transparent, var(--line), transparent);
    }

    /* Panel */
    .panel{
      background:linear-gradient(180deg, var(--panel) 0%, var(--panel2) 100%);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .panelSection{padding:22px 22px 18px}
    .panelSection + .panelSection{border-top:1px solid rgba(255,255,255,.06)}
    h2{margin:0 0 10px; font-size:18px; letter-spacing:.2px}
    p{margin:0 0 12px; color:var(--text); line-height:1.55}
    .muted{color:var(--muted)}
    .hr{height:1px; background:rgba(255,255,255,.08); margin:18px 0}
    ul{margin:10px 0 12px 18px; padding:0}
    li{margin:6px 0; color:var(--text); line-height:1.5}
    .quote{
      margin:12px 0 0;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(212,175,55,.22);
      background:rgba(212,175,55,.08);
      color:var(--text);
    }

    /* Table (mini) */
    .miniTableWrap{
      overflow:auto;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
    }
    table.mini{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      min-width:740px;
    }
    table.mini th, table.mini td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      vertical-align:top;
      text-align:left;
      font-size:13px;
      color:var(--text);
    }
    table.mini th{
      position:sticky; top:0;
      background:rgba(0,0,0,.35);
      color:var(--muted);
      font-weight:700;
      letter-spacing:.2px;
      z-index:1;
    }
    table.mini tr:last-child td{border-bottom:none}

    /* Inputs in table */
    .cellInput{
      width:100%;
      height:34px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.35);
      color:var(--text);
      padding:6px 8px;
      outline:none;
    }
    .cellInput:focus{
      border-color:rgba(212,175,55,.35);
      box-shadow:0 0 0 4px rgba(212,175,55,.10);
    }

    /* Notes + fields */
    .hint{
      font-size:13px; color:var(--muted);
      margin:6px 0 12px;
    }
    textarea#notes{
      width:100%;
      min-height:200px;
      resize:vertical;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.35);
      color:var(--text);
      padding:12px 12px;
      outline:none;
    }
    textarea#notes:focus{
      border-color:rgba(212,175,55,.35);
      box-shadow:0 0 0 4px rgba(212,175,55,.10);
    }

    .fields{
      margin:14px 0 12px;
      display:grid;
      gap:10px;
    }
    .field{
      display:grid;
      gap:8px;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.22);
    }
    .field label{
      font-size:13px;
      color:var(--muted);
      line-height:1.35;
    }
    input[type="text"], input[type="date"], input[type="number"], select{
      width:100%;
      height:40px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.35);
      color:var(--text);
      padding:8px 10px;
      outline:none;
    }
    input[type="text"]:focus, input[type="date"]:focus, input[type="number"]:focus, select:focus{
      border-color:rgba(212,175,55,.35);
      box-shadow:0 0 0 4px rgba(212,175,55,.10);
    }
    .checkRow{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
    }
    .check{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      color:var(--text);
      font-size:13px;
    }
    .check input{width:16px;height:16px}

    .noteRow{
      margin-top:12px;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    #saveHint{color:var(--muted); font-size:12px}
    .btnRow{display:flex; gap:10px; flex-wrap:wrap}
    button{
      appearance:none;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.35);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
    }
    button:hover{border-color:rgba(212,175,55,.35)}
    button:active{transform:translateY(1px)}
    .danger{border-color:rgba(239,68,68,.35)}
    .danger:hover{border-color:rgba(239,68,68,.6)}
    .primary{
      border-color:rgba(212,175,55,.35);
      background:rgba(212,175,55,.14);
    }

    /* FooterNav */
    .footerNav{
      padding:14px 16px;
      display:grid;
      grid-template-columns: 1fr 1.2fr 1fr;
      gap:12px;
      align-items:center;
      border-top:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.25);
    }
    .footerNav a{
      color:var(--text);
      text-decoration:none;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      display:inline-flex;
      justify-content:center;
      gap:8px;
      white-space:nowrap;
    }
    .footerNav a:hover{border-color:rgba(212,175,55,.35)}
    .navMid{
      display:flex; justify-content:center; gap:10px; flex-wrap:wrap;
    }
    .navRight{display:flex; justify-content:flex-end}

    /* Print */
    @page{margin:14mm;}
    @media print{
      body{background:#fff !important; color:#000 !important;}
      .topbar{display:none !important;}
      .wrap{padding:0 !important; margin:0 !important; max-width:none !important;}
      .panel{box-shadow:none !important; background:#fff !important; border:1px solid #000 !important;}
      .panelSection{padding:12px 12px !important;}
      .kickerRow, .line{display:none !important;}
      h1, h2, p, li, label, .muted, .hint{color:#000 !important;}
      .miniTableWrap{border:1px solid #000 !important; background:#fff !important;}
      table.mini th, table.mini td{color:#000 !important; border-bottom:1px solid #000 !important;}
      table.mini th{background:#eee !important;}
      textarea#notes, input[type="text"], input[type="date"], input[type="number"], select, .cellInput{
        background:#fff !important;
        color:#000 !important;
        border:1px solid #000 !important;
        box-shadow:none !important;
      }
      .noteRow button{display:none !important;}
      .footerNav{display:none !important;}
    }

    @media (max-width: 820px){
      h1{font-size:26px}
      .footerNav{grid-template-columns:1fr; text-align:center}
      .navRight{justify-content:center}
      table.mini{min-width:640px}
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="inner">
      <div class="brand">
        <span class="mark" aria-hidden="true"></span>
        <span class="txt">FSA • Vertriebshandbuch</span>
      </div>
      <div class="rightNote">Kapitel 27</div>
    </div>
  </div>

  <div class="wrap">
    <div class="kickerRow">
      <span class="pill"><span class="dot" aria-hidden="true"></span> Band / Abschnitt: Gesprächsführung & Entscheidung</span>
    </div>

    <h1>Kapitel 27 – Einwandbehandlung &amp; Entscheidung: Klar bleiben, ohne Manipulation</h1>
    <p class="subline">Einwände ruhig auffangen, sauber sortieren – und zu einer klaren Entscheidung führen, ohne Druck oder Rechtfertigung.</p>
    <div class="line"></div>

    <section class="panel">
      <div class="panelSection">
        <h2>Kernaussage</h2>
        <p class="quote"><b>Einwände sind selten „Ablehnung“.</b> Meist sind sie Schutz: vor Fehlern, vor Druck, vor Kontrollverlust. Seriöse Einwandbehandlung bedeutet: verstehen, sortieren, sauber entscheiden – nicht überreden.</p>
        <p>Dieses Kapitel gibt dir eine klare Struktur, mit der du Einwände ruhig auffängst, ohne in Diskussionen oder Rechtfertigungen zu rutschen.</p>
      </div>

      <div class="panelSection">
        <h2>1) Erst verstehen: Einwand ist nicht das Thema – sondern das Gefühl dahinter</h2>
        <p>Viele Einwände sind Stellvertreter für etwas anderes:</p>
        <ul>
          <li>„Zu teuer“ bedeutet oft: „Ich sehe den Wert noch nicht.“</li>
          <li>„Keine Zeit“ bedeutet oft: „Ich habe Angst, wieder zu scheitern.“</li>
          <li>„Krypto ist gefährlich“ bedeutet oft: „Ich will nicht dumm aussehen oder Geld verlieren.“</li>
          <li>„Ich muss nachdenken“ bedeutet oft: „Ich brauche Sicherheit, bevor ich entscheide.“</li>
        </ul>
        <p class="quote"><b>Merksatz:</b> Du behandelst nicht den Satz. Du behandelst den Grund.</p>

        <div class="hr"></div>

        <h2>2) Die 4 häufigsten Einwand-Typen</h2>
        <p><b>Typ A: Informations-Einwand</b><br><span class="muted">„Ich verstehe das nicht.“ / „Wie läuft das ab?“ → Lösung: Struktur, Beispiele, klare Schritte.</span></p>
        <p><b>Typ B: Risiko-Einwand</b><br><span class="muted">„Das ist mir zu riskant.“ / „Was, wenn…?“ → Lösung: Grenzen, Schutzlogik, realistische Erwartung.</span></p>
        <p><b>Typ C: Ressourcen-Einwand</b><br><span class="muted">„Keine Zeit“ / „Kein Geld“ / „Zu viel im Kopf“ → Lösung: kleiner Einstieg, Prioritäten klären, Tempo reduzieren.</span></p>
        <p><b>Typ D: Vertrauens-Einwand</b><br><span class="muted">„Ich will nichts verkauft bekommen.“ / „Klingt nach Marketing“ → Lösung: Transparenz, Entscheidung beim Gegenüber lassen, Druck komplett rausnehmen.</span></p>

        <div class="hr"></div>

        <h2>3) Die seriöse 3-Schritt-Formel (die fast immer funktioniert)</h2>
        <p><b>1) Anerkennen (ohne kleinzureden)</b><br>„Versteh ich. Das ist ein fairer Punkt.“</p>
        <p><b>2) Klären (eine präzise Frage)</b><br>„Was genau meinst du damit – eher Zeit, eher Überforderung oder eher Priorität?“</p>
        <p><b>3) Einordnen (Weg statt Kampf)</b><br>„Dann wäre vermutlich ein kleiner Einstieg sinnvoll – damit du nicht überrollt wirst.“</p>
        <p class="quote">Du argumentierst nicht. Du sortierst.</p>

        <div class="hr"></div>

        <h2>4) Das wichtigste Prinzip: „Einwand = Entscheidungspunkt“</h2>
        <p>Einwandbehandlung dient nicht dazu, jemanden „drinzuhalten“.</p>
        <p>Sie dient dazu, eine saubere Entscheidung möglich zu machen:</p>
        <ul>
          <li>Ja, ich starte.</li>
          <li>Nein, ich starte nicht.</li>
          <li>Ich starte später – mit klarem Datum.</li>
          <li>Ich starte klein – mit minimalem Schritt.</li>
        </ul>
        <p class="muted">Alles andere erzeugt nur Hängepartien.</p>

        <div class="hr"></div>

        <h2>5) Einwand: „Ich habe keine Zeit.“</h2>
        <p class="muted">Was dahinter steckt: Überforderung, Stress, schlechte Erfahrungen mit „Dranbleiben“.</p>
        <p><b>Saubere Antwort:</b><br>„Dann ist es wichtig, dass du nicht groß startest, sondern machbar. Wenn wir es so klein machen, dass es wirklich in deinen Alltag passt: Was wäre realistisch – 20 Minuten oder 30 Minuten pro Woche?“</p>
        <p class="muted"><b>Mini-Entscheidung:</b> Wenn 20–30 Minuten möglich: kleiner Startpfad setzen. Wenn gar nichts möglich: nicht drücken – späteren Zeitpunkt vereinbaren.</p>

        <div class="hr"></div>

        <h2>6) Einwand: „Das ist mir zu riskant.“</h2>
        <p class="muted">Was dahinter steckt: Angst vor Verlust, Scam, Kontrollverlust.</p>
        <p><b>Saubere Antwort:</b><br>„Sehr gut, dass du das sagst. Genau deshalb geht es hier zuerst um Orientierung, Schutz und Grenzen. Nicht um Aktionismus. Du musst nichts tun, bevor du es verstehst.“</p>
        <p class="muted"><b>Wichtige Ergänzung:</b> „Es gibt keine Versprechen. Es geht um Bildung, Struktur und Eigenverantwortung.“</p>

        <div class="hr"></div>

        <h2>7) Einwand: „Ich will nichts verkauft bekommen.“</h2>
        <p class="muted">Was dahinter steckt: schlechte Erfahrungen, Misstrauen.</p>
        <p><b>Saubere Antwort:</b><br>„Will ich auch nicht. Ich kann dir die Logik erklären – und du entscheidest, ob das für dich passt. Wenn nicht, ist das vollkommen okay.“</p>

        <div class="hr"></div>

        <h2>8) Einwand: „Zu teuer.“</h2>
        <p class="muted">Was dahinter steckt: Wert noch unklar, Priorität unklar, Angst vor Fehlkauf.</p>
        <p><b>Saubere Antwort (ohne Diskussion):</b><br>„Versteh ich. Die Frage ist: Was wäre für dich ein sinnvoller Einstieg, damit du erst sicher wirst, bevor du Geld ausgibst?“</p>
        <p class="muted">Wichtig: Nicht anfangen, Preis „zu verteidigen“. Wert entsteht durch Klarheit, nicht durch Reden.</p>

        <div class="hr"></div>

        <h2>9) Einwand: „Ich muss erstmal nachdenken.“</h2>
        <p class="muted">Was dahinter steckt: Bedürfnis nach Sicherheit.</p>
        <p><b>Saubere Antwort:</b><br>„Sehr gut. Dann lass uns kurz klären, was du brauchst, um entscheiden zu können: eher Überblick, eher Beispiele, oder eher ein zweites Gespräch?“</p>
        <p class="muted"><b>Seriöser Abschluss:</b> „Wollen wir einen Zeitpunkt setzen, wann du dich meldest oder wann wir kurz sprechen? Sonst bleibt es nur im Kopf.“</p>

        <div class="hr"></div>

        <h2>10) Tabelle: Einwände → Klärfragen → nächster Schritt</h2>
        <div class="miniTableWrap">
          <table class="mini">
            <thead>
              <tr>
                <th style="width:22%">Einwand</th>
                <th style="width:38%">Klärfrage</th>
                <th style="width:40%">Nächster Schritt</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>„Keine Zeit“</td>
                <td>„Was wäre realistisch pro Woche?“</td>
                <td>Mini-Rhythmus festlegen</td>
              </tr>
              <tr>
                <td>„Zu riskant“</td>
                <td>„Wovor genau willst du dich schützen?“</td>
                <td>Orientierung/Sicherheit zuerst</td>
              </tr>
              <tr>
                <td>„Zu teuer“</td>
                <td>„Woran würdest du merken, dass es sich lohnt?“</td>
                <td>kleiner Einstieg oder Pause</td>
              </tr>
              <tr>
                <td>„Ich verstehe nichts“</td>
                <td>„Was ist unklar: Begriff, Ablauf oder Entscheidung?“</td>
                <td>10-Minuten-Überblick</td>
              </tr>
              <tr>
                <td>„Ich bin skeptisch“</td>
                <td>„Was müsste passieren, damit du Vertrauen hast?“</td>
                <td>Transparenz + Druck raus</td>
              </tr>
              <tr>
                <td>„Später“</td>
                <td>„Wann genau wäre später?“</td>
                <td>Datum setzen oder beenden</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="hr"></div>

        <h2>11) Die stärkste Entscheidungshilfe: „Was ist dein nächster sauberer Schritt?“</h2>
        <p>Menschen scheitern selten am Willen. Sie scheitern an fehlender Struktur.</p>
        <p class="quote">Frage, die oft alles löst: „Wenn du nur einen kleinen, sauberen Schritt gehen würdest – welcher wäre das?“</p>
        <p>Dann setzt du genau diesen Schritt. Kein mehr.</p>
      </div>

      <div class="panelSection">
        <h2>Notizen &amp; Antworten</h2>
        <p class="hint">Alles, was du hier einträgst, bleibt nur auf deinem Gerät (LocalStorage).</p>

        <!-- Ausfüllfelder (Pflicht) -->
        <div class="fields" aria-label="Ausfüllfelder Kapitel 27">
          <div class="field">
            <label for="q1">1) Mein häufigster Einwand (den ich höre):</label>
            <input id="q1" type="text" placeholder="z. B. „Keine Zeit“, „Zu riskant“, …" />
          </div>

          <div class="field">
            <label for="q2">2) Was steckt meistens wirklich dahinter (mein Gefühl dazu):</label>
            <input id="q2" type="text" placeholder="z. B. Überforderung / Misstrauen / Angst vor Fehlern …" />
          </div>

          <div class="field">
            <label for="q3">3) Meine Standard-Klärfrage (eine einzige, die ich immer stelle):</label>
            <input id="q3" type="text" placeholder="z. B. „Was genau meinst du damit …?“" />
          </div>

          <div class="field">
            <label for="q4">4) Meine Grenze (was ich niemals tue/sage):</label>
            <input id="q4" type="text" placeholder="z. B. keine Versprechen / kein Druck / keine Beratung …" />
          </div>

          <div class="field">
            <label for="q5">5) Mein Abschluss-Satz ohne Druck:</label>
            <input id="q5" type="text" placeholder="z. B. „Du musst heute nichts entscheiden …“" />
          </div>

          <div class="field">
            <label>6) Entscheidung (für mein eigenes Vorgehen):</label>
            <div class="checkRow">
              <label class="check"><input id="q6_a" type="checkbox" /> Ich setze immer einen Mini-Schritt</label>
              <label class="check"><input id="q6_b" type="checkbox" /> Ich setze immer ein Datum</label>
              <label class="check"><input id="q6_c" type="checkbox" /> Ich beende sauber, wenn es nicht passt</label>
            </div>
          </div>
        </div>

        <!-- Standard Notes -->
        <textarea id="notes" placeholder="Freie Notizen zu Kapitel 27 …"></textarea>

        <div class="noteRow">
          <div id="saveHint">Nicht gespeichert.</div>
          <div class="btnRow">
            <button id="clearChapterBtn" class="danger" type="button">Kapitel-Notizen löschen</button>
            <button id="clearAllBtn" class="danger" type="button">Alle Handbuch-Daten löschen</button>
          </div>
        </div>
      </div>

      <div class="footerNav">
        <div class="navLeft">
          <a data-internal href="./index.html">← Inhaltsverzeichnis</a>
        </div>
        <div class="navMid">
          <a data-internal href="./kapitel-26.html">← Zurück</a>
          <a data-internal href="./kapitel-28.html">Nächstes →</a>
        </div>
        <div class="navRight">
          <button id="printBtn" class="primary" type="button">Drucken</button>
        </div>
      </div>
    </section>
  </div>

  <script>
    (function(){
      "use strict";

      /* Print */
      const printBtn = document.getElementById("printBtn");
      if(printBtn){
        printBtn.addEventListener("click", () => window.print());
      }

      /* LocalStorage */
      const STORAGE_PREFIX = "fsa_vh_";
      const KEY_NOTES  = "fsa_vh_kap27_notes";
      const KEY_FIELDS = "fsa_vh_kap27_fields";

      const notesEl = document.getElementById("notes");
      const saveHint = document.getElementById("saveHint");

      const fieldEls = Array.from(document.querySelectorAll("input[id], select[id], textarea[id]"))
        .filter(el => el.id !== "notes"); // notes separat

      function debounce(fn, wait){
        let t;
        return function(){
          const ctx=this, args=arguments;
          clearTimeout(t);
          t=setTimeout(()=>fn.apply(ctx,args), wait);
        };
      }

      function setHint(text){
        if(saveHint) saveHint.textContent = text;
      }

      function collectFields(){
        const data = {};
        fieldEls.forEach(el=>{
          if(!el.id) return;
          if(el.type === "checkbox"){
            data[el.id] = !!el.checked;
          }else{
            data[el.id] = el.value;
          }
        });
        return data;
      }

      function restoreFields(obj){
        if(!obj || typeof obj !== "object") return;
        fieldEls.forEach(el=>{
          if(!el.id) return;
          if(!(el.id in obj)) return;
          if(el.type === "checkbox"){
            el.checked = !!obj[el.id];
          }else{
            el.value = obj[el.id] ?? "";
          }
        });
      }

      function saveAll(){
        try{
          if(notesEl){
            localStorage.setItem(KEY_NOTES, notesEl.value || "");
          }
          const fields = collectFields();
          localStorage.setItem(KEY_FIELDS, JSON.stringify(fields));
          setHint("Gespeichert.");
        }catch(e){
          setHint("Speichern fehlgeschlagen (LocalStorage).");
        }
      }

      const debouncedSave = debounce(saveAll, 250);

      function bindAutosave(){
        if(notesEl){
          notesEl.addEventListener("input", () => {
            setHint("Speichern …");
            debouncedSave();
          });
        }
        fieldEls.forEach(el=>{
          const evt = (el.type === "checkbox" || el.tagName === "SELECT") ? "change" : "input";
          el.addEventListener(evt, () => {
            setHint("Speichern …");
            debouncedSave();
          });
        });
      }

      function restoreAll(){
        try{
          if(notesEl){
            notesEl.value = localStorage.getItem(KEY_NOTES) || "";
          }
          const raw = localStorage.getItem(KEY_FIELDS);
          if(raw){
            restoreFields(JSON.parse(raw));
          }
          setHint("Geladen.");
        }catch(e){
          setHint("Laden fehlgeschlagen (LocalStorage).");
        }
      }

      function clearChapter(){
        try{
          localStorage.removeItem(KEY_NOTES);
          localStorage.removeItem(KEY_FIELDS);
          if(notesEl) notesEl.value = "";
          fieldEls.forEach(el=>{
            if(el.type === "checkbox") el.checked = false;
            else el.value = "";
          });
          setHint("Kapitel-Daten gelöscht.");
        }catch(e){
          setHint("Löschen fehlgeschlagen (LocalStorage).");
        }
      }

      function clearAll(){
        try{
          const keys = [];
          for(let i=0;i<localStorage.length;i++){
            const k = localStorage.key(i);
            if(k && k.startsWith(STORAGE_PREFIX)) keys.push(k);
          }
          keys.forEach(k=>localStorage.removeItem(k));
          if(notesEl) notesEl.value = "";
          fieldEls.forEach(el=>{
            if(el.type === "checkbox") el.checked = false;
            else el.value = "";
          });
          setHint("Alle Handbuch-Daten gelöscht.");
        }catch(e){
          setHint("Löschen fehlgeschlagen (LocalStorage).");
        }
      }

      const clearChapterBtn = document.getElementById("clearChapterBtn");
      const clearAllBtn = document.getElementById("clearAllBtn");

      if(clearChapterBtn) clearChapterBtn.addEventListener("click", clearChapter);
      if(clearAllBtn) clearAllBtn.addEventListener("click", clearAll);

      restoreAll();
      bindAutosave();

      /* nocache for internal links */
      const ts = Date.now();
      document.querySelectorAll('a[data-internal]').forEach(a=>{
        try{
          const href = a.getAttribute("href");
          if(!href) return;
          const joiner = href.includes("?") ? "&" : "?";
          a.setAttribute("href", href + joiner + "nocache=" + ts);
        }catch(e){}
      });
    })();
  </script>
</body>
</html>
