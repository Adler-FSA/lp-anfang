<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FSA Trendbarometer – Dashboard</title>
  <meta name="description" content="Dashboard: Jahr & Halbjahr (H1/H2) mit Charts & Tabellen. Datenquelle: öffentlich zugängliche Online-Signale (RSS/Atom), nicht repräsentativ." />
  <style>
    :root{
      --bg:#050814;
      --panel:rgba(15,23,42,.92);
      --panel2:rgba(15,23,42,.82);
      --text:#e9edf3;
      --muted:#97a0ad;
      --gold:#d4af37;
      --gold2:#f1d070;
      --ring:rgba(212,175,55,.25);
      --radius:16px;
      --shadow:0 12px 40px rgba(0,0,0,.55);
      --maxw:1200px;
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(212,175,55,.12), transparent 55%),
        radial-gradient(900px 500px at 80% 20%, rgba(120,180,255,.10), transparent 60%),
        linear-gradient(180deg, #020617 0%, #050814 60%, #020617 100%);
    }
    .wrap{max-width:var(--maxw); margin:0 auto; padding:24px 16px 44px;}
    .topbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:12px;}
    h1{margin:0; font-size:22px;}
    .sub{color:var(--muted); font-size:13px; margin-top:4px;}
    .btnrow{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px; border-radius:999px;
      background:rgba(15,23,42,.65);
      border:1px solid rgba(212,175,55,.25);
      color:var(--text); text-decoration:none;
      box-shadow:0 8px 22px rgba(0,0,0,.35);
      cursor:pointer;
    }
    .btn .dot{width:10px;height:10px;border-radius:50%; background:rgba(212,175,55,.9); box-shadow:0 0 0 4px rgba(212,175,55,.12);}
    .grid{display:grid; grid-template-columns:1.1fr .9fr; gap:12px; align-items:start;}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }
    .card{
      background:linear-gradient(180deg, rgba(15,23,42,.92), rgba(15,23,42,.82));
      border:1px solid rgba(212,175,55,.18);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    select{
      background:rgba(2,6,23,.35);
      border:1px solid rgba(212,175,55,.18);
      border-radius:12px;
      padding:10px 12px;
      color:var(--text);
      outline:none;
    }
    .kpis{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px; margin-top:10px;}
    @media (max-width: 700px){ .kpis{grid-template-columns:1fr;} }
    .kpi{padding:12px; border-radius:14px; border:1px solid rgba(212,175,55,.14); background:rgba(2,6,23,.25);}
    .kpi .v{font-size:18px; font-weight:800;}
    .kpi .l{font-size:12px; color:var(--muted); margin-top:4px;}
    canvas{width:100%; height:210px; background:rgba(2,6,23,.25); border:1px solid rgba(212,175,55,.12); border-radius:14px;}
    table{width:100%; border-collapse:collapse; margin-top:10px; font-size:13px;}
    th,td{padding:10px 8px; border-bottom:1px solid rgba(212,175,55,.10); vertical-align:top;}
    th{color:rgba(233,237,243,.85); text-align:left; font-weight:700;}
    td{color:rgba(233,237,243,.82);}
    .muted{color:var(--muted); font-size:12px; line-height:1.35;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1 data-i18n data-de="FSA Trendbarometer – Dashboard" data-en="FSA Trend Barometer – Dashboard"></h1>
        <div class="sub" data-i18n
          data-de="Jahr & Halbjahr (H1/H2) mit Charts/Tabellen. Nicht repräsentativ – Quellenqualität sichtbar."
          data-en="Year & half-year (H1/H2) with charts/tables. Not representative—source quality visible."></div>
      </div>
      <div class="btnrow">
        <a class="btn" href="./index.html"><span class="dot"></span><span data-i18n data-de="Start" data-en="Home"></span></a>
        <a class="btn" href="./chronologie.html"><span class="dot"></span><span data-i18n data-de="Chronologie" data-en="Chronology"></span></a>
        <button class="btn" id="langBtn" type="button"><span class="dot"></span>DE</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row">
          <select id="yearSel" aria-label="Jahr"></select>
          <select id="periodSel" aria-label="Periode">
            <option value="year" data-i18n data-de="Jahr" data-en="Year"></option>
            <option value="h1">H1</option>
            <option value="h2">H2</option>
          </select>
          <span class="muted" id="updated">—</span>
        </div>

        <div class="kpis">
          <div class="kpi"><div class="v" id="kItems">—</div><div class="l" data-i18n data-de="Items (Summe)" data-en="Items (sum)"></div></div>
          <div class="kpi"><div class="v" id="kSent">—</div><div class="l" data-i18n data-de="Tonalität (avg)" data-en="Tone (avg)"></div></div>
          <div class="kpi"><div class="v" id="kTop">—</div><div class="l" data-i18n data-de="Top-Thema" data-en="Top topic"></div></div>
        </div>

        <div style="margin-top:12px;">
          <canvas id="bar"></canvas>
        </div>

        <div class="muted" id="narr" style="margin-top:10px;">—</div>
      </div>

      <div class="card">
        <div class="muted" data-i18n
          data-de="Themen-Tabelle (Summe Keyword-Treffer in der Periode)"
          data-en="Topic table (sum of keyword hits for the period)"></div>

        <table>
          <thead>
            <tr>
              <th data-i18n data-de="Thema" data-en="Topic"></th>
              <th data-i18n data-de="Treffer" data-en="Hits"></th>
            </tr>
          </thead>
          <tbody id="tbl"></tbody>
        </table>

        <div class="muted" style="margin-top:10px;" data-i18n
          data-de="Hinweis: 'Tonalität' ist ein einfacher Lexikon-Score aus Titel/Snippet – keine KI-Semantik, keine Volksumfrage."
          data-en="Note: 'Tone' is a simple lexicon score from title/snippet—no AI semantics, no population survey."></div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      let lang = localStorage.getItem('fsa_trend_lang') || 'de';
      const langBtn = document.getElementById('langBtn');

      function applyLang(){
        document.querySelectorAll('[data-i18n]').forEach(el=>{
          const de = el.getAttribute('data-de') || '';
          const en = el.getAttribute('data-en') || '';
          el.textContent = (lang === 'en') ? en : de;
        });
        langBtn.textContent = (lang === 'en') ? 'EN' : 'DE';
      }

      langBtn.addEventListener('click', ()=>{
        lang = (lang === 'de') ? 'en' : 'de';
        localStorage.setItem('fsa_trend_lang', lang);
        applyLang();
        loadPeriod();
      });

      const yearSel = document.getElementById('yearSel');
      const periodSel = document.getElementById('periodSel');

      function drawBars(labels, values){
        const c = document.getElementById('bar');
        const ctx = c.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        const w = c.width = c.clientWidth * dpr;
        const h = c.height = 210 * dpr;
        ctx.clearRect(0,0,w,h);

        const pad = 18*dpr;
        const maxV = Math.max(1, ...values);
        const barW = (w - pad*2) / Math.max(1, values.length);
        const baseY = h - pad;

        ctx.globalAlpha = 0.25;
        ctx.strokeStyle = '#d4af37';
        ctx.lineWidth = 1*dpr;
        for(let i=0;i<4;i++){
          const y = pad + i*((h-pad*2)/3);
          ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(w-pad,y); ctx.stroke();
        }
        ctx.globalAlpha = 1;

        for(let i=0;i<values.length;i++){
          const v = values[i];
          const bh = (v/maxV) * (h - pad*2);
          const x = pad + i*barW + barW*0.12;
          const y = baseY - bh;
          const bw = barW*0.76;
          ctx.fillStyle = 'rgba(212,175,55,.55)';
          ctx.fillRect(x,y,bw,bh);
          ctx.strokeStyle = 'rgba(212,175,55,.85)';
          ctx.strokeRect(x,y,bw,bh);
        }

        ctx.fillStyle = 'rgba(233,237,243,.75)';
        ctx.font = `${11*dpr}px system-ui, -apple-system, Segoe UI, Arial`;
        const showEvery = Math.ceil(values.length/7);
        for(let i=0;i<labels.length;i++){
          if(i%showEvery!==0) continue;
          const x = pad + i*barW + barW*0.12;
          ctx.fillText(labels[i].slice(0,10), x, h - 6*dpr);
        }
      }

      async function loadManifest(){
        const r = await fetch('./data/manifest.json?nocache=' + Date.now());
        const mf = await r.json();
        const years = Object.keys(mf.years||{}).sort().reverse();
        yearSel.innerHTML = years.map(y=>`<option value="${y}">${y}</option>`).join('');
        if(years.length) yearSel.value = years[0];
      }

      async function loadPeriod(){
        const y = yearSel.value;
        const p = periodSel.value;

        let file = `./data/${y}.json`;
        if(p === 'h1') file = `./data/${y}-h1.json`;
        if(p === 'h2') file = `./data/${y}-h2.json`;

        const r = await fetch(file + '?nocache=' + Date.now());
        const d = await r.json();

        document.getElementById('updated').textContent =
          (lang==='en' ? 'Updated: ' : 'Aktualisiert: ') + (d.generated_at || '—');

        document.getElementById('kItems').textContent = d.items_total ?? '0';
        document.getElementById('kSent').textContent = (d.sentiment && typeof d.sentiment.avg === 'number') ? d.sentiment.avg.toFixed(2) : '0.00';
        document.getElementById('kTop').textContent = (lang==='en') ? (d.top_topic_en||'—') : (d.top_topic_de||'—');

        const narr = (lang==='en' ? (d.narrative_en||[]) : (d.narrative_de||[])).join(' • ');
        document.getElementById('narr').textContent = narr || '—';

        const topics = d.topics || [];
        const labels = topics.map(t => (lang==='en' ? t.label_en : t.label_de));
        const values = topics.map(t => t.count || 0);
        drawBars(labels, values);

        const tb = document.getElementById('tbl');
        tb.innerHTML = topics
          .slice()
          .sort((a,b)=>(b.count||0)-(a.count||0))
          .map(t=>`<tr><td>${lang==='en'?t.label_en:t.label_de}</td><td>${t.count||0}</td></tr>`)
          .join('');
      }

      yearSel.addEventListener('change', loadPeriod);
      periodSel.addEventListener('change', loadPeriod);

      applyLang();
      loadManifest().then(loadPeriod);
    })();
  </script>
</body>
</html>
