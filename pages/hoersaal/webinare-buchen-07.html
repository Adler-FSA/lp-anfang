<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>H√∂rsaal ‚Ä¢ Webinare buchen ‚Äì Termine w√§hlen</title>
<meta name="robots" content="index,follow" />

<style>
  :root{
    --text:#f2f2f2;
    --muted:#b9c2d0;
    --gold:#d4af37;
    --turq:#1cc2a0;
    --bg-card: rgba(15,15,25,.78);
    --radius:16px;
    --shadow:0 26px 50px rgba(0,0,0,.55);
    --glow:0 0 26px rgba(212,175,55,.45), 0 10px 28px rgba(0,0,0,.55);
    --maxw:1200px;

    /* Laufband leserlicher */
    --marquee-speed:58s;
    --marquee-gap:3.0cm;
  }

  html,body{height:100%}
  body{
    margin:0;background:#000;color:var(--text);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
    overflow-x:hidden;
  }
  h1,h2,h3{font-family:Montserrat,system-ui,sans-serif;margin:0 0 12px}
  h1{font-size:2.4rem;line-height:1.2}
  h2{font-size:1.9rem;line-height:1.25}

  /* ===== Hintergrund-VIDEO (Adlerflug) ===== */
  .bg-video{position:fixed;inset:0;z-index:-2;overflow:hidden;background:#000}
  .bg-video video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.86)}

  /* ===== Layout ===== */
  main{position:relative;z-index:1}
  section{padding:90px 0}
  .wrap{max-width:var(--maxw);margin:0 auto;padding:0 24px}
  .grid{display:grid;gap:38px}
  .cols-2{grid-template-columns:repeat(2,1fr)}
  @media (max-width:980px){.cols-2{grid-template-columns:1fr}}

  /* mehr Luft am Startbereich */
  #hero{padding-top:110px}

  /* ===== Glow & Floating ===== */
  @keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-7px)}100%{transform:translateY(0)}}
  @keyframes pulse{0%{box-shadow:var(--shadow)}50%{box-shadow:0 0 34px rgba(212,175,55,.55), 0 14px 34px rgba(0,0,0,.55)}100%{box-shadow:var(--shadow)}}
  .floating{animation:float 11s ease-in-out infinite, pulse 11s ease-in-out infinite;will-change:transform,box-shadow}

  /* ===== Cards ===== */
  .card{
    background:var(--bg-card);
    border:1px solid rgba(212,175,55,.18);
    border-radius:var(--radius);
    box-shadow:var(--glow);
    padding:32px;
    backdrop-filter: blur(4px);
  }

  /* ===== Laufband ===== */
  .laufband-wrap{margin:42px auto 40px;max-width:var(--maxw);padding:0 24px}
  .laufband{position:relative;overflow:hidden;border:2px solid var(--gold);border-radius:12px;background:rgba(0,0,0,.35);box-shadow:var(--glow)}
  .laufband::before,.laufband::after{content:"";position:absolute;top:0;bottom:0;width:80px;z-index:1}
  .laufband::before{left:0;background:linear-gradient(90deg,#000,transparent)}
  .laufband::after{right:0;background:linear-gradient(-90deg,#000,transparent)}
  .marquee{
    display:flex;align-items:center;gap:var(--marquee-gap);white-space:nowrap;
    padding:16px 0;will-change:transform;
    animation:marq var(--marquee-speed) linear infinite;
    font-size:1.22rem;letter-spacing:.2px;font-weight:700;
  }
  .marquee > span{display:inline-flex;align-items:center;gap:.6rem}
  @keyframes marq{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

  /* ===== Buttons ===== */
  .btn{display:inline-block;background:var(--gold);color:#000;padding:14px 22px;border-radius:999px;font-weight:900;text-decoration:none;border:none;cursor:pointer}
  .btn:hover{filter:brightness(1.05)}
  .btn.full{display:block;text-align:center}
  .btnLine{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .btnGhost{
    display:inline-block;
    border:1px solid rgba(212,175,55,.38);
    background:rgba(0,0,0,.18);
    color:var(--text);
    padding:14px 22px;border-radius:999px;
    font-weight:900;text-decoration:none;
  }
  .btnGhost:hover{background:rgba(0,0,0,.26)}
  .btnSmall{padding:10px 14px;font-weight:900;border-radius:999px}

  /* ===== Auswahl UI ===== */
  .helper{color:var(--muted);line-height:1.7;margin:0}
  .hr{height:1px;background:rgba(255,255,255,.14);margin:18px 0}

  .pillRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .pill{
    display:inline-flex;align-items:center;gap:8px;
    padding:7px 10px;border-radius:999px;
    border:1px solid rgba(212,175,55,.25);
    background:rgba(0,0,0,.18);
    color:#f6e6b0;
    font-weight:900;
    font-size:.92rem;
    white-space:nowrap;
  }
  .pill.free{border-color:rgba(28,194,160,.35);color:#bff6ea}
  .pill.paid{border-color:rgba(212,175,55,.35);color:#f6e6b0}

  .twoCols{display:grid;grid-template-columns:1.05fr .95fr;gap:14px}
  @media (max-width:980px){.twoCols{grid-template-columns:1fr}}

  .box{
    border-radius:14px;
    border:1px solid rgba(212,175,55,.18);
    background:rgba(0,0,0,.22);
    padding:16px 18px;
  }
  .box h3{
    margin:0 0 10px;
    font-family:Montserrat,system-ui,sans-serif;
    font-size:1.15rem;
    color:var(--gold);
    letter-spacing:.2px;
  }

  label{display:block;font-weight:900;margin:8px 0 6px}
  select,input{
    width:100%;
    border-radius:12px;
    border:1px solid rgba(212,175,55,.28);
    background:rgba(0,0,0,.22);
    color:var(--text);
    padding:12px 12px;
    font-size:1rem;
    outline:none;
  }
  select:focus,input:focus{border-color:rgba(212,175,55,.55); box-shadow:0 0 0 3px rgba(212,175,55,.15);}

  .slots{
    display:grid;
    grid-template-columns:repeat(2, minmax(0,1fr));
    gap:10px;
    margin-top:10px;
  }
  @media (max-width:680px){.slots{grid-template-columns:1fr}}
  .slotBtn{
    width:100%;
    text-align:left;
    border-radius:14px;
    border:1px solid rgba(212,175,55,.20);
    background:rgba(0,0,0,.20);
    padding:12px 12px;
    color:var(--text);
    cursor:pointer;
    font-weight:900;
  }
  .slotBtn:hover{background:rgba(0,0,0,.28)}
  .slotBtn.active{
    border-color:rgba(28,194,160,.55);
    box-shadow:0 0 0 3px rgba(28,194,160,.16);
  }
  .slotMeta{display:block;color:var(--muted);font-weight:700;margin-top:4px;line-height:1.35}

  .summary{
    border-radius:14px;
    border:1px solid rgba(28,194,160,.28);
    background:rgba(0,0,0,.22);
    padding:14px 14px;
  }
  .summary strong{color:#dffaf4}
  .summary .line2{color:var(--muted);margin-top:6px;line-height:1.6}

  .note{
    margin-top:10px;
    padding:12px 14px;
    border-radius:14px;
    border:1px dashed rgba(212,175,55,.35);
    background:rgba(0,0,0,.18);
    color:var(--muted);
    line-height:1.65;
  }

  /* ===== Kino ===== */
  #kino .frame{
    position:relative;border:2px solid var(--gold);border-radius:16px;aspect-ratio:16/9;
    box-shadow:var(--glow);overflow:hidden;background:transparent;backdrop-filter:none
  }
  #kino iframe{width:100%;height:100%;border:0;background:#000}

  /* Hilfsklasse */
  .hidden{display:none !important}

  /* ===== Footer-Navigation: 8 Seiten ===== */
  #bottomNav{padding:60px 0 80px}
  .nav8{
    display:grid;
    grid-template-columns:repeat(4, minmax(0,1fr));
    gap:10px;
    margin-top:14px;
  }
  @media (max-width:980px){.nav8{grid-template-columns:repeat(2, minmax(0,1fr));}}
  .nav8 a{
    display:block;
    text-align:center;
    padding:12px 12px;
    border-radius:999px;
    border:1px solid rgba(212,175,55,.26);
    background:rgba(0,0,0,.18);
    color:var(--text);
    text-decoration:none;
    font-weight:900;
    line-height:1.2;
  }
  .nav8 a:hover{background:rgba(0,0,0,.26)}
  .nav8 a.active{
    background:var(--gold);
    color:#000;
    border-color:rgba(212,175,55,.55);
  }
  .nav8 small{
    display:block;
    margin-top:6px;
    color:rgba(0,0,0,.75);
    font-weight:800;
    letter-spacing:.2px;
  }
  .nav8 a:not(.active) small{
    color:rgba(242,242,242,.70);
    font-weight:800;
  }
</style>
</head>

<body>

<div id="menu-root"></div>

<div class="bg-video" aria-hidden="true">
  <video autoplay loop muted playsinline>
    <source src="../../library/videos/adlerflug.mp4" type="video/mp4">
    Dein Browser unterst√ºtzt kein MP4-Video.
  </video>
</div>

<main>

  <!-- ===== HERO ===== -->
  <section id="hero">
    <div class="wrap grid cols-2">

      <div class="card floating">
        <h1>
          <span class="de">Termine w√§hlen<br><span style="color:var(--turq)">Webinar, Training oder kostenloses Gespr√§ch</span></span>
          <span class="en hidden">Choose a slot<br><span style="color:var(--turq)">Webinar, training or a free call</span></span>
        </h1>

        <p class="helper de">
          Du bist neu? Dann starte mit einem <strong>kostenlosen Gespr√§ch</strong>.
          Wenn du direkt in die Umsetzung willst, w√§hle <strong>Webinar/Training</strong>.
        </p>
        <p class="helper en hidden">
          New here? Start with a <strong>free call</strong>.
          If you want to move straight into execution, choose <strong>webinar/training</strong>.
        </p>

        <div class="pillRow" aria-label="Format-Hinweise">
          <span class="pill free"><span class="de">üÜì Bewerbung / Kennenlernen</span><span class="en hidden">üÜì Application / intro</span></span>
          <span class="pill paid"><span class="de">üí≥ Webinar / Training / Workshop</span><span class="en hidden">üí≥ Webinar / training / workshop</span></span>
          <span class="pill"><span class="de">üè∑Ô∏è Mitglieder: 20% Rabatt (Preis auf Seite 08)</span><span class="en hidden">üè∑Ô∏è Members: 20% discount (see page 08)</span></span>
        </div>

        <div class="hr"></div>

        <div class="btnLine">
          <a class="btnGhost" href="./webinare-buchen-06-ablauf-regeln.html" data-internal>
            <span class="de">‚Üê zur√ºck</span><span class="en hidden">‚Üê back</span>
          </a>
          <a class="btn" href="./webinare-buchen-08-ticketseite.html" data-internal id="toTicketTop">
            <span class="de">Weiter zur Ticketseite ‚Üí</span><span class="en hidden">Go to tickets ‚Üí</span>
          </a>
        </div>

        <div class="note">
          <span class="de">Deine Auswahl wird auf diesem Ger√§t gespeichert und auf Seite 08 √ºbernommen.</span>
          <span class="en hidden">Your selection is saved on this device and used on page 08.</span>
        </div>
      </div>

      <div class="card floating">
        <h2 style="margin-bottom:10px">
          <span class="de">Auswahl</span>
          <span class="en hidden">Selection</span>
        </h2>

        <div class="twoCols">
          <div class="box">
            <h3><span class="de">1) Format</span><span class="en hidden">1) Format</span></h3>

            <label for="fmt">
              <span class="de">Was willst du buchen?</span>
              <span class="en hidden">What do you want to book?</span>
            </label>
            <select id="fmt">
              <option value="free"><span class="de">Kostenloses Gespr√§ch (Bewerbung / Kennenlernen)</span></option>
              <option value="paid"><span class="de">Webinar / Training / Workshop (kostenpflichtig)</span></option>
            </select>

            <label for="topic" style="margin-top:12px">
              <span class="de">2) Thema</span><span class="en hidden">2) Topic</span>
            </label>
            <select id="topic"></select>

            <label for="week" style="margin-top:12px">
              <span class="de">3) Woche</span><span class="en hidden">3) Week</span>
            </label>
            <select id="week"></select>

            <button class="btn btnSmall" type="button" id="savePick" style="margin-top:14px;width:100%">
              <span class="de">Auswahl speichern</span>
              <span class="en hidden">Save selection</span>
            </button>
          </div>

          <div class="box">
            <h3><span class="de">4) Uhrzeit</span><span class="en hidden">4) Time</span></h3>

            <p class="helper" style="margin:0 0 10px">
              <span class="de">Klicke einen Slot an. Der Slot wird f√ºr Seite 08 √ºbernommen.</span>
              <span class="en hidden">Click a slot. It will be used on page 08.</span>
            </p>

            <div class="slots" id="slots"></div>

            <div class="summary" id="summary" style="margin-top:12px">
              <strong>
                <span class="de">Deine Auswahl:</span>
                <span class="en hidden">Your selection:</span>
              </strong>
              <div class="line2" id="sumLine">
                <span class="de">Noch nichts gew√§hlt.</span>
                <span class="en hidden">Nothing selected yet.</span>
              </div>
            </div>

            <div class="btnLine" style="margin-top:12px;justify-content:space-between">
              <button class="btnGhost btnSmall" type="button" id="clearPick">
                <span class="de">Reset</span><span class="en hidden">Reset</span>
              </button>
              <a class="btn btnSmall" href="./webinare-buchen-08-ticketseite.html" data-internal id="toTicketBtn">
                <span class="de">weiter ‚Üí</span><span class="en hidden">next ‚Üí</span>
              </a>
            </div>
          </div>
        </div>

        <div class="note">
          <span class="de">Kostenlos hei√üt: Passung kl√§ren. Kostenpflichtig hei√üt: Ergebnis liefern.</span>
          <span class="en hidden">Free means: fit check. Paid means: deliver results.</span>
        </div>
      </div>

    </div>
  </section>

  <!-- ===== Laufband ===== -->
  <section id="laufband-sec">
    <div class="laufband-wrap">
      <div class="laufband floating">
        <div class="marquee" id="mqA"></div>
      </div>
    </div>
  </section>

  <!-- ===== Kino ===== -->
  <section id="kino">
    <div class="wrap" style="max-width:960px">
      <div class="frame floating">
        <iframe
          src="https://www.youtube-nocookie.com/embed/miWBKSszEIw?rel=0&modestbranding=1&playsinline=1"
          title="Kino ‚Äì Termine w√§hlen"
          loading="lazy"
          referrerpolicy="strict-origin-when-cross-origin"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen></iframe>
      </div>
    </div>
  </section>

  <!-- ===== Footer-Navigation (8 Seiten, aktive Seite markiert) ===== -->
  <section id="bottomNav">
    <div class="wrap">
      <div class="card floating">
        <h3 style="margin:0 0 10px">
          <span class="de">Navigation ‚Äì Webinare buchen</span>
          <span class="en hidden">Navigation ‚Äì Webinar booking</span>
        </h3>
        <p class="note" style="margin:0 0 14px">
          <span class="de">Du bist auf Seite <strong>07</strong>.</span>
          <span class="en hidden">You are on page <strong>07</strong>.</span>
        </p>

        <div class="nav8" aria-label="Navigation 8 Seiten">
          <a href="./webinare-buchen.html" data-internal>
            <span class="de">01 ‚Ä¢ Einstieg</span><span class="en hidden">01 ‚Ä¢ Start</span>
            <small class="de">Start</small><small class="en hidden">Start</small>
          </a>

          <a href="./webinare-buchen-02-ueberblick.html" data-internal>
            <span class="de">02 ‚Ä¢ √úberblick</span><span class="en hidden">02 ‚Ä¢ Overview</span>
            <small class="de">Orientierung</small><small class="en hidden">Orientation</small>
          </a>

          <a href="./webinare-buchen-03-webinare.html" data-internal>
            <span class="de">03 ‚Ä¢ Webinare</span><span class="en hidden">03 ‚Ä¢ Webinars</span>
            <small class="de">Formate</small><small class="en hidden">Formats</small>
          </a>

          <a href="./webinare-buchen-04-themen.html" data-internal>
            <span class="de">04 ‚Ä¢ Themen</span><span class="en hidden">04 ‚Ä¢ Topics</span>
            <small class="de">Auswahl</small><small class="en hidden">Selection</small>
          </a>

          <a href="./webinare-buchen-05-rollen-team.html" data-internal>
            <span class="de">05 ‚Ä¢ Rollen</span><span class="en hidden">05 ‚Ä¢ Roles</span>
            <small class="de">Einstieg</small><small class="en hidden">Entry</small>
          </a>

          <a href="./webinare-buchen-06-ablauf-regeln.html" data-internal>
            <span class="de">06 ‚Ä¢ Ablauf</span><span class="en hidden">06 ‚Ä¢ Flow</span>
            <small class="de">Rahmen</small><small class="en hidden">Scope</small>
          </a>

          <a href="./webinare-buchen-07.html" class="active" data-internal aria-current="page">
            <span class="de">07 ‚Ä¢ Buchung</span><span class="en hidden">07 ‚Ä¢ Booking</span>
            <small class="de">Aktuell</small><small class="en hidden">Current</small>
          </a>

          <a href="./webinare-buchen-08-ticketseite.html" data-internal>
            <span class="de">08 ‚Ä¢ Ticketseite</span><span class="en hidden">08 ‚Ä¢ Tickets</span>
            <small class="de">Kauf</small><small class="en hidden">Purchase</small>
          </a>
        </div>
      </div>
    </div>
  </section>

</main>

<script src="../../library/js/lang-switcher.js"></script>
<script src="../../library/js/music-button.js"></script>

<script>
  /* ========= Auswahl speichern ========= */
  const LS_KEY = "fsa_hoersaal_webinar_pick_v1";

  function niceDate(d, lang){
    const locale = (lang === "en") ? "en-GB" : "de-DE";
    const opts = { weekday:"short", day:"2-digit", month:"2-digit", year:"numeric" };
    return d.toLocaleDateString(locale, opts);
  }

  const TOPICS_DE = {
    paid: [
      { id:"akquise",  label:"Akquise-Training (klarer Gespr√§chsaufbau)" },
      { id:"telefon",  label:"Telefon-Training (Einwand ‚Üí Abschluss)" },
      { id:"workshop", label:"Workshop (Team/Prozess/Umsetzung)" },
      { id:"hoersaal", label:"H√∂rsaal-Besprechung (Partner-Setup & Inhalte)" }
    ],
    free: [
      { id:"bewerb_prom",  label:"Bewerbung: Promotor (kostenlos)" },
      { id:"bewerb_speak", label:"Bewerbung: Speaker (kostenlos)" },
      { id:"bewerb_event", label:"Bewerbung: Eventmanager (kostenlos)" },
      { id:"partner",      label:"Partner-Vorgespr√§ch (kostenlos)" }
    ]
  };

  const TOPICS_EN = {
    paid: [
      { id:"akquise",  label:"Outreach training (clear conversation flow)" },
      { id:"telefon",  label:"Call training (objection ‚Üí close)" },
      { id:"workshop", label:"Workshop (team/process/execution)" },
      { id:"hoersaal", label:"Session (partner setup & content)" }
    ],
    free: [
      { id:"bewerb_prom",  label:"Application: promoter (free)" },
      { id:"bewerb_speak", label:"Application: speaker (free)" },
      { id:"bewerb_event", label:"Application: event manager (free)" },
      { id:"partner",      label:"Partner intro call (free)" }
    ]
  };

  const TIMES = ["10:00","11:30","13:00","14:30","16:00","18:00"];

  function buildWeeks(n=8){
    const arr=[];
    const now=new Date();
    const day=now.getDay(); // 0..6
    const diffToMon = (day===0 ? -6 : (1 - day));
    const monday = new Date(now);
    monday.setDate(now.getDate() + diffToMon);

    for(let i=0;i<n;i++){
      const start=new Date(monday);
      start.setDate(monday.getDate() + i*7);
      const end=new Date(start);
      end.setDate(start.getDate() + 6);
      arr.push({ id:`w${i}`, start, end });
    }
    return arr;
  }
  const WEEKS = buildWeeks(8);

  /* ========= UI refs ========= */
  const elFmt   = document.getElementById("fmt");
  const elTopic = document.getElementById("topic");
  const elWeek  = document.getElementById("week");
  const elSlots = document.getElementById("slots");
  const elSum   = document.getElementById("sumLine");
  const btnSave = document.getElementById("savePick");
  const btnClear= document.getElementById("clearPick");

  let currentLang = (localStorage.getItem("fsa_lang") || "de");

  let state = {
    fmt: "free",
    topicId: "",
    weekId: WEEKS[0].id,
    slot: ""
  };

  function topicList(){
    const dict = (currentLang === "en") ? TOPICS_EN : TOPICS_DE;
    return dict[state.fmt] || [];
  }

  function weekLabel(weekId){
    const w = WEEKS.find(x=>x.id===weekId);
    if(!w) return "";
    return `${niceDate(w.start, currentLang)} ‚Äì ${niceDate(w.end, currentLang)}`;
  }

  function renderWeeks(){
    elWeek.innerHTML = "";
    WEEKS.forEach(w=>{
      const o=document.createElement("option");
      o.value=w.id;
      o.textContent=weekLabel(w.id);
      elWeek.appendChild(o);
    });
    elWeek.value = state.weekId;
  }

  function renderTopics(){
    const list = topicList();
    elTopic.innerHTML = "";
    list.forEach(t=>{
      const o=document.createElement("option");
      o.value=t.id;
      o.textContent=t.label;
      elTopic.appendChild(o);
    });
    if(!state.topicId || !list.some(x=>x.id===state.topicId)){
      state.topicId = list[0] ? list[0].id : "";
    }
    elTopic.value = state.topicId;
  }

  function renderSlots(){
    elSlots.innerHTML = "";
    TIMES.forEach(time=>{
      const b=document.createElement("button");
      b.type="button";
      b.className="slotBtn" + (state.slot===time ? " active" : "");
      b.dataset.time = time;
      b.innerHTML = `${time}<span class="slotMeta">${currentLang==="en" ? "Select slot" : "Slot w√§hlen"}</span>`;
      b.addEventListener("click", ()=>{
        state.slot = time;
        renderSlots();
        renderSummary();
        persist(false);
      });
      elSlots.appendChild(b);
    });
  }

  function topicLabel(){
    const list = topicList();
    const found = list.find(x=>x.id===state.topicId);
    return found ? found.label : "";
  }

  function renderSummary(){
    const fmtTxt = (currentLang==="en")
      ? (state.fmt==="paid" ? "Paid" : "Free")
      : (state.fmt==="paid" ? "Kostenpflichtig" : "Kostenlos");

    const t = topicLabel();
    const w = weekLabel(state.weekId);
    const s = state.slot ? state.slot : (currentLang==="en" ? "‚Äî" : "‚Äî");
    elSum.textContent = `${fmtTxt} ‚Ä¢ ${t} ‚Ä¢ ${w} ‚Ä¢ ${s}`;
  }

  function persist(showToast){
    try{
      const payload = {
        fmt: state.fmt,
        topicId: state.topicId,
        weekId: state.weekId,
        slot: state.slot,
        topicLabelDE: (TOPICS_DE[state.fmt] || []).find(x=>x.id===state.topicId)?.label || "",
        topicLabelEN: (TOPICS_EN[state.fmt] || []).find(x=>x.id===state.topicId)?.label || "",
        savedAt: Date.now()
      };
      localStorage.setItem(LS_KEY, JSON.stringify(payload));
      if(showToast){
        const de = (currentLang!=="en");
        btnSave.textContent = de ? "Gespeichert ‚úì" : "Saved ‚úì";
        setTimeout(()=>btnSave.textContent = de ? "Auswahl speichern" : "Save selection", 1200);
      }
    }catch(e){}
  }

  function restore(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return;
      const p = JSON.parse(raw);
      if(p && p.fmt) state.fmt = p.fmt;
      if(p && p.topicId) state.topicId = p.topicId;
      if(p && p.weekId) state.weekId = p.weekId;
      if(p && p.slot) state.slot = p.slot;
    }catch(e){}
  }

  function applyStateToUI(){
    elFmt.value = state.fmt;
    renderTopics();
    renderWeeks();
    elWeek.value = state.weekId;
    renderSlots();
    renderSummary();
  }

  elFmt.addEventListener("change", ()=>{
    state.fmt = elFmt.value;
    state.slot = "";
    state.topicId = "";
    renderTopics();
    renderSlots();
    renderSummary();
    persist(false);
  });

  elTopic.addEventListener("change", ()=>{
    state.topicId = elTopic.value;
    renderSummary();
    persist(false);
  });

  elWeek.addEventListener("change", ()=>{
    state.weekId = elWeek.value;
    renderSummary();
    persist(false);
  });

  btnSave.addEventListener("click", ()=>persist(true));

  btnClear.addEventListener("click", ()=>{
    state.slot = "";
    state.topicId = "";
    state.weekId = WEEKS[0].id;
    renderTopics();
    renderWeeks();
    renderSlots();
    renderSummary();
    persist(true);
  });

  /* ========= Laufband ‚Äì DE/EN ========= */
  const bandTextsDE = [
    "üóìÔ∏è Termin w√§hlen ‚Üí Ticket ‚Üí Link",
    "üÜì Gespr√§ch: Passung kl√§ren",
    "üí≥ Webinar/Training: Ergebnis liefern",
    "üè∑Ô∏è Mitglieder: 20% Rabatt",
    "üéØ Fokus: Umsetzung",
    "üìå Next Step statt H√§ngepartie",
    "‚è±Ô∏è P√ºnktlich starten, klar enden",
    "üöÄ Momentum ist die W√§hrung"
  ];
  const bandTextsEN = [
    "üóìÔ∏è Pick slot ‚Üí ticket ‚Üí link",
    "üÜì Free call: fit check",
    "üí≥ Paid: deliver results",
    "üè∑Ô∏è Members: 20% discount",
    "üéØ Focus: execution",
    "üìå Next step over limbo",
    "‚è±Ô∏è Start on time, end clearly",
    "üöÄ Momentum is the currency"
  ];

  function buildMarqueeLine(texts){
    const line = document.createElement('div');
    line.style.display='flex';
    line.style.alignItems='center';
    line.style.gap = getComputedStyle(document.documentElement).getPropertyValue('--marquee-gap') || '3cm';
    [...texts, ...texts].forEach(t=>{
      const span=document.createElement('span');
      span.textContent=t;
      line.appendChild(span);
    });
    return line.innerHTML;
  }

  function renderMarqueeByLang(code){
    const mq = document.getElementById('mqA');
    if(!mq) return;
    mq.innerHTML = buildMarqueeLine(code==='en' ? bandTextsEN : bandTextsDE);
  }

  /* ========= DE/EN Sichtbarkeit ========= */
  function applyLang(code){
    currentLang = (code === "en") ? "en" : "de";
    document.querySelectorAll('.de').forEach(el=>el.classList.toggle('hidden', currentLang!=='de'));
    document.querySelectorAll('.en').forEach(el=>el.classList.toggle('hidden', currentLang!=='en'));
    renderMarqueeByLang(currentLang);

    // UI Labels nach Sprache neu zeichnen
    renderTopics();
    renderWeeks();
    renderSlots();
    renderSummary();

    // Button-Text nach Language (falls vorher Toast)
    btnSave.textContent = (currentLang==="en") ? "Save selection" : "Auswahl speichern";
  }

  (function initLang(){
    const stored = localStorage.getItem('fsa_lang') || 'de';
    applyLang(stored);
  })();

  document.addEventListener('fsa:lang-change', (e)=>{
    const code = (e && e.detail) ? e.detail : (localStorage.getItem('fsa_lang') || 'de');
    applyLang(code);
  });

  /* ========= init ========= */
  restore();
  applyStateToUI();

  /* ========= nocache f√ºr interne Links ========= */
  (function(){
    const t = Date.now();
    document.querySelectorAll('a[data-internal]').forEach(a=>{
      try{
        const u = new URL(a.getAttribute('href'), location.href);
        u.searchParams.set('nocache', t);
        a.href = u.pathname + u.search + u.hash;
      }catch(e){}
    });
  })();

  /* ========= Scroll-Position bei Reload deaktivieren ========= */
  if ('scrollRestoration' in history) {
    history.scrollRestoration = 'manual';
    window.scrollTo(0, 0);
  }
</script>

</body>
</html>
