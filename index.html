<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FSA Landingpage â€” Autoplay Versuch</title>
<style>
  :root{
    --text:#f2f2f2; --gold:#d4af37; --glow:0 0 26px rgba(212,175,55,.45), 0 10px 28px rgba(0,0,0,.55);
    --maxw:1200px; --marquee-gap:4cm;
  }
  html,body{height:100%}
  body{margin:0;background:#000;color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;overflow-x:hidden}
  .bg{position:fixed;inset:0;z-index:-2;background:#000;overflow:hidden;pointer-events:auto}
  .bg iframe{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:120vw;height:120vh;border:0}
  .bg .slides{position:absolute;inset:0;z-index:-3}
  .slide{position:absolute;inset:0;background:#000 center/cover no-repeat;opacity:0;transition:opacity .9s;filter:brightness(.86)}
  .slide.active{opacity:1}
  main{position:relative;z-index:1}
  /* minimal rest (du kannst restlichen CSS/Text unverÃ¤ndert reinnehmen) */
  .fixed-right{position:fixed;right:20px;bottom:20px;z-index:4}
</style>
</head>
<body>

<!-- Hintergrund -->
<div class="bg" aria-hidden="true">
  <!-- iframe id bleibt bgVideo fÃ¼r YT API -->
  <iframe id="bgVideo" title="Adlerflug" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
  <div id="slides" class="slides"></div>
</div>

<main>
  <!-- hier kommt dein kompletter Seiteninhalt (Hero, Cards, etc.) â€” unverÃ¤ndert -->
  <section id="hero" style="padding-top:110px">
    <div style="max-width:1200px;margin:0 auto;color:var(--text)">
      <!-- Platzhalterinhalt -->
      <h1 style="color:var(--gold)">Dein Geld. Deine Freiheit.</h1>
    </div>
  </section>
</main>

<button id="musicBtn" class="fixed-right">ðŸŽµ Musik starten</button>
<audio id="bgMusic" loop src="library/music/pool/track-01.mp3"></audio>

<script>
/* =========================================================
   Robust Autoplay: Yout-ube hack (mirror) -> nocookie -> YT API playVideo()
   Fallback: Slideshow startet, wenn iframe nicht spielbar.
   ========================================================= */

(function(){
  const ytId = "miWBKSszEIw";
  const iframeEl = document.getElementById('bgVideo');
  const slidesEl = document.getElementById('slides');

  // Kandidaten (Hack-Mirror zuerst, dann privacy-nocookie)
  const CANDIDATES = [
    id => `https://www.yout-ube.com/embed/${id}?autoplay=1&mute=1&loop=1&playlist=${id}&controls=0&modestbranding=1&playsinline=1&enablejsapi=1`,
    id => `https://www.youtube-nocookie.com/embed/${id}?autoplay=1&mute=1&loop=1&playlist=${id}&controls=0&modestbranding=1&playsinline=1&enablejsapi=1`
  ];

  // Slideshow build (fallback)
  const MAX = 48;
  const nodes = [];
  for(let i=1;i<=MAX;i++){
    const n = String(i).padStart(2,'0');
    const d = document.createElement('div');
    d.className = 'slide';
    d.style.backgroundImage = `url('library/images/pool-live/slide-${n}.jpg')`;
    slidesEl.appendChild(d);
    nodes.push(d);
  }
  let si = 0, slideTimer = null;
  function stepSlides(){ nodes.forEach(x=>x.classList.remove('active')); nodes[si].classList.add('active'); si=(si+1)%nodes.length; }
  function startSlides(){ if(slideTimer) return; stepSlides(); slideTimer = setInterval(stepSlides, 6000); }

  // Versuchs-Logik: wir versuchen Kandidaten nacheinander + YouTube IFrame API
  let tried = 0, loaded = false, safety = null, player = null, apiReady = false;

  // Lade YouTube IFrame API (nur einmal)
  function loadYTApi(cb){
    if(window.YT && window.YT.Player){ apiReady = true; return cb(); }
    const s = document.createElement('script');
    s.src = "https://www.youtube.com/iframe_api";
    s.onload = ()=>{ /* onYouTubeIframeAPIReady wird aufgerufen global */ };
    document.head.appendChild(s);
    // Polling fallback
    let checks = 0;
    const poll = setInterval(()=>{
      checks++;
      if(window.YT && window.YT.Player){ clearInterval(poll); apiReady = true; cb(); }
      else if(checks>40){ clearInterval(poll); cb(); } // give up after ~4s
    },100);
  }

  // Erzeuge Player via API (wenn mÃ¶glich)
  function createPlayer(urlCandidateIndex){
    // Set iframe src first (enablejsapi required in URL)
    iframeEl.src = CANDIDATES[urlCandidateIndex](ytId);
    try{
      // Wenn API bereit -> baue Player instance
      if(window.YT && window.YT.Player){
        player = new YT.Player('bgVideo', {
          playerVars:{
            autoplay:1, mute:1, loop:1, playlist:ytId, controls:0, modestbranding:1, playsinline:1
          },
          events:{
            onReady: function(){
              apiReady = true;
              // mute + try play
              try{ player.mute(); player.playVideo(); loaded = true; clearTimeout(safety); }
              catch(e){ /* ignore */ }
            },
            onStateChange: function(e){
              // wenn playing -> success
              if(e.data === YT.PlayerState.PLAYING){ loaded = true; clearTimeout(safety); }
              if(e.data === YT.PlayerState.ENDED){ /* loop handled by playlist param */ }
            },
            onError: function(){
              // try next candidate
              if(!loaded){ tried++; tryLoad(); }
            }
          }
        });
      } else {
        // no API -> set src only (some browsers will autoplay muted)
        iframeEl.src = CANDIDATES[urlCandidateIndex](ytId);
      }
    }catch(err){
      // fallback
      iframeEl.src = CANDIDATES[urlCandidateIndex](ytId);
    }
  }

  function tryLoad(){
    if(loaded) return;
    if(tried >= CANDIDATES.length){
      // alle Kandidaten probiert -> starte Slideshow fallback
      startSlides();
      return;
    }
    // erst lade API, dann create player
    loadYTApi(()=>{ createPlayer(tried); });

    // safety: wenn innerhalb 2500ms nichts lÃ¤uft -> nÃ¤chster Kandidat
    clearTimeout(safety);
    safety = setTimeout(()=>{
      if(!loaded){
        tried++;
        // cleanup previous player if exists
        try{ if(player && player.destroy) player.destroy(); player = null; }catch(e){}
        if(tried < CANDIDATES.length) tryLoad();
        else startSlides();
      }
    }, 2500);
  }

  // Wenn Autoplay dennoch blockiert, erlauben wir eine automatische "retry" bei erster Interaktion
  function userRetry(){
    if(loaded) return;
    if(player && player.playVideo){
      player.mute();
      player.playVideo().catch(()=>{ startSlides(); });
    } else {
      // set src again to trigger
      iframeEl.src = CANDIDATES[Math.min(tried, CANDIDATES.length-1)](ytId);
    }
    window.removeEventListener('pointerdown', userRetry);
    window.removeEventListener('touchstart', userRetry);
  }

  window.addEventListener('pointerdown', userRetry, { once:true });
  window.addEventListener('touchstart', userRetry, { once:true });

  // Start
  tryLoad();
})();
</script>

</body>
</html>
