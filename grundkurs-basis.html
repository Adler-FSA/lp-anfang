<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FSA Akademie ‚Äì Grundkurs 1 (Basis)</title>
<style>
:root{
  --bg:#0b0f14;
  --panel:#111826;
  --panel-2:#0f1622;
  --ink:#e6eaf1;
  --muted:#9aa3b8;
  --gold:#d4af37;
  --gold-soft:#f4d98a;
  --accent:#4ea1ff;     /* Progress */
  --accent-2:#8ec5ff;  /* Hover */
  --ok:#10b981;
  --warn:#f59e0b;
  --err:#ef4444;
}

html,body{margin:0;height:100%;background:
 radial-gradient(1200px 700px at 50% -10%, #17202b 0%, #0b0f14 55%, #070a0f 100%);
 color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}

.container{max-width:1000px;margin:22px auto 80px;padding:0 16px}

/* NAV (LP-Stil) */
.topbar{position:sticky;top:0;z-index:50;background:rgba(7,10,15,.7);backdrop-filter:blur(10px);padding:10px 0;border-bottom:1px solid rgba(255,255,255,.06)}
.nav{display:flex;gap:12px;align-items:center;justify-content:flex-start}
.pill{display:inline-flex;gap:8px;align-items:center;padding:8px 14px;border-radius:16px;background:#161d27;color:#e9eef7;border:1px solid rgba(255,255,255,.08);text-decoration:none;font-weight:600}
.pill:hover{border-color:rgba(255,255,255,.18);background:#1a2330}
.pill svg{width:18px;height:18px}
.flex-spacer{flex:1}
.lang-toggle,.music-toggle{cursor:pointer}
.music-toggle{padding:8px 12px}

/* GREETING */
.header{margin:24px 0 16px}
.header h1{margin:0 0 8px;font-size:clamp(24px,3.2vw,34px);color:var(--gold)}
.header p{margin:4px 0;color:var(--muted)}

/* QUIZ CARD */
.card{background:linear-gradient(180deg,#0e1520,#0b1119);border-radius:14px;padding:16px;border:1px solid rgba(255,255,255,.06);
 box-shadow:0 28px 120px rgba(212,175,55,.12), 0 0 0 2px rgba(212,175,55,.15) inset}
.card-header{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-bottom:10px}
.bread{display:flex;gap:8px;align-items:center;color:#d9e6ff;font-weight:700}
.bread svg{width:18px;height:18px}
.step{color:#b9c7dd}

.progress{height:8px;background:#0f1622;border-radius:8px;overflow:hidden;margin:6px 0 16px}
.progress span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%}

.q-text{margin:6px 0 12px;font-size:1.05rem;font-weight:700}
.answers{display:flex;flex-direction:column;gap:10px;margin:12px 0}
.answer{background:#0f1622;border:1px solid rgba(255,255,255,.06);border-radius:10px;padding:12px 14px;cursor:pointer}
.answer:hover{border-color:rgba(255,255,255,.18);background:#121a26}
.answer.selected{outline:2px solid var(--accent)}

.actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
.btn{padding:10px 14px;border:none;border-radius:10px;font-weight:700;cursor:pointer}
.btn-ghost{background:#0f1622;color:#dce6f7;border:1px solid rgba(255,255,255,.08)}
.btn-ghost:hover{background:#151f2c}
.btn-gold{background:linear-gradient(180deg,#ffe09a,#efc24a);color:#1a1403;box-shadow:0 8px 26px rgba(239,194,74,.35)}
.btn-gold:disabled{opacity:.6;cursor:not-allowed}

/* GLOSSAR */
.glossar{margin:28px 0}
.glossar h2{font-size:1.2rem;margin:0 0 10px}
.accordion{display:flex;flex-direction:column;gap:8px}
.acc-item{border:1px solid rgba(255,255,255,.06);border-radius:10px;background:#0f1622}
.acc-head{padding:12px 14px;cursor:pointer;display:flex;align-items:center;justify-content:space-between}
.acc-head span{font-weight:700}
.acc-body{display:none;padding:12px 14px;color:#cfd8e6;border-top:1px solid rgba(255,255,255,.06)}
.acc-item.open .acc-body{display:block}

/* AUSWERTUNG */
.result{margin:26px 0 12px;display:none}
.result.show{display:block;animation:fadein .35s ease}
@keyframes fadein{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.result .badge{display:inline-block;background:#0f1622;border:1px solid rgba(255,255,255,.08);border-radius:999px;padding:6px 10px;margin-bottom:8px}
.result h3{margin:6px 0 10px}
.score{font-size:1.1rem;margin-bottom:10px}
.kite{border:1px solid rgba(255,255,255,.08);background:#0f1622;border-radius:12px;padding:12px;margin:8px 0}
.kite strong{color:#e7f0ff}
.next-block{display:flex;flex-direction:column;gap:10px;margin-top:14px}
.note{color:var(--muted);font-size:.95rem}

/* helpers */
.hidden{display:none}

/* Responsive */
@media (max-width:700px){
  .actions{justify-content:stretch}
  .btn{flex:1}
}
</style>
</head>
<body>

<div class="topbar">
  <div class="container nav">
    <!-- LP-Buttons mit originalen Inline-SVGs -->
    <a class="pill" href="/lp-anfang/index.html" aria-label="Start">
      <!-- Haus -->
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 11.5 12 5l8 6.5v6.5a1.5 1.5 0 0 1-1.5 1.5H5.5A1.5 1.5 0 0 1 4 18V11.5Z" stroke="#e8f0ff" stroke-width="1.5"/><path d="M9 19V13h6v6" stroke="#e8f0ff" stroke-width="1.5"/></svg>
      Start
    </a>
    <a class="pill" href="/lp-anfang/campus.html" aria-label="Campus">
      <!-- Graduation -->
      <svg viewBox="0 0 24 24" fill="none"><path d="M2 9.5 12 5l10 4.5-10 4.5L2 9.5Z" fill="#e8f0ff" opacity=".9"/><path d="M7 12.5c2 2 8 2 10 0v3c-2 3-8 3-10 0v-3Z" fill="#c7d2fe"/></svg>
      Campus
    </a>
    <a class="pill" href="/lp-anfang/office.html" aria-label="Office">
      <!-- Folder -->
      <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="6" width="18" height="14" rx="2" fill="#dbeafe"/><path d="M3 10h18" stroke="#94a3b8"/></svg>
      Office
    </a>
    <a class="pill" href="/lp-anfang/krypto.html" aria-label="Krypto">
      <!-- Diamond/Tile -->
      <svg viewBox="0 0 24 24" fill="none"><rect x="6" y="6" width="12" height="12" rx="3" fill="#bfe1ff"/><path d="M6 12h12M12 6v12" stroke="#0b0f14" opacity=".45"/></svg>
      Krypto
    </a>

    <div class="flex-spacer"></div>

    <button class="pill lang-toggle" id="langToggle" aria-label="Sprache">
      DE / EN / RU
    </button>
    <button class="pill music-toggle" id="musicBtn" aria-label="Musik">
      ‚ô™ Musik
    </button>
  </div>
</div>

<div class="container">
  <section class="header">
    <h1 id="greet">Hallo, du!</h1>
    <p id="intro1">Starte deinen ersten Grundkurs und lerne jetzt deine Basis kennen.</p>
    <p id="intro2">Diese vier Kurse bilden dein Fundament f√ºr den Rest deines Lebens und geben dir die Chance, endlich finanziell souver√§n zu leben.</p>
  </section>

  <!-- QUIZ -->
  <section class="card" id="quizCard" aria-live="polite">
    <div class="card-header">
      <div class="bread">
        <!-- Buch-Icon -->
        <svg viewBox="0 0 24 24" fill="none"><path d="M5 5h10a3 3 0 0 1 3 3v11H8a3 3 0 0 1-3-3V5Z" fill="#8ab6ff"/><rect x="5" y="5" width="3" height="11" fill="#1e3a8a"/></svg>
        <span id="crumb">Grundkurs ‚Äì Basis</span>
      </div>
      <div class="step" id="stepLbl">Frage 1 von 10</div>
    </div>

    <div class="progress" aria-hidden="true"><span id="progBar"></span></div>

    <div class="q-text" id="qText">‚Ä¶</div>

    <div class="answers" id="answers"></div>

    <div class="actions">
      <button class="btn btn-ghost" id="prevBtn">‚Üê Zur√ºck</button>
      <button class="btn btn-gold" id="nextBtn" disabled>Weiter ‚Üí</button>
    </div>
  </section>

  <!-- GLOSSAR -->
  <section class="glossar" id="glossar">
    <h2>üß† <span id="glTitle">Glossar ‚Äì Fachbegriffe in diesem Grundkurs</span></h2>
    <div class="accordion" id="acc">
      <!-- Items werden via JS gef√ºllt (sprachabh√§ngig) -->
    </div>
  </section>

  <!-- AUSWERTUNG -->
  <section class="card result" id="resultCard" aria-live="polite">
    <span class="badge" id="resBadge">Auswertung</span>
    <h3 id="resTitle">Ergebnis</h3>
    <div class="score" id="resScore"></div>
    <div id="resList"></div>

    <div class="next-block">
      <div class="note" id="nextHint">N√§chster Kurs: Sicherheit ‚Äì Schutz, Seeds, Disziplin ‚Äì souver√§n bleiben.</div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a class="btn btn-ghost" href="/lp-anfang/grundkurs-sicherheit.html">Weiter zu ‚ÄûGrundkurs ‚Äì Sicherheit‚Äú</a>
        <button class="btn btn-gold" id="retryBtn">Nochmal starten</button>
      </div>
    </div>
  </section>
</div>

<audio id="bgm" src="/library/music/pool/track-02.mp3" preload="auto" loop></audio>

<script>
/* ========= Utilities ========= */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

const stateKey = 'fsa:gk1:run';
const langKey  = 'fsa:lang';
const musicKey = 'fsa:music:on';

const nameFromTor = sessionStorage.getItem('visitorName') || '';

const qs = new URLSearchParams(location.search);
if(qs.get('reset')==='1'){ localStorage.removeItem(stateKey); }

/* ========= Sprache: Inhalte ========= */
const i18n = {
  de: {
    greet: (name)=> `Hallo, ${name || 'du'}!`,
    intro1: "Starte deinen ersten Grundkurs und lerne jetzt deine Basis kennen.",
    intro2: "Diese vier Kurse bilden dein Fundament f√ºr den Rest deines Lebens und geben dir die Chance, endlich finanziell souver√§n zu leben.",
    crumb: "Grundkurs ‚Äì Basis",
    step: (i,total)=> `Frage ${i} von ${total}`,
    btnPrev: "‚Üê Zur√ºck",
    btnNext: "Weiter ‚Üí",
    glossTitle: "Glossar ‚Äì Fachbegriffe in diesem Grundkurs",
    gloss: [
      {t:"Seed Phrase", d:"Eine geheime Wortliste (meist 12‚Äì24 W√∂rter). Sie ist der Generalschl√ºssel zu deinen Werten. Wer sie hat, besitzt dein Verm√∂gen."},
      {t:"Dezentralit√§t", d:"Kein einzelner Akteur kontrolliert das System. Regeln sind offen, transparent und durch Technik gesichert."},
      {t:"Liquidit√§t", d:"Wie leicht sich ein Asset kaufen/verkaufen l√§sst, ohne den Preis stark zu bewegen."},
      {t:"Trustyfy", d:"Plattform-Br√ºcke zwischen Fiat (IBAN, zentral) und dezentralen Werten. Nicht dezentral."},
      {t:"Krypto-Wallet", d:"Software/Hardware zur Verwaltung deiner Schl√ºssel. Die Coins liegen auf der Blockchain, nicht ‚Äûin‚Äú der Wallet."}
    ],
    resBadge:"Auswertung",
    tiers:{
      none:"Keine Qualifikation",
      rep:"Wiederholung empfohlen",
      bronze:"Bronze ‚Äì Qualifiziert",
      silver:"Silber ‚Äì Qualifiziert",
      gold:"Gold ‚Äì Qualifiziert"
    },
    nextHint:"N√§chster Kurs: Sicherheit ‚Äì Schutz, Seeds, Disziplin ‚Äì souver√§n bleiben.",
    retry:"Nochmal starten",
    // Fragen (10) ‚Äì mit richtiger Antwort (correctIndex)
    questions: [
      {
        q:"Warum ist der erste Schritt zur finanziellen Souver√§nit√§t das eigene Verst√§ndnis √ºber Geldfl√ºsse?",
        a:[
          "Weil nur wer versteht, wie Geld entsteht und zirkuliert, bewusste Entscheidungen treffen kann.",
          "Weil Geld immer durch Banken kontrolliert wird und man sich dem nicht entziehen kann.",
          "Weil finanzielle Souver√§nit√§t nur von staatlicher Regulierung abh√§ngt."
        ],
        correctIndex:0,
        mentor:"Finanzielle M√ºndigkeit beginnt mit Verst√§ndnis √ºber Entstehung und Zirkulation von Geld.",
        deepen:"Vertiefung: Grundlagen & Geldfl√ºsse ‚Äì siehe Krypto Step 1."
      },
      {
        q:"Was unterscheidet ein klassisches Bankkonto von einer Krypto-Wallet?",
        a:[
          "Beide speichern nur die Transaktionen, nicht das Geld selbst.",
          "Ein Bankkonto geh√∂rt einer Bank, eine Wallet geh√∂rt ausschlie√ülich dir selbst.",
          "Beide Systeme werden von denselben Institutionen √ºberwacht."
        ],
        correctIndex:1,
        mentor:"Bei der Wallet verwahrst du die Schl√ºssel selbst ‚Äì damit die Kontrolle.",
        deepen:"Vertiefung: Wallet vs. IBAN ‚Äì siehe Krypto Step 1."
      },
      {
        q:"Warum ist die Seed Phrase der wichtigste Teil einer Wallet?",
        a:[
          "Sie ersetzt die PIN deiner Bankkarte.",
          "Sie ist der Nachweis, dass du Kunde einer B√∂rse bist.",
          "Sie ist der einzige Zugang zu deinem Verm√∂gen ‚Äì ohne Seed kein Zugriff."
        ],
        correctIndex:2,
        mentor:"Ohne Seed keine Wiederherstellung ‚Äì behandle sie wie ein Schatz.",
        deepen:"Vertiefung: Seed-Sicherheit ‚Äì siehe Krypto Step 2."
      },
      {
        q:"Was bedeutet ‚Äûfinanzielle Eigenverantwortung‚Äú im Krypto-Kontext wirklich?",
        a:[
          "Dass man bereit ist, f√ºr seine Entscheidungen und Fehler selbst einzustehen.",
          "Dass man anderen Vertrauenspersonen die Verwahrung √ºberl√§sst.",
          "Dass man m√∂glichst viele Konten bei verschiedenen B√∂rsen er√∂ffnet."
        ],
        correctIndex:0,
        mentor:"Eigenverantwortung = Verantwortung tragen, Risiken verstehen, bewusst handeln.",
        deepen:"Vertiefung: Verantwortung & Praxis ‚Äì siehe Krypto Step 3."
      },
      {
        q:"Warum sollte man Plattformen wie Trustyfy verstehen, bevor man Geld einzahlt?",
        a:[
          "Weil sie das beste Zinsmodell bieten.",
          "Weil Verst√§ndnis √ºber Funktion und Risiko vor Verlust sch√ºtzt.",
          "Weil sonst Transaktionen automatisch abgelehnt werden."
        ],
        correctIndex:1,
        mentor:"Trustyfy ist die Br√ºcke (Fiat ‚Üî dezentral). Verstehe Regeln & Risiken.",
        deepen:"Vertiefung: On/Off-Ramp ‚Äì siehe Krypto Step 3."
      },
      {
        q:"Welche Aussage beschreibt ‚ÄûDezentralit√§t‚Äú am besten?",
        a:[
          "Ein System, das von einer zentralen Beh√∂rde gesteuert wird.",
          "Ein System, bei dem jeder Teilnehmer gleiche Rechte und Zugriffe hat.",
          "Ein System, das keine Technologie, sondern eine Bankstruktur nutzt."
        ],
        correctIndex:1,
        mentor:"Dezentralit√§t ist Machtverteilung ‚Äì nicht Zentralsteuerung.",
        deepen:"Vertiefung: Dezentralit√§t ‚Äì siehe Krypto Step 2."
      },
      {
        q:"Warum ist ‚ÄûNicht deine Schl√ºssel ‚Äì nicht deine Coins‚Äú mehr als nur ein Spruch?",
        a:[
          "Weil du ohne eigene Schl√ºssel nicht wirklich der Besitzer deiner Krypto-Werte bist.",
          "Weil die Schl√ºssel automatisch bei der B√∂rse gespeichert werden.",
          "Weil Coins immer durch staatliche Versicherung gesch√ºtzt sind."
        ],
        correctIndex:0,
        mentor:"Eigene Schl√ºssel = tats√§chliches Eigentum. Sonst nur Anspruch.",
        deepen:"Vertiefung: Self-Custody ‚Äì siehe Krypto Step 2."
      },
      {
        q:"Welche Haltung f√ºhrt am ehesten zu langfristigem finanziellen Erfolg?",
        a:[
          "Schnelles Handeln, ohne sich vorher zu informieren.",
          "Geduld, Disziplin und die Bereitschaft, st√§ndig weiter zu lernen.",
          "Blindes Vertrauen in die Erfahrungen anderer."
        ],
        correctIndex:1,
        mentor:"Disziplin + Lernbereitschaft schlagen Hektik und H√∂rensagen.",
        deepen:"Vertiefung: Mindset & Prozesse ‚Äì siehe Krypto Step 3."
      },
      {
        q:"Warum braucht finanzielle Souver√§nit√§t ein Verst√§ndnis f√ºr Risiko?",
        a:[
          "Weil Risiko nur bei Banken existiert.",
          "Weil du ohne Risikobewusstsein nicht frei, sondern abh√§ngig entscheidest.",
          "Weil Risiken sich automatisch ausgleichen, wenn man Geduld hat."
        ],
        correctIndex:1,
        mentor:"Ohne Risikokompetenz triffst du keine souver√§nen Entscheidungen.",
        deepen:"Vertiefung: Risiko-Grundlagen ‚Äì siehe Krypto Step 3."
      },
      {
        q:"Was zeigt, dass jemand finanziell souver√§n geworden ist?",
        a:[
          "Er kann sich schnell Geld leihen, wenn er es braucht.",
          "Er nutzt sein Wissen bewusst, um unabh√§ngig von Systemen zu handeln.",
          "Er vertraut darauf, dass andere f√ºr ihn die richtige Entscheidung treffen."
        ],
        correctIndex:1,
        mentor:"Souver√§nit√§t = Wissen bewusst anwenden und unabh√§ngig handeln.",
        deepen:"Vertiefung: Praxis & Souver√§nit√§t ‚Äì siehe Krypto Step 3."
      }
    ]
  },
  en: {
    greet: (name)=> `Hello, ${name || 'you'}!`,
    intro1: "Start your first course and get your foundations right.",
    intro2: "These four courses form the basis for the rest of your life and enable true financial sovereignty.",
    crumb: "Foundation Course ‚Äì Basics",
    step: (i,total)=> `Question ${i} of ${total}`,
    btnPrev:"‚Üê Back", btnNext:"Next ‚Üí",
    glossTitle:"Glossary ‚Äì Terms in this course",
    gloss:[
      {t:"Seed phrase", d:"Secret word list (12‚Äì24). Master key to your funds. Whoever owns it, owns your assets."},
      {t:"Decentralization", d:"No single actor controls the system; rules are open and enforced by tech."},
      {t:"Liquidity", d:"How easily an asset can be traded without moving the price much."},
      {t:"Trustyfy", d:"Platform bridge between fiat (IBAN, centralized) and decentralized value. Not decentralized."},
      {t:"Crypto wallet", d:"Manages keys. Coins live on the blockchain, not ‚Äúin‚Äù the wallet."}
    ],
    resBadge:"Evaluation",
    tiers:{none:"No qualification",rep:"Repeat recommended",bronze:"Bronze ‚Äì Qualified",silver:"Silver ‚Äì Qualified",gold:"Gold ‚Äì Qualified"},
    nextHint:"Next course: Security ‚Äì protection, seeds, discipline.",
    retry:"Restart",
    questions: [] // (wir benutzen DE-Fragen + laufende √úbersetzung bei Bedarf; kann sp√§ter bef√ºllt werden)
  },
  ru: {
    greet: (name)=> `–ü—Ä–∏–≤–µ—Ç, ${name || '—Ç—ã'}!`,
    intro1: "–ù–∞—á–Ω–∏ –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å –∏ –æ—Å–≤–æÃÅ–π –±–∞–∑—É.",
    intro2: "–≠—Ç–∏ —á–µ—Ç—ã—Ä–µ –∫—É—Ä—Å–∞ —Å—Ç–∞–Ω—É—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–º –Ω–∞ –≤—Å—é –∂–∏–∑–Ω—å –∏ –¥–∞–¥—É—Ç —à–∞–Ω—Å –∂–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ —Å—É–≤–µ—Ä–µ–Ω–Ω–æ.",
    crumb: "–ë–∞–∑–æ–≤—ã–π –∫—É—Ä—Å ‚Äì –û—Å–Ω–æ–≤–∞",
    step: (i,total)=> `–í–æ–ø—Ä–æ—Å ${i} –∏–∑ ${total}`,
    btnPrev:"‚Üê –ù–∞–∑–∞–¥", btnNext:"–î–∞–ª—å—à–µ ‚Üí",
    glossTitle:"–ì–ª–æ—Å—Å–∞—Ä–∏–π ‚Äì —Ç–µ—Ä–º–∏–Ω—ã –≤ —ç—Ç–æ–º –∫—É—Ä—Å–µ",
    gloss:[
      {t:"–°–∏–¥-—Ñ—Ä–∞–∑–∞", d:"–°–µ–∫—Ä–µ—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ (12‚Äì24). –ì–ª–∞–≤–Ω—ã–π –∫–ª—é—á –∫ —Å—Ä–µ–¥—Å—Ç–≤–∞–º. –£ –∫–æ–≥–æ –æ–Ω –µ—Å—Ç—å ‚Äì —Ç–æ—Ç –≤–ª–∞–¥–µ–µ—Ç –∞–∫—Ç–∏–≤–∞–º–∏."},
      {t:"–î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è", d:"–ù–∏–∫—Ç–æ –µ–¥–∏–Ω–æ–ª–∏—á–Ω–æ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É; –ø—Ä–∞–≤–∏–ª–∞ –æ—Ç–∫—Ä—ã—Ç—ã –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω—ã —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–µ–π."},
      {t:"–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å", d:"–ù–∞—Å–∫–æ–ª—å–∫–æ –ª–µ–≥–∫–æ –∫—É–ø–∏—Ç—å/–ø—Ä–æ–¥–∞—Ç—å –∞–∫—Ç–∏–≤ –±–µ–∑ —Å–∏–ª—å–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ü–µ–Ω—É."},
      {t:"Trustyfy", d:"–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞-–º–æ—Å—Ç –º–µ–∂–¥—É —Ñ–∏–∞—Ç–æ–º (IBAN, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è) –∏ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∞–∫—Ç–∏–≤–∞–º–∏. –ù–µ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞."},
      {t:"–ö—Ä–∏–ø—Ç–æ-–∫–æ—à–µ–ª—ë–∫", d:"–ü–û/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏. –ú–æ–Ω–µ—Ç—ã ‚Äî –≤ –±–ª–æ–∫—á–µ–π–Ω–µ, –∞ –Ω–µ ¬´–≤¬ª –∫–æ—à–µ–ª—å–∫–µ."}
    ],
    resBadge:"–ò—Ç–æ–≥–∏",
    tiers:{none:"–ù–µ—Ç –¥–æ–ø—É—Å–∫–∞",rep:"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä",bronze:"–ë—Ä–æ–Ω–∑–∞ ‚Äî –¥–æ–ø—É—Å–∫",silver:"–°–µ—Ä–µ–±—Ä–æ ‚Äî –¥–æ–ø—É—Å–∫",gold:"–ó–æ–ª–æ—Ç–æ ‚Äî –¥–æ–ø—É—Å–∫"},
    nextHint:"–°–ª–µ–¥—É—é—â–∏–π –∫—É—Ä—Å: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî –∑–∞—â–∏—Ç–∞, —Å–∏–¥, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞.",
    retry:"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ",
    questions: [] // –∫–∞–∫ –≤—ã—à–µ ‚Äî –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∑–∂–µ
  }
};

// Falls EN/RU-Fragen noch leer: fallback auf DE-Fragen
['en','ru'].forEach(k=>{
  if(!i18n[k].questions?.length){
    // einfache Spiegelung (DE Fragen), Antworten bleiben DE ‚Äì UI ist √ºbersetzt
    i18n[k].questions = JSON.parse(JSON.stringify(i18n.de.questions));
  }
});

/* ========= State ========= */
let lang = localStorage.getItem(langKey) || 'de';
let run = JSON.parse(localStorage.getItem(stateKey) || 'null');

const total = i18n.de.questions.length;
let idx = 0;                     // aktuelle Frage (0-based)
let order = [];                  // Shuffle-Order pro Frage (Array[3])
let picks = new Array(total).fill(null); // gew√§hlte Antwort (0..2 in shufflender Ordnung)
let correct = 0;

/* ========= DOM refs ========= */
const greet = $('#greet'), intro1=$('#intro1'), intro2=$('#intro2');
const crumb = $('#crumb'), stepLbl=$('#stepLbl'), progBar=$('#progBar');
const qText = $('#qText'), answers=$('#answers');
const prevBtn=$('#prevBtn'), nextBtn=$('#nextBtn');

const resCard=$('#resultCard'), resBadge=$('#resBadge'), resTitle=$('#resTitle'),
      resScore=$('#resScore'), resList=$('#resList'), retryBtn=$('#retryBtn'),
      nextHint=$('#nextHint');

const glossTitle = $('#glTitle'); const acc = $('#acc');

const bgm = $('#bgm'), musicBtn = $('#musicBtn');
const langToggle = $('#langToggle');

/* ========= Helpers ========= */
const saveRun = ()=> {
  const data = { idx, order, picks };
  localStorage.setItem(stateKey, JSON.stringify(data));
};
const loadRun = ()=> {
  if(!run) return false;
  ({ idx, order, picks } = run);
  return true;
};
const shuffle = (arr)=>{ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr; };

const setLang = (l)=>{
  lang = l; localStorage.setItem(langKey,l);
  const L = i18n[lang];
  greet.textContent = L.greet(nameFromTor);
  intro1.textContent = L.intro1;
  intro2.textContent = L.intro2;
  crumb.textContent = L.crumb;
  prevBtn.textContent = L.btnPrev;
  nextBtn.textContent = L.btnNext;
  glossTitle.textContent = L.glossTitle;
  resBadge.textContent = L.resBadge;
  nextHint.textContent = L.nextHint;

  // Glossar
  acc.innerHTML = '';
  L.gloss.forEach((g,i)=>{
    const item = document.createElement('div'); item.className='acc-item';
    item.innerHTML = `
      <div class="acc-head"><span>${g.t}</span><svg width="16" height="16" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" stroke="#cfe0ff" stroke-width="2" fill="none"/></svg></div>
      <div class="acc-body">${g.d}</div>
    `;
    item.querySelector('.acc-head').addEventListener('click',()=>{
      item.classList.toggle('open');
      // nur ein offenes
      $$('.acc-item').forEach(el=>{ if(el!==item) el.classList.remove('open'); });
    });
    acc.appendChild(item);
  });

  render();
};

const computeScore = ()=>{
  const Q = i18n[lang].questions;
  correct = 0;
  for(let i=0;i<total;i++){
    if(picks[i]==null) continue;
    const ord = order[i];
    const pickedOriginalIndex = ord[picks[i]];
    if(pickedOriginalIndex===Q[i].correctIndex) correct++;
  }
  return correct;
};

const tierLabel = (score)=>{
  const t = i18n[lang].tiers;
  if(score<=5) return t.rep;      // (0..5) -> Wiederholung empfohlen
  if(score<=6) return t.rep;      // 6 -> empfohlen
  if(score<=8) return t.bronze;   // 7..8
  if(score===9) return t.silver;  // 9
  return t.gold;                  // 10
};

/* ========= Render ========= */
function render(){
  const L = i18n[lang], Q = L.questions;
  // Step
  stepLbl.textContent = L.step(idx+1, total);
  progBar.style.width = `${((idx)/total)*100}%`;

  // Frage
  qText.textContent = Q[idx].q;

  // Antworten (shuffle beim ersten Besuch der Frage)
  if(!order[idx]) order[idx] = shuffle([0,1,2]);

  answers.innerHTML='';
  order[idx].forEach((origIndex, i)=>{
    const btn = document.createElement('button');
    btn.className = 'answer';
    btn.type='button';
    btn.textContent = Q[idx].a[origIndex];
    if(picks[idx]===i) btn.classList.add('selected');
    btn.addEventListener('click', ()=>{
      picks[idx]=i;
      // UI markieren
      $$('.answer').forEach(b=>b.classList.remove('selected'));
      btn.classList.add('selected');
      nextBtn.disabled=false;
      saveRun();
    });
    answers.appendChild(btn);
  });

  // Buttons
  prevBtn.disabled = idx===0;
  nextBtn.disabled = picks[idx]==null;

  // Result ausblenden bis zum Ende
  resCard.classList.remove('show');
}

/* ========= Events ========= */
prevBtn.addEventListener('click', ()=>{
  if(idx>0){ idx--; saveRun(); render(); }
});
nextBtn.addEventListener('click', ()=>{
  if(picks[idx]==null) return;
  if(idx<total-1){
    idx++; saveRun(); render();
  }else{
    // Abschluss
    progBar.style.width='100%';
    showResult();
  }
});

function showResult(){
  computeScore();
  const L = i18n[lang], Q = L.questions;

  resList.innerHTML='';
  // Board: jede Frage
  for(let i=0;i<total;i++){
    const wrap = document.createElement('div');
    wrap.className='kite';
    const ord = order[i];
    const picked = picks[i]; // 0..2
    const pickedOrig = (picked==null)? null : ord[picked];
    const correctOrig = Q[i].correctIndex;

    const pickedTxt = (pickedOrig==null)? '‚Äî' : Q[i].a[pickedOrig];
    const corrTxt   = Q[i].a[correctOrig];

    wrap.innerHTML = `
      <div><strong>Frage ${i+1}:</strong> ${Q[i].q}</div>
      <div><strong>Deine Antwort:</strong> ${pickedTxt}</div>
      <div><strong>Richtig:</strong> ${corrTxt}</div>
      <div style="margin-top:6px">${Q[i].mentor}</div>
      <div style="margin-top:6px;color:#a6b6ce"><em>${Q[i].deepen}</em></div>
    `;
    resList.appendChild(wrap);
  }

  const score = correct;
  const tier = tierLabel(score);
  resTitle.textContent = L.resBadge;
  resScore.textContent = `${score} / ${total} richtig ‚Äî ${tier}`;
  resCard.classList.add('show');

  // Abschluss speichern (optional)
  localStorage.setItem(stateKey, JSON.stringify({idx, order, picks}));
}

retryBtn.addEventListener('click', ()=>{
  // Restart mit neuem Shuffle
  order = [];
  picks = new Array(total).fill(null);
  idx = 0; correct = 0;
  saveRun();
  resCard.classList.remove('show');
  render();
});

/* ========= Musik ========= */
const musicOn = localStorage.getItem(musicKey)==='1';
if(musicOn){ bgm.play().catch(()=>{}); musicBtn.setAttribute('aria-pressed','true'); }
musicBtn.addEventListener('click', ()=>{
  if(bgm.paused){ bgm.play().catch(()=>{}); localStorage.setItem(musicKey,'1'); musicBtn.setAttribute('aria-pressed','true'); }
  else { bgm.pause(); localStorage.setItem(musicKey,'0'); musicBtn.setAttribute('aria-pressed','false'); }
});

/* ========= Sprache Toggle ========= */
langToggle.addEventListener('click', ()=>{
  const order = ['de','en','ru'];
  const i = order.indexOf(lang);
  const next = order[(i+1)%order.length];
  setLang(next);
});

/* ========= Init ========= */
(function init(){
  // Sprache
  setLang(localStorage.getItem(langKey) || 'de');

  // Name (Tor)
  greet.textContent = i18n[lang].greet(nameFromTor);

  // State laden falls vorhanden
  run = JSON.parse(localStorage.getItem(stateKey) || 'null');
  if(loadRun()){
    // validiere L√§ngen
    if(!order || order.length!==total) order=[];
    if(!picks || picks.length!==total) picks = new Array(total).fill(null);
  }else{
    order=[]; picks=new Array(total).fill(null); idx=0;
    saveRun();
  }
  render();
})();
</script>
</body>
</html>
