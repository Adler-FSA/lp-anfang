<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FSA Akademie ‚Äì Pr√ºfungsvorbereitung & Qualifikation</title>

  <style>
    :root{
      --gold:#d4af37;--ink:#0b0f14;--panel:rgba(17,24,39,.82);
      --line:rgba(212,175,55,.35);--muted:#9ca3af;
    }
    body{margin:0;background:var(--ink);color:#e5e7eb;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
    main{max-width:960px;margin:0 auto;padding:2cm 1rem;}
    h1,h2{color:var(--gold);margin:.4rem 0 1rem;}
    p{color:var(--muted);line-height:1.6;}
    .panel{background:var(--panel);border:1px solid var(--line);
      border-radius:14px;padding:1.6rem;box-shadow:0 0 24px rgba(212,175,55,.08);}
    .badge{display:inline-block;margin-left:.4rem;
      border:1px solid var(--line);border-radius:999px;
      padding:.2rem .6rem;color:#fff;background:rgba(255,255,255,.06);}
    .bar{height:16px;background:#1e293b;border-radius:8px;overflow:hidden;margin:1rem 0;}
    .bar>div{height:100%;transition:width .8s ease;}
    .btn-row{display:flex;flex-wrap:wrap;gap:.8rem;margin-top:1.4rem;}
    .btn{background:rgba(0,0,0,.6);color:var(--gold);
      border:1px solid var(--line);border-radius:8px;
      padding:.7rem 1.4rem;font-weight:600;cursor:pointer;transition:.25s;}
    .btn:hover{filter:brightness(1.1);}
    .btn.primary{background:linear-gradient(90deg,#3b82f6,#d4af37);
      color:#fff;border:none;}
    blockquote{margin:1.4rem 0;padding:1rem 1.4rem;
      background:rgba(255,255,255,.05);border-left:4px solid var(--gold);
      font-style:italic;color:#e5e7eb;border-radius:6px;}
    #certCard{margin-top:1.4rem;text-align:center;padding:1.6rem;
      border:2px solid var(--gold);border-radius:16px;
      background:rgba(255,255,255,0.03);box-shadow:0 0 30px rgba(212,175,55,.15);}
    @media(max-width:720px){.btn-row{justify-content:space-between}.btn{flex:1 1 auto;text-align:center}}
  </style>
</head>

<body>
  <main>
    <!-- Pr√ºfungs√ºbersicht -->
    <section class="panel">
      <h1>üèÜ Pr√ºfungsvorbereitung</h1>
      <p id="introText">
        Herzlichen Gl√ºckwunsch, <span id="userName"></span>!  
        Du hast dich qualifiziert und <strong id="userPoints">0</strong> Punkte erreicht.
        Jetzt wartet die gro√üe Hauptpr√ºfung mit 50 Fragen auf dich ‚Äì dein letzter Schritt
        zur <strong>Mentor-Qualifikation</strong>.
      </p>

      <div class="bar"><div id="barFill"></div></div>
      <p><strong>Wissensindex:</strong> <span id="percent"></span>% | Status: <span id="status"></span></p>

      <blockquote id="mentorMsg">
        ‚ÄûWissen ist kein Besitz, sondern Bewegung. ‚Äî Bleib im Flug.‚Äú
      </blockquote>

      <div class="btn-row">
        <button class="btn primary" id="toExamBtn">Zur Hauptpr√ºfung ‚Üí</button>
        <button class="btn" id="backToCourses">Zur√ºck zu den Kursen</button>
        <button class="btn" id="resetBtn">üîÑ Daten zur√ºcksetzen</button>
      </div>
    </section>

    <!-- Zertifikat -->
    <section id="certificate" class="panel" style="display:none;margin-top:2cm;">
      <h2>üéì Zertifikat ‚Äì Mentor Qualifikation</h2>
      <p id="certText">
        Herzlichen Gl√ºckwunsch, <strong id="certName"></strong>!  
        Du hast die Hauptpr√ºfung mit <strong id="certPoints"></strong> Punkten abgeschlossen  
        und damit <strong>100 % Wissen</strong> in der FSA-Akademie erreicht.  
        Dieses Zertifikat best√§tigt deine Qualifikation als Mentor ü¶Ö.
      </p>

      <div id="certCard">
        <h3 style="color:var(--gold);margin-bottom:.2rem;">FSA Akademie</h3>
        <p style="font-size:1.1rem;">Mentor-Zertifikat</p>
        <hr style="border:none;border-top:1px solid var(--gold);margin:1rem auto;width:60%;">
        <p style="font-size:1.2rem;font-weight:600;" id="certDisplayName"></p>
        <p style="margin:.4rem 0;">hat erfolgreich die Hauptpr√ºfung absolviert</p>
        <p><strong>Wissensindex: 100 % ‚Äì Gold ü•á</strong></p>
        <p style="font-size:.9rem;color:var(--muted);margin-top:.8rem;">
          Datum: <span id="certDate"></span>
        </p>
      </div>

      <div class="btn-row">
        <button class="btn primary" id="downloadCert">üìÑ Zertifikat herunterladen (PDF)</button>
      </div>
    </section>
  </main>

  <!-- Globale Module -->
  <script src="library/js/menu.js" defer></script>
  <script src="library/js/lang-switcher.js" defer></script>
  <script src="library/js/music-button.js" defer></script>
  <script src="library/js/back-to-home.js" defer></script>
  <!-- jsPDF f√ºr PDF-Export -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
  document.addEventListener("DOMContentLoaded",()=>{
    const lang = localStorage.getItem("fsa_lang") || "de";
    const first = localStorage.getItem("fsa_firstName") || "";
    const last  = localStorage.getItem("fsa_lastName") || "";
    const full  = (first + " " + last).trim() || (lang==="de"?"Teilnehmer":"Participant");

    const pts   = parseInt(localStorage.getItem("fsa_exam_points")||"0",10);
    const perc  = parseInt(localStorage.getItem("fsa_exam_percent")||"0",10);
    const stat  = localStorage.getItem("fsa_exam_status") || "‚Äî";

    document.getElementById("userName").textContent = full;
    document.getElementById("userPoints").textContent = pts;
    document.getElementById("percent").textContent = perc;
    document.getElementById("status").textContent = stat;

    const fill = document.getElementById("barFill");
    const color = pts<60?"#ef4444":pts<75?"#cd7f32":pts<90?"#93c5fd":"#d4af37";
    fill.style.width = Math.min(perc,100)+"%";
    fill.style.background = color;

    // Mentor-Kommentar
    const msg = document.getElementById("mentorMsg");
    msg.textContent =
      pts < 60 ? (lang==="de"
        ?"Bleib dran ‚Äì aus Fehlern w√§chst St√§rke."
        :"Keep going ‚Äì every mistake is fuel for growth.")
      : pts < 75 ? (lang==="de"
        ?"Stark begonnen, jetzt gilt: Wiederholen festigt Wissen."
        :"Strong start ‚Äì repetition builds mastery.")
      : pts < 90 ? (lang==="de"
        ?"Sehr gut! Du bist fast am Ziel ‚Äì Feinschliff entscheidet."
        :"Very good! You‚Äôre nearly there ‚Äì refinement decides.")
      : (lang==="de"
        ?"Exzellent! Du hast 100 % Wissen erschaffen ‚Äì Mentor-Niveau erreicht ü¶Ö"
        :"Excellent! You‚Äôve reached 100 % knowledge ‚Äì mentor level ü¶Ö");

    // Navigation-Buttons
    document.getElementById("toExamBtn").addEventListener("click",()=>{
      window.location.href = "grundkurs-pruefung.html?nocache=" + Date.now();
    });
    document.getElementById("backToCourses").addEventListener("click",()=>{
      window.location.href = "grundkurs-basis.html?nocache=" + Date.now();
    });
    document.getElementById("resetBtn").addEventListener("click",()=>{
      if(confirm(lang==="de"
        ?"Alle Pr√ºfungsdaten und Namen wirklich l√∂schen?"
        :"Really delete all exam data and names?")){
        Object.keys(localStorage)
          .filter(k=>k.startsWith("fsa_"))
          .forEach(k=>localStorage.removeItem(k));
        location.reload();
      }
    });

    // ‚ñ∫ Zertifikat anzeigen + PDF-Export
    const cert = document.getElementById("certificate");
    if(pts >= 100){
      const date = new Date().toLocaleDateString("de-DE");
      document.getElementById("certName").textContent = full;
      document.getElementById("certDisplayName").textContent = full;
      document.getElementById("certPoints").textContent = pts;
      document.getElementById("certDate").textContent = date;
      cert.style.display = "block";

      document.getElementById("downloadCert").addEventListener("click",()=>{
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF("p","mm","a4");
        const center = w => (210 - w) / 2;
        doc.setFillColor(11,15,20);
        doc.rect(0,0,210,297,"F");
        doc.setTextColor(212,175,55);
        doc.setFontSize(20);
        const title = lang==="de"?"FSA Akademie ‚Äì Mentor-Zertifikat":"FSA Academy ‚Äì Mentor Certificate";
        doc.text(title, center(doc.getTextWidth(title)), 40);
        doc.setFontSize(14);
        doc.setTextColor(255,255,255);
        const nameLine = full;
        doc.text(nameLine, center(doc.getTextWidth(nameLine)), 80);
        doc.setFontSize(12);
        const line1 = lang==="de"
          ? "hat erfolgreich die Hauptpr√ºfung absolviert und 100 % Wissen erreicht."
          : "has successfully completed the final exam and reached 100 % knowledge.";
        doc.text(line1, center(doc.getTextWidth(line1)), 95);
        const line2 = lang==="de"
          ? "Damit best√§tigt die FSA Akademie den Mentor-Status (Gold ü•á)."
          : "FSA Academy hereby confirms Mentor Status (Gold ü•á).";
        doc.text(line2, center(doc.getTextWidth(line2)), 105);
        doc.setFontSize(10);
        doc.setTextColor(150,150,150);
        doc.text("Datum: "+date, 20, 280);
        doc.text("FSA Akademie ‚Äì Finanzielle Souver√§nit√§t", 20, 286);
        doc.save("FSA-Mentor-Zertifikat.pdf");
      });
    }
  });
  </script>
</body>
</html>
