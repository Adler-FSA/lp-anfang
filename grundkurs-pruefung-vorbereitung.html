<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FSA Akademie – Prüfungsvorbereitung</title>

  <style>
    :root { --gold:#d4af37; --ink:#0b0f14; --panel:rgba(17,24,39,.7); --line:rgba(212,175,55,.35); --muted:#a3a3a3; }
    html,body{margin:0;padding:0;background:var(--ink);color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    main{max-width:1040px;margin:0 auto;padding:0 16px 100px}
    h1,h2{color:var(--gold);margin:0 0 .6rem 0;text-align:center}
    p{color:var(--muted);line-height:1.6;margin:.4rem 0;text-align:center}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:1.6rem;box-shadow:0 0 22px rgba(212,175,55,.08)}
    #quiz-root{margin-top:1.5cm}
    .sp-2cm{margin-top:2cm}
    .list{display:inline-block;text-align:left;line-height:1.9;color:#e5e7eb;margin:1rem 0}
    .pill{display:inline-block;padding:.1rem .55rem;border:1px solid rgba(212,175,55,.35);border-radius:999px;font-size:.85rem;margin-left:.4rem}
    .ok{color:#d4af37;border-color:#d4af37}
    .warn{color:#94a3b8}
    .btn{background:rgba(0,0,0,0.7);border:1px solid #d4af37;color:#d4af37;padding:.8rem 1.6rem;border-radius:8px;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .row{display:flex;gap:.8rem;justify-content:center;margin-top:1.1rem;flex-wrap:wrap}
    a.inline{color:#d4af37;text-decoration:none;border-bottom:1px dotted rgba(212,175,55,.5)}
  </style>
</head>

<body>
  <main>
    <!-- Intro -->
    <section class="card sp-2cm" id="intro">
      <h1>Prüfungsvorbereitung</h1>
      <p id="introText">
        Hier siehst du deinen Fortschritt aus allen vier Grundkursen.<br>
        <strong>Wichtig:</strong> Bronze oder Silber reichen <em>nicht</em> für die Hauptprüfung.
        <br>Du brauchst <strong>viermal Gold</strong>, dann wird die Prüfung freigeschaltet.
      </p>
      <p style="color:#94a3b8" id="introHint">
        Die Übersicht zeigt dir, wo du ggf. noch nachschärfen solltest.
      </p>
    </section>

    <!-- Gesamtauswertung -->
    <section id="quiz-root"></section>
  </main>

  <!-- Globale Module -->
  <script src="library/js/menu.js" defer></script>
  <script src="library/js/lang-switcher.js" defer></script>
  <script src="library/js/music-button.js" defer></script>
  <script src="library/js/back-to-home.js" defer></script>

  <script>
    // Seite aufbauen: 4×Gold nötig
    document.addEventListener("DOMContentLoaded", () => {
      const lang = localStorage.getItem("fsa_lang") || "de";
      document.documentElement.lang = lang;

      // EN-Introtexte
      if (lang === "en") {
        document.querySelector("#intro h1").textContent = "Exam Preparation";
        document.getElementById("introText").innerHTML =
          `Here you can see your progress across all four basic courses.<br>
           <strong>Important:</strong> Bronze or Silver are <em>not</em> sufficient for the final exam.
           <br>You need <strong>Gold in all four courses</strong> to unlock the exam.`;
        document.getElementById("introHint").textContent =
          "The overview shows where you might still want to improve.";
      }

      // Kursliste
      const courses = [
        {key:"course1", de:"Grundkurs 1 – Basis",     en:"Course 1 – Foundation", next:"grundkurs-sicherheit.html"},
        {key:"course2", de:"Grundkurs 2 – Sicherheit",en:"Course 2 – Security",   next:"grundkurs-einkommen.html"},
        {key:"course3", de:"Grundkurs 3 – Einkommen", en:"Course 3 – Income",     next:"grundkurs-network.html"},
        {key:"course4", de:"Grundkurs 4 – Network",   en:"Course 4 – Network",    next:"grundkurs-pruefung.html"}
      ];

      // Daten sammeln
      const items = [];
      let allGold = true;
      const notGold = [];

      courses.forEach(c => {
        const score  = Number(localStorage.getItem(`fsa_${c.key}_score`) || 0);
        const status = (localStorage.getItem(`fsa_${c.key}_status`) || "—").trim();
        const title  = lang==="de" ? c.de : c.en;
        const isGold = /Gold/i.test(status);
        if (!isGold) { allGold = false; notGold.push({title, next:c.next}); }

        items.push(
          `<li>
             <strong>${title}:</strong>
             ${score}/10 – <span class="pill ${isGold ? "ok":"warn"}">${status}</span>
           </li>`
        );
      });

      // UI rendern
      const container = document.getElementById("quiz-root");
      const readyTxt = lang==="de" ? "✅ Alle vier Kurse: Gold – die Hauptprüfung ist freigeschaltet."
                                   : "✅ All four courses: Gold — the final exam is unlocked.";
      const notReadyTxt = lang==="de"
        ? "⏳ Noch nicht bereit – es fehlt mindestens ein Gold-Status."
        : "⏳ Not ready yet — at least one course is not Gold.";

      // Hinweise für fehlende Gold-Kurse (mit Links)
      const needList = !allGold
        ? `<p style="margin-top:.6rem">${lang==="de" ? "Hier weiter üben:" : "Continue training here:"}
            ${notGold.map(n => ` • <a class="inline" href="${n.next}">${n.title}</a>`).join("")}
           </p>`
        : "";

      container.innerHTML = `
        <div class="card" style="text-align:center;margin-top:1.2cm">
          <h2>${lang==="de" ? "Dein Fortschritt" : "Your Progress"}</h2>
          <ul class="list">${items.join("")}</ul>
          <p style="margin-top:.6rem">${allGold ? readyTxt : notReadyTxt}</p>
          ${needList}
          <div class="row">
            <button id="examBtn" class="btn" ${allGold ? "" : "disabled"}>
              ${lang==="de" ? "Zur Hauptprüfung →" : "Go to Final Exam →"}
            </button>
          </div>
        </div>
      `;

      // Button-Aktion
      const examBtn = document.getElementById("examBtn");
      examBtn?.addEventListener("click", () => {
        if (!allGold) return;
        window.location.href = "grundkurs-pruefung.html?nocache=" + Date.now();
      });
    });
  </script>
</body>
</html>
