<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Schritt 1 â€“ Einstieg & On-/Off-Ramp (trustyfy)</title>
<style>
  :root{
    --bg:#0b0f14;
    --panel:#121821;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --gold:#f2c94c;
    --glow:#f59e0b;
  }

  html,body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }

  /* â–‘â–‘ Topbar fix: bÃ¼ndig am Viewport â–‘â–‘ */
  header.global-menu{
    position:fixed;
    top:0 !important; left:0; right:0;
    margin-top:0 !important; padding-top:0 !important;
    z-index:9999;
  }

  .wrap{max-width:1400px;margin:0 auto;padding:0 16px}

  .hero{
    background:linear-gradient(180deg,rgba(242,201,76,.07),rgba(0,0,0,0));
    border:1px solid rgba(242,201,76,.25);
    border-radius:16px;
    padding:24px 20px;
    box-shadow:0 0 40px rgba(245,158,11,.15) inset,0 0 24px rgba(245,158,11,.12);
    /* WICHTIG: Top-Abstand wird per JS gesetzt, damit keine Oberkante-Luft entsteht */
    margin-top:0;
  }
  .hero h1{margin:0 0 6px;font-size:34px;color:var(--gold);text-align:center}
  .hero p{margin:4px auto 0;max-width:880px;text-align:center;color:var(--muted)}

  .cta-row{display:flex;gap:12px;justify-content:center;margin-top:16px;flex-wrap:wrap}
  .btn{border:0;border-radius:12px;padding:12px 18px;font-weight:700;cursor:pointer}
  .btn-primary{background:var(--gold);color:#111827;box-shadow:0 0 18px rgba(245,158,11,.25)}
  .btn-ghost{background:transparent;color:var(--gold);border:1px solid rgba(242,201,76,.35)}

  .panel{
    background:var(--panel);
    border:1px solid rgba(242,201,76,.18);
    border-radius:16px;
    box-shadow:0 0 32px rgba(245,158,11,.12);
    padding:20px;
    margin-top:24px;
  }

  /* Slideshow */
  .stage{position:relative;width:100%;height:75vh;border-radius:14px;overflow:hidden;background:#000;border:1px solid rgba(242,201,76,.16)}
  .slide{position:absolute;inset:0;opacity:0;transition:opacity .35s ease}
  .slide.active{opacity:1}
  .stage img{width:100%;height:100%;object-fit:contain;background:#000}
  .nav{position:absolute;inset-inline:0;bottom:20px;display:flex;justify-content:center;gap:6px;z-index:5}
  .dot{width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,.28);border:0;cursor:pointer}
  .dot.active{background:#fff}

  /* Steuerleiste */
  .control-bar{display:flex;justify-content:center;gap:16px;margin-top:16px;flex-wrap:wrap}
  .ctrl-btn{background:var(--gold);color:#111827;font-weight:700;padding:12px 18px;border-radius:10px;border:0;cursor:pointer;transition:all .2s ease}
  .ctrl-btn:hover{background:#ffd95c;}

  /* FAQ */
  details{
    border:1px solid rgba(242,201,76,.15);
    border-radius:10px;
    margin-bottom:10px;
    padding:12px 14px;
    background:rgba(255,255,255,.02);
  }
  summary{
    cursor:pointer;
    font-weight:600;
    list-style:none;
    display:flex;
    align-items:center;
    justify-content:space-between;
    color:var(--gold);
  }
  summary::-webkit-details-marker{display:none}
  details p{margin-top:10px;color:var(--muted);line-height:1.5}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.35);color:#bbf7d0;margin-left:8px}
  .foot{margin-top:20px;color:var(--muted);font-size:14px;text-align:center}
  .link{color:#93c5fd;text-decoration:underline}

  /* ===== Affiliate-Bar (Trustyfy) ===== */
  .affbar{
    position:fixed; top:-220px; left:0; right:0; z-index:9998;
    backdrop-filter:blur(8px) saturate(140%);
    background:linear-gradient(180deg, rgba(17,24,39,.96), rgba(17,24,39,.88));
    border-bottom:1px solid rgba(242,201,76,.28);
    box-shadow:0 10px 40px rgba(0,0,0,.5), 0 0 28px rgba(245,158,11,.28);
    transition:top .28s ease;
  }
  .affbar.open{ top:0; }
  .affbar-inner{ max-width:1400px; margin:0 auto; padding:16px 20px; display:grid; gap:10px; }
  .aff-row{ display:flex; gap:10px; align-items:center; }
  .aff-title{ display:flex; align-items:center; gap:8px; font-weight:700; color:#fff; }
  .addr{ flex:1; display:flex; align-items:center; gap:10px; background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.18); border-radius:12px; padding:10px 12px; }
  .addr input{ flex:1; background:transparent; border:0; outline:0; color:#fff; font-size:.98rem; font-family:inherit; }
  .aff-help{ color:var(--muted); font-size:.9rem; margin:0 0 2px; }
  .aff-error{ color:#ffb4b4; font-size:.9rem; margin:0; display:none; }
  .aff-actions{ display:flex; gap:10px; }
  .btn-ghost-aff{ display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:10px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.18); color:#fff; cursor:pointer; }
  .btn-ghost-aff:hover{ filter:brightness(1.06); transform:translateY(-1px); }
  .icon{width:20px;height:20px;flex:0 0 20px}

  /* Toast */
  .toast{ position:fixed; bottom:18px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,.78); border:1px solid rgba(255,255,255,.18); color:#fff; padding:10px 14px; border-radius:10px; font-size:.92rem; z-index:9999; box-shadow:0 8px 28px rgba(0,0,0,.4); display:none; }
  .toast.show{ display:block; }
  .muted-link-mini{ display:inline-block; margin-top:8px; color:var(--muted); text-decoration:underline; cursor:pointer; }
</style>
</head>
<body>

  <!-- Globale Topbar (wird von menu.js befÃ¼llt) -->
  <div id="menu-root"></div>

  <!-- â–‘â–‘ Affiliate-Bar (Trustyfy) â–‘â–‘ -->
  <div id="affBar" class="affbar" role="dialog" aria-modal="true" aria-labelledby="affTitle" aria-hidden="true">
    <div class="affbar-inner">
      <div class="aff-title" id="affTitle">
        <!-- Lock Icon -->
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M8 10V7a4 4 0 0 1 8 0v3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          <rect x="4" y="10" width="16" height="10" rx="2" stroke="currentColor" stroke-width="1.8" fill="none"/>
        </svg>
        <span>Affiliate-Link erforderlich</span>
      </div>
      <p class="aff-help">FÃ¼ge deinen persÃ¶nlichen trustyfy-Affiliate-Link ein (nur <b>app.trustyfy.com</b>). Danach kannst du ihn Ã¶ffnen oder teilen.</p>

      <div class="aff-row">
        <div class="addr" style="min-height:44px">
          <!-- Globe Icon -->
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6" fill="none"/>
            <path d="M3 12h18M12 3a16 16 0 0 1 0 18M12 3a16 16 0 0 0 0 18" stroke="currentColor" stroke-width="1.4" fill="none"/>
          </svg>
          <input id="affInput" type="url" inputmode="url" autocomplete="url" placeholder="https://app.trustyfy.com/?by=â€¦" aria-label="Affiliate-Link" />
        </div>
        <div class="aff-actions">
          <button id="affSaveOpen" class="btn-ghost-aff">
            <!-- Check Icon -->
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M5 12l4 4 10-10" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Speichern
          </button>
          <button id="affCancel" class="btn-ghost-aff">
            <!-- X Icon -->
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
            </svg>
            Abbrechen
          </button>
        </div>
      </div>
      <p id="affError" class="aff-error">Bitte eine gÃ¼ltige http(s)-URL zur Domain <b>app.trustyfy.com</b> einfÃ¼gen.</p>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite">
    <span id="tSaved">Affiliate-Link gespeichert.</span>
    <span id="tCopied" style="display:none">Link kopiert.</span>
    <span id="tShared" style="display:none">Teilen-Dialog geÃ¶ffnet.</span>
    <span id="tReset" style="display:none">Affiliate-Link zurÃ¼ckgesetzt.</span>
    <span id="tFromUrl" style="display:none">Affiliate-Link aus URL Ã¼bernommen.</span>
  </div>

  <div class="wrap">
    <!-- Hero -->
    <div class="hero panel" id="first-panel">
      <h1>Schritt&nbsp;1 â€“ Einstieg &amp; On-/Off-Ramp (trustyfy)</h1>
      <p>Hier startest du sauber: KYC, IBAN, Euro â†’ Krypto und zurÃ¼ck. Die Slides zeigen dir den Ablauf Schritt fÃ¼r Schritt â€“ klar und groÃŸ.</p>
      <div class="cta-row">
        <!-- Ã–ffnet gespeicherten Affiliate-Link (oder fordert ihn an) -->
        <a class="btn btn-primary" id="ctaOpen" href="https://app.trustyfy.com" target="_blank" rel="noopener">ğŸš€ Zu trustyfy wechseln</a>
        <!-- Teilt/Kopiert den gespeicherten Link -->
        <button class="btn btn-ghost" id="ctaShare">Affiliate-Link teilen</button>
      </div>
      <p class="foot"><button id="affReset" class="muted-link-mini">Affiliate-Link Ã¤ndern / zurÃ¼cksetzen</button></p>
    </div>

    <!-- Intro -->
    <div class="panel">
      <h2 style="color:var(--gold);text-align:center;margin-bottom:14px;font-size:26px;">
        Finanzielle SouverÃ¤nitÃ¤t â€“ kein Traum, sondern ein Weg
      </h2>
      <p style="color:var(--muted);max-width:900px;margin:0 auto 14px;text-align:center;font-size:1.05rem;line-height:1.6;">
        Finanzielle SouverÃ¤nitÃ¤t bedeutet: Niemand auÃŸer dir bestimmt Ã¼ber dein Geld, deinen Zugang und deine Entscheidungen.
        Keine Bank, kein Staat, kein Algorithmus, der dich sperren kann.
      </p>
      <p style="color:var(--muted);max-width:900px;margin:0 auto 14px;text-align:center;font-size:1.05rem;line-height:1.6;">
        Das war lange Theorie. Mit <strong style="color:var(--gold);">Trustyfy</strong> wird sie real.
        Du bekommst eine eigene IBAN, tauschst FIAT direkt in Krypto und behÃ¤ltst die volle Kontrolle â€” 
        ohne App-Store-Zwang, ohne Zwischeninstanzen, ohne Erlaubnis.
      </p>
      <ul style="color:var(--muted);max-width:700px;margin:0 auto 14px;font-size:1rem;line-height:1.6;text-align:left;">
        <li>ğŸš€ Du verlÃ¤sst ein System, das jederzeit einfrieren oder sperren kann.</li>
        <li>ğŸŒ Du betrittst ein globales Finanznetzwerk, das niemandem gehÃ¶rt â€” aber allen offensteht.</li>
        <li>ğŸ§  Du baust Sicherheit durch Wissen und Verantwortung statt Institutionen.</li>
        <li>ğŸ”‘ Du lernst, wie Geld endlich wirklich dir gehÃ¶rt.</li>
      </ul>
      <blockquote style="max-width:700px;margin:18px auto 0;padding-left:16px;border-left:3px solid var(--gold);font-style:italic;color:var(--muted);">
        â€Freiheit ist kein Geschenk. Sie entsteht, wenn du dich entscheidest, die Kontrolle selbst zu Ã¼bernehmen.â€œ
      </blockquote>
    </div>

    <!-- ğŸ§­ Was du hier erledigst -->
    <div class="panel" style="text-align:center;">
      <h2 style="color:var(--gold);margin-bottom:14px;font-size:26px;">
        ğŸ§­ Was du hier erledigst <span class="badge">Startklar</span>
      </h2>
      <ul style="list-style:none;padding:0;max-width:700px;margin:0 auto;text-align:left;color:var(--muted);line-height:1.6;font-size:1.05rem;">
        <li>âœ… Konto bei <b>trustyfy</b> anlegen und KYC durchfÃ¼hren.</li>
        <li>ğŸ¦ Eigene <b>IBAN</b> erhalten â€“ Ein- und Auszahlungen per Ãœberweisung.</li>
        <li>ğŸ’± Euro sicher in <b>Krypto</b> tauschen (On-Ramp) â€“ und zurÃ¼ck (Off-Ramp).</li>
        <li>ğŸ“Š Transparenz: GebÃ¼hren, Netzwerke, Slippage â€“ direkt sichtbar.</li>
        <li>ğŸ”‘ Volle Kontrolle: Dein Geld, dein Weg â€“ ohne App-Store-Zwang.</li>
      </ul>
      <p class="foot">
        Tipp: Ã–ffne trustyfy parallel in einem neuen Tab und gehe die Slides Schritt fÃ¼r Schritt mit. 
      </p>
    </div>

    <!-- Slideshow -->
    <div class="panel">
      <div class="stage" id="stage">
        <img src="/lp-anfang/krypto/images/slide-01.jpg" alt="Slide 1" class="slide active" id="fallback">
        <div class="nav" id="nav"></div>
      </div>
      <div class="control-bar">
        <button class="ctrl-btn" id="prev">â—€ ZurÃ¼ck</button>
        <button class="ctrl-btn" id="next">Weiter â–¶</button>
      </div>
    </div>

    <!-- ğŸ‰ Mentor -->
    <div class="panel">
      <h2 style="color:var(--gold);text-align:center;margin-bottom:16px;">ğŸ‰ Starker Schritt â€“ Willkommen in deiner finanziellen EigenstÃ¤ndigkeit</h2>
      <p style="color:var(--muted);max-width:880px;margin:0 auto 16px;text-align:center;font-size:1.05rem;line-height:1.6;">
        Du hast jetzt den ersten und wichtigsten Schritt gemacht: <strong>deine eigene finanzielle Infrastruktur aufgebaut</strong>.
        Von diesem Moment an bist du nicht mehr Zuschauer â€“ du bist derjenige, der die Kontrolle hat.
      </p>
      <p style="color:var(--muted);max-width:880px;margin:0 auto 16px;text-align:center;font-size:1.05rem;line-height:1.6;">
        Ein Mentor wÃ¼rde dir an dieser Stelle sagen: <em>â€Das war kein kleiner Klick â€” das war eine Entscheidung fÃ¼r Freiheit.â€œ</em>
      </p>
    </div>

    <!-- ğŸ§ª Ãœbungen -->
    <div class="panel">
      <h2 style="color:var(--gold);text-align:center;margin-bottom:16px;">ğŸ§ª Deine ersten Ãœbungsaufgaben</h2>
      <ul style="color:var(--muted);max-width:700px;margin:0 auto;font-size:1.05rem;line-height:1.6;">
        <li>ğŸ’¸ <b>Zahle</b> einen kleinen Betrag ein (z. B. 10 â‚¬), um die AblÃ¤ufe kennenzulernen.</li>
        <li>ğŸ”„ <b>Tausche</b> den Betrag in eine KryptowÃ¤hrung deiner Wahl â€” und zurÃ¼ck in Euro.</li>
        <li>ğŸš€ <b>Teste</b> eine Transaktion: sende einen kleinen Betrag an dich selbst oder einen Partner.</li>
      </ul>
      <p style="text-align:center;color:var(--muted);margin-top:12px;">
        ğŸ‘‰ Diese Ãœbungen geben dir Sicherheit im Umgang â€” noch bevor es wirklich wichtig wird.
      </p>
    </div>

    <!-- â“ FAQ -->
    <div class="panel">
      <h2 style="color:var(--gold);text-align:center;margin-bottom:10px;">â“ HÃ¤ufige Fragen (FAQ)</h2>
      <p style="text-align:center;color:var(--muted);margin-bottom:20px;">ğŸ’¡ Tippe auf eine Frage, um die Antwort und den Mentor-Tipp zu Ã¶ffnen.</p>
      <div style="max-width:880px;margin:0 auto;">
        <details><summary>â³ Wie lange dauert eine Einzahlung?</summary><p>In der Regel 1â€“2 Werktage, abhÃ¤ngig von deiner Bank.</p></details>
        <details><summary>ğŸªª Muss ich jedes Mal KYC machen?</summary><p>Nein. Nach der Ersteinrichtung bleibt dein Konto verifiziert.</p></details>
        <details><summary>ğŸ’¸ Was kostet eine Transaktion?</summary><p>Die GebÃ¼hren sind transparent in der App sichtbar â€” keine versteckten Kosten.</p></details>
        <details><summary>ğŸ” Kann mein Konto gesperrt werden?</summary><p>Nicht durch Banken â€” du bist selbst in Kontrolle.</p></details>
        <details><summary>âœï¸ Was ist, wenn ich mich vertippe?</summary><p>Transaktionen sind endgÃ¼ltig. Daher immer Adresse doppelt prÃ¼fen.</p></details>
        <details><summary>ğŸ§  Wie sicher ist mein Guthaben?</summary><p>Trustyfy ist reguliert und nutzt Kryptografie â€” die grÃ¶ÃŸte Sicherheit ist dein Wissen.</p></details>
        <details><summary>ğŸ’± Kann ich wieder zurÃ¼ck auf FIAT wechseln?</summary><p>Ja, du kannst jederzeit in Euro auszahlen.</p></details>
        <details><summary>ğŸ”‘ Brauche ich ein Hardware-Wallet?</summary><p>Empfohlen fÃ¼r grÃ¶ÃŸere BetrÃ¤ge â€“ fÃ¼r den Anfang reicht dein Konto.</p></details>
        <details><summary>ğŸ” Was, wenn ich mein Passwort vergesse?</summary><p>Du kannst es mit den hinterlegten Daten sicher zurÃ¼cksetzen.</p></details>
        <details><summary>âš–ï¸ Ist das alles legal?</summary><p>Ja. Trustyfy arbeitet reguliert, du nutzt lediglich dein Recht auf finanzielle Selbstbestimmung.</p></details>
      </div>
    </div>

    <!-- ğŸš€ Ãœbergang zu Schritt 2 -->
    <div class="panel" style="text-align:center;">
      <h2 style="color:var(--gold);margin-bottom:14px;">ğŸš€ Weiter zum nÃ¤chsten Schritt</h2>
      <p style="color:var(--muted);max-width:800px;margin:0 auto 20px;font-size:1.05rem;line-height:1.6;">
        Du hast Schritt 1 erfolgreich abgeschlossen und die Grundlage gelegt.<br/>
        Im nÃ¤chsten Schritt geht es darum, dein Wissen in konkrete Praxis umzusetzen â€” bewusst, souverÃ¤n und mit System.
      </p>
      <a class="btn btn-primary" href="https://adler-fsa.github.io/lp-anfang/steps/krypto-step2.html" style="font-size:1.1rem;">
        ğŸ‘‰ Zu Schritt 2 wechseln
      </a>
    </div>
  </div>

<!-- â–‘â–‘ Globale Bausteine (Top-MenÃ¼, Sprache, Musik) â–‘â–‘ -->
<script src="/lp-anfang/library/js/menu.js?v=20251109"></script>
<script src="/lp-anfang/library/js/lang-switcher.js?v=20251109"></script>
<script src="/lp-anfang/library/js/music-button.js?v=20251109"></script>
<script src="/lp-anfang/library/js/topbar-autohide.js?v=20251109"></script>

<!-- FSA Lang-Bridge: Datei-Paare DE/EN umschalten, ohne lang-switcher.js zu Ã¤ndern -->
<script>
(function () {
  const KEY='fsa_lang';
  const path=location.pathname;

  function counterpart(p,to){
    let m;
    m=p.match(/\/steps\/krypto-step(\d+)\.html$/);
    if(m && to==='en') return `/lp-anfang/steps/step${m[1]}-en.html`;
    m=p.match(/\/steps\/step(\d+)-en\.html$/);
    if(m && to==='de') return `/lp-anfang/steps/krypto-step${m[1]}.html`;
    if(p.endsWith('/lp-anfang/krypto.html') && to==='en') return '/lp-anfang/krypto-en.html';
    if(p.endsWith('/lp-anfang/krypto-en.html') && to==='de') return '/lp-anfang/krypto.html';
    return null;
  }

  function go(lang){
    const target = counterpart(path,(lang||'de').toLowerCase());
    if(target) location.assign(target+location.search+location.hash);
  }

  try{
    const pref=localStorage.getItem(KEY)||'de';
    const isEN=/-en\.html$/.test(path)||/krypto-en\.html$/.test(path);
    if((pref==='en' && !isEN) || (pref==='de' && isEN)) go(pref);
  }catch(e){}

  document.addEventListener('fsa:lang-change', ev => go(ev.detail || (localStorage.getItem(KEY)||'de')));
  window.addEventListener('storage', ev => { if(ev.key===KEY) go(ev.newValue); });
})();
</script>

<!-- ===== Slideshow ===== -->
<script>
(function(){
  const count = 29;
  const base = "/lp-anfang/krypto/images/slide-";
  const stage = document.getElementById('stage');
  const nav = document.getElementById('nav');
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const fallback = document.getElementById('fallback');

  const slides = [];
  for(let i=1;i<=count;i++){
    const n = String(i).padStart(2,'0');
    const img = document.createElement('img');
    img.loading = i<=2 ? "eager" : "lazy";
    img.src = `${base}${n}.jpg`;
    img.alt = `Slide ${i}`;
    img.className = 'slide' + (i===1 ? ' active':'');
    slides.push(img);
  }
  if(fallback){ fallback.remove(); }
  slides.forEach(s => stage.insertBefore(s, nav));

  const dots=[];
  slides.forEach((_,i)=>{
    const b=document.createElement('button');
    b.className='dot'+(i===0?' active':'');
    b.addEventListener('click',()=>show(i));
    nav.appendChild(b);
    dots.push(b);
  });

  let idx=0;
  function show(i){
    slides[idx].classList.remove('active');
    dots[idx].classList.remove('active');
    idx=(i+slides.length)%slides.length;
    slides[idx].classList.add('active');
    dots[idx].classList.add('active');
  }

  // ZÃ¤hler
  const counter=document.createElement('div');
  counter.style.cssText="position:absolute;bottom:20px;right:20px;padding:6px 10px;border-radius:8px;background:rgba(0,0,0,.6);color:#f2c94c;font-weight:600;font-size:14px;font-family:system-ui";
  stage.appendChild(counter);

  function updateCounter(){counter.textContent=`${idx+1} / ${slides.length}`;}
  updateCounter();

  prev.addEventListener('click',()=>{show(idx-1);updateCounter();});
  next.addEventListener('click',()=>{show(idx+1);updateCounter();});
  dots.forEach((d,i)=>d.addEventListener('click',()=>{show(i);updateCounter();}));
})();
</script>

<!-- ===== Affiliate-Flow (Trustyfy) ===== -->
<script>
(function(){
  const WHITELIST = ['app.trustyfy.com']; // nur diese Domain erlauben
  const KEY = 'trustyfy_affiliate_url';

  const ctaOpen    = document.getElementById('ctaOpen');
  const ctaShare   = document.getElementById('ctaShare');
  const affBar     = document.getElementById('affBar');
  const affInput   = document.getElementById('affInput');
  const affSave    = document.getElementById('affSaveOpen');
  const affCancel  = document.getElementById('affCancel');
  const affError   = document.getElementById('affError');
  const toast      = document.getElementById('toast');
  const tSaved     = document.getElementById('tSaved');
  const tCopied    = document.getElementById('tCopied');
  const tShared    = document.getElementById('tShared');
  const tReset     = document.getElementById('tReset');
  const tFromUrl   = document.getElementById('tFromUrl');
  const btnReset   = document.getElementById('affReset');

  function isValidUrl(u){
    try{
      const url = new URL(u);
      const okHost = WHITELIST.includes(url.hostname);
      const okProto = (url.protocol==='https:'||url.protocol==='http:');
      return okHost && okProto;
    }catch(e){ return false; }
  }
  function getSaved(){ try{return localStorage.getItem(KEY)||'';}catch(e){return '';} }
  function saveUrl(u){ try{ localStorage.setItem(KEY,u); }catch(e){} }
  function clearUrl(){ try{ localStorage.removeItem(KEY); }catch(e){} }

  function showToast(which){
    [tSaved,tCopied,tShared,tReset,tFromUrl].forEach(n=>n.style.display='none');
    if(which) which.style.display='inline';
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 1500);
  }

  function showAffBar(prefill){
    affInput.value = prefill || '';
    affBar.classList.add('open'); affBar.setAttribute('aria-hidden','false');
    document.body.style.overflow='hidden';
    affError.style.display='none';
    setTimeout(()=>{try{affInput.focus();affInput.select();}catch(e){}},10);
  }
  function hideAffBar(){
    affBar.classList.remove('open'); affBar.setAttribute('aria-hidden','true');
    document.body.style.overflow='';
    affError.style.display='none';
  }

  // Ã–ffnen (bestehenden Link nutzen)
  ctaOpen.addEventListener('click', (e)=>{
    const link = getSaved();
    if(!isValidUrl(link)){ e.preventDefault(); showAffBar(link); return; }
    // Wenn Link vorhanden -> in neuem Tab Ã¶ffnen (Partner kann dort E-Mail eintragen)
    window.open(link, '_blank', 'noopener');
    // kein Toast nÃ¶tig
  });

  // Teilen/Kopieren
  ctaShare.addEventListener('click', async ()=>{
    const link = getSaved();
    if(!isValidUrl(link)){ showAffBar(link); return; }
    try{
      if(navigator.share){
        await navigator.share({title:'trustyfy â€“ Empfehlung', text:'Hier ist mein trustyfy-Link:', url:link});
        showToast(tShared);
      }else if(navigator.clipboard && navigator.clipboard.writeText){
        await navigator.clipboard.writeText(link); showToast(tCopied);
      }else{
        const ta=document.createElement('textarea'); ta.value=link; ta.style.position='fixed'; ta.style.top='-2000px';
        document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        showToast(tCopied);
      }
    }catch(e){
      // Bei Abbruch nichts tun
    }
  });

  // Speichern / Abbrechen
  affSave.addEventListener('click', ()=>{
    const val = (affInput.value||'').trim();
    if(!isValidUrl(val)){ affError.style.display='block'; return; }
    saveUrl(val); hideAffBar(); showToast(tSaved);
  });
  affCancel.addEventListener('click', hideAffBar);
  window.addEventListener('keydown', e=>{ if(e.key==='Escape' && affBar.classList.contains('open')) hideAffBar(); });

  // Reset
  btnReset.addEventListener('click', ()=>{
    clearUrl(); showAffBar(''); showToast(tReset);
  });

  // Prefill via ?aff=
  (function(){
    const q=new URLSearchParams(location.search);
    const aff=q.get('aff');
    if(!aff) return;
    const candidate = aff.trim();
    if(isValidUrl(candidate)){ saveUrl(candidate); showToast(tFromUrl); }
    else{ showAffBar(candidate); }
  })();
})();
</script>
</body>
</html>
